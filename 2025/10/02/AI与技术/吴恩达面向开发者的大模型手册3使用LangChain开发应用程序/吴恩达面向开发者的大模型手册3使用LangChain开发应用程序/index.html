

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">

  <link rel="apple-touch-icon" sizes="76x76" href="/images/avatar.jpg">
  <link rel="icon" href="/images/avatar.jpg">
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Peng Yue">
  <meta name="keywords" content="Axure/Figmaã€Xmindã€SQLã€Python/Javaã€Gitã€Visioã€Tableauã€Cursorã€Geminiã€Prompt Engineeringã€Difyã€Cozeã€agent">
  
    <meta name="description" content="ç¬¬ä¸‰éƒ¨åˆ† ä½¿ç”¨LangChainå¼€å‘åº”ç”¨ç¨‹åºè¿™é‡Œæˆ‘å¼€å§‹ä½¿ç”¨å…è´¹çš„åƒé—®æ¨¡å‹ï¼Œæ›´æ”¹.envçš„api tool.py: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576">
<meta property="og:type" content="article">
<meta property="og:title" content="å´æ©è¾¾é¢å‘å¼€å‘è€…çš„å¤§æ¨¡å‹æ‰‹å†Œ3ä½¿ç”¨LangChainå¼€å‘åº”ç”¨ç¨‹åº">
<meta property="og:url" content="https://py0909.github.io/2025/10/02/AI%E4%B8%8E%E6%8A%80%E6%9C%AF/%E5%90%B4%E6%81%A9%E8%BE%BE%E9%9D%A2%E5%90%91%E5%BC%80%E5%8F%91%E8%80%85%E7%9A%84%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%89%8B%E5%86%8C3%E4%BD%BF%E7%94%A8LangChain%E5%BC%80%E5%8F%91%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/%E5%90%B4%E6%81%A9%E8%BE%BE%E9%9D%A2%E5%90%91%E5%BC%80%E5%8F%91%E8%80%85%E7%9A%84%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%89%8B%E5%86%8C3%E4%BD%BF%E7%94%A8LangChain%E5%BC%80%E5%8F%91%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/index.html">
<meta property="og:site_name" content="Peng Yueçš„äº§å“æ€è€ƒåšå®¢">
<meta property="og:description" content="ç¬¬ä¸‰éƒ¨åˆ† ä½¿ç”¨LangChainå¼€å‘åº”ç”¨ç¨‹åºè¿™é‡Œæˆ‘å¼€å§‹ä½¿ç”¨å…è´¹çš„åƒé—®æ¨¡å‹ï¼Œæ›´æ”¹.envçš„api tool.py: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://py0909.github.io/llmcookbook.jpg">
<meta property="article:published_time" content="2025-10-01T16:00:00.000Z">
<meta property="article:modified_time" content="2025-12-23T15:20:22.912Z">
<meta property="article:author" content="Peng Yue">
<meta property="article:tag" content="Prompt">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://py0909.github.io/llmcookbook.jpg">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>å´æ©è¾¾é¢å‘å¼€å‘è€…çš„å¤§æ¨¡å‹æ‰‹å†Œ3ä½¿ç”¨LangChainå¼€å‘åº”ç”¨ç¨‹åº - Peng Yueçš„äº§å“æ€è€ƒåšå®¢</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css">



<link rel="stylesheet" href="//at.alicdn.com/t/c/font_1736178_k526ubmyhba.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"py0909.github.io","root":"/","version":"1.9.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false},"umami":{"src":null,"website_id":null,"domains":null,"start_time":"2024-01-01T00:00:00.000Z","token":null,"api_server":null}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Peng Yueçš„äº§å“ç¬”è®°</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>é¦–é¡µ</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/%E9%A1%B9%E7%9B%AE%E5%A4%8D%E7%9B%98/" target="_self">
                <i class="iconfont icon-ppt"></i>
                <span>é¡¹ç›®å¤ç›˜</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/AI%E4%B8%8E%E6%8A%80%E6%9C%AF/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>AIæ¢ç´¢</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/%E4%BA%A7%E5%93%81%E6%8B%86%E8%A7%A3/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>äº§å“æ‹†è§£</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/%E6%96%B9%E6%B3%95%E8%AE%BA/" target="_self">
                <i class="iconfont icon-book-fill"></i>
                <span>æ–¹æ³•è®º</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/%E5%8E%9F%E5%9E%8B%E8%AE%BE%E8%AE%A1/" target="_self">
                <i class="iconfont icon-pen"></i>
                <span>åŸå‹è®¾è®¡</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>å½’æ¡£</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>å…³äº</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/llmcookbook.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="å´æ©è¾¾é¢å‘å¼€å‘è€…çš„å¤§æ¨¡å‹æ‰‹å†Œ3ä½¿ç”¨LangChainå¼€å‘åº”ç”¨ç¨‹åº"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        Peng Yue
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2025-10-02 00:00" pubdate>
          2025å¹´10æœˆ2æ—¥ å‡Œæ™¨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          231k å­—
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          1926 åˆ†é’Ÿ
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> æ¬¡
        </span>
        

      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">å´æ©è¾¾é¢å‘å¼€å‘è€…çš„å¤§æ¨¡å‹æ‰‹å†Œ3ä½¿ç”¨LangChainå¼€å‘åº”ç”¨ç¨‹åº</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="ç¬¬ä¸‰éƒ¨åˆ†-ä½¿ç”¨LangChainå¼€å‘åº”ç”¨ç¨‹åº"><a href="#ç¬¬ä¸‰éƒ¨åˆ†-ä½¿ç”¨LangChainå¼€å‘åº”ç”¨ç¨‹åº" class="headerlink" title="ç¬¬ä¸‰éƒ¨åˆ† ä½¿ç”¨LangChainå¼€å‘åº”ç”¨ç¨‹åº"></a>ç¬¬ä¸‰éƒ¨åˆ† ä½¿ç”¨LangChainå¼€å‘åº”ç”¨ç¨‹åº</h1><p>è¿™é‡Œæˆ‘å¼€å§‹ä½¿ç”¨å…è´¹çš„åƒé—®æ¨¡å‹ï¼Œæ›´æ”¹.envçš„api</p>
<p>tool.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> openai <span class="hljs-keyword">import</span> OpenAI<br><span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv, find_dotenv<br><br><span class="hljs-comment"># è¯»å–æœ¬åœ°/é¡¹ç›®çš„ç¯å¢ƒå˜é‡ã€‚</span><br><br><span class="hljs-comment"># find_dotenv()å¯»æ‰¾å¹¶å®šä½.envæ–‡ä»¶çš„è·¯å¾„</span><br><span class="hljs-comment"># load_dotenv()è¯»å–è¯¥.envæ–‡ä»¶ï¼Œå¹¶å°†å…¶ä¸­çš„ç¯å¢ƒå˜é‡åŠ è½½åˆ°å½“å‰çš„è¿è¡Œç¯å¢ƒä¸­  </span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_openai_key</span>():<br>    <span class="hljs-comment"># è‡ªåŠ¨æŸ¥æ‰¾å¹¶åŠ è½½å½“å‰ç›®å½•/çˆ¶ç›®å½•ä¸‹çš„.envæ–‡ä»¶</span><br>    _ = load_dotenv(find_dotenv())<br>    <span class="hljs-comment"># è¿”å›ç¯å¢ƒå˜é‡ä¸­çš„OPENAI_API_KEYï¼ˆè‹¥ä¸å­˜åœ¨ä¼šæŠ›å‡ºKeyErrorï¼Œæç¤ºé…ç½®ç¼ºå¤±ï¼‰</span><br>    <span class="hljs-keyword">return</span> os.environ[<span class="hljs-string">&#x27;OPENAI_API_KEY&#x27;</span>]<br><br>client = OpenAI(<br>    <span class="hljs-comment"># This is the default and can be omitted</span><br>    api_key=get_openai_key(),  <br>)<br><br><span class="hljs-comment"># å•è½®èŠå¤©</span><br><span class="hljs-comment"># ä¸€ä¸ªå°è£… OpenAI æ¥å£çš„å‡½æ•°ï¼Œå‚æ•°ä¸º Promptï¼Œè¿”å›å¯¹åº”ç»“æœ</span><br><span class="hljs-comment"># é€‚ç”¨äºå•è½®å¯¹è¯ã€‚æˆ‘ä»¬å°† Prompt æ”¾å…¥æŸç§ç±»ä¼¼ç”¨æˆ·æ¶ˆæ¯çš„å¯¹è¯æ¡†ä¸­ã€‚</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_completion</span>(<span class="hljs-params">prompt, model=<span class="hljs-string">&quot;gpt-4o-mini&quot;</span></span>):<br>    <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    prompt: å¯¹åº”çš„æç¤ºè¯</span><br><span class="hljs-string">    model: è°ƒç”¨çš„æ¨¡å‹</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br>    messages = [&#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: prompt&#125;]<br>    response = client.chat.completions.create(<br>        model=model,<br>        messages=messages,<br>        temperature=<span class="hljs-number">0</span>, <span class="hljs-comment"># æ¨¡å‹è¾“å‡ºçš„æ¸©åº¦ç³»æ•°ï¼Œæ§åˆ¶è¾“å‡ºçš„éšæœºç¨‹åº¦</span><br>        max_tokens=<span class="hljs-number">500</span><br>    )<br>    <span class="hljs-comment"># è°ƒç”¨ OpenAI çš„ ChatCompletion æ¥å£</span><br>    <span class="hljs-keyword">return</span> response.choices[<span class="hljs-number">0</span>].message.content.strip()<br><br><span class="hljs-comment">#å¤šè½®èŠå¤©</span><br><span class="hljs-comment"># ä¼ å…¥ä¸€ä¸ªæ¶ˆæ¯åˆ—è¡¨ã€‚è¿™äº›æ¶ˆæ¯å¯ä»¥æ¥è‡ªå¤§é‡ä¸åŒçš„è§’è‰² (roles) ï¼Œæˆ‘ä»¬ä¼šæè¿°ä¸€ä¸‹è¿™äº›è§’è‰²ã€‚</span><br><span class="hljs-comment"># def get_completion_from_messages(messages, model=&quot;gpt-4o-mini&quot;, temperature=0):</span><br><span class="hljs-comment">#     response = client.chat.completions.create(</span><br><span class="hljs-comment">#         model=model,</span><br><span class="hljs-comment">#         messages=messages,</span><br><span class="hljs-comment">#         temperature=temperature, # æ§åˆ¶æ¨¡å‹è¾“å‡ºçš„éšæœºç¨‹åº¦</span><br><span class="hljs-comment">#     )</span><br><span class="hljs-comment"># #     print(str(response.choices[0].message))</span><br><span class="hljs-comment">#     return response.choices[0].message.content.strip()</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_completion_from_messages</span>(<span class="hljs-params">messages, </span><br><span class="hljs-params">                                 model=<span class="hljs-string">&quot;gpt-4o-mini&quot;</span>, </span><br><span class="hljs-params">                                 temperature=<span class="hljs-number">0</span>, </span><br><span class="hljs-params">                                 max_tokens=<span class="hljs-number">500</span></span>):<br>    <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    å°è£…ä¸€ä¸ªæ”¯æŒæ›´å¤šå‚æ•°çš„è‡ªå®šä¹‰è®¿é—® OpenAI GPT4 çš„å‡½æ•°</span><br><span class="hljs-string"></span><br><span class="hljs-string">    å‚æ•°: </span><br><span class="hljs-string">    messages: è¿™æ˜¯ä¸€ä¸ªæ¶ˆæ¯åˆ—è¡¨ï¼Œæ¯ä¸ªæ¶ˆæ¯éƒ½æ˜¯ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å« role(è§’è‰²ï¼‰å’Œ content(å†…å®¹)ã€‚è§’è‰²å¯ä»¥æ˜¯&#x27;system&#x27;ã€&#x27;user&#x27; æˆ– &#x27;assistantâ€™ï¼Œå†…å®¹æ˜¯è§’è‰²çš„æ¶ˆæ¯ã€‚</span><br><span class="hljs-string">    model: è°ƒç”¨çš„æ¨¡å‹ï¼Œé»˜è®¤ä¸º gpt-4o-mini(ChatGPT)ï¼Œæœ‰å†…æµ‹èµ„æ ¼çš„ç”¨æˆ·å¯ä»¥é€‰æ‹© gpt-4</span><br><span class="hljs-string">    temperature: è¿™å†³å®šæ¨¡å‹è¾“å‡ºçš„éšæœºç¨‹åº¦ï¼Œé»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºè¾“å‡ºå°†éå¸¸ç¡®å®šã€‚å¢åŠ æ¸©åº¦ä¼šä½¿è¾“å‡ºæ›´éšæœºã€‚</span><br><span class="hljs-string">    max_tokens: è¿™å†³å®šæ¨¡å‹è¾“å‡ºçš„æœ€å¤§çš„ token æ•°ã€‚</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br>    response = client.chat.completions.create(<br>        model=model,<br>        messages=messages,<br>        temperature=temperature, <span class="hljs-comment"># è¿™å†³å®šæ¨¡å‹è¾“å‡ºçš„éšæœºç¨‹åº¦</span><br>        max_tokens=max_tokens, <span class="hljs-comment"># è¿™å†³å®šæ¨¡å‹è¾“å‡ºçš„æœ€å¤§çš„ token æ•°</span><br>    )<br>    <span class="hljs-keyword">return</span> response.choices[<span class="hljs-number">0</span>].message.content.strip()<br><br><span class="hljs-comment"># å®ç°äº†è°ƒç”¨ OpenAI çš„ æ¨¡å‹ç”ŸæˆèŠå¤©å›å¤ï¼Œ å¹¶è¿”å›ç”Ÿæˆçš„å›å¤å†…å®¹ä»¥åŠä½¿ç”¨çš„ token æ•°é‡ã€‚</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_completion_and_token_count</span>(<span class="hljs-params">messages, </span><br><span class="hljs-params">                                   model=<span class="hljs-string">&quot;gpt-4o-mini&quot;</span>, </span><br><span class="hljs-params">                                   temperature=<span class="hljs-number">0</span>, </span><br><span class="hljs-params">                                   max_tokens=<span class="hljs-number">500</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    ä½¿ç”¨ OpenAI çš„ GPT-4 æ¨¡å‹ç”ŸæˆèŠå¤©å›å¤ï¼Œå¹¶è¿”å›ç”Ÿæˆçš„å›å¤å†…å®¹ä»¥åŠä½¿ç”¨çš„ token æ•°é‡ã€‚</span><br><span class="hljs-string"></span><br><span class="hljs-string">    å‚æ•°:</span><br><span class="hljs-string">    messages: èŠå¤©æ¶ˆæ¯åˆ—è¡¨ã€‚</span><br><span class="hljs-string">    model: ä½¿ç”¨çš„æ¨¡å‹åç§°ã€‚é»˜è®¤ä¸º&quot;gpt-4o-mini&quot;ã€‚</span><br><span class="hljs-string">    temperature: æ§åˆ¶ç”Ÿæˆå›å¤çš„éšæœºæ€§ã€‚å€¼è¶Šå¤§ï¼Œç”Ÿæˆçš„å›å¤è¶Šéšæœºã€‚é»˜è®¤ä¸º 0ã€‚</span><br><span class="hljs-string">    max_tokens: ç”Ÿæˆå›å¤çš„æœ€å¤§ token æ•°é‡ã€‚é»˜è®¤ä¸º 500ã€‚</span><br><span class="hljs-string"></span><br><span class="hljs-string">    è¿”å›:</span><br><span class="hljs-string">    content: ç”Ÿæˆçš„å›å¤å†…å®¹ã€‚</span><br><span class="hljs-string">    token_dict: åŒ…å«&#x27;prompt_tokens&#x27;ã€&#x27;completion_tokens&#x27;å’Œ&#x27;total_tokens&#x27;çš„å­—å…¸ï¼Œåˆ†åˆ«è¡¨ç¤ºæç¤ºçš„ token æ•°é‡ã€ç”Ÿæˆçš„å›å¤çš„ token æ•°é‡å’Œæ€»çš„ token æ•°é‡ã€‚</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    response = client.chat.completions.create(<br>        model=model,<br>        messages=messages,<br>        temperature=temperature, <br>        max_tokens=max_tokens,<br>    )<br><br>    content = response.choices[<span class="hljs-number">0</span>].message.content.strip()<br>    <br>    token_dict = &#123;<br>        <span class="hljs-string">&#x27;prompt_tokens&#x27;</span>: response.usage.prompt_tokens,<br>        <span class="hljs-string">&#x27;completion_tokens&#x27;</span>: response.usage.completion_tokens,<br>        <span class="hljs-string">&#x27;total_tokens&#x27;</span>: response.usage.total_tokens,<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> content, token_dict<br><br><br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_moderation_with_retry</span>(<span class="hljs-params">input_text, max_retries=<span class="hljs-number">3</span>, initial_delay=<span class="hljs-number">1</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    ä½¿ç”¨OpenAIçš„å®¡æ ¸APIæ£€æŸ¥æ–‡æœ¬å†…å®¹ï¼Œå¸¦æœ‰é‡è¯•æœºåˆ¶</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    å‚æ•°:</span><br><span class="hljs-string">    input_text: è¦å®¡æ ¸çš„æ–‡æœ¬</span><br><span class="hljs-string">    max_retries: æœ€å¤§é‡è¯•æ¬¡æ•°</span><br><span class="hljs-string">    initial_delay: åˆå§‹å»¶è¿Ÿæ—¶é—´ï¼ˆç§’ï¼‰</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    è¿”å›:</span><br><span class="hljs-string">    å®¡æ ¸ç»“æœ</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    retries = <span class="hljs-number">0</span><br>    delay = initial_delay<br>    <br>    <span class="hljs-keyword">while</span> retries &lt; max_retries:<br>        <span class="hljs-keyword">try</span>:<br>            response = client.moderations.create(<span class="hljs-built_in">input</span>=input_text)<br>            <span class="hljs-keyword">return</span> response.results[<span class="hljs-number">0</span>]<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;rate limit&quot;</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">str</span>(e).lower() <span class="hljs-keyword">and</span> retries &lt; max_retries - <span class="hljs-number">1</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;é‡åˆ°é€Ÿç‡é™åˆ¶ï¼Œ<span class="hljs-subst">&#123;delay&#125;</span>ç§’åé‡è¯•...&quot;</span>)<br>                time.sleep(delay)<br>                retries += <span class="hljs-number">1</span><br>                delay *= <span class="hljs-number">2</span>  <span class="hljs-comment"># æŒ‡æ•°é€€é¿</span><br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">raise</span> e<br>    <br>    <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&quot;è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œè¯·æ±‚å¤±è´¥&quot;</span>)<br><br><span class="hljs-keyword">def</span>  <span class="hljs-title function_">get_moderation</span>(<span class="hljs-params">input_text</span>):<br>    response = client.moderations.create(<span class="hljs-built_in">input</span>=input_text)<br>    <span class="hljs-keyword">return</span> response.results[<span class="hljs-number">0</span>]<br><br><br><br><br><br><span class="hljs-comment">######################################</span><br><span class="hljs-comment"># ä»¥ä¸‹æ˜¯langchainçš„å°è£…ä»£ç </span><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv, find_dotenv<br><span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_chat_model</span>(<span class="hljs-params">temperature=<span class="hljs-number">0.0</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    åŠ è½½ç¯å¢ƒå¹¶è¿”å›ä¸€ä¸ªé…ç½®å¥½çš„ ChatOpenAI å¯¹è±¡</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 1. åŠ è½½ç¯å¢ƒ</span><br>    _ = load_dotenv(find_dotenv())<br>    <br>    <span class="hljs-comment"># 2. æ£€æŸ¥ Key (å¢åŠ ä¸€ç‚¹é”™è¯¯å¤„ç†)</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.environ.get(<span class="hljs-string">&quot;OPENAI_API_KEY&quot;</span>):<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;âŒ é”™è¯¯: æœªæ‰¾åˆ° OPENAI_API_KEYï¼Œè¯·æ£€æŸ¥ .env æ–‡ä»¶ã€‚&quot;</span>)<br><br>    <span class="hljs-comment"># 3. è¿”å›å¯¹è±¡</span><br>    <span class="hljs-keyword">return</span> ChatOpenAI(temperature=temperature)<br><br><br><span class="hljs-comment">###################################### </span><br><span class="hljs-comment"># ä¸Šé¢çš„ä¹‹å‰çš„apiç”¨æ²¡äº†ï¼Œé‡æ–°ç”¨ç¡…åŸºæµåŠ¨çš„å…è´¹api</span><br><span class="hljs-comment"># ç”¨äºå°è£…æ¨¡å‹çš„åˆå§‹åŒ–è¿‡ç¨‹</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_chat_model2</span>(<span class="hljs-params">temperature=<span class="hljs-number">0.0</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    åŠ è½½ç¯å¢ƒå¹¶è¿”å›ä¸€ä¸ªé…ç½®å¥½çš„ ChatOpenAI å¯¹è±¡</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 1. åŠ è½½ç¯å¢ƒ</span><br>    _ = load_dotenv(find_dotenv())<br>    <br>    <span class="hljs-comment"># 2. æ£€æŸ¥ Key (å¢åŠ ä¸€ç‚¹é”™è¯¯å¤„ç†)</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.environ.get(<span class="hljs-string">&quot;OPENAI_API_KEY&quot;</span>):<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;âŒ é”™è¯¯: æœªæ‰¾åˆ° OPENAI_API_KEYï¼Œè¯·æ£€æŸ¥ .env æ–‡ä»¶ã€‚&quot;</span>)<br><br>    <span class="hljs-comment"># å…³é”®ï¼šä¿®æ”¹ base_url å‘Šè¯‰ LangChainæŒ‡å‘ç¡…åŸºæµåŠ¨ï¼Œè€Œä¸æ˜¯ OpenAI</span><br>    <span class="hljs-comment"># model å‚æ•°æ¢æˆå…è´¹æ¨¡å‹ï¼Œä¾‹å¦‚ &#x27;Qwen/Qwen2.5-7B-Instruct&#x27; æˆ– &#x27;deepseek-ai/DeepSeek-V2.5&#x27;</span><br>    chat = ChatOpenAI(<br>        base_url=<span class="hljs-string">&quot;https://api.siliconflow.cn/v1&quot;</span>,<br>        model=<span class="hljs-string">&quot;Qwen/Qwen2.5-7B-Instruct&quot;</span>, <br>        temperature=<span class="hljs-number">0.0</span>,<br>        tiktoken_model_name=<span class="hljs-string">&quot;gpt-4&quot;</span><br>    )<br>    <span class="hljs-comment"># è¿”å›langchainåº“ä¸­çš„ä¸€ä¸ªchatopenaiå¯¹è±¡å®ä¾‹ï¼Œä»¥ä¾¿åœ¨å¤–éƒ¨ä½¿ç”¨</span><br>    <span class="hljs-keyword">return</span> chat<br><br><br><span class="hljs-comment"># 2.1 åˆå§‹åŒ– Embedding æ¨¡å‹</span><br><span class="hljs-comment"># æ–‡ä»¶å: tool.py</span><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> lru_cache<br><span class="hljs-keyword">from</span> langchain_huggingface <span class="hljs-keyword">import</span> HuggingFaceEmbeddings<br><br><span class="hljs-comment"># --- é…ç½®é¡¹ ---</span><br><span class="hljs-comment"># 1. å¼ºåˆ¶ä½¿ç”¨ HuggingFace å›½å†…é•œåƒï¼Œè§£å†³å›½å†…ç½‘ç»œæ— æ³•ä¸‹è½½æ¨¡å‹çš„é—®é¢˜</span><br>os.environ[<span class="hljs-string">&#x27;HF_ENDPOINT&#x27;</span>] = <span class="hljs-string">&#x27;https://hf-mirror.com&#x27;</span><br><br><span class="hljs-comment"># 2. å¿½ç•¥ä¸€äº›æ— å…³ç´§è¦çš„è­¦å‘Šä¿¡æ¯</span><br>os.environ[<span class="hljs-string">&quot;TOKENIZERS_PARALLELISM&quot;</span>] = <span class="hljs-string">&quot;false&quot;</span><br><br><span class="hljs-comment"># æœªä¸‹è½½æ—¶ä½¿ç”¨æ­¤æ–¹æ³•</span><br><span class="hljs-meta">@lru_cache(<span class="hljs-params">maxsize=<span class="hljs-number">1</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_embedding_model1</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    åˆå§‹åŒ–å¹¶è¿”å› Embedding æ¨¡å‹ (å•ä¾‹æ¨¡å¼)ã€‚</span><br><span class="hljs-string">    ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶ä¼šä¸‹è½½/åŠ è½½æ¨¡å‹ï¼Œåç»­è°ƒç”¨ç›´æ¥è¿”å›å·²åŠ è½½çš„å¯¹è±¡ã€‚</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ğŸ”„ æ­£åœ¨åˆå§‹åŒ– Embedding æ¨¡å‹ (CPUæ¨¡å¼)ï¼Œé¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨ä¸‹è½½çº¦ 400MB æ–‡ä»¶...&quot;</span>)<br>    <br>    <span class="hljs-comment"># æŒ‡å®šæ¨¡å‹åç§° (ä¸­æ–‡æ•ˆæœå¾ˆå¥½çš„å°æ¨¡å‹)</span><br>    model_name = <span class="hljs-string">&quot;BAAI/bge-base-zh-v1.5&quot;</span><br>    <br>    <span class="hljs-comment"># å¼ºåˆ¶ä½¿ç”¨ CPU</span><br>    model_kwargs = &#123;<span class="hljs-string">&#x27;device&#x27;</span>: <span class="hljs-string">&#x27;cpu&#x27;</span>&#125;<br>    <br>    <span class="hljs-comment"># å¼€å¯å‘é‡å½’ä¸€åŒ– (å¯¹è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦å¾ˆé‡è¦)</span><br>    encode_kwargs = &#123;<span class="hljs-string">&#x27;normalize_embeddings&#x27;</span>: <span class="hljs-literal">True</span>&#125;<br>    <br>    <span class="hljs-keyword">try</span>:<br>        embeddings = HuggingFaceEmbeddings(<br>            model_name=model_name,<br>            model_kwargs=model_kwargs,<br>            encode_kwargs=encode_kwargs<br>        )<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;âœ… Embedding æ¨¡å‹åŠ è½½å®Œæˆï¼&quot;</span>)<br>        <span class="hljs-keyword">return</span> embeddings<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âŒ æ¨¡å‹åŠ è½½å¤±è´¥: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å»ºè®®æ£€æŸ¥ç½‘ç»œï¼Œæˆ–å°è¯•æ‰‹åŠ¨ä¸‹è½½æ¨¡å‹ã€‚&quot;</span>)<br>        <span class="hljs-keyword">raise</span> e<br><br><span class="hljs-comment"># å·²ç»ä¸‹è½½äº†ï¼Œç›´æ¥åŠ è½½æœ¬åœ°</span><br><span class="hljs-meta">@lru_cache(<span class="hljs-params">maxsize=<span class="hljs-number">1</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_embedding_model</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    ç›´æ¥åŠ è½½æœ¬åœ°ç¼“å­˜çš„ BAAI/bge-base-zh-v1.5 æ¨¡å‹</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 1. æŒ‡å®šæ¨¡å‹ ID (åº“ä¼šè‡ªåŠ¨å» ~/.cache/huggingface/hub æ‰¾å¯¹åº”çš„æ–‡ä»¶å¤¹)</span><br>    model_name = <span class="hljs-string">&quot;BAAI/bge-base-zh-v1.5&quot;</span><br><br>    <span class="hljs-comment"># 2. å…³é”®é…ç½®</span><br>    model_kwargs = &#123;<br>        <span class="hljs-string">&#x27;device&#x27;</span>: <span class="hljs-string">&#x27;cpu&#x27;</span>,           <span class="hljs-comment"># å¼ºåˆ¶ä½¿ç”¨ CPU</span><br>        <span class="hljs-string">&#x27;trust_remote_code&#x27;</span>: <span class="hljs-literal">True</span>, <span class="hljs-comment"># å…è®¸è¿è¡Œæ¨¡å‹è‡ªå®šä¹‰ä»£ç ï¼ˆéƒ¨åˆ†æ¨¡å‹éœ€è¦ï¼‰</span><br>    &#125;<br><br>    <span class="hljs-comment"># 3. ç¼–ç é…ç½®</span><br>    encode_kwargs = &#123;<br>        <span class="hljs-string">&#x27;normalize_embeddings&#x27;</span>: <span class="hljs-literal">True</span> <span class="hljs-comment"># å¼€å¯å½’ä¸€åŒ–ï¼Œè¿™å¯¹ RAG æ£€ç´¢å‡†ç¡®ç‡å¾ˆé‡è¦</span><br>    &#125;<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ğŸš€ æ­£åœ¨ä»æœ¬åœ°ç¼“å­˜åŠ è½½æ¨¡å‹: <span class="hljs-subst">&#123;model_name&#125;</span> ...&quot;</span>)<br><br>    <span class="hljs-keyword">try</span>:<br>        embeddings = HuggingFaceEmbeddings(<br>            model_name=model_name,<br>            model_kwargs=model_kwargs,<br>            encode_kwargs=encode_kwargs,<br>            <span class="hljs-comment"># è¿™æ˜¯ä¸€ä¸ªä¿é™©å‚æ•°ï¼Œå‘Šè¯‰åº“â€œåªåœ¨æœ¬åœ°æ‰¾ï¼Œåˆ«è”ç½‘â€</span><br>            <span class="hljs-comment"># æ³¨æ„ï¼šæŸäº›æ—§ç‰ˆæœ¬ langchain å¯èƒ½ä¸ç›´æ¥æ”¯æŒæ­¤å‚æ•°ï¼Œå¦‚æœæŠ¥é”™è¯·åˆ é™¤ä¸‹é¢è¿™è¡Œ</span><br>            <span class="hljs-comment"># multi_process=False </span><br>        )<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;âœ… æ¨¡å‹åŠ è½½æˆåŠŸï¼&quot;</span>)<br>        <span class="hljs-keyword">return</span> embeddings<br>    <br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âŒ æ¨¡å‹åŠ è½½å‡ºé”™: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        <span class="hljs-comment"># å¦‚æœæ˜¯å› ä¸ºæ‰¾ä¸åˆ°æ–‡ä»¶ï¼Œå¯èƒ½æ˜¯æ–‡ä»¶å¤¹åå­—å¯¹ä¸ä¸Šï¼Œé€šå¸¸ä¸ä¼šå‘ç”Ÿ</span><br>        <span class="hljs-keyword">raise</span> e<br></code></pre></td></tr></table></figure>

<p>main.pyä¸‹è½½æ¨¡å‹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ–‡ä»¶å: main.py</span><br><span class="hljs-keyword">import</span> time<br><span class="hljs-comment"># ä» tool æ–‡ä»¶ä¸­å¯¼å…¥æ–¹æ³•</span><br><span class="hljs-keyword">from</span> tool <span class="hljs-keyword">import</span> get_embedding_model<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;--- ç¨‹åºå¼€å§‹ ---&quot;</span>)<br>    <br>    <span class="hljs-comment"># 1. è·å–æ¨¡å‹å®ä¾‹</span><br>    <span class="hljs-comment"># ç¬¬ä¸€æ¬¡è¿è¡Œè¿™è¡Œä»£ç æ—¶ï¼Œä¼šå»ä¸‹è½½æ¨¡å‹ï¼ˆå¦‚æœæœ¬åœ°æ²¡æœ‰ï¼‰å¹¶åŠ è½½è¿›å†…å­˜</span><br>    start_time = time.time()<br>    embeddings = get_embedding_model()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ç¬¬ä¸€æ¬¡è·å–æ¨¡å‹è€—æ—¶: <span class="hljs-subst">&#123;time.time() - start_time:<span class="hljs-number">.2</span>f&#125;</span> ç§’&quot;</span>)<br>    <br>    <span class="hljs-comment"># 2. æ¨¡æ‹Ÿåœ¨ä»£ç çš„å…¶ä»–åœ°æ–¹å†æ¬¡è°ƒç”¨</span><br>    <span class="hljs-comment"># ç”±äºåŠ äº†ç¼“å­˜ï¼Œè¿™æ¬¡ä¼šç¬é—´å®Œæˆï¼Œä¸ä¼šé‡æ–°å ç”¨å†…å­˜</span><br>    embeddings_copy = get_embedding_model()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç¬¬äºŒæ¬¡è·å–æ¨¡å‹å®ä¾‹ (éªŒè¯æ˜¯å¦ç¬é—´å®Œæˆ): å®Œæˆ&quot;</span>)<br><br>    <span class="hljs-comment"># 3. æµ‹è¯•å®é™…æ•ˆæœ</span><br>    test_text = <span class="hljs-string">&quot;æµ‹è¯•æ–‡æœ¬ï¼šLangChainæ˜¯ä¸€ä¸ªå¾ˆæ£’çš„æ¡†æ¶&quot;</span><br>    <br>    <span class="hljs-comment"># ç”Ÿæˆå‘é‡ (Embed Query)</span><br>    vector = embeddings.embed_query(test_text)<br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n--- æµ‹è¯•ç»“æœ ---&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;è¾“å…¥æ–‡æœ¬: <span class="hljs-subst">&#123;test_text&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ç”Ÿæˆå‘é‡é•¿åº¦: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(vector)&#125;</span> (ä¹Ÿå°±æ˜¯ 768 ç»´)&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å‘é‡å‰5ä½æ•°æ®: <span class="hljs-subst">&#123;vector[:<span class="hljs-number">5</span>]&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure>



<h2 id="ç¬¬ä¸€ç« ç®€ä»‹"><a href="#ç¬¬ä¸€ç« ç®€ä»‹" class="headerlink" title="ç¬¬ä¸€ç« ç®€ä»‹"></a>ç¬¬ä¸€ç« ç®€ä»‹</h2><p>LangChain æ˜¯ç”¨äºæ„å»ºå¤§æ¨¡å‹åº”ç”¨ç¨‹åºçš„å¼€æºæ¡†æ¶ï¼Œæœ‰Pythonå’ŒJavaScriptä¸¤ä¸ªä¸åŒç‰ˆæœ¬çš„åŒ…ã€‚LangChain ä¹Ÿæ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œç¤¾åŒºæ´»è·ƒï¼Œæ–°å¢åŠŸèƒ½å¿«é€Ÿè¿­ä»£ã€‚LangChainåŸºäºæ¨¡å—åŒ–ç»„åˆï¼Œæœ‰è®¸å¤šå•ç‹¬çš„ç»„ä»¶ï¼Œå¯ä»¥ä¸€èµ·ä½¿ç”¨æˆ–å•ç‹¬ä½¿ç”¨ã€‚</p>
<p>æœ¬æ¨¡å—å°†é‡ç‚¹ä»‹ç» LangChain çš„å¸¸ç”¨ç»„ä»¶ï¼š<br>1.æ¨¡å‹(Models)ï¼šé›†æˆå„ç§è¯­è¨€æ¨¡å‹ä¸å‘é‡æ¨¡å‹ã€‚<br>2.æç¤º(Prompts)ï¼šå‘æ¨¡å‹æä¾›æŒ‡ä»¤çš„é€”å¾„ã€‚<br>3.ç´¢å¼•(Indexes)ï¼šæä¾›æ•°æ®æ£€ç´¢åŠŸèƒ½ã€‚<br>4.é“¾(Chains)ï¼šå°†ç»„ä»¶ç»„åˆå®ç°ç«¯åˆ°ç«¯åº”ç”¨ã€‚<br>5.ä»£ç†(Agents)ï¼šæ‰©å±•æ¨¡å‹çš„æ¨ç†èƒ½åŠ›ã€‚</p>
<h2 id="ç¬¬äºŒç« -æ¨¡å‹ï¼Œæç¤ºå’Œè¾“å‡ºè§£é‡Šå™¨"><a href="#ç¬¬äºŒç« -æ¨¡å‹ï¼Œæç¤ºå’Œè¾“å‡ºè§£é‡Šå™¨" class="headerlink" title="ç¬¬äºŒç«  æ¨¡å‹ï¼Œæç¤ºå’Œè¾“å‡ºè§£é‡Šå™¨"></a>ç¬¬äºŒç«  æ¨¡å‹ï¼Œæç¤ºå’Œè¾“å‡ºè§£é‡Šå™¨</h2><h3 id="ä¸€ã€ç›´æ¥è°ƒç”¨OpenAPI"><a href="#ä¸€ã€ç›´æ¥è°ƒç”¨OpenAPI" class="headerlink" title="ä¸€ã€ç›´æ¥è°ƒç”¨OpenAPI"></a>ä¸€ã€ç›´æ¥è°ƒç”¨OpenAPI</h3><p>1.1è®¡ç®—1+1</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><span class="hljs-comment"># 3. å¤„ç†æ¨¡å—å¯¼å…¥ (ä¿æŒæ‚¨åŸæœ‰çš„é€»è¾‘)</span><br><span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;tool&#x27;</span> <span class="hljs-keyword">in</span> sys.modules:<br>    <span class="hljs-keyword">del</span> sys.modules[<span class="hljs-string">&#x27;tool&#x27;</span>]<br><span class="hljs-comment"># if &#x27;utils_zh&#x27; in sys.modules:</span><br><span class="hljs-comment">#     del sys.modules[&#x27;utils_zh&#x27;]</span><br><span class="hljs-comment"># é‡æ–°å¯¼å…¥æ¨¡å—</span><br>sys.path.append(<span class="hljs-string">&#x27;/home/py/shared/StudyChatgpt&#x27;</span>)<br><span class="hljs-keyword">from</span> tool <span class="hljs-keyword">import</span> get_completion<br><br>get_completion(<span class="hljs-string">&quot;1+1æ˜¯ä»€ä¹ˆï¼Ÿ&quot;</span>)<br><br></code></pre></td></tr></table></figure>




<pre><code class="hljs">&#39;1+1ç­‰äº2ã€‚&#39;
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 1.2 ç”¨æ™®é€šè¯è¡¨è¾¾æµ·ç›—é‚®ä»¶</span><br><span class="hljs-comment"># ä¸‹é¢æ˜¯ä¸€ä¸ªå®¢æˆ·çš„é£æ ¼è¿¥å¼‚çš„é‚®ä»¶</span><br>customer_email = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">å—¯å‘ï¼Œæˆ‘ç°åœ¨å¯æ˜¯ç«å†’ä¸‰ä¸ˆï¼Œæˆ‘é‚£ä¸ªæ…æ‹Œæœºç›–å­ç«Ÿç„¶é£äº†å‡ºå»ï¼ŒæŠŠæˆ‘å¨æˆ¿çš„å¢™å£éƒ½æº…ä¸Šäº†æœæ±ï¼</span><br><span class="hljs-string">æ›´ç³Ÿç³•çš„æ˜¯ï¼Œä¿ä¿®æ¡æ¬¾å¯ä¸åŒ…æ‹¬æ¸…ç†æˆ‘å¨æˆ¿çš„è´¹ç”¨ã€‚</span><br><span class="hljs-string">ä¼™è®¡ï¼Œèµ¶ç´§ç»™æˆ‘è¿‡æ¥ï¼</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-comment"># åœ¨å¤„ç†æ¥è‡ªå¤šå…ƒæ–‡åŒ–èƒŒæ™¯çš„é¡¾å®¢æ—¶ï¼Œæˆ‘ä»¬çš„å®¢æœå›¢é˜Ÿå¯èƒ½ä¼šé‡åˆ°æŸäº›ç‰¹æ®Šçš„è¯­è¨€éšœç¢ã€‚å¦‚ä¸Šï¼Œæˆ‘ä»¬æ”¶åˆ°äº†ä¸€åæµ·ç›—å®¢æˆ·çš„é‚®ä»¶ï¼Œè€Œä»–çš„è¡¨è¾¾æ–¹å¼å¯¹äºæˆ‘ä»¬çš„å®¢æœå›¢é˜Ÿæ¥è¯´ç•¥æ˜¾ç”Ÿæ¶©ã€‚</span><br><br><span class="hljs-comment"># ä¸ºäº†è§£å†³è¿™ä¸€æŒ‘æˆ˜ï¼Œæˆ‘ä»¬è®¾å®šäº†ä»¥ä¸‹ä¸¤ä¸ªç›®æ ‡ï¼š</span><br><br><span class="hljs-comment"># é¦–å…ˆï¼Œæˆ‘ä»¬å¸Œæœ›æ¨¡å‹èƒ½å¤Ÿå°†è¿™å°å……æ»¡æµ·ç›—æ–¹è¨€çš„é‚®ä»¶ç¿»è¯‘æˆæ™®é€šè¯ï¼Œè¿™æ ·å®¢æœå›¢é˜Ÿå°±èƒ½æ›´å®¹æ˜“åœ°ç†è§£å…¶å†…å®¹ã€‚</span><br><span class="hljs-comment"># å…¶æ¬¡ï¼Œåœ¨è¿›è¡Œç¿»è¯‘æ—¶ï¼Œæˆ‘ä»¬æœŸæœ›æ¨¡å‹èƒ½é‡‡ç”¨å¹³å’Œå’Œå°Šé‡çš„è¯­æ°”ï¼Œè¿™ä¸ä»…èƒ½ç¡®ä¿ä¿¡æ¯å‡†ç¡®ä¼ è¾¾ï¼Œè¿˜èƒ½ä¿æŒä¸é¡¾å®¢ä¹‹é—´çš„å’Œè°å…³ç³»ã€‚</span><br><span class="hljs-comment"># ä¸ºäº†æŒ‡å¯¼æ¨¡å‹çš„è¾“å‡ºï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæ–‡æœ¬è¡¨è¾¾é£æ ¼æ ‡ç­¾ï¼Œç®€ç§°ä¸ºstyleã€‚</span><br><span class="hljs-comment"># æ™®é€šè¯ + å¹³é™ã€å°Šæ•¬çš„è¯­è°ƒ</span><br>style = <span class="hljs-string">&quot;&quot;&quot;æ­£å¼æ™®é€šè¯ \</span><br><span class="hljs-string">ç”¨ä¸€ä¸ªå¹³é™ã€å°Šæ•¬ã€æœ‰ç¤¼è²Œçš„è¯­è°ƒ</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-comment"># å°†customer_emailå’Œstyleç»„åˆèµ·æ¥ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªåŒ…å«æŒ‡ä»¤çš„å®Œæ•´æç¤ºã€‚</span><br>prompt = <span class="hljs-string">f&quot;&quot;&quot;æŠŠç”±ä¸‰ä¸ªåå¼•å·åˆ†å‰²çš„æ–‡æœ¬\</span><br><span class="hljs-string">    ç¿»è¯‘æˆä¸€ç§<span class="hljs-subst">&#123;style&#125;</span>é£æ ¼ã€‚</span><br><span class="hljs-string">    æ–‡æœ¬ï¼š```<span class="hljs-subst">&#123;customer_email&#125;</span>```</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æç¤ºï¼š&quot;</span>,prompt)<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">æç¤ºï¼š æŠŠç”±ä¸‰ä¸ªåå¼•å·åˆ†å‰²çš„æ–‡æœ¬    ç¿»è¯‘æˆä¸€ç§æ­£å¼æ™®é€šè¯ ç”¨ä¸€ä¸ªå¹³é™ã€å°Šæ•¬ã€æœ‰ç¤¼è²Œçš„è¯­è°ƒ
é£æ ¼ã€‚
    æ–‡æœ¬ï¼š```
å—¯å‘ï¼Œæˆ‘ç°åœ¨å¯æ˜¯ç«å†’ä¸‰ä¸ˆï¼Œæˆ‘é‚£ä¸ªæ…æ‹Œæœºç›–å­ç«Ÿç„¶é£äº†å‡ºå»ï¼ŒæŠŠæˆ‘å¨æˆ¿çš„å¢™å£éƒ½æº…ä¸Šäº†æœæ±ï¼
æ›´ç³Ÿç³•çš„æ˜¯ï¼Œä¿ä¿®æ¡æ¬¾å¯ä¸åŒ…æ‹¬æ¸…ç†æˆ‘å¨æˆ¿çš„è´¹ç”¨ã€‚
ä¼™è®¡ï¼Œèµ¶ç´§ç»™æˆ‘è¿‡æ¥ï¼
<figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><br><br><br><br>```<span class="hljs-variable">python</span><br><span class="hljs-variable">response</span> = <span class="hljs-function"><span class="hljs-title">get_completion</span>(<span class="hljs-variable">prompt</span>)</span><br><span class="hljs-function"><span class="hljs-title">print</span>(<span class="hljs-variable">response</span>)</span><br><br></code></pre></td></tr></table></figure>

æˆ‘ç°åœ¨æ„Ÿåˆ°éå¸¸æ„¤æ€’ï¼Œå› ä¸ºæˆ‘çš„æ…æ‹Œæœºç›–å­æ„å¤–é£å‡ºï¼Œå¯¼è‡´æœæ±æº…åˆ°äº†å¨æˆ¿çš„å¢™å£ä¸Šã€‚æ›´ä»¤äººæ²®ä¸§çš„æ˜¯ï¼Œä¿ä¿®æ¡æ¬¾å¹¶ä¸æ¶µç›–æ¸…ç†å¨æˆ¿çš„è´¹ç”¨ã€‚è¯·æ‚¨å°½å¿«è¿‡æ¥å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚è°¢è°¢ï¼
</code></pre>
<h3 id="äºŒã€é€šè¿‡LangChainä½¿ç”¨OpenAI"><a href="#äºŒã€é€šè¿‡LangChainä½¿ç”¨OpenAI" class="headerlink" title="äºŒã€é€šè¿‡LangChainä½¿ç”¨OpenAI"></a>äºŒã€é€šè¿‡LangChainä½¿ç”¨OpenAI</h3><p>2.1æ¨¡å‹<br>Langchain<br>å®˜æ–¹æ–‡æ¡£(<a target="_blank" rel="noopener" href="https://python.langchain.com/en/latest/modules/models/chat/integrations.html)%E3%80%82">https://python.langchain.com/en/latest/modules/models/chat/integrations.html)ã€‚</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">%pip install -U langchain-community langchain-openai<br></code></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><span class="hljs-comment"># 3. å¤„ç†æ¨¡å—å¯¼å…¥ (ä¿æŒæ‚¨åŸæœ‰çš„é€»è¾‘)</span><br><span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;tool&#x27;</span> <span class="hljs-keyword">in</span> sys.modules:<br>    <span class="hljs-keyword">del</span> sys.modules[<span class="hljs-string">&#x27;tool&#x27;</span>]<br><span class="hljs-comment"># if &#x27;utils_zh&#x27; in sys.modules:</span><br><span class="hljs-comment">#     del sys.modules[&#x27;utils_zh&#x27;]</span><br><span class="hljs-comment"># é‡æ–°å¯¼å…¥æ¨¡å—</span><br>sys.path.append(<span class="hljs-string">&#x27;/home/py/shared/StudyChatgpt&#x27;</span>)<br><span class="hljs-keyword">from</span> tool <span class="hljs-keyword">import</span> get_chat_model2<br><br><span class="hljs-comment"># è¿™é‡Œæˆ‘ä»¬å°†å‚æ•°temperatureè®¾ç½®ä¸º0.0ï¼Œä»è€Œå‡å°‘ç”Ÿæˆç­”æ¡ˆçš„éšæœºæ€§ã€‚</span><br><span class="hljs-comment"># å¦‚æœä½ æƒ³è¦æ¯æ¬¡å¾—åˆ°ä¸ä¸€æ ·çš„æœ‰æ–°æ„çš„ç­”æ¡ˆï¼Œå¯ä»¥å°è¯•è°ƒæ•´è¯¥å‚æ•°ã€‚</span><br><span class="hljs-comment"># åˆå§‹åŒ–å¯¹è±¡ åªç”¨é…ç½®ä¸€æ¬¡</span><br>chat = get_chat_model2(temperature=<span class="hljs-number">0.0</span>)<br>chat<br><br></code></pre></td></tr></table></figure>




<pre><code class="hljs">ChatOpenAI(client=&lt;openai.resources.chat.completions.completions.Completions object at 0x79262ee24130&gt;, async_client=&lt;openai.resources.chat.completions.completions.AsyncCompletions object at 0x79262df57a60&gt;, root_client=&lt;openai.OpenAI object at 0x79262df7dfd0&gt;, root_async_client=&lt;openai.AsyncOpenAI object at 0x79262def8640&gt;, model_name=&#39;Qwen/Qwen2.5-7B-Instruct&#39;, temperature=0.0, model_kwargs=&#123;&#125;, openai_api_key=SecretStr(&#39;**********&#39;), openai_api_base=&#39;https://api.siliconflow.cn/v1&#39;)
</code></pre>
<p>ä¸Šé¢çš„è°ƒç”¨ï¼Œå¹¶ä¸æ˜¯æ¨¡å‹æœ¬èº«ï¼Œè¯¥æ¨¡å‹åœ¨ç¡…åŸºæµåŠ¨çš„æœåŠ¡å™¨ä¸Šï¼Œä½œç”¨æ˜¯å¸®ä½ å‘é€ç½‘ç»œè¯·æ±‚ã€‚å½“ä½ ç»™å®ƒå‘æ¶ˆæ¯æ—¶ï¼Œå¥¹å°±ä¼šæŠŠPythonå¯¹è±¡è½¬æ¢ä¸ºHTTPè¯·æ±‚å‘é€å‡ºå»ï¼Œæ”¶åˆ°å›å¤åå†è½¬å›Pythonå¯¹è±¡ç»™ä½ ã€‚<br>ChatOpenAI(client&#x3D;&lt;openai.resources.chat.completions.completions.Completions object at 0x7186a2fecdf0&gt;, async_client&#x3D;&lt;openai.resources.chat.completions.completions.AsyncCompletions object at 0x7186b0539a90&gt;, root_client&#x3D;&lt;openai.OpenAI object at 0x7186a2fec730&gt;, root_async_client&#x3D;&lt;openai.AsyncOpenAI object at 0x7186a2fecfd0&gt;, model_name&#x3D;â€™Qwen&#x2F;Qwen2.5-7B-Instructâ€™, temperature&#x3D;0.0, model_kwargs&#x3D;{}, openai_api_key&#x3D;SecretStr(â€˜**********â€™), openai_api_base&#x3D;â€™<a target="_blank" rel="noopener" href="https://api.siliconflow.cn/v1">https://api.siliconflow.cn/v1</a>â€˜)</p>
<p>2.2ä½¿ç”¨æç¤ºæ¨¡æ¿<br>2.2.1ç”¨æ™®é€šè¯æ¥è¡¨è¾¾æµ·ç›—é‚®ä»¶</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate<br><br><br><span class="hljs-comment"># é¦–å…ˆï¼Œæ„é€ ä¸€ä¸ªåŸå§‹çš„æç¤ºæ¨¡ç‰ˆå­—ç¬¦ä¸²ï¼š`template_string` </span><br><span class="hljs-comment"># å…¶ä¸­ &#123;style&#125; å’Œ &#123;text&#125; æ˜¯æŒ–å¥½çš„â€œå‘â€ï¼ˆå˜é‡å ä½ç¬¦ï¼‰ï¼Œç­‰å¾…åç»­å¡«å…¥</span><br>template_string = <span class="hljs-string">&quot;&quot;&quot;æŠŠç”±ä¸‰ä¸ªåå¼•å·åˆ†éš”çš„æ–‡æœ¬\</span><br><span class="hljs-string">ç¿»è¯‘æˆä¸€ç§&#123;style&#125;é£æ ¼ã€‚\</span><br><span class="hljs-string">æ–‡æœ¬: ```&#123;text&#125;```</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-comment"># 1.æ¨¡æ¿ï¼ˆtemplateï¼‰ ã€åƒä¸€ä¸ªå¡«ç©ºé¢˜ã€‘</span><br><span class="hljs-comment"># ç„¶åï¼Œæˆ‘ä»¬è°ƒç”¨`ChatPromptTemplatee.from_template()`å‡½æ•°å°†</span><br><span class="hljs-comment"># ä¸Šé¢çš„æ™®é€šæç¤ºå­—ç¬¦ä¸²`template_string`è§£æä¸º LangChain å¯è¯†åˆ«çš„PromptTemplate å¯¹è±¡</span><br><span class="hljs-comment"># è¿™ä¸ªå¯¹è±¡èƒ½è‡ªåŠ¨è¯†åˆ«å‡ºå­—ç¬¦ä¸²é‡Œæœ‰å“ªäº›å˜é‡éœ€è¦å¡«å……  </span><br>prompt_template = ChatPromptTemplate.from_template(template_string)<br><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span>, prompt_template.messages)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span>, prompt_template.messages[<span class="hljs-number">0</span>])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span>, prompt_template.messages[<span class="hljs-number">0</span>].prompt)<br><br></code></pre></td></tr></table></figure>


<pre><code class="hljs"> [HumanMessagePromptTemplate(prompt=PromptTemplate(input_variables=[&#39;style&#39;, &#39;text&#39;], input_types=&#123;&#125;, partial_variables=&#123;&#125;, template=&#39;æŠŠç”±ä¸‰ä¸ªåå¼•å·åˆ†éš”çš„æ–‡æœ¬ç¿»è¯‘æˆä¸€ç§&#123;style&#125;é£æ ¼ã€‚æ–‡æœ¬: ```&#123;text&#125;```\n&#39;), additional_kwargs=&#123;&#125;)]

 prompt=PromptTemplate(input_variables=[&#39;style&#39;, &#39;text&#39;], input_types=&#123;&#125;, partial_variables=&#123;&#125;, template=&#39;æŠŠç”±ä¸‰ä¸ªåå¼•å·åˆ†éš”çš„æ–‡æœ¬ç¿»è¯‘æˆä¸€ç§&#123;style&#125;é£æ ¼ã€‚æ–‡æœ¬: ```&#123;text&#125;```\n&#39;) additional_kwargs=&#123;&#125;

 input_variables=[&#39;style&#39;, &#39;text&#39;] input_types=&#123;&#125; partial_variables=&#123;&#125; template=&#39;æŠŠç”±ä¸‰ä¸ªåå¼•å·åˆ†éš”çš„æ–‡æœ¬ç¿»è¯‘æˆä¸€ç§&#123;style&#125;é£æ ¼ã€‚æ–‡æœ¬: ```&#123;text&#125;```\n&#39;
</code></pre>
<p>å¯¹äºç»™å®šçš„customer_styleå’Œcustomer_email, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æç¤ºæ¨¡ç‰ˆprompt_templateçš„format_messagesæ–¹æ³•ç”Ÿæˆæƒ³è¦çš„å®¢æˆ·æ¶ˆæ¯customer_messagesã€‚</p>
<p>æç¤ºæ¨¡ç‰ˆprompt_templateéœ€è¦ä¸¤ä¸ªè¾“å…¥å˜é‡ï¼š style å’Œ textã€‚ è¿™é‡Œåˆ†åˆ«å¯¹åº”</p>
<p>customer_style: æˆ‘ä»¬æƒ³è¦çš„é¡¾å®¢é‚®ä»¶é£æ ¼<br>customer_email: é¡¾å®¢çš„åŸå§‹é‚®ä»¶æ–‡æœ¬ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#å®šä¹‰å˜é‡ï¼šæƒ³è¦è½¬æ¢çš„ç›®æ ‡é£æ ¼</span><br>customer_style = <span class="hljs-string">&quot;&quot;&quot;æ­£å¼æ™®é€šè¯ \</span><br><span class="hljs-string">ç”¨ä¸€ä¸ªå¹³é™ã€å°Šæ•¬çš„è¯­æ°”</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-comment"># å®šä¹‰å˜é‡ï¼šéœ€è¦å¤„ç†çš„åŸå§‹æ–‡æœ¬ï¼ˆè¿™é‡Œæ˜¯ä¸€å°æ„¤æ€’çš„å®¢æˆ·é‚®ä»¶ï¼‰</span><br>customer_email = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">å—¯å‘ï¼Œæˆ‘ç°åœ¨å¯æ˜¯ç«å†’ä¸‰ä¸ˆï¼Œæˆ‘é‚£ä¸ªæ…æ‹Œæœºç›–å­ç«Ÿç„¶é£äº†å‡ºå»ï¼ŒæŠŠæˆ‘å¨æˆ¿çš„å¢™å£éƒ½æº…ä¸Šäº†æœæ±ï¼</span><br><span class="hljs-string">æ›´ç³Ÿç³•çš„æ˜¯ï¼Œä¿ä¿®æ¡æ¬¾å¯ä¸åŒ…æ‹¬æ¸…ç†æˆ‘å¨æˆ¿çš„è´¹ç”¨ã€‚</span><br><span class="hljs-string">ä¼™è®¡ï¼Œèµ¶ç´§ç»™æˆ‘è¿‡æ¥ï¼</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-comment"># 2.æ ¼å¼åŒ–æ¶ˆæ¯ï¼ˆformattingï¼‰</span><br><span class="hljs-comment"># ä½¿ç”¨æç¤ºæ¨¡ç‰ˆ æŠŠå…·ä½“çš„å˜é‡å¡«å…¥ç©ºä½ </span><br>customer_messages = prompt_template.format_messages(<br>                    style=customer_style,<br>                    text=customer_email)<br><span class="hljs-comment"># æ‰“å°å®¢æˆ·æ¶ˆæ¯ç±»å‹</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å®¢æˆ·æ¶ˆæ¯ç±»å‹:&quot;</span>,<span class="hljs-built_in">type</span>(customer_messages),<span class="hljs-string">&quot;\n&quot;</span>)<br><br><span class="hljs-comment"># æ‰“å°ç¬¬ä¸€ä¸ªå®¢æˆ·æ¶ˆæ¯ç±»å‹</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç¬¬ä¸€ä¸ªå®¢æˆ·æ¶ˆæ¯çš„ç±»å‹:&quot;</span>, <span class="hljs-built_in">type</span>(customer_messages[<span class="hljs-number">0</span>]),<span class="hljs-string">&quot;\n&quot;</span>)<br><br><span class="hljs-comment"># æ‰“å°ç¬¬ä¸€ä¸ªå…ƒç´ </span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç¬¬ä¸€ä¸ªå®¢æˆ·æ¶ˆæ¯: &quot;</span>, customer_messages[<span class="hljs-number">0</span>],<span class="hljs-string">&quot;\n&quot;</span>)<br><br></code></pre></td></tr></table></figure>

<pre><code class="hljs">å®¢æˆ·æ¶ˆæ¯ç±»å‹: &lt;class &#39;list&#39;&gt; 

ç¬¬ä¸€ä¸ªå®¢æˆ·æ¶ˆæ¯çš„ç±»å‹: &lt;class &#39;langchain_core.messages.human.HumanMessage&#39;&gt; 

ç¬¬ä¸€ä¸ªå®¢æˆ·æ¶ˆæ¯:  content=&#39;æŠŠç”±ä¸‰ä¸ªåå¼•å·åˆ†éš”çš„æ–‡æœ¬ç¿»è¯‘æˆä¸€ç§æ­£å¼æ™®é€šè¯ ç”¨ä¸€ä¸ªå¹³é™ã€å°Šæ•¬çš„è¯­æ°”\né£æ ¼ã€‚æ–‡æœ¬: ```\nå—¯å‘ï¼Œæˆ‘ç°åœ¨å¯æ˜¯ç«å†’ä¸‰ä¸ˆï¼Œæˆ‘é‚£ä¸ªæ…æ‹Œæœºç›–å­ç«Ÿç„¶é£äº†å‡ºå»ï¼ŒæŠŠæˆ‘å¨æˆ¿çš„å¢™å£éƒ½æº…ä¸Šäº†æœæ±ï¼\næ›´ç³Ÿç³•çš„æ˜¯ï¼Œä¿ä¿®æ¡æ¬¾å¯ä¸åŒ…æ‹¬æ¸…ç†æˆ‘å¨æˆ¿çš„è´¹ç”¨ã€‚\nä¼™è®¡ï¼Œèµ¶ç´§ç»™æˆ‘è¿‡æ¥ï¼\n```\n&#39; additional_kwargs=&#123;&#125; response_metadata=&#123;&#125; 
</code></pre>
<p>ç¬¬äºŒæ­¥ï¼šæ ¼å¼åŒ–åï¼Œè¾“å‡ºçš„ç»“æœï¼š<br>ç”Ÿæˆäº†ä¸€ä¸ªhumanmessageå¯¹è±¡åˆ—è¡¨ã€‚è¿™æ˜¯langchainç»Ÿä¸€çš„æ¶ˆæ¯æ ¼å¼ï¼Œä¸ç®¡æ˜¯openaiè¿˜æ˜¯å…¶ä»–çš„æ¨¡å‹ï¼Œlangchainéƒ½ä¼šæŠŠä»–ä»¬æ ‡å‡†åŒ–è¾“å‡º</p>
<p>customer_messageså˜é‡ç±»å‹ä¸ºåˆ—è¡¨(list)<br>åˆ—è¡¨é‡Œçš„å…ƒç´ å˜é‡ç±»å‹ä¸ºlangchainè‡ªå®šä¹‰æ¶ˆæ¯(langchain.schema.HumanMessage)ã€‚</p>
<p>ç¬¬ä¸‰æ­¥ï¼šè°ƒç”¨ chat(customer_messages) è·å–æ¨¡å‹è¾“å‡ºç»“æœ<br>ç°åœ¨æˆ‘ä»¬å¯ä»¥è°ƒç”¨æ¨¡å‹éƒ¨åˆ†å®šä¹‰çš„chatæ¨¡å‹æ¥å®ç°è½¬æ¢å®¢æˆ·æ¶ˆæ¯é£æ ¼ã€‚</p>
<pre><code class="hljs">LangChain å†…éƒ¨ä¼šå°† HumanMessage è½¬æ¢æˆ OpenAI API éœ€è¦çš„ JSON æ ¼å¼ï¼ˆä¾‹å¦‚ &#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;...&quot;&#125;ï¼‰ã€‚

å®ƒå‘ https://api.siliconflow.cn/v1/chat/completions å‘é€ä¸€ä¸ª HTTP POST è¯·æ±‚ã€‚

ç¡…åŸºæµåŠ¨çš„æœåŠ¡å™¨æ¥æ”¶è¯·æ±‚ï¼Œè®© Qwen æ¨¡å‹è¿›è¡Œæ¨ç†ï¼Œç”Ÿæˆæ–‡æœ¬ã€‚

LangChain æ”¶åˆ°æœåŠ¡å™¨è¿”å›çš„ JSON æ•°æ®ï¼Œå°†å…¶è§£æå¹¶å°è£…æˆä¸€ä¸ª AIMessage å¯¹è±¡è¿”å›ç»™ä½ ã€‚.content å±æ€§åŒ…å«äº† AI ç”Ÿæˆçš„æ–‡æœ¬
</code></pre>
<p>content&#x3D;â€™å—¯å‘ï¼Œæˆ‘ç°åœ¨ç¡®å®æ„Ÿåˆ°éå¸¸ç”Ÿæ°”ï¼Œæˆ‘çš„æ…æ‹Œæœºç›–å­ç«Ÿç„¶é£äº†å‡ºå»ï¼Œå°†æœæ±æº…åˆ°äº†å¨æˆ¿çš„å¢™å£ä¸Šã€‚æ›´ä¸ºç³Ÿç³•çš„æ˜¯ï¼Œä¿ä¿®æ¡æ¬¾å¹¶ä¸åŒ…æ‹¬æ¸…ç†å¨æˆ¿çš„è´¹ç”¨ã€‚\n\nåŠ³é©¾ï¼Œæ‚¨èƒ½å°½å¿«è¿‡æ¥ä¸€è¶Ÿå—ï¼Ÿâ€™ additional_kwargs&#x3D;{â€˜refusalâ€™: None} response_metadata&#x3D;{â€˜token_usageâ€™: {â€˜completion_tokensâ€™: 51, â€˜prompt_tokensâ€™: 114, â€˜total_tokensâ€™: 165, â€˜completion_tokens_detailsâ€™: None, â€˜prompt_tokens_detailsâ€™: None}, â€˜model_nameâ€™: â€˜Qwen&#x2F;Qwen2.5-7B-Instructâ€™, â€˜system_fingerprintâ€™: â€˜â€™, â€˜idâ€™: â€˜019b11df2d8cf1c40276cfc29b83da2eâ€™, â€˜service_tierâ€™: None, â€˜finish_reasonâ€™: â€˜stopâ€™, â€˜logprobsâ€™: None} id&#x3D;â€™runâ€“81d8c7ca-67e3-484f-8bd6-7ba0107cf55a-0â€™ usage_metadata&#x3D;{â€˜input_tokensâ€™: 114, â€˜output_tokensâ€™: 51, â€˜total_tokensâ€™: 165, â€˜input_token_detailsâ€™: {}, â€˜output_token_detailsâ€™: {}}<br>å—¯å‘ï¼Œæˆ‘ç°åœ¨ç¡®å®æ„Ÿåˆ°éå¸¸ç”Ÿæ°”ï¼Œæˆ‘çš„æ…æ‹Œæœºç›–å­ç«Ÿç„¶é£äº†å‡ºå»ï¼Œå°†æœæ±æº…åˆ°äº†å¨æˆ¿çš„å¢™å£ä¸Šã€‚æ›´ä¸ºç³Ÿç³•çš„æ˜¯ï¼Œä¿ä¿®æ¡æ¬¾å¹¶ä¸åŒ…æ‹¬æ¸…ç†å¨æˆ¿çš„è´¹ç”¨ã€‚</p>
<p>åŠ³é©¾ï¼Œæ‚¨èƒ½å°½å¿«è¿‡æ¥ä¸€è¶Ÿå—ï¼Ÿ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">customer_response = chat.invoke(customer_messages)<br><span class="hljs-built_in">print</span>(customer_response)<br><span class="hljs-built_in">print</span>(customer_response.content)<br><br></code></pre></td></tr></table></figure>

<pre><code class="hljs">content=&#39;å—¯å‘ï¼Œæˆ‘ç°åœ¨ç¡®å®æ„Ÿåˆ°éå¸¸ç”Ÿæ°”ï¼Œæˆ‘çš„æ…æ‹Œæœºç›–å­ç«Ÿç„¶é£äº†å‡ºå»ï¼Œå°†æœæ±æº…åˆ°äº†å¨æˆ¿çš„å¢™å£ä¸Šã€‚æ›´ä¸ºç³Ÿç³•çš„æ˜¯ï¼Œä¿ä¿®æ¡æ¬¾å¹¶ä¸åŒ…æ‹¬æ¸…ç†å¨æˆ¿çš„è´¹ç”¨ã€‚\n\nåŠ³é©¾ï¼Œæ‚¨èƒ½å°½å¿«è¿‡æ¥ä¸€è¶Ÿå—ï¼Ÿ&#39; additional_kwargs=&#123;&#39;refusal&#39;: None&#125; response_metadata=&#123;&#39;token_usage&#39;: &#123;&#39;completion_tokens&#39;: 51, &#39;prompt_tokens&#39;: 114, &#39;total_tokens&#39;: 165, &#39;completion_tokens_details&#39;: None, &#39;prompt_tokens_details&#39;: None&#125;, &#39;model_name&#39;: &#39;Qwen/Qwen2.5-7B-Instruct&#39;, &#39;system_fingerprint&#39;: &#39;&#39;, &#39;id&#39;: &#39;019b11df2d8cf1c40276cfc29b83da2e&#39;, &#39;service_tier&#39;: None, &#39;finish_reason&#39;: &#39;stop&#39;, &#39;logprobs&#39;: None&#125; id=&#39;run--81d8c7ca-67e3-484f-8bd6-7ba0107cf55a-0&#39; usage_metadata=&#123;&#39;input_tokens&#39;: 114, &#39;output_tokens&#39;: 51, &#39;total_tokens&#39;: 165, &#39;input_token_details&#39;: &#123;&#125;, &#39;output_token_details&#39;: &#123;&#125;&#125;
å—¯å‘ï¼Œæˆ‘ç°åœ¨ç¡®å®æ„Ÿåˆ°éå¸¸ç”Ÿæ°”ï¼Œæˆ‘çš„æ…æ‹Œæœºç›–å­ç«Ÿç„¶é£äº†å‡ºå»ï¼Œå°†æœæ±æº…åˆ°äº†å¨æˆ¿çš„å¢™å£ä¸Šã€‚æ›´ä¸ºç³Ÿç³•çš„æ˜¯ï¼Œä¿ä¿®æ¡æ¬¾å¹¶ä¸åŒ…æ‹¬æ¸…ç†å¨æˆ¿çš„è´¹ç”¨ã€‚

åŠ³é©¾ï¼Œæ‚¨èƒ½å°½å¿«è¿‡æ¥ä¸€è¶Ÿå—ï¼Ÿ
</code></pre>
<p>2.2.3 ä¸ºä»€ä¹ˆéœ€è¦æç¤ºæ¨¡ç‰ˆ<br>åœ¨åº”ç”¨äºæ¯”è¾ƒå¤æ‚çš„åœºæ™¯æ—¶ï¼Œæç¤ºå¯èƒ½ä¼šéå¸¸é•¿å¹¶ä¸”åŒ…å«æ¶‰åŠè®¸å¤šç»†èŠ‚ã€‚ä½¿ç”¨æç¤ºæ¨¡ç‰ˆï¼Œå¯ä»¥è®©æˆ‘ä»¬æ›´ä¸ºæ–¹ä¾¿åœ°é‡å¤ä½¿ç”¨è®¾è®¡å¥½çš„æç¤ºã€‚è‹±æ–‡ç‰ˆæç¤º2.2.3 ç»™å‡ºäº†ä½œä¸šçš„æç¤ºæ¨¡ç‰ˆæ¡ˆä¾‹ï¼šå­¦ç”Ÿä»¬çº¿ä¸Šå­¦ä¹ å¹¶æäº¤ä½œä¸šï¼Œé€šè¿‡æç¤ºæ¥å®ç°å¯¹å­¦ç”Ÿçš„æäº¤çš„ä½œä¸šçš„è¯„åˆ†ã€‚</p>
<p>æ­¤å¤–ï¼ŒLangChainè¿˜æä¾›äº†æç¤ºæ¨¡ç‰ˆç”¨äºä¸€äº›å¸¸ç”¨åœºæ™¯ã€‚æ¯”å¦‚è‡ªåŠ¨æ‘˜è¦ã€é—®ç­”ã€è¿æ¥åˆ°SQLæ•°æ®åº“ã€è¿æ¥åˆ°ä¸åŒçš„APIã€‚é€šè¿‡ä½¿ç”¨LangChainå†…ç½®çš„æç¤ºæ¨¡ç‰ˆï¼Œä½ å¯ä»¥å¿«é€Ÿå»ºç«‹è‡ªå·±çš„å¤§æ¨¡å‹åº”ç”¨ï¼Œè€Œä¸éœ€è¦èŠ±æ—¶é—´å»è®¾è®¡å’Œæ„é€ æç¤ºã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬åœ¨å»ºç«‹å¤§æ¨¡å‹åº”ç”¨æ—¶ï¼Œé€šå¸¸å¸Œæœ›æ¨¡å‹çš„è¾“å‡ºä¸ºç»™å®šçš„æ ¼å¼ï¼Œæ¯”å¦‚åœ¨è¾“å‡ºä½¿ç”¨ç‰¹å®šçš„å…³é”®è¯æ¥è®©è¾“å‡ºç»“æ„åŒ–ã€‚è‹±æ–‡ç‰ˆæç¤º2.2.3 ç»™å‡ºäº†ä½¿ç”¨å¤§æ¨¡å‹è¿›è¡Œé“¾å¼æ€è€ƒæ¨ç†ç»“æœç¤ºä¾‹ â€“ å¯¹äºé—®é¢˜ï¼šWhat is the elevation range for the area that the eastern sector of the Colorado orogeny extends into? é€šè¿‡ä½¿ç”¨LangChainåº“å‡½æ•°ï¼Œè¾“å‡ºé‡‡ç”¨â€Thoughtâ€ï¼ˆæ€è€ƒï¼‰ã€â€Actionâ€ï¼ˆè¡ŒåŠ¨ï¼‰ã€â€Observationâ€ï¼ˆè§‚å¯Ÿï¼‰ä½œä¸ºé“¾å¼æ€è€ƒæ¨ç†çš„å…³é”®è¯ï¼Œè®©è¾“å‡ºç»“æ„åŒ–ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ä¸­æ–‡ç‰ˆ</span><br>prompt = <span class="hljs-string">&quot;&quot;&quot; ä½ çš„ä»»åŠ¡æ˜¯åˆ¤æ–­å­¦ç”Ÿçš„è§£å†³æ–¹æ¡ˆæ˜¯æ­£ç¡®çš„è¿˜æ˜¯ä¸æ­£ç¡®çš„</span><br><span class="hljs-string"></span><br><span class="hljs-string">è¦è§£å†³è¯¥é—®é¢˜ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</span><br><span class="hljs-string"> - é¦–å…ˆï¼Œåˆ¶å®šè‡ªå·±çš„é—®é¢˜è§£å†³æ–¹æ¡ˆ</span><br><span class="hljs-string"> - ç„¶åå°†æ‚¨çš„è§£å†³æ–¹æ¡ˆä¸å­¦ç”Ÿçš„è§£å†³æ–¹æ¡ˆè¿›è¡Œæ¯”è¾ƒ</span><br><span class="hljs-string"> å¹¶è¯„ä¼°å­¦ç”Ÿçš„è§£å†³æ–¹æ¡ˆæ˜¯å¦æ­£ç¡®ã€‚</span><br><span class="hljs-string">...</span><br><span class="hljs-string">ä½¿ç”¨ä¸‹é¢çš„æ ¼å¼:</span><br><span class="hljs-string"></span><br><span class="hljs-string">é—®é¢˜:</span><br></code></pre></td></tr></table></figure>
<p>é—®é¢˜æ–‡æœ¬</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">å­¦ç”Ÿçš„è§£å†³æ–¹æ¡ˆ:</span><br></code></pre></td></tr></table></figure>
<p>å­¦ç”Ÿçš„è§£å†³æ–¹æ¡ˆæ–‡æœ¬</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">å®é™…è§£å†³æ–¹æ¡ˆ:</span><br></code></pre></td></tr></table></figure>
<p>â€¦<br>åˆ¶å®šè§£å†³æ–¹æ¡ˆçš„æ­¥éª¤ä»¥åŠæ‚¨çš„è§£å†³æ–¹æ¡ˆè¯·å‚è§æ­¤å¤„</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livescript">å­¦ç”Ÿçš„è§£å†³æ–¹æ¡ˆå’Œå®é™…è§£å†³æ–¹æ¡ˆæ˜¯å¦ç›¸åŒ <span class="hljs-string">\</span><br>åªè®¡ç®—ï¼š<br></code></pre></td></tr></table></figure>
<p>æ˜¯æˆ–è€…ä¸æ˜¯</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">å­¦ç”Ÿçš„æˆç»©<br></code></pre></td></tr></table></figure>
<p>æ­£ç¡®æˆ–è€…ä¸æ­£ç¡®</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><br><span class="hljs-section">é—®é¢˜:</span><br></code></pre></td></tr></table></figure>
<p>{question}</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">å­¦ç”Ÿçš„è§£å†³æ–¹æ¡ˆ:</span><br></code></pre></td></tr></table></figure>
<p>{studentâ€™s solution}</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs 1c">å®é™…è§£å†³æ–¹æ¡ˆ<span class="hljs-punctuation">:</span><br><br><span class="hljs-string">&quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure>

<p>2.3è¾“å‡ºè§£æå™¨<br>2.3.1ä¸ä½¿ç”¨è¾“å‡ºè§£é‡Šå™¨æå–å®¢æˆ·è¯„ä»·ä¸­çš„ä¿¡æ¯<br>å¯¹äºç»™å®šçš„è¯„ä»·customer_reviewï¼Œæˆ‘ä»¬å¸Œæœ›æå–ä¿¡æ¯ï¼Œå¹¶æŒ‰ç…§ä»¥ä¸‹æ ¼å¼è¾“å‡ºï¼š<br>{<br>  â€œgiftâ€: False,<br>  â€œdelivery_daysâ€: 5,<br>  â€œprice_valueâ€: â€œpretty affordable!â€<br>}</p>
<p>ä¸ä½¿ç”¨è¾“å‡ºè§£é‡Šå™¨ï¼Œé‚£ä¹ˆå¾—åˆ°çš„å°±æ˜¯ä¸€å †æ–‡æœ¬ã€‚ä½†æ˜¯ç”¨äº†è¾“å‡ºè§£é‡Šå™¨ï¼Œå°±å¯ä»¥å¾—åˆ°pythonå¯¹è±¡ï¼ˆå­—å…¸ã€åˆ—è¡¨ç­‰ï¼‰</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate<br><span class="hljs-keyword">from</span> tool <span class="hljs-keyword">import</span> get_chat_model2<br><br>review_template = <span class="hljs-string">&quot;&quot;&quot;\</span><br><span class="hljs-string">å¯¹äºä»¥ä¸‹æ–‡æœ¬ï¼Œè¯·ä»ä¸­æå–ä»¥ä¸‹ä¿¡æ¯ï¼š</span><br><span class="hljs-string"></span><br><span class="hljs-string">ç¤¼ç‰©ï¼šè¯¥å•†å“æ˜¯ä½œä¸ºç¤¼ç‰©é€ç»™åˆ«äººçš„å—ï¼Ÿ \</span><br><span class="hljs-string">å¦‚æœæ˜¯ï¼Œåˆ™å›ç­” æ˜¯çš„ï¼›å¦‚æœå¦æˆ–æœªçŸ¥ï¼Œåˆ™å›ç­” ä¸æ˜¯ã€‚</span><br><span class="hljs-string"></span><br><span class="hljs-string">äº¤è´§å¤©æ•°ï¼šäº§å“éœ€è¦å¤šå°‘å¤©\</span><br><span class="hljs-string">åˆ°è¾¾ï¼Ÿ å¦‚æœæ²¡æœ‰æ‰¾åˆ°è¯¥ä¿¡æ¯ï¼Œåˆ™è¾“å‡º-1ã€‚</span><br><span class="hljs-string"></span><br><span class="hljs-string">ä»·é’±ï¼šæå–æœ‰å…³ä»·å€¼æˆ–ä»·æ ¼çš„ä»»ä½•å¥å­ï¼Œ\</span><br><span class="hljs-string">å¹¶å°†å®ƒä»¬è¾“å‡ºä¸ºé€—å·åˆ†éš”çš„ Python åˆ—è¡¨ã€‚</span><br><span class="hljs-string"></span><br><span class="hljs-string">ä½¿ç”¨ä»¥ä¸‹é”®å°†è¾“å‡ºæ ¼å¼åŒ–ä¸º JSONï¼š</span><br><span class="hljs-string">ç¤¼ç‰©</span><br><span class="hljs-string">äº¤è´§å¤©æ•°</span><br><span class="hljs-string">ä»·é’±</span><br><span class="hljs-string"></span><br><span class="hljs-string">æ–‡æœ¬: &#123;text&#125;</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br>prompt_template = ChatPromptTemplate.from_template(review_template)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æç¤ºæ¨¡ç‰ˆï¼š&quot;</span>, prompt_template)<br><br><br>messages = prompt_template.format_messages(text=customer_review)<br><br><br><span class="hljs-comment"># chat = get_chat_model2(temperature=0.0)</span><br>response = chat.invoke(messages)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç»“æœç±»å‹:&quot;</span>, <span class="hljs-built_in">type</span>(response.content))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç»“æœ:&quot;</span>, response.content)<br><br></code></pre></td></tr></table></figure>

<pre><code class="hljs">æç¤ºæ¨¡ç‰ˆï¼š input_variables=[&#39;text&#39;] input_types=&#123;&#125; partial_variables=&#123;&#125; messages=[HumanMessagePromptTemplate(prompt=PromptTemplate(input_variables=[&#39;text&#39;], input_types=&#123;&#125;, partial_variables=&#123;&#125;, template=&#39;å¯¹äºä»¥ä¸‹æ–‡æœ¬ï¼Œè¯·ä»ä¸­æå–ä»¥ä¸‹ä¿¡æ¯ï¼š\n\nç¤¼ç‰©ï¼šè¯¥å•†å“æ˜¯ä½œä¸ºç¤¼ç‰©é€ç»™åˆ«äººçš„å—ï¼Ÿ å¦‚æœæ˜¯ï¼Œåˆ™å›ç­” æ˜¯çš„ï¼›å¦‚æœå¦æˆ–æœªçŸ¥ï¼Œåˆ™å›ç­” ä¸æ˜¯ã€‚\n\näº¤è´§å¤©æ•°ï¼šäº§å“éœ€è¦å¤šå°‘å¤©åˆ°è¾¾ï¼Ÿ å¦‚æœæ²¡æœ‰æ‰¾åˆ°è¯¥ä¿¡æ¯ï¼Œåˆ™è¾“å‡º-1ã€‚\n\nä»·é’±ï¼šæå–æœ‰å…³ä»·å€¼æˆ–ä»·æ ¼çš„ä»»ä½•å¥å­ï¼Œå¹¶å°†å®ƒä»¬è¾“å‡ºä¸ºé€—å·åˆ†éš”çš„ Python åˆ—è¡¨ã€‚\n\nä½¿ç”¨ä»¥ä¸‹é”®å°†è¾“å‡ºæ ¼å¼åŒ–ä¸º JSONï¼š\nç¤¼ç‰©\näº¤è´§å¤©æ•°\nä»·é’±\n\næ–‡æœ¬: &#123;text&#125;\n&#39;), additional_kwargs=&#123;&#125;)]
ç»“æœç±»å‹: &lt;class &#39;str&#39;&gt;
ç»“æœ: æ ¹æ®æä¾›çš„æ–‡æœ¬ï¼Œæˆ‘ä»¬å¯ä»¥æå–ä»¥ä¸‹ä¿¡æ¯ï¼š

- ç¤¼ç‰©ï¼šæ˜¯çš„
- äº¤è´§å¤©æ•°ï¼š2
- ä»·é’±ï¼š[&#39;å®ƒæ¯”å…¶ä»–å¹å¶æœºç¨å¾®è´µä¸€ç‚¹&#39;]

æ ¼å¼åŒ–åçš„ JSON è¾“å‡ºå¦‚ä¸‹ï¼š

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;ç¤¼ç‰©&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æ˜¯çš„&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;äº¤è´§å¤©æ•°&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;ä»·é’±&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;å®ƒæ¯”å…¶ä»–å¹å¶æœºç¨å¾®è´µä¸€ç‚¹&quot;</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>
</code></pre>
<p>å¯ä»¥çœ‹å‡º response.contentç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼ˆstrï¼‰ï¼Œè€Œå¹¶éå­—å…¸(dict)ã€‚å“ªæ€•å®ƒé•¿å¾—åƒ JSONï¼ŒPython ä¹ŸåªæŠŠå®ƒå½“ä½œä¸€ä¸²å­—ç¬¦ã€‚<br>ç—›ç‚¹ï¼š<br>    æ— æ³•ç›´æ¥ä½¿ç”¨ï¼šä½ ä¸èƒ½ç›´æ¥å†™ response[â€˜ä»·é’±â€™]ï¼Œå› ä¸ºå­—ç¬¦ä¸²ä¸æ”¯æŒé”®å€¼å¯¹æ“ä½œã€‚</p>
<pre><code class="hljs">å®¹æ˜“æŠ¥é”™ï¼šä½ éœ€è¦æ‰‹åŠ¨å†™ json.loads(response.content)ã€‚ä½†å¦‚æœæ¨¡å‹å¤šå˜´è¯´äº†ä¸€å¥â€œå¥½çš„ï¼Œè¿™æ˜¯ä½ çš„ JSON...â€ï¼Œæˆ–è€…åŠ äº† Markdown ä»£ç å—ï¼ˆjson ... ï¼‰ï¼Œä½ çš„ json.loads å°±ä¼šç›´æ¥æŠ¥é”™ï¼Œç¨‹åºå´©æºƒã€‚

æç¤ºè¯éš¾å†™ï¼šä½ éœ€è¦è‡ªå·±è´¹å°½å¿ƒæ€å†™ Promptï¼šâ€œè¯·åªè¾“å‡º JSONï¼Œä¸è¦æ¢è¡Œï¼Œä¸è¦åºŸè¯...â€ã€‚
</code></pre>
<p>å¦‚æœæƒ³è¦ä»ä¸­æ›´æ–¹ä¾¿çš„æå–ä¿¡æ¯ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨Langchainä¸­çš„è¾“å‡ºè§£é‡Šå™¨ã€‚</p>
<p>2.3.2 ä½¿ç”¨è¾“å‡ºè§£æå™¨æå–å®¢æˆ·è¯„ä»·ä¸­çš„ä¿¡æ¯<br>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨è¾“å‡ºè§£é‡Šå™¨ã€‚ä½¿ç”¨è§£æå™¨ä¼šè‡ªåŠ¨æŠŠæ¨¡å‹çš„å­—ç¬¦ä¸²è½¬æ¢æˆPythonå­—å…¸ï¼ˆdictï¼‰æˆ–pydanticå¯¹è±¡<br>å¥½å¤„ï¼š<br>    è‡ªåŠ¨åŒ–promptï¼šä½ ä¸éœ€è¦è‡ªå·±åœ¨æç¤ºè¯é‡Œå†™å¤æ‚çš„â€œè¯·æŒ‰ JSON æ ¼å¼è¾“å‡ºâ€¦â€ï¼Œparser.get_format_instructions() ä¼šè‡ªåŠ¨å¸®ä½ ç”Ÿæˆæœ€æ ‡å‡†çš„æ ¼å¼æŒ‡ä»¤ã€‚</p>
<pre><code class="hljs">æ•°æ®ç»“æ„åŒ–ï¼šç›´æ¥æ‹¿åˆ°å­—å…¸ã€‚ä½ å¯ä»¥é©¬ä¸Šå†™ä»£ç ï¼šif output_dict[&#39;ç¤¼ç‰©&#39;] == &#39;æ˜¯çš„&#39;: print(&quot;æ‰“åŒ…ç¤¼ç‰©&quot;)ã€‚

å¥å£®æ€§ï¼šå³ä½¿æ¨¡å‹è¿”å›äº†å¸¦æœ‰ Markdown æ ‡è®°ï¼ˆ```jsonï¼‰çš„æ–‡æœ¬ï¼Œè§£æå™¨é€šå¸¸ä¹Ÿèƒ½è‡ªåŠ¨å¤„ç†å¹¶æ¸…æ´—å¹²å‡€ï¼Œæå–å‡ºæ ¸å¿ƒæ•°æ®ã€‚
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 1. å®šä¹‰å®¢æˆ·è¯„è®ºæ–‡æœ¬ï¼ˆè¾“å…¥æ•°æ®ï¼‰</span><br>customer_review = <span class="hljs-string">&quot;&quot;&quot;\</span><br><span class="hljs-string">è¿™æ¬¾å¹å¶æœºéå¸¸ç¥å¥‡ã€‚ å®ƒæœ‰å››ä¸ªè®¾ç½®ï¼š\</span><br><span class="hljs-string">å¹èœ¡çƒ›ã€å¾®é£ã€é£åŸã€é¾™å·é£ã€‚ \</span><br><span class="hljs-string">ä¸¤å¤©åå°±åˆ°äº†ï¼Œæ­£å¥½èµ¶ä¸Šæˆ‘å¦»å­çš„\</span><br><span class="hljs-string">å‘¨å¹´çºªå¿µç¤¼ç‰©ã€‚ \</span><br><span class="hljs-string">æˆ‘æƒ³æˆ‘çš„å¦»å­ä¼šå–œæ¬¢å®ƒåˆ°è¯´ä¸å‡ºè¯æ¥ã€‚ \</span><br><span class="hljs-string">åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘æ˜¯å”¯ä¸€ä¸€ä¸ªä½¿ç”¨å®ƒçš„äººï¼Œè€Œä¸”æˆ‘ä¸€ç›´\</span><br><span class="hljs-string">æ¯éš”ä¸€å¤©æ—©ä¸Šç”¨å®ƒæ¥æ¸…ç†è‰åªä¸Šçš„å¶å­ã€‚ \</span><br><span class="hljs-string">å®ƒæ¯”å…¶ä»–å¹å¶æœºç¨å¾®è´µä¸€ç‚¹ï¼Œ\</span><br><span class="hljs-string">ä½†æˆ‘è®¤ä¸ºå®ƒçš„é¢å¤–åŠŸèƒ½æ˜¯å€¼å¾—çš„ã€‚</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-comment"># 2. å®šä¹‰æç¤ºè¯æ¨¡ç‰ˆ</span><br><span class="hljs-comment"># æ³¨æ„ &#123;format_instructions&#125; è¿™ä¸ªå ä½ç¬¦ï¼Œè¿™æ˜¯ç•™ç»™è§£æå™¨è‡ªåŠ¨å¡«å…¥æ ¼å¼è¦æ±‚çš„</span><br><span class="hljs-comment"># ä¸Šé¢çš„æ˜¯è¦äººä¸ºçš„å†™è¾“å‡ºçš„æ ¼å¼è¦æ±‚:</span><br><span class="hljs-comment"># ä½¿ç”¨ä»¥ä¸‹é”®å°†è¾“å‡ºæ ¼å¼åŒ–ä¸º JSONï¼š</span><br><span class="hljs-comment"># ç¤¼ç‰©</span><br><span class="hljs-comment"># äº¤è´§å¤©æ•°</span><br><span class="hljs-comment"># ä»·é’±</span><br>review_template_2 = <span class="hljs-string">&quot;&quot;&quot;\</span><br><span class="hljs-string">å¯¹äºä»¥ä¸‹æ–‡æœ¬ï¼Œè¯·ä»ä¸­æå–ä»¥ä¸‹ä¿¡æ¯ï¼šï¼š</span><br><span class="hljs-string"></span><br><span class="hljs-string">ç¤¼ç‰©ï¼šè¯¥å•†å“æ˜¯ä½œä¸ºç¤¼ç‰©é€ç»™åˆ«äººçš„å—ï¼Ÿ</span><br><span class="hljs-string">å¦‚æœæ˜¯ï¼Œåˆ™å›ç­” æ˜¯çš„ï¼›å¦‚æœå¦æˆ–æœªçŸ¥ï¼Œåˆ™å›ç­” ä¸æ˜¯ã€‚</span><br><span class="hljs-string"></span><br><span class="hljs-string">äº¤è´§å¤©æ•°ï¼šäº§å“åˆ°è¾¾éœ€è¦å¤šå°‘å¤©ï¼Ÿ å¦‚æœæ²¡æœ‰æ‰¾åˆ°è¯¥ä¿¡æ¯ï¼Œåˆ™è¾“å‡º-1ã€‚</span><br><span class="hljs-string"></span><br><span class="hljs-string">ä»·é’±ï¼šæå–æœ‰å…³ä»·å€¼æˆ–ä»·æ ¼çš„ä»»ä½•å¥å­ï¼Œå¹¶å°†å®ƒä»¬è¾“å‡ºä¸ºé€—å·åˆ†éš”çš„ Python åˆ—è¡¨ã€‚</span><br><span class="hljs-string"></span><br><span class="hljs-string">æ–‡æœ¬: &#123;text&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&#123;format_instructions&#125;</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-comment"># 3. åˆ›å»º ChatPromptTemplate å¯¹è±¡,ä¼šè‡ªåŠ¨åˆ†æå­—ç¬¦ä¸²é‡Œæœ‰å“ªäº› &#123;å˜é‡&#125; éœ€è¦ç¨åå¡«å……</span><br>prompt = ChatPromptTemplate.from_template(template=review_template_2)<br><br><span class="hljs-keyword">from</span> langchain.output_parsers <span class="hljs-keyword">import</span> ResponseSchema<br><span class="hljs-keyword">from</span> langchain.output_parsers <span class="hljs-keyword">import</span> StructuredOutputParser<br><br><span class="hljs-comment"># 4. å®šä¹‰è¾“å‡ºç»“æ„ (Schema) - ç¤¼ç‰©å­—æ®µ</span><br><span class="hljs-comment"># ResponseSchema å®šä¹‰äº†æˆ‘ä»¬æƒ³è¦çš„ä¸€ä¸ªå­—æ®µçš„åå­—å’Œæè¿°ï¼Œå‘Šè¯‰æ¨¡å‹è¿™ä¸ªå­—æ®µè¯¥æ€ä¹ˆå¡«</span><br>gift_schema = ResponseSchema(name=<span class="hljs-string">&quot;ç¤¼ç‰©&quot;</span>,<br>                             description=<span class="hljs-string">&quot;è¿™ä»¶ç‰©å“æ˜¯ä½œä¸ºç¤¼ç‰©é€ç»™åˆ«äººçš„å—ï¼Ÿ\</span><br><span class="hljs-string">                            å¦‚æœæ˜¯ï¼Œåˆ™å›ç­” æ˜¯çš„ï¼Œ\</span><br><span class="hljs-string">                            å¦‚æœå¦æˆ–æœªçŸ¥ï¼Œåˆ™å›ç­” ä¸æ˜¯ã€‚&quot;</span>)<br><br><span class="hljs-comment"># 5. å®šä¹‰è¾“å‡ºç»“æ„ (Schema) - äº¤è´§å¤©æ•°å­—æ®µ</span><br>delivery_days_schema = ResponseSchema(name=<span class="hljs-string">&quot;äº¤è´§å¤©æ•°&quot;</span>,<br>                                      description=<span class="hljs-string">&quot;äº§å“éœ€è¦å¤šå°‘å¤©æ‰èƒ½åˆ°è¾¾ï¼Ÿ\</span><br><span class="hljs-string">                                      å¦‚æœæ²¡æœ‰æ‰¾åˆ°è¯¥ä¿¡æ¯ï¼Œåˆ™è¾“å‡º-1ã€‚&quot;</span>)<br><br><span class="hljs-comment"># 6. å®šä¹‰è¾“å‡ºç»“æ„ (Schema) - ä»·é’±å­—æ®µ</span><br>price_value_schema = ResponseSchema(name=<span class="hljs-string">&quot;ä»·é’±&quot;</span>,<br>                                    description=<span class="hljs-string">&quot;æå–æœ‰å…³ä»·å€¼æˆ–ä»·æ ¼çš„ä»»ä½•å¥å­ï¼Œ\</span><br><span class="hljs-string">                                    å¹¶å°†å®ƒä»¬è¾“å‡ºä¸ºé€—å·åˆ†éš”çš„ Python åˆ—è¡¨&quot;</span>)<br><br><span class="hljs-comment"># 7. å°†æ‰€æœ‰å­—æ®µç»“æ„æ”¾å…¥ä¸€ä¸ªåˆ—è¡¨</span><br>response_schemas = [gift_schema, <br>                    delivery_days_schema,<br>                    price_value_schema]<br><br><span class="hljs-comment"># 8. åˆå§‹åŒ– StructuredOutputParser (ç»“æ„åŒ–è¾“å‡ºè§£æå™¨)</span><br><span class="hljs-comment"># è¿™ä¸€æ­¥æ˜¯æ ¸å¿ƒï¼Œå®ƒæ ¹æ®æˆ‘ä»¬å®šä¹‰çš„å­—æ®µåˆ—è¡¨ï¼Œå‡†å¤‡å¥½äº†è§£æé€»è¾‘</span><br><span class="hljs-comment"># output_parser ç±»å®ä¾‹åŒ–åï¼Œä¼šè‡ªåŠ¨åˆ†æå­—ç¬¦ä¸²é‡Œæœ‰å“ªäº› &#123;å˜é‡&#125; éœ€è¦ç¨åå¡«å……  ã€æ¨¡å…·ã€‘</span><br>output_parser = StructuredOutputParser.from_response_schemas(response_schemas)<br><br><span class="hljs-comment"># 9. è·å–è‡ªåŠ¨ç”Ÿæˆçš„æ ¼å¼è¯´æ˜</span><br><span class="hljs-comment"># è¿™æ˜¯ä¸€ä¸ªç¥å¥‡çš„æ–¹æ³•ï¼å®ƒä¼šæ ¹æ®ä¸Šé¢çš„ schemas è‡ªåŠ¨ç”Ÿæˆä¸€æ®µå¾ˆé•¿çš„ prompt å­—ç¬¦ä¸²ã€‚</span><br><span class="hljs-comment"># å†…å®¹å¤§æ¦‚æ˜¯ï¼šâ€œè¾“å‡ºå¿…é¡»æ˜¯ markdown ä»£ç ç‰‡æ®µ... æ ¼å¼å¦‚ä¸‹ JSON schema...â€  ã€å…·ä½“çš„äº§å“åŠŸèƒ½ã€‘</span><br>format_instructions = output_parser.get_format_instructions()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è¾“å‡ºæ ¼å¼è§„å®šï¼š&quot;</span>,format_instructions)<br><br></code></pre></td></tr></table></figure>

<pre><code class="hljs">è¾“å‡ºæ ¼å¼è§„å®šï¼š The output should be a markdown code snippet formatted in the following schema, including the leading and trailing &quot;```json&quot; and &quot;```&quot;:

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>	<span class="hljs-attr">&quot;ç¤¼ç‰©&quot;</span><span class="hljs-punctuation">:</span> string  <span class="hljs-comment">// è¿™ä»¶ç‰©å“æ˜¯ä½œä¸ºç¤¼ç‰©é€ç»™åˆ«äººçš„å—ï¼Ÿ                            å¦‚æœæ˜¯ï¼Œåˆ™å›ç­” æ˜¯çš„ï¼Œ                            å¦‚æœå¦æˆ–æœªçŸ¥ï¼Œåˆ™å›ç­” ä¸æ˜¯ã€‚</span><br>	<span class="hljs-attr">&quot;äº¤è´§å¤©æ•°&quot;</span><span class="hljs-punctuation">:</span> string  <span class="hljs-comment">// äº§å“éœ€è¦å¤šå°‘å¤©æ‰èƒ½åˆ°è¾¾ï¼Ÿ                                      å¦‚æœæ²¡æœ‰æ‰¾åˆ°è¯¥ä¿¡æ¯ï¼Œåˆ™è¾“å‡º-1ã€‚</span><br>	<span class="hljs-attr">&quot;ä»·é’±&quot;</span><span class="hljs-punctuation">:</span> string  <span class="hljs-comment">// æå–æœ‰å…³ä»·å€¼æˆ–ä»·æ ¼çš„ä»»ä½•å¥å­ï¼Œ                                    å¹¶å°†å®ƒä»¬è¾“å‡ºä¸ºé€—å·åˆ†éš”çš„ Python åˆ—è¡¨</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 10. æ ¼å¼åŒ–æç¤ºè¯</span><br><span class="hljs-comment"># æˆ‘ä»¬æŠŠåŸå§‹æ–‡æœ¬ (text) å’Œè‡ªåŠ¨ç”Ÿæˆçš„æ ¼å¼è¯´æ˜ (format_instructions) ä¸€èµ·å¡«å…¥æ¨¡ç‰ˆ</span><br>messages = prompt.format_messages(text=customer_review, format_instructions=format_instructions)<br><span class="hljs-comment"># æ‰“å°ä¸€ä¸‹çœ‹çœ‹å®é™…å‘ç»™ AI çš„æ¶ˆæ¯é•¿ä»€ä¹ˆæ ·</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç¬¬ä¸€æ¡å®¢æˆ·æ¶ˆæ¯:&quot;</span>,messages[<span class="hljs-number">0</span>].content)<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">ç¬¬ä¸€æ¡å®¢æˆ·æ¶ˆæ¯: å¯¹äºä»¥ä¸‹æ–‡æœ¬ï¼Œè¯·ä»ä¸­æå–ä»¥ä¸‹ä¿¡æ¯ï¼šï¼š

ç¤¼ç‰©ï¼šè¯¥å•†å“æ˜¯ä½œä¸ºç¤¼ç‰©é€ç»™åˆ«äººçš„å—ï¼Ÿ
å¦‚æœæ˜¯ï¼Œåˆ™å›ç­” æ˜¯çš„ï¼›å¦‚æœå¦æˆ–æœªçŸ¥ï¼Œåˆ™å›ç­” ä¸æ˜¯ã€‚

äº¤è´§å¤©æ•°ï¼šäº§å“åˆ°è¾¾éœ€è¦å¤šå°‘å¤©ï¼Ÿ å¦‚æœæ²¡æœ‰æ‰¾åˆ°è¯¥ä¿¡æ¯ï¼Œåˆ™è¾“å‡º-1ã€‚

ä»·é’±ï¼šæå–æœ‰å…³ä»·å€¼æˆ–ä»·æ ¼çš„ä»»ä½•å¥å­ï¼Œå¹¶å°†å®ƒä»¬è¾“å‡ºä¸ºé€—å·åˆ†éš”çš„ Python åˆ—è¡¨ã€‚

æ–‡æœ¬: è¿™æ¬¾å¹å¶æœºéå¸¸ç¥å¥‡ã€‚ å®ƒæœ‰å››ä¸ªè®¾ç½®ï¼šå¹èœ¡çƒ›ã€å¾®é£ã€é£åŸã€é¾™å·é£ã€‚ ä¸¤å¤©åå°±åˆ°äº†ï¼Œæ­£å¥½èµ¶ä¸Šæˆ‘å¦»å­çš„å‘¨å¹´çºªå¿µç¤¼ç‰©ã€‚ æˆ‘æƒ³æˆ‘çš„å¦»å­ä¼šå–œæ¬¢å®ƒåˆ°è¯´ä¸å‡ºè¯æ¥ã€‚ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘æ˜¯å”¯ä¸€ä¸€ä¸ªä½¿ç”¨å®ƒçš„äººï¼Œè€Œä¸”æˆ‘ä¸€ç›´æ¯éš”ä¸€å¤©æ—©ä¸Šç”¨å®ƒæ¥æ¸…ç†è‰åªä¸Šçš„å¶å­ã€‚ å®ƒæ¯”å…¶ä»–å¹å¶æœºç¨å¾®è´µä¸€ç‚¹ï¼Œä½†æˆ‘è®¤ä¸ºå®ƒçš„é¢å¤–åŠŸèƒ½æ˜¯å€¼å¾—çš„ã€‚
</code></pre>
<p>â€‹<br>    The output should be a markdown code snippet formatted in the following schema, including the leading and trailing â€œ<code>json&quot; and &quot;</code>â€œ:</p>
<pre><code class="hljs"><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>	<span class="hljs-attr">&quot;ç¤¼ç‰©&quot;</span><span class="hljs-punctuation">:</span> string  <span class="hljs-comment">// è¿™ä»¶ç‰©å“æ˜¯ä½œä¸ºç¤¼ç‰©é€ç»™åˆ«äººçš„å—ï¼Ÿ                            å¦‚æœæ˜¯ï¼Œåˆ™å›ç­” æ˜¯çš„ï¼Œ                            å¦‚æœå¦æˆ–æœªçŸ¥ï¼Œåˆ™å›ç­” ä¸æ˜¯ã€‚</span><br>	<span class="hljs-attr">&quot;äº¤è´§å¤©æ•°&quot;</span><span class="hljs-punctuation">:</span> string  <span class="hljs-comment">// äº§å“éœ€è¦å¤šå°‘å¤©æ‰èƒ½åˆ°è¾¾ï¼Ÿ                                      å¦‚æœæ²¡æœ‰æ‰¾åˆ°è¯¥ä¿¡æ¯ï¼Œåˆ™è¾“å‡º-1ã€‚</span><br>	<span class="hljs-attr">&quot;ä»·é’±&quot;</span><span class="hljs-punctuation">:</span> string  <span class="hljs-comment">// æå–æœ‰å…³ä»·å€¼æˆ–ä»·æ ¼çš„ä»»ä½•å¥å­ï¼Œ                                    å¹¶å°†å®ƒä»¬è¾“å‡ºä¸ºé€—å·åˆ†éš”çš„ Python åˆ—è¡¨</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 11. è°ƒç”¨æ¨¡å‹ (Invoke)</span><br>response = chat.invoke(messages)<br><span class="hljs-comment"># 12. æ‰“å°åŸå§‹å“åº”</span><br><span class="hljs-comment"># æ­¤æ—¶ response.content ä»ç„¶æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸² (str)ï¼Œè™½ç„¶å®ƒçœ‹èµ·æ¥åƒ JSON</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç»“æœç±»å‹:&quot;</span>, <span class="hljs-built_in">type</span>(response.content))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç»“æœ:&quot;</span>, response.content)<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">ç»“æœç±»å‹: &lt;class &#39;str&#39;&gt;
ç»“æœ: ```json
&#123;
	&quot;ç¤¼ç‰©&quot;: &quot;æ˜¯çš„&quot;,
	&quot;äº¤è´§å¤©æ•°&quot;: &quot;ä¸¤å¤©å&quot;,
	&quot;ä»·é’±&quot;: &quot;æ¯”å…¶ä»–å¹å¶æœºç¨å¾®è´µä¸€ç‚¹&quot;
&#125;
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br><br><br>```python<br><span class="hljs-comment"># 13. ã€å…³é”®æ­¥éª¤ã€‘ä½¿ç”¨è§£æå™¨è§£æç»“æœ</span><br><span class="hljs-comment"># output_parser.parse() ä¼šåšä¸¤ä»¶äº‹ï¼š</span><br><span class="hljs-comment"># 1. æ¸…æ´—å­—ç¬¦ä¸²ï¼ˆå»æ‰å¯èƒ½å­˜åœ¨çš„ ```json ç­‰æ ‡è®°ï¼‰</span><br><span class="hljs-comment"># 2. å°† JSON å­—ç¬¦ä¸²è½¬æ¢æˆ Python å­—å…¸</span><br>output_dict = output_parser.parse(response.content)<br><span class="hljs-comment"># 14. éªŒè¯è§£æåçš„ç±»å‹</span><br><span class="hljs-comment"># ç°åœ¨å®ƒæ˜¯ä¸€ä¸ªçœŸæ­£çš„ dict äº†</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è§£æåçš„ç»“æœç±»å‹:&quot;</span>, type(output_dict))<br><span class="hljs-comment"># output_dictç±»å‹ä¸ºå­—å…¸(dict), å¯ç›´æ¥ä½¿ç”¨getæ–¹æ³•ã€‚è¿™æ ·çš„è¾“å‡ºæ›´æ–¹ä¾¿ä¸‹æ¸¸ä»»åŠ¡çš„å¤„ç†ã€‚</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è§£æåçš„ç»“æœ:&quot;</span>, output_dict)<br><br></code></pre></td></tr></table></figure>

è§£æåçš„ç»“æœç±»å‹: &lt;class &#39;dict&#39;&gt;
è§£æåçš„ç»“æœ: &#123;&#39;ç¤¼ç‰©&#39;: &#39;æ˜¯çš„&#39;, &#39;äº¤è´§å¤©æ•°&#39;: &#39;ä¸¤å¤©å&#39;, &#39;ä»·é’±&#39;: &#39;æ¯”å…¶ä»–å¹å¶æœºç¨å¾®è´µä¸€ç‚¹&#39;&#125;
</code></pre>
<p>æµå¼ã€å¼‚æ­¥ã€å¹¶è¡Œæ˜¯ LCEL (LangChain Expression Language) æœ€ç‰›çš„åœ°æ–¹</p>
<ol>
<li>æµå¼ï¼š.stream()ï¼Œå­—ä¸€ä¸ªä¸€ä¸ªè¹¦å‡ºæ¥ï¼Œå°±åƒ ChatGPT ç½‘é¡µä¸€æ ·ã€‚<br>åœºæ™¯ï¼šå¤§æ¨¡å‹ç”Ÿæˆé•¿æ–‡æ—¶ï¼Œç”¨æˆ·ä¸éœ€è¦ç­‰å‡ åç§’çœ‹å®Œæ•´ç»“æœï¼Œè€Œæ˜¯åƒ ChatGPT ç½‘é¡µä¸€æ ·ï¼Œå­—æ˜¯ä¸€ä¸ªä¸€ä¸ªè¹¦å‡ºæ¥çš„ã€‚<br>ä»£ç å®ç°ï¼š ä½ åªéœ€è¦æŠŠ .invoke() æ¢æˆ .stream()ï¼Œç„¶åç”¨ for å¾ªç¯éå†å®ƒã€‚</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI<br><span class="hljs-keyword">from</span> langchain.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate<br><span class="hljs-keyword">from</span> langchain_core.output_parsers <span class="hljs-keyword">import</span> StrOutputParser<br><br><span class="hljs-comment"># 0. å‡†å¤‡åŸºç¡€ç»„ä»¶</span><br>model = ChatOpenAI(<br>    base_url=<span class="hljs-string">&quot;https://api.siliconflow.cn/v1&quot;</span>,<br>    model=<span class="hljs-string">&quot;Qwen/Qwen2.5-7B-Instruct&quot;</span>, <span class="hljs-comment"># æˆ–è€… deepseek-ai/DeepSeek-V2.5</span><br>    temperature=<span class="hljs-number">0</span><br>)<br><span class="hljs-comment"># StrOutputParser çš„å·¥ä½œå°±æ˜¯å¸®ä½ è‡ªåŠ¨å®Œæˆ .content è¿™ä¸€æ­¥</span><br>parser = StrOutputParser()<br></code></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 1. å®šä¹‰é“¾</span><br>prompt = ChatPromptTemplate.from_template(<span class="hljs-string">&quot;è¯·å¸®æˆ‘å†™ä¸€é¦–å…³äº&#123;topic&#125;çš„ä¸ƒè¨€ç»å¥ã€‚&quot;</span>)<br>chain = prompt | model | parser<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;--- å¼€å§‹æµå¼è¾“å‡º ---&quot;</span>)<br><br><span class="hljs-comment"># 2. ä½¿ç”¨ chain.stream</span><br><span class="hljs-comment"># chunk æ˜¯æ¯æ¬¡è¹¦å‡ºæ¥çš„å‡ ä¸ªå­—</span><br><span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> chain.stream(&#123;<span class="hljs-string">&quot;topic&quot;</span>: <span class="hljs-string">&quot;æ˜¥é›¨&quot;</span>&#125;):<br>    <span class="hljs-comment"># end=&quot;&quot; è¡¨ç¤ºä¸æ¢è¡Œï¼Œflush=True è¡¨ç¤ºç«‹å³æ‰“å°å‡ºæ¥</span><br>    <span class="hljs-built_in">print</span>(chunk, end=<span class="hljs-string">&quot;|&quot;</span>, flush=<span class="hljs-literal">True</span>) <br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n--- ç»“æŸ ---&quot;</span>)<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">--- å¼€å§‹æµå¼è¾“å‡º ---
|æ˜¥|é›¨|ç»µ|ç»µ|æ¶¦|ç‰©|å|ï¼Œ|è½»|æ•²|çª—|æ£‚|å”¤|æ™¨|éœ|ã€‚
|ç»¿|è‚¥|çº¢|ç˜¦|çŸ¥|æ—¶|ä»¤|ï¼Œ|ä¸€|æ›²|æ¸…|æ­Œ|é†‰|æ™š|éœ|ã€‚||
--- ç»“æŸ ---
</code></pre>
<p>2.å¼‚æ­¥æ”¯æŒAsyncâ€”â€”é«˜å¹¶å‘<br>åœºæ™¯ï¼šå¦‚æœä½ åœ¨å†™ä¸€ä¸ªwebæœåŠ¡å™¨ï¼ˆæ¯”å¦‚fastapiï¼‰ï¼Œå½“ä½ åœ¨ç­‰aiå›å¤çš„é‚£å‡ ç§’é‡Œï¼Œä½ çš„æœåŠ¡å™¨ä¸åº”è¯¥å¡æ­»ï¼Œè€Œåº”è¯¥å»å¤„ç†åˆ«äººçš„è¯·æ±‚ã€‚<br>ä»£ç å®ç°ï¼š åœ¨ Python çš„ async ç¯å¢ƒä¸­ï¼ˆJupyter Notebook æœ¬ç”Ÿå°±æ˜¯æ”¯æŒ async çš„ï¼‰ï¼Œç›´æ¥ç”¨ await chain.ainvoke(â€¦)ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python">%pip install asyncio<br><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-comment"># 1. å®šä¹‰é“¾</span><br>prompt = ChatPromptTemplate.from_template(<span class="hljs-string">&quot;ç”¨ä¸€å¥è¯ä»‹ç»&#123;topic&#125;ã€‚&quot;</span>)<br>chain = prompt | model | parser<br><br><span class="hljs-comment"># 2. æ¨¡æ‹Ÿå¼‚æ­¥ä»»åŠ¡</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">run_demo</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[<span class="hljs-subst">&#123;time.strftime(<span class="hljs-string">&#x27;%X&#x27;</span>)&#125;</span>] å¼€å§‹å‘é€è¯·æ±‚...&quot;</span>)<br>    <br>    <span class="hljs-comment"># ä½¿ç”¨ await è°ƒç”¨ ainvoke</span><br>    <span class="hljs-comment"># æ­¤æ—¶ï¼ŒPython å¯ä»¥åœ¨ç­‰å¾… AI å›å¤çš„åŒæ—¶å»å¹²åˆ«çš„äº‹ï¼ˆå¦‚æœæœ‰å…¶ä»–å¹¶å‘ä»»åŠ¡çš„è¯ï¼‰</span><br>    result = <span class="hljs-keyword">await</span> chain.ainvoke(&#123;<span class="hljs-string">&quot;topic&quot;</span>: <span class="hljs-string">&quot;Pythonè¯­è¨€&quot;</span>&#125;)<br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[<span class="hljs-subst">&#123;time.strftime(<span class="hljs-string">&#x27;%X&#x27;</span>)&#125;</span>] AIå›å¤åˆ°äº†ï¼š<span class="hljs-subst">&#123;result&#125;</span>&quot;</span>)<br><br><span class="hljs-comment"># åœ¨ Jupyter ä¸­ç›´æ¥è¿è¡Œè¿™è¡Œï¼ˆå¦‚æœåœ¨æ™®é€š .py æ–‡ä»¶ä¸­ï¼Œéœ€ä½¿ç”¨ asyncio.run(run_demo())ï¼‰</span><br><span class="hljs-keyword">await</span> run_demo()<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">Collecting asyncio
  Downloading asyncio-4.0.0-py3-none-any.whl.metadata (994 bytes)
Downloading asyncio-4.0.0-py3-none-any.whl (5.6 kB)
Installing collected packages: asyncio
Successfully installed asyncio-4.0.0
Note: you may need to restart the kernel to use updated packages.
[15:48:08] å¼€å§‹å‘é€è¯·æ±‚...
[15:48:09] AIå›å¤åˆ°äº†ï¼šPythonæ˜¯ä¸€ç§ç®€å•æ˜“è¯»ã€åŠŸèƒ½å¼ºå¤§çš„é«˜çº§ç¼–ç¨‹è¯­è¨€ã€‚
</code></pre>
<ol start="3">
<li>å¹¶è¡Œå¤„ç† (Parallel) â€”â€” åŒæ—¶å¼€å·¥<br>åœºæ™¯ï¼šä½ éœ€è¦åˆ†æä¸€ä¸ªäº§å“ï¼Œæƒ³è¦åŒæ—¶å¾—åˆ°å®ƒçš„â€œä¼˜ç‚¹â€å’Œâ€œç¼ºç‚¹â€ã€‚<br>ä¼ ç»Ÿå†™æ³•ï¼šå…ˆé—®ä¼˜ç‚¹ï¼ˆç­‰ 3 ç§’ï¼‰ï¼Œå†é—®ç¼ºç‚¹ï¼ˆç­‰ 3 ç§’ï¼‰ï¼Œæ€»å…± 6 ç§’ã€‚<br>LangChain å¹¶è¡Œï¼šåŒæ—¶é—®ï¼Œæ€»å…±åªè¦ 3 ç§’ï¼ˆå–å†³äºæ…¢çš„é‚£ä¸€ä¸ªï¼‰ã€‚</li>
</ol>
<p>åŸç†å›¾è§£ï¼š<br>ä»£ç å®ç°ï¼š æˆ‘ä»¬éœ€è¦å¼•å…¥ RunnableParallelï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨å­—å…¸ç»“æ„ï¼ˆè¿™æ˜¯è¯­æ³•ç³–ï¼‰ã€‚<br>RunnableParallel å°±åƒä¸€ä¸ªåˆ†æµå™¨ã€‚å®ƒæ¥æ”¶åˆ° {â€œproductâ€: â€œiPhone 15â€} åï¼ŒåŒæ—¶æŠŠå®ƒä¸¢ç»™ pros_chain å’Œ cons_chainã€‚å®ƒä¼šç­‰å¾…ä¸¤ä¸ªé“¾éƒ½è·‘å®Œï¼Œç„¶åæŠŠç»“æœæ‹¼æˆä¸€ä¸ªå­—å…¸ï¼š{â€˜prosâ€™: â€˜â€¦â€™, â€˜consâ€™: â€˜â€¦â€™} è¿”å›ç»™ä½ ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain_core.runnables <span class="hljs-keyword">import</span> RunnableParallel<br><br><span class="hljs-comment"># 1. å®šä¹‰ä¸¤ä¸ªç‹¬ç«‹çš„é“¾</span><br><span class="hljs-comment"># é“¾ Aï¼šæ‰¾ä¼˜ç‚¹</span><br>pros_chain = (<br>    ChatPromptTemplate.from_template(<span class="hljs-string">&quot;åˆ—å‡º&#123;product&#125;çš„3ä¸ªä¼˜ç‚¹ã€‚&quot;</span>)<br>    | model<br>    | parser<br>)<br><br><span class="hljs-comment"># é“¾ Bï¼šæ‰¾ç¼ºç‚¹</span><br>cons_chain = (<br>    ChatPromptTemplate.from_template(<span class="hljs-string">&quot;åˆ—å‡º&#123;product&#125;çš„3ä¸ªç¼ºç‚¹ã€‚&quot;</span>)<br>    | model<br>    | parser<br>)<br><br><span class="hljs-comment"># 2. ã€é«˜å…‰æ—¶åˆ»ã€‘æ„å»ºå¹¶è¡Œé“¾</span><br><span class="hljs-comment"># è¿™é‡Œçš„ key (&#x27;pros&#x27;, &#x27;cons&#x27;) å°†ä¼šæˆä¸ºæœ€ç»ˆç»“æœå­—å…¸çš„ key</span><br>map_chain = RunnableParallel(<br>    pros=pros_chain,<br>    cons=cons_chain<br>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ­£åœ¨åŒæ—¶æ€è€ƒä¼˜ç‚¹å’Œç¼ºç‚¹...&quot;</span>)<br><br><span class="hljs-comment"># 3. è°ƒç”¨å¹¶è¡Œé“¾</span><br><span class="hljs-comment"># è¾“å…¥çš„ &#123;&quot;product&quot;: &quot;iPhone&quot;&#125; ä¼šè‡ªåŠ¨åˆ†å‘ç»™ä¸¤ä¸ªå­é“¾</span><br>result = map_chain.invoke(&#123;<span class="hljs-string">&quot;product&quot;</span>: <span class="hljs-string">&quot;iPhone 14pro&quot;</span>&#125;)<br><br><span class="hljs-comment"># 4. æ‰“å°ç»“æœ</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n=== ä¼˜ç‚¹ ===&quot;</span>)<br><span class="hljs-built_in">print</span>(result[<span class="hljs-string">&#x27;pros&#x27;</span>])<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n=== ç¼ºç‚¹ ===&quot;</span>)<br><span class="hljs-built_in">print</span>(result[<span class="hljs-string">&#x27;cons&#x27;</span>])<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">æ­£åœ¨åŒæ—¶æ€è€ƒä¼˜ç‚¹å’Œç¼ºç‚¹...

=== ä¼˜ç‚¹ ===
iPhone 14 Proä½œä¸ºè‹¹æœå…¬å¸æ¨å‡ºçš„ä¸€æ¬¾é«˜ç«¯æ™ºèƒ½æ‰‹æœºï¼Œå…·æœ‰è®¸å¤šå¸å¼•äººçš„ç‰¹ç‚¹ã€‚ä»¥ä¸‹æ˜¯å®ƒçš„ä¸‰ä¸ªä¼˜ç‚¹ï¼š

1. **å¼ºå¤§çš„A16ä»¿ç”ŸèŠ¯ç‰‡**ï¼šiPhone 14 Proæ­è½½äº†è‹¹æœè‡ªå®¶ç ”å‘çš„A16ä»¿ç”ŸèŠ¯ç‰‡ï¼Œè¿™æ˜¯ä¸€æ¬¾æ€§èƒ½å¼ºå¤§çš„èŠ¯ç‰‡ï¼Œä¸ä»…åœ¨å¤„ç†é€Ÿåº¦å’Œæ•ˆç‡ä¸Šè¡¨ç°å‡ºè‰²ï¼Œè¿˜æ”¯æŒå…ˆè¿›çš„æœºå™¨å­¦ä¹ åŠŸèƒ½ï¼Œèƒ½å¤Ÿæä¾›æµç•…çš„ç”¨æˆ·ä½“éªŒå’Œé«˜æ•ˆçš„èƒ½æ•ˆæ¯”ã€‚

2. **Proçº§æ‘„åƒå¤´ç³»ç»Ÿ**ï¼šiPhone 14 Proé…å¤‡äº†å…ˆè¿›çš„æ‘„åƒå¤´ç³»ç»Ÿï¼ŒåŒ…æ‹¬ä¸€ä¸ª4800ä¸‡åƒç´ çš„ä¸»æ‘„åƒå¤´ã€ä¸€ä¸ª1200ä¸‡åƒç´ çš„è¶…å¹¿è§’æ‘„åƒå¤´å’Œä¸€ä¸ª1200ä¸‡åƒç´ çš„é•¿ç„¦æ‘„åƒå¤´ã€‚è¿™äº›æ‘„åƒå¤´æ”¯æŒå¤šç§ä¸“ä¸šçº§æ‘„å½±åŠŸèƒ½ï¼Œå¦‚ProRAWæ ¼å¼ã€ç”µå½±æ¨¡å¼ä¸‹çš„è‡ªåŠ¨å¯¹ç„¦å’Œäººåƒæ¨¡å¼ç­‰ï¼Œèƒ½å¤Ÿæ»¡è¶³ç”¨æˆ·å¯¹é«˜è´¨é‡æ‘„å½±çš„éœ€æ±‚ã€‚

3. **æ”¹è¿›çš„æ˜¾ç¤ºæŠ€æœ¯**ï¼šiPhone 14 Proé‡‡ç”¨äº†Super Retina XDRæ˜¾ç¤ºå±ï¼Œæ”¯æŒProMotionè‡ªé€‚åº”åˆ·æ–°ç‡æŠ€æœ¯ï¼Œåˆ·æ–°ç‡å¯åœ¨10Hzåˆ°120Hzä¹‹é—´åŠ¨æ€è°ƒæ•´ï¼Œä»¥ä¼˜åŒ–æ˜¾ç¤ºæ•ˆæœå’Œç”µæ± å¯¿å‘½ã€‚è¿™ç§æŠ€æœ¯ä¸ä»…æå‡äº†å±å¹•çš„æµç•…åº¦ï¼Œè¿˜å¢å¼ºäº†è§†è§‰ä½“éªŒï¼Œç‰¹åˆ«æ˜¯åœ¨è§‚çœ‹è§†é¢‘æˆ–è¿›è¡Œæ¸¸æˆæ—¶ã€‚

ä»¥ä¸Šæ˜¯iPhone 14 Proçš„ä¸€äº›ä¸»è¦ä¼˜ç‚¹ï¼Œå½“ç„¶ï¼Œå…·ä½“é€‰æ‹©è¿˜éœ€æ ¹æ®ä¸ªäººéœ€æ±‚å’Œåå¥½æ¥å†³å®šã€‚

=== ç¼ºç‚¹ ===
iPhone 14 Proä½œä¸ºè‹¹æœå…¬å¸æ¨å‡ºçš„ä¸€æ¬¾é«˜ç«¯æ™ºèƒ½æ‰‹æœºï¼Œè™½ç„¶åœ¨æ€§èƒ½å’ŒåŠŸèƒ½ä¸Šæœ‰å¾ˆå¤šäº®ç‚¹ï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€äº›ç¼ºç‚¹ã€‚ä»¥ä¸‹æ˜¯iPhone 14 Proçš„ä¸‰ä¸ªå¯èƒ½çš„ç¼ºç‚¹ï¼š

1. **ä»·æ ¼è¾ƒé«˜**ï¼šiPhone 14 Proä½œä¸ºé«˜ç«¯æœºå‹ï¼Œå…¶ä»·æ ¼ç›¸å¯¹è¾ƒé«˜ï¼Œå¯¹äºé¢„ç®—æœ‰é™çš„æ¶ˆè´¹è€…æ¥è¯´å¯èƒ½ä¸å¤ªå‹å¥½ã€‚é«˜ç«¯é…ç½®å’Œææ–™çš„ä½¿ç”¨ä½¿å¾—å…¶æˆæœ¬å¢åŠ ï¼Œæœ€ç»ˆåæ˜ åœ¨å”®ä»·ä¸Šã€‚

2. **ç”µæ± ç»­èˆªä¸€èˆ¬**ï¼šå°½ç®¡iPhone 14 Proåœ¨å…¶ä»–æ–¹é¢è¡¨ç°ä¼˜ç§€ï¼Œä½†åœ¨ç”µæ± ç»­èˆªæ–¹é¢å¯èƒ½ä¸å¦‚ä¸€äº›ç«äº‰å¯¹æ‰‹ã€‚å¯¹äºé‡åº¦ç”¨æˆ·æ¥è¯´ï¼Œå¯èƒ½éœ€è¦æ›´é¢‘ç¹åœ°å……ç”µã€‚

3. **ä¸æ”¯æŒæ­£åæ’å……ç”µ**ï¼šiPhone 14 Proä»ç„¶é‡‡ç”¨Lightningæ¥å£ï¼Œä¸æ”¯æŒæ­£åæ’å……ç”µï¼Œè¿™ä¸ä¸€äº›ç«äº‰å¯¹æ‰‹ï¼ˆå¦‚éƒ¨åˆ†å®‰å“æ‰‹æœºï¼‰ç›¸æ¯”ï¼Œä½¿ç”¨ä½“éªŒä¸Šç•¥æ˜¾ä¸ä¾¿ã€‚ä¸è¿‡ï¼Œè‹¹æœå…¬å¸å·²ç»å®£å¸ƒå°†åœ¨æœªæ¥å‡ å¹´å†…é€æ­¥æ·˜æ±°Lightningæ¥å£ï¼Œè½¬è€Œé‡‡ç”¨USB-Cæ¥å£ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›ç¼ºç‚¹æ˜¯ç›¸å¯¹è€Œè¨€çš„ï¼Œå…·ä½“ä½“éªŒè¿˜å¯èƒ½å› ä¸ªäººä½¿ç”¨ä¹ æƒ¯å’Œéœ€æ±‚è€Œæœ‰æ‰€ä¸åŒã€‚
</code></pre>
<h2 id="ç¬¬ä¸‰ç« -å‚¨å­˜"><a href="#ç¬¬ä¸‰ç« -å‚¨å­˜" class="headerlink" title="ç¬¬ä¸‰ç«  å‚¨å­˜"></a>ç¬¬ä¸‰ç«  å‚¨å­˜</h2><p>ä½¿ç”¨ LangChain ä¸­çš„å‚¨å­˜(Memory)æ¨¡å—æ—¶ï¼Œå®ƒæ—¨åœ¨ä¿å­˜ã€ç»„ç»‡å’Œè·Ÿè¸ªæ•´ä¸ªå¯¹è¯çš„å†å²ï¼Œä»è€Œä¸ºç”¨æˆ·å’Œæ¨¡å‹ä¹‹é—´çš„äº¤äº’æä¾›è¿ç»­çš„ä¸Šä¸‹æ–‡ã€‚<br>LangChain æä¾›äº†å¤šç§å‚¨å­˜ç±»å‹ã€‚å…¶ä¸­ï¼Œç¼“å†²åŒºå‚¨å­˜å…è®¸ä¿ç•™æœ€è¿‘çš„èŠå¤©æ¶ˆæ¯ï¼Œæ‘˜è¦å‚¨å­˜åˆ™æä¾›äº†å¯¹æ•´ä¸ªå¯¹è¯çš„æ‘˜è¦ã€‚å®ä½“å‚¨å­˜åˆ™å…è®¸åœ¨å¤šè½®å¯¹è¯ä¸­ä¿ç•™æœ‰å…³ç‰¹å®šå®ä½“çš„ä¿¡æ¯ã€‚è¿™äº›è®°å¿†ç»„ä»¶éƒ½æ˜¯æ¨¡å—åŒ–çš„ï¼Œå¯ä¸å…¶ä»–ç»„ä»¶ç»„åˆä½¿ç”¨ï¼Œä»è€Œå¢å¼ºæœºå™¨äººçš„å¯¹è¯ç®¡ç†èƒ½åŠ›ã€‚å‚¨å­˜æ¨¡å—å¯ä»¥é€šè¿‡ç®€å•çš„ API è°ƒç”¨æ¥è®¿é—®å’Œæ›´æ–°ï¼Œå…è®¸å¼€å‘äººå‘˜æ›´è½»æ¾åœ°å®ç°å¯¹è¯å†å²è®°å½•çš„ç®¡ç†å’Œç»´æŠ¤ã€‚<br>å¯¹è¯ç¼“å­˜å‚¨å­˜ (ConversationBufferMemoryï¼‰<br>å¯¹è¯ç¼“å­˜çª—å£å‚¨å­˜ (ConversationBufferWindowMemoryï¼‰<br>å¯¹è¯ä»¤ç‰Œç¼“å­˜å‚¨å­˜ (ConversationTokenBufferMemoryï¼‰<br>å¯¹è¯æ‘˜è¦ç¼“å­˜å‚¨å­˜ (ConversationSummaryBufferMemoryï¼‰</p>
<p>åœ¨ LangChain ä¸­ï¼Œå‚¨å­˜æŒ‡çš„æ˜¯å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„çŸ­æœŸè®°å¿†ã€‚ä¸ºä»€ä¹ˆæ˜¯çŸ­æœŸè®°å¿†ï¼Ÿé‚£æ˜¯å› ä¸ºLLMè®­ç»ƒå¥½ä¹‹å (è·å¾—äº†ä¸€äº›é•¿æœŸè®°å¿†)ï¼Œå®ƒçš„å‚æ•°ä¾¿ä¸ä¼šå› ä¸ºç”¨æˆ·çš„è¾“å…¥è€Œå‘ç”Ÿæ”¹å˜ã€‚å½“ç”¨æˆ·ä¸è®­ç»ƒå¥½çš„LLMè¿›è¡Œå¯¹è¯æ—¶ï¼ŒLLM ä¼šæš‚æ—¶è®°ä½ç”¨æˆ·çš„è¾“å…¥å’Œå®ƒå·²ç»ç”Ÿæˆçš„è¾“å‡ºï¼Œä»¥ä¾¿é¢„æµ‹ä¹‹åçš„è¾“å‡ºï¼Œè€Œæ¨¡å‹è¾“å‡ºå®Œæ¯•åï¼Œå®ƒä¾¿ä¼šâ€œé—å¿˜â€ä¹‹å‰ç”¨æˆ·çš„è¾“å…¥å’Œå®ƒçš„è¾“å‡ºã€‚å› æ­¤ï¼Œä¹‹å‰çš„è¿™äº›ä¿¡æ¯åªèƒ½ç§°ä½œä¸º LLM çš„çŸ­æœŸè®°å¿†ã€‚</p>
<p>é€šè¿‡å€ŸåŠ©å¤–éƒ¨å‚¨å­˜æ–¹å¼ï¼Œæ¥è¿›è¡Œè®°å¿†ï¼Œä»¥ä¾¿åœ¨ç”¨æˆ·ä¸llmå¯¹è¯ä¸­ï¼Œllmèƒ½å¤Ÿå°½å¯èƒ½çš„çŸ¥é“ç”¨æˆ·ä¸å®ƒæ‰€è¿›è¡Œçš„å†å²å¯¹è¯ä¿¡æ¯ã€‚</p>
<p>ä¸€ã€å¯¹è¯ç¼“å­˜å‚¨å­˜ (ConversationBufferMemoryï¼‰</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><span class="hljs-comment"># 3. å¤„ç†æ¨¡å—å¯¼å…¥ (ä¿æŒæ‚¨åŸæœ‰çš„é€»è¾‘)</span><br><span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;tool&#x27;</span> <span class="hljs-keyword">in</span> sys.modules:<br>    <span class="hljs-keyword">del</span> sys.modules[<span class="hljs-string">&#x27;tool&#x27;</span>]<br><span class="hljs-comment"># if &#x27;utils_zh&#x27; in sys.modules:</span><br><span class="hljs-comment">#     del sys.modules[&#x27;utils_zh&#x27;]</span><br><span class="hljs-comment"># é‡æ–°å¯¼å…¥æ¨¡å—</span><br>sys.path.append(<span class="hljs-string">&#x27;/home/py/shared/StudyChatgpt&#x27;</span>)<br><span class="hljs-keyword">from</span> tool <span class="hljs-keyword">import</span> get_chat_model2<br><br><span class="hljs-comment"># 1.1 åˆå§‹åŒ–å¯¹è¯æ¨¡å‹</span><br><span class="hljs-comment"># from langchain.chains import ConversationChain   ã€å¼ƒç”¨ã€‘</span><br><span class="hljs-comment"># from langchain.memory import ConversationBufferMemory   ã€å¼ƒç”¨ã€‘</span><br><span class="hljs-comment"># å»ºè®®ä½¿ç”¨ConversationSummaryMemoryæˆ–ConversationSummaryBufferMemoryæ¥æ›¿ä»£</span><br><span class="hljs-keyword">from</span> langchain.<span class="hljs-built_in">globals</span> <span class="hljs-keyword">import</span> set_debug<br><span class="hljs-keyword">from</span> langchain_community.chat_message_histories <span class="hljs-keyword">import</span> ChatMessageHistory<br><span class="hljs-keyword">from</span> langchain_core.chat_history <span class="hljs-keyword">import</span> BaseChatMessageHistory<br><span class="hljs-keyword">from</span> langchain_core.runnables.history <span class="hljs-keyword">import</span> RunnableWithMessageHistory<br><span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate, MessagesPlaceholder<br><br><span class="hljs-comment"># ================= åŸºç¡€è®¾ç½® =================</span><br><span class="hljs-comment"># å¼€å¯è°ƒè¯•æ¨¡å¼ï¼Œè¿™ä¼šè®©ä½ åœ¨æ§åˆ¶å°çœ‹åˆ°ç»¿è‰²çš„è¯¦ç»†æ—¥å¿—ï¼ˆPrompt æ˜¯æ€ä¹ˆæ‹¼çš„ï¼ŒToken ç”¨äº†å¤šå°‘ç­‰ï¼‰</span><br>set_debug(<span class="hljs-literal">True</span>)<br><br><span class="hljs-comment"># åˆå§‹åŒ–å¤§æ¨¡å‹å¯¹è±¡ï¼ˆè¿™åªæ˜¯ä¸€ä¸ªæ‰§è¡Œè€…ï¼Œå®ƒè‡ªå·±ä¸è®°äº‹ï¼‰</span><br>chat = get_chat_model2(temperature=<span class="hljs-number">0.0</span>)<br><br><span class="hljs-comment"># ================= æ­¥éª¤ 2: æ„å»º Prompt =================</span><br><span class="hljs-comment"># è¿™é‡Œå®šä¹‰äº†å¯¹è¯çš„â€œæ¨¡å…·â€ã€‚</span><br>prompt = ChatPromptTemplate.from_messages([<br>    <span class="hljs-comment"># ç³»ç»Ÿæç¤ºè¯ï¼šå®šåŸºè°ƒ</span><br>    (<span class="hljs-string">&quot;system&quot;</span>, <span class="hljs-string">&quot;ä½ æ˜¯ä¸€ä¸ªä¹äºåŠ©äººçš„åŠ©æ‰‹ã€‚&quot;</span>),<br>    <br>    <span class="hljs-comment"># ã€å…³é”®ç»„ä»¶ã€‘MessagesPlaceholder</span><br>    <span class="hljs-comment"># å®ƒçš„ä½œç”¨æ˜¯å ä½ã€‚å‘Šè¯‰ LangChainï¼šâ€œç­‰ä¼šå„¿æ‹¿åˆ°çš„å†å²è®°å½•ï¼ˆMessageå¯¹è±¡åˆ—è¡¨ï¼‰ï¼Œè¯·åŸå°ä¸åŠ¨åœ°å¡åˆ°è¿™é‡Œï¼â€</span><br>    <span class="hljs-comment"># variable_name=&quot;history&quot; å¿…é¡»å’Œåé¢åŒ…è£…å™¨é‡Œçš„ history_messages_key å¯¹åº”</span><br>    MessagesPlaceholder(variable_name=<span class="hljs-string">&quot;history&quot;</span>), <br>    <br>    <span class="hljs-comment"># ç”¨æˆ·çš„å½“å‰è¾“å…¥</span><br>    (<span class="hljs-string">&quot;human&quot;</span>, <span class="hljs-string">&quot;&#123;input&#125;&quot;</span>),<br>])<br><br><span class="hljs-comment"># ================= æ­¥éª¤ 3: æ„å»ºåŸºç¡€é“¾ =================</span><br><span class="hljs-comment"># ä½¿ç”¨ LCEL ç®¡é“ç¬¦ |</span><br><span class="hljs-comment"># æ•°æ®æµå‘ï¼šç”¨æˆ·è¾“å…¥ -&gt; Promptå¡«å…… -&gt; å‘ç»™Chatæ¨¡å‹ -&gt; å¾—åˆ°AIå›ç­”</span><br>llm = prompt | chat<br><br><span class="hljs-comment"># ================= æ­¥éª¤ 4: å®šä¹‰å­˜å‚¨æœºåˆ¶ =================</span><br><span class="hljs-comment"># è¿™æ˜¯ä¸€ä¸ªä¸´æ—¶çš„å†…å­˜å­—å…¸ã€‚å¦‚æœç¨‹åºé‡å¯ï¼Œè¿™é‡Œçš„æ•°æ®ä¼šä¸¢å¤±ã€‚</span><br><span class="hljs-comment"># åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿™é‡Œé€šå¸¸ä¼šæ¢æˆ Redis æˆ–æ•°æ®åº“è¿æ¥ã€‚</span><br>store = &#123;&#125;<br><br><span class="hljs-comment"># è¿™æ˜¯ä¸€ä¸ªå·¥å‚å‡½æ•°ã€‚</span><br><span class="hljs-comment"># å®ƒçš„é€»è¾‘æ˜¯ï¼šâ€œæœ‰æ—§è´¦æœ¬å°±æŸ¥æ—§è´¦æœ¬ï¼Œæ²¡æ—§è´¦æœ¬å°±å¼€æ–°è´¦æœ¬â€</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_session_history</span>(<span class="hljs-params">session_id: <span class="hljs-built_in">str</span></span>) -&gt; BaseChatMessageHistory:<br>    <span class="hljs-keyword">if</span> session_id <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> store:<br>        <span class="hljs-comment"># å¦‚æœè¿™ä¸ª session_id ç¬¬ä¸€æ¬¡æ¥ï¼Œç»™ä»–å‘ä¸ªæ–°æœ¬å­ï¼ˆåˆ›å»ºæ–°å†å²å¯¹è±¡ï¼‰</span><br>        store[session_id] = ChatMessageHistory()<br>    <span class="hljs-comment"># å¦‚æœä»¥å‰æ¥è¿‡ï¼Œå°±æŠŠä»–ä¹‹å‰çš„æœ¬å­æ‹¿å‡ºæ¥ï¼ˆè¿”å›å·²æœ‰çš„å¯¹è±¡ï¼‰</span><br>    <span class="hljs-keyword">return</span> store[session_id]<br><br><span class="hljs-comment"># ================= æ­¥éª¤ 5: æ³¨å…¥è®°å¿†èƒ½åŠ› =================</span><br><span class="hljs-comment"># RunnableWithMessageHistory æ˜¯ä¸€ä¸ªâ€œå¤–æŒ‚â€ã€‚</span><br><span class="hljs-comment"># å®ƒæŠŠæœ¬æ¥æ²¡æœ‰è®°å¿†çš„ `llm` (åŸºç¡€é“¾) åŒ…è£¹èµ·æ¥ï¼Œèµ‹äºˆå®ƒè¯»å†™å†å²çš„èƒ½åŠ›ã€‚</span><br>conversation = RunnableWithMessageHistory(<br>    runnable=llm,                         <span class="hljs-comment"># è¢«åŒ…è£¹çš„é“¾</span><br>    get_session_history=get_session_history, <span class="hljs-comment"># å‘Šè¯‰å®ƒå»å“ªé‡Œæ‰¾å†å²ã€‚RunnableWithMessageHistory è¿™ä¸ªåŒ…è£…å™¨å¹¶ä¸çŸ¥é“ä½ è¦æŠŠå†å²å­˜åœ¨å“ªé‡Œï¼ˆæ˜¯å­˜åœ¨å†…å­˜ï¼ŸRedisï¼Ÿè¿˜æ˜¯ SQLï¼Ÿï¼‰ã€‚æ‰€ä»¥å®ƒè¦æ±‚ä½ æä¾›ä¸€ä¸ªå‡½æ•°å‘Šè¯‰å®ƒæ€ä¹ˆè·å–å†å²ã€‚</span><br>    input_messages_key=<span class="hljs-string">&quot;input&quot;</span>,           <span class="hljs-comment"># å‘Šè¯‰å®ƒï¼šinvokeä¼ å…¥çš„å­—å…¸é‡Œï¼Œå“ªä¸ªå­—æ®µæ˜¯ç”¨æˆ·è¯´çš„è¯ï¼ˆç”¨äºå­˜å…¥å†å²ï¼‰</span><br>    history_messages_key=<span class="hljs-string">&quot;history&quot;</span>,       <span class="hljs-comment"># å‘Šè¯‰å®ƒï¼šè¯»å–åˆ°çš„å†å²è®°å½•ï¼Œè¦å¡«å…¥ Prompt é‡Œçš„å“ªä¸ªå ä½ç¬¦ï¼ˆå¯¹åº”ä¸Šé¢çš„ MessagesPlaceholderï¼‰</span><br>)<br></code></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ================= è°ƒç”¨ç¯èŠ‚ =================</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;--- ç¬¬ä¸€è½® ---&quot;</span>)<br><span class="hljs-comment"># è°ƒç”¨ invokeã€‚</span><br><span class="hljs-comment"># config ä¸­çš„ session_id æ˜¯å¿…é¡»çš„ï¼Œå®ƒæ˜¯æŸ¥æ‰¾å†å²çš„å”¯ä¸€å‡­è¯ã€‚</span><br>conversation.invoke(<br>    &#123;<span class="hljs-string">&quot;input&quot;</span>: <span class="hljs-string">&quot;ä½ å¥½, æˆ‘å«çš®çš®é²&quot;</span>&#125;, <br>    config=&#123;<span class="hljs-string">&quot;configurable&quot;</span>: &#123;<span class="hljs-string">&quot;session_id&quot;</span>: <span class="hljs-string">&quot;session_123&quot;</span>&#125;&#125;<br>)<br><span class="hljs-comment"># æ­¤æ—¶ï¼Œstore[&quot;session_123&quot;] é‡Œå­˜äº†ä¸¤æ¡è®°å½•ï¼š</span><br><span class="hljs-comment"># 1. Human: ä½ å¥½, æˆ‘å«çš®çš®é²</span><br><span class="hljs-comment"># 2. AI: ä½ å¥½çš®çš®é²...</span><br></code></pre></td></tr></table></figure>

<pre><code class="hljs">--- ç¬¬ä¸€è½® ---
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä½ å¥½, æˆ‘å«çš®çš®é²&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä½ å¥½, æˆ‘å«çš®çš®é²&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt;] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä½ å¥½, æˆ‘å«çš®çš®é²&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:load_history] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä½ å¥½, æˆ‘å«çš®çš®é²&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:load_history] [1ms] Exiting Chain run with output:
[0m&#123;
  &quot;output&quot;: []
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt;] [2ms] Exiting Chain run with output:
[0m&#123;
  &quot;history&quot;: []
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history] [3ms] Exiting Chain run with output:
[0m&#123;
  &quot;input&quot;: &quot;ä½ å¥½, æˆ‘å«çš®çš®é²&quot;,
  &quot;history&quot;: []
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä½ å¥½, æˆ‘å«çš®çš®é²&quot;,
  &quot;history&quot;: []
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä½ å¥½, æˆ‘å«çš®çš®é²&quot;,
  &quot;history&quot;: []
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] Entering Prompt run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä½ å¥½, æˆ‘å«çš®çš®é²&quot;,
  &quot;history&quot;: []
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] [1ms] Exiting Prompt run with output:
[0m[outputs]
[32;1m[1;3m[llm/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] Entering LLM run with input:
[0m&#123;
  &quot;prompts&quot;: [
    &quot;System: ä½ æ˜¯ä¸€ä¸ªä¹äºåŠ©äººçš„åŠ©æ‰‹ã€‚\nHuman: ä½ å¥½, æˆ‘å«çš®çš®é²&quot;
  ]
&#125;
[36;1m[1;3m[llm/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] [954ms] Exiting LLM run with output:
[0m&#123;
  &quot;generations&quot;: [
    [
      &#123;
        &quot;text&quot;: &quot;ä½ å¥½ï¼Œçš®çš®é²ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ã€‚ä½ å¬è¯´è¿‡ã€Šçš®çš®é²ä¼ ã€‹å—ï¼Ÿè¿™æ˜¯éƒ‘æ¸Šæ´çˆ·çˆ·åˆ›ä½œçš„ä¸€ç³»åˆ—ç«¥è¯æ•…äº‹ï¼Œè®²è¿°äº†çš®çš®é²å’Œä»–çš„æœ‹å‹ä»¬çš„å†’é™©æ•…äº‹ã€‚&quot;,
        &quot;generation_info&quot;: &#123;
          &quot;finish_reason&quot;: &quot;stop&quot;,
          &quot;logprobs&quot;: null
        &#125;,
        &quot;type&quot;: &quot;ChatGeneration&quot;,
        &quot;message&quot;: &#123;
          &quot;lc&quot;: 1,
          &quot;type&quot;: &quot;constructor&quot;,
          &quot;id&quot;: [
            &quot;langchain&quot;,
            &quot;schema&quot;,
            &quot;messages&quot;,
            &quot;AIMessage&quot;
          ],
          &quot;kwargs&quot;: &#123;
            &quot;content&quot;: &quot;ä½ å¥½ï¼Œçš®çš®é²ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ã€‚ä½ å¬è¯´è¿‡ã€Šçš®çš®é²ä¼ ã€‹å—ï¼Ÿè¿™æ˜¯éƒ‘æ¸Šæ´çˆ·çˆ·åˆ›ä½œçš„ä¸€ç³»åˆ—ç«¥è¯æ•…äº‹ï¼Œè®²è¿°äº†çš®çš®é²å’Œä»–çš„æœ‹å‹ä»¬çš„å†’é™©æ•…äº‹ã€‚&quot;,
            &quot;additional_kwargs&quot;: &#123;
              &quot;refusal&quot;: null
            &#125;,
            &quot;response_metadata&quot;: &#123;
              &quot;token_usage&quot;: &#123;
                &quot;completion_tokens&quot;: 41,
                &quot;prompt_tokens&quot;: 29,
                &quot;total_tokens&quot;: 70,
                &quot;completion_tokens_details&quot;: null,
                &quot;prompt_tokens_details&quot;: null
              &#125;,
              &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
              &quot;system_fingerprint&quot;: &quot;&quot;,
              &quot;id&quot;: &quot;019b27201e8c07bd64c999cb31b3b6a6&quot;,
              &quot;service_tier&quot;: null,
              &quot;finish_reason&quot;: &quot;stop&quot;,
              &quot;logprobs&quot;: null
            &#125;,
            &quot;type&quot;: &quot;ai&quot;,
            &quot;id&quot;: &quot;run--ac76a79b-b449-45ae-89fc-4838018c4e35-0&quot;,
            &quot;usage_metadata&quot;: &#123;
              &quot;input_tokens&quot;: 29,
              &quot;output_tokens&quot;: 41,
              &quot;total_tokens&quot;: 70,
              &quot;input_token_details&quot;: &#123;&#125;,
              &quot;output_token_details&quot;: &#123;&#125;
            &#125;,
            &quot;tool_calls&quot;: [],
            &quot;invalid_tool_calls&quot;: []
          &#125;
        &#125;
      &#125;
    ]
  ],
  &quot;llm_output&quot;: &#123;
    &quot;token_usage&quot;: &#123;
      &quot;completion_tokens&quot;: 41,
      &quot;prompt_tokens&quot;: 29,
      &quot;total_tokens&quot;: 70,
      &quot;completion_tokens_details&quot;: null,
      &quot;prompt_tokens_details&quot;: null
    &#125;,
    &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
    &quot;system_fingerprint&quot;: &quot;&quot;,
    &quot;id&quot;: &quot;019b27201e8c07bd64c999cb31b3b6a6&quot;,
    &quot;service_tier&quot;: null
  &#125;,
  &quot;run&quot;: null,
  &quot;type&quot;: &quot;LLMResult&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence] [957ms] Exiting Chain run with output:
[0m[outputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async] [958ms] Exiting Chain run with output:
[0m[outputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory] [961ms] Exiting Chain run with output:
[0m[outputs]





AIMessage(content=&#39;ä½ å¥½ï¼Œçš®çš®é²ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ã€‚ä½ å¬è¯´è¿‡ã€Šçš®çš®é²ä¼ ã€‹å—ï¼Ÿè¿™æ˜¯éƒ‘æ¸Šæ´çˆ·çˆ·åˆ›ä½œçš„ä¸€ç³»åˆ—ç«¥è¯æ•…äº‹ï¼Œè®²è¿°äº†çš®çš®é²å’Œä»–çš„æœ‹å‹ä»¬çš„å†’é™©æ•…äº‹ã€‚&#39;, additional_kwargs=&#123;&#39;refusal&#39;: None&#125;, response_metadata=&#123;&#39;token_usage&#39;: &#123;&#39;completion_tokens&#39;: 41, &#39;prompt_tokens&#39;: 29, &#39;total_tokens&#39;: 70, &#39;completion_tokens_details&#39;: None, &#39;prompt_tokens_details&#39;: None&#125;, &#39;model_name&#39;: &#39;Qwen/Qwen2.5-7B-Instruct&#39;, &#39;system_fingerprint&#39;: &#39;&#39;, &#39;id&#39;: &#39;019b27201e8c07bd64c999cb31b3b6a6&#39;, &#39;service_tier&#39;: None, &#39;finish_reason&#39;: &#39;stop&#39;, &#39;logprobs&#39;: None&#125;, id=&#39;run--ac76a79b-b449-45ae-89fc-4838018c4e35-0&#39;, usage_metadata=&#123;&#39;input_tokens&#39;: 29, &#39;output_tokens&#39;: 41, &#39;total_tokens&#39;: 70, &#39;input_token_details&#39;: &#123;&#125;, &#39;output_token_details&#39;: &#123;&#125;&#125;)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;--- ç¬¬äºŒè½® ---&quot;</span>)<br><span class="hljs-comment"># å†æ¬¡è°ƒç”¨ï¼Œä½¿ç”¨åŒä¸€ä¸ª session_id</span><br><span class="hljs-comment"># åŒ…è£…å™¨ä¼šè‡ªåŠ¨æŠŠç¬¬ä¸€è½®çš„å¯¹è¯å–å‡ºæ¥ï¼Œæ”¾åœ¨ Prompt ä¸­å‘ç»™æ¨¡å‹</span><br>conversation.invoke(<br>    &#123;<span class="hljs-string">&quot;input&quot;</span>: <span class="hljs-string">&quot;1+1ç­‰äºå¤šå°‘&quot;</span>&#125;,<br>    config=&#123;<span class="hljs-string">&quot;configurable&quot;</span>: &#123;<span class="hljs-string">&quot;session_id&quot;</span>: <span class="hljs-string">&quot;session_123&quot;</span>&#125;&#125;<br>)<br><span class="hljs-comment"># æ­¤æ—¶ï¼Œstore[&quot;session_123&quot;] é‡Œæœ‰å››æ¡è®°å½•ã€‚</span><br></code></pre></td></tr></table></figure>

<pre><code class="hljs">--- ç¬¬äºŒè½® ---
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;1+1ç­‰äºå¤šå°‘&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;1+1ç­‰äºå¤šå°‘&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt;] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;1+1ç­‰äºå¤šå°‘&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:load_history] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;1+1ç­‰äºå¤šå°‘&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:load_history] [1ms] Exiting Chain run with output:
[0m[outputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt;] [2ms] Exiting Chain run with output:
[0m[outputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history] [3ms] Exiting Chain run with output:
[0m[outputs]
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async] Entering Chain run with input:
[0m[inputs]
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence] Entering Chain run with input:
[0m[inputs]
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] Entering Prompt run with input:
[0m[inputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] [1ms] Exiting Prompt run with output:
[0m[outputs]
[32;1m[1;3m[llm/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] Entering LLM run with input:
[0m&#123;
  &quot;prompts&quot;: [
    &quot;System: ä½ æ˜¯ä¸€ä¸ªä¹äºåŠ©äººçš„åŠ©æ‰‹ã€‚\nHuman: ä½ å¥½, æˆ‘å«çš®çš®é²\nAI: ä½ å¥½ï¼Œçš®çš®é²ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ã€‚ä½ å¬è¯´è¿‡ã€Šçš®çš®é²ä¼ ã€‹å—ï¼Ÿè¿™æ˜¯éƒ‘æ¸Šæ´çˆ·çˆ·åˆ›ä½œçš„ä¸€ç³»åˆ—ç«¥è¯æ•…äº‹ï¼Œè®²è¿°äº†çš®çš®é²å’Œä»–çš„æœ‹å‹ä»¬çš„å†’é™©æ•…äº‹ã€‚\nHuman: 1+1ç­‰äºå¤šå°‘&quot;
  ]
&#125;
[36;1m[1;3m[llm/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] [338ms] Exiting LLM run with output:
[0m&#123;
  &quot;generations&quot;: [
    [
      &#123;
        &quot;text&quot;: &quot;1+1ç­‰äº2ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬çš„åŠ æ³•è¿ç®—ã€‚&quot;,
        &quot;generation_info&quot;: &#123;
          &quot;finish_reason&quot;: &quot;stop&quot;,
          &quot;logprobs&quot;: null
        &#125;,
        &quot;type&quot;: &quot;ChatGeneration&quot;,
        &quot;message&quot;: &#123;
          &quot;lc&quot;: 1,
          &quot;type&quot;: &quot;constructor&quot;,
          &quot;id&quot;: [
            &quot;langchain&quot;,
            &quot;schema&quot;,
            &quot;messages&quot;,
            &quot;AIMessage&quot;
          ],
          &quot;kwargs&quot;: &#123;
            &quot;content&quot;: &quot;1+1ç­‰äº2ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬çš„åŠ æ³•è¿ç®—ã€‚&quot;,
            &quot;additional_kwargs&quot;: &#123;
              &quot;refusal&quot;: null
            &#125;,
            &quot;response_metadata&quot;: &#123;
              &quot;token_usage&quot;: &#123;
                &quot;completion_tokens&quot;: 13,
                &quot;prompt_tokens&quot;: 85,
                &quot;total_tokens&quot;: 98,
                &quot;completion_tokens_details&quot;: null,
                &quot;prompt_tokens_details&quot;: null
              &#125;,
              &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
              &quot;system_fingerprint&quot;: &quot;&quot;,
              &quot;id&quot;: &quot;019b27205b05e5463e8aa53495b596bf&quot;,
              &quot;service_tier&quot;: null,
              &quot;finish_reason&quot;: &quot;stop&quot;,
              &quot;logprobs&quot;: null
            &#125;,
            &quot;type&quot;: &quot;ai&quot;,
            &quot;id&quot;: &quot;run--fd5a99de-9c0e-4572-b9af-dccc724d133d-0&quot;,
            &quot;usage_metadata&quot;: &#123;
              &quot;input_tokens&quot;: 85,
              &quot;output_tokens&quot;: 13,
              &quot;total_tokens&quot;: 98,
              &quot;input_token_details&quot;: &#123;&#125;,
              &quot;output_token_details&quot;: &#123;&#125;
            &#125;,
            &quot;tool_calls&quot;: [],
            &quot;invalid_tool_calls&quot;: []
          &#125;
        &#125;
      &#125;
    ]
  ],
  &quot;llm_output&quot;: &#123;
    &quot;token_usage&quot;: &#123;
      &quot;completion_tokens&quot;: 13,
      &quot;prompt_tokens&quot;: 85,
      &quot;total_tokens&quot;: 98,
      &quot;completion_tokens_details&quot;: null,
      &quot;prompt_tokens_details&quot;: null
    &#125;,
    &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
    &quot;system_fingerprint&quot;: &quot;&quot;,
    &quot;id&quot;: &quot;019b27205b05e5463e8aa53495b596bf&quot;,
    &quot;service_tier&quot;: null
  &#125;,
  &quot;run&quot;: null,
  &quot;type&quot;: &quot;LLMResult&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence] [342ms] Exiting Chain run with output:
[0m[outputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async] [344ms] Exiting Chain run with output:
[0m[outputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory] [348ms] Exiting Chain run with output:
[0m[outputs]





AIMessage(content=&#39;1+1ç­‰äº2ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬çš„åŠ æ³•è¿ç®—ã€‚&#39;, additional_kwargs=&#123;&#39;refusal&#39;: None&#125;, response_metadata=&#123;&#39;token_usage&#39;: &#123;&#39;completion_tokens&#39;: 13, &#39;prompt_tokens&#39;: 85, &#39;total_tokens&#39;: 98, &#39;completion_tokens_details&#39;: None, &#39;prompt_tokens_details&#39;: None&#125;, &#39;model_name&#39;: &#39;Qwen/Qwen2.5-7B-Instruct&#39;, &#39;system_fingerprint&#39;: &#39;&#39;, &#39;id&#39;: &#39;019b27205b05e5463e8aa53495b596bf&#39;, &#39;service_tier&#39;: None, &#39;finish_reason&#39;: &#39;stop&#39;, &#39;logprobs&#39;: None&#125;, id=&#39;run--fd5a99de-9c0e-4572-b9af-dccc724d133d-0&#39;, usage_metadata=&#123;&#39;input_tokens&#39;: 85, &#39;output_tokens&#39;: 13, &#39;total_tokens&#39;: 98, &#39;input_token_details&#39;: &#123;&#125;, &#39;output_token_details&#39;: &#123;&#125;&#125;)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ================= æŸ¥çœ‹å†å² =================</span><br><span class="hljs-comment"># ç›´æ¥å» store å­—å…¸é‡ŒæŸ¥å²—</span><br>history_obj = get_session_history(<span class="hljs-string">&quot;session_123&quot;</span>) <br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;=== å†å²è®°å½•æ¡æ•°: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(history_obj.messages)&#125;</span> ===&quot;</span>)<br><br><span class="hljs-comment"># éå†æ‰“å°ï¼Œçœ‹çœ‹å®é™…ä¸Šå­˜äº†ä»€ä¹ˆ</span><br><span class="hljs-keyword">for</span> msg <span class="hljs-keyword">in</span> history_obj.messages:<br>    <span class="hljs-comment"># msg æ˜¯ BaseMessage å¯¹è±¡</span><br>    <span class="hljs-comment"># type å±æ€§é€šå¸¸æ˜¯ &#x27;human&#x27; æˆ– &#x27;ai&#x27;</span><br>    <span class="hljs-comment"># content å±æ€§æ˜¯æ–‡æœ¬å†…å®¹</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[<span class="hljs-subst">&#123;msg.<span class="hljs-built_in">type</span>&#125;</span>]: <span class="hljs-subst">&#123;msg.content&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">=== å†å²è®°å½•æ¡æ•°: 4 ===
[human]: ä½ å¥½, æˆ‘å«çš®çš®é²
[ai]: ä½ å¥½ï¼Œçš®çš®é²ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ã€‚ä½ å¬è¯´è¿‡ã€Šçš®çš®é²ä¼ ã€‹å—ï¼Ÿè¿™æ˜¯éƒ‘æ¸Šæ´çˆ·çˆ·åˆ›ä½œçš„ä¸€ç³»åˆ—ç«¥è¯æ•…äº‹ï¼Œè®²è¿°äº†çš®çš®é²å’Œä»–çš„æœ‹å‹ä»¬çš„å†’é™©æ•…äº‹ã€‚
[human]: 1+1ç­‰äºå¤šå°‘
[ai]: 1+1ç­‰äº2ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬çš„åŠ æ³•è¿ç®—ã€‚
</code></pre>
<p>äºŒã€å¯¹è¯ç¼“å­˜çª—å£å­˜å‚¨<br>éšç€å¯¹è¯å˜å¾—è¶Šæ¥è¶Šé•¿ï¼Œæ‰€éœ€çš„å†…å­˜é‡ä¹Ÿå˜å¾—éå¸¸é•¿ã€‚å°†å¤§é‡çš„tokenså‘é€åˆ°LLMçš„æˆæœ¬ï¼Œä¹Ÿä¼šå˜å¾—æ›´åŠ æ˜‚è´µï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆAPIçš„è°ƒç”¨è´¹ç”¨ï¼Œé€šå¸¸æ˜¯åŸºäºå®ƒéœ€è¦å¤„ç†çš„tokensæ•°é‡è€Œæ”¶è´¹çš„ã€‚</p>
<p>é’ˆå¯¹ä»¥ä¸Šé—®é¢˜ï¼ŒLangChainä¹Ÿæä¾›äº†å‡ ç§æ–¹ä¾¿çš„å‚¨å­˜æ–¹å¼æ¥ä¿å­˜å†å²å¯¹è¯ã€‚å…¶ä¸­ï¼Œå¯¹è¯ç¼“å­˜çª—å£å‚¨å­˜åªä¿ç•™ä¸€ä¸ªçª—å£å¤§å°çš„å¯¹è¯ã€‚å®ƒåªä½¿ç”¨æœ€è¿‘çš„næ¬¡äº¤äº’ã€‚è¿™å¯ä»¥ç”¨äºä¿æŒæœ€è¿‘äº¤äº’çš„æ»‘åŠ¨çª—å£ï¼Œä»¥ä¾¿ç¼“å†²åŒºä¸ä¼šè¿‡å¤§ã€‚</p>
<p>åˆ—è¡¨åˆ‡ç‰‡ å’Œ ç±»å‹æ³¨è§£</p>
<ol>
<li>åˆ—è¡¨åˆ‡ç‰‡<br>åœ¨ Python ä¸­ï¼Œåˆ—è¡¨åˆ‡ç‰‡æ˜¯ä¸€ç§å¸¸è§çš„æ“ä½œï¼Œç”¨äºè·å–åˆ—è¡¨çš„ä¸€éƒ¨åˆ†ã€‚å®ƒä½¿ç”¨ä¸¤ä¸ªç´¢å¼•æ¥æŒ‡å®šè¦åˆ‡ç‰‡çš„èŒƒå›´ï¼ŒåŒ…æ‹¬èµ·å§‹ç´¢å¼•ï¼Œä½†ä¸åŒ…æ‹¬ç»“æŸç´¢å¼•ã€‚ä¾‹å¦‚ï¼Œ<code>list[start:end]</code> å°†è¿”å›ä» <code>start</code> åˆ° <code>end-1</code> çš„å…ƒç´ ã€‚<br>è¯­æ³•æ‹†è§£ï¼š<br>history.messages: è¿™æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œé‡Œé¢è£…äº†ä¸€å †æ¶ˆæ¯å¯¹è±¡ï¼Œæ¯”å¦‚ [æ¶ˆæ¯1, æ¶ˆæ¯2, æ¶ˆæ¯3, æ¶ˆæ¯4, æ¶ˆæ¯5]ã€‚<br>[ â€¦ ]: è¿™æ˜¯åˆ‡ç‰‡æ“ä½œç¬¦ã€‚<br><br>-2: èµ·å§‹ä½ç½®ã€‚<br>æ­£æ•°ï¼ˆå¦‚ 0, 1ï¼‰è¡¨ç¤ºä»å¤´å¼€å§‹æ•°ã€‚<br>è´Ÿæ•°ï¼ˆå¦‚ -1, -2ï¼‰è¡¨ç¤ºä»å°¾å·´å€’ç€æ•°ã€‚-1 æ˜¯æœ€åä¸€ä¸ªï¼Œ-2 æ˜¯å€’æ•°ç¬¬äºŒä¸ªã€‚<br>:å†’å·ã€‚æ„æ€æ˜¯â€œä¸€ç›´åˆ°â€¦â€ã€‚å¦‚æœä¸å†™ç»“æŸä½ç½®ï¼Œé»˜è®¤å°±æ˜¯â€œä¸€ç›´åˆ°åˆ—è¡¨ç»“æŸâ€ã€‚</li>
</ol>
<p>å‡è®¾ history.messages &#x3D; [1, 2, 3, 4, 5]</p>
<p>å–å€’æ•°ç¬¬ 1 ä¸ª</p>
<p>print(history.messages[-1])   # ç»“æœ: 5</p>
<p>å–å€’æ•°ç¬¬ 2 ä¸ª</p>
<p>print(history.messages[-2])   # ç»“æœ: 4</p>
<p>ã€ä½ çš„ä»£ç ã€‘ä»å€’æ•°ç¬¬ 2 ä¸ªå¼€å§‹ï¼Œå–åˆ°æœ€å</p>
<p>print(history.messages[-2:])  # ç»“æœ: [4, 5]</p>
<p>LangChainä¸­ï¼Œä¸€è½®å¯¹è¯åŒ…æ‹¬ä¸€é—®ä¸€ç­”<br>history.messages[-2:] çš„æ„æ€å°±æ˜¯ï¼šâ€œåªä¿ç•™æœ€è¿‘çš„ä¸€è½®å¯¹è¯ï¼ˆå³æœ€åé‚£ä¸¤æ¡æ¶ˆæ¯ï¼‰ï¼ŒæŠŠå…¶ä»–çš„éƒ½ä¸¢æ‰&#x2F;å¿½ç•¥ã€‚â€</p>
<ol start="2">
<li>ç±»å‹æ³¨è§£    -&gt; BaseChatMessageHistory:     å‡½æ•°è¿”å›å€¼æ³¨è§£<br>ç±»å‹æ³¨è§£æ˜¯ä¸€ç§åœ¨ Python ä¸­æŒ‡å®šå˜é‡ç±»å‹çš„æ–¹æ³•ã€‚å®ƒå¯ä»¥åœ¨å‡½æ•°å‚æ•°å’Œè¿”å›å€¼ä¸­ä½¿ç”¨ï¼Œä»¥å¸®åŠ©å¼€å‘äººå‘˜ç†è§£ä»£ç çš„æ„å›¾ã€‚ä¾‹å¦‚ï¼Œ<code>def add(a: int, b: int) -&gt; int:</code> è¡¨ç¤º <code>add</code> å‡½æ•°æ¥å—ä¸¤ä¸ªæ•´æ•°å‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ•´æ•°ã€‚ç»™ä»£ç è´´æ ‡ç­¾ï¼Œè®© Cursor æ›´æ™ºèƒ½åœ°æç¤ºä»£ç ï¼Œæ–¹ä¾¿é˜…è¯»ã€‚</li>
</ol>
<p>def get_session_history(session_id: str) -&gt; BaseChatMessageHistory:<br>    if session_id not in store:<br>        # å¦‚æœè¿™ä¸ª session_id ç¬¬ä¸€æ¬¡æ¥ï¼Œç»™ä»–å‘ä¸ªæ–°æœ¬å­ï¼ˆåˆ›å»ºæ–°å†å²å¯¹è±¡ï¼‰<br>        store[session_id] &#x3D; ChatMessageHistory()<br>    # å¦‚æœä»¥å‰æ¥è¿‡ï¼Œå°±æŠŠä»–ä¹‹å‰çš„æœ¬å­æ‹¿å‡ºæ¥ï¼ˆè¿”å›å·²æœ‰çš„å¯¹è±¡ï¼‰<br>    return store[session_id]</p>
<p>å¦‚æœä½ ä¸å†™è¿™ä¸ªï¼ŒCursor&#x2F;VS Code å°±ä¸çŸ¥é“è¿™ä¸ªå‡½æ•°è¿”å›ä»€ä¹ˆã€‚ å½“ä½ å†™äº†ä»£ç  history &#x3D; get_session_history(â€¦) ä¹‹åï¼š<br>1.æ²¡å†™æ³¨è§£ï¼šä½ æ•² history.ï¼ŒIDE ä»€ä¹ˆéƒ½å¼¹ä¸å‡ºæ¥ï¼Œå› ä¸ºå®ƒå¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ã€‚<br>2.å†™äº†æ³¨è§£ï¼šä½ æ•² history.ï¼ŒIDE ä¼šç«‹åˆ»å¼¹å‡º .add_user_message(), .messages, .clear() ç­‰æ–¹æ³•æç¤ºã€‚å› ä¸º IDE çŸ¥é“å®ƒæ˜¯ä¸ª BaseChatMessageHistory å¯¹è±¡ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 2.1æ·»åŠ ä¸¤è½®å¯¹è¯åˆ°çª—å£å‚¨å­˜</span><br><span class="hljs-keyword">from</span> langchain_core.chat_history <span class="hljs-keyword">import</span> InMemoryChatMessageHistory<br><br><span class="hljs-comment"># 1. ã€å­˜å‚¨ã€‘åˆå§‹åŒ–å†å²è®°å½•å¯¹è±¡ (åªè´Ÿè´£å­˜ï¼Œç›¸å½“äºæ— é™å®¹é‡)</span><br>history = InMemoryChatMessageHistory()<br><br><span class="hljs-comment"># 2. ã€ä¿å­˜ä¸Šä¸‹æ–‡ã€‘æ¨¡æ‹Ÿ memory.save_context</span><br><span class="hljs-comment"># æ–°ç‰ˆå†™æ³•æ›´åŠ ç›´è§‚ï¼Œç›´æ¥ add_user_message å’Œ add_ai_message</span><br>history.add_user_message(<span class="hljs-string">&quot;ä½ å¥½ï¼Œæˆ‘å«çš®çš®é²&quot;</span>)<br>history.add_ai_message(<span class="hljs-string">&quot;ä½ å¥½å•Šï¼Œæˆ‘å«é²è¥¿è¥¿&quot;</span>)<br><br>history.add_user_message(<span class="hljs-string">&quot;å¾ˆé«˜å…´å’Œä½ æˆä¸ºæœ‹å‹ï¼&quot;</span>)<br>history.add_ai_message(<span class="hljs-string">&quot;æ˜¯çš„ï¼Œè®©æˆ‘ä»¬ä¸€èµ·å»å†’é™©å§ï¼&quot;</span>)<br><br><span class="hljs-comment"># --- åˆ°è¿™é‡Œï¼Œhistory é‡Œå­˜äº†å…¨éƒ¨ 4 æ¡æ¶ˆæ¯ ---</span><br><br><span class="hljs-comment"># 3. ã€é€»è¾‘ã€‘å®ç° k=1 (ä¿ç•™æœ€å 1 è½®å¯¹è¯ = æœ€å 2 æ¡æ¶ˆæ¯)</span><br><span class="hljs-comment"># åœ¨ LCEL ä¸­ï¼Œæ˜¾å¼ä¼˜äºéšå¼ã€‚æœ€ç®€å•çš„ k=1 å°±æ˜¯ Python åˆ—è¡¨åˆ‡ç‰‡ï¼š</span><br>current_messages = history.messages[-<span class="hljs-number">2</span>:] <br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;åŸå§‹æ¶ˆæ¯æ€»æ•°: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(history.messages)&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;--- k=1 (Window) æ•ˆæœ ---&quot;</span>)<br><span class="hljs-built_in">print</span>(current_messages)<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">åŸå§‹æ¶ˆæ¯æ€»æ•°: 4
--- k=1 (Window) æ•ˆæœ ---
[HumanMessage(content=&#39;å¾ˆé«˜å…´å’Œä½ æˆä¸ºæœ‹å‹ï¼&#39;, additional_kwargs=&#123;&#125;, response_metadata=&#123;&#125;), AIMessage(content=&#39;æ˜¯çš„ï¼Œè®©æˆ‘ä»¬ä¸€èµ·å»å†’é™©å§ï¼&#39;, additional_kwargs=&#123;&#125;, response_metadata=&#123;&#125;)]
</code></pre>
<p>è¿›é˜¶ï¼šä½¿ç”¨å®˜æ–¹æ¨èçš„ trim_messages<br>å¦‚æœä½ æ˜¯åœ¨æ„å»ºä¸€ä¸ªçœŸæ­£çš„ç”Ÿäº§çº§ Chainï¼Œå®˜æ–¹æ¨èä½¿ç”¨ trim_messagesã€‚å®ƒæ¯”ç®€å•çš„åˆ—è¡¨åˆ‡ç‰‡æ›´æ™ºèƒ½ï¼ˆå®ƒèƒ½ç¡®ä¿ä¸ä¼šæŠŠ SystemPrompt åˆ‡æ‰ï¼Œä¹Ÿèƒ½æŒ‰ Token æ•°é‡è€Œä¸æ˜¯æ¶ˆæ¯æ¡æ•°æ¥åˆ‡ï¼‰ã€‚</p>
<p>è™½ç„¶ k&#x3D;1 æ˜¯æŒ‰â€œæ¡æ•°â€åˆ‡ï¼Œä½†ç°ä»£ LLM å¼€å‘é€šå¸¸æ›´å…³æ³¨â€œToken æ•°â€ã€‚å¦‚æœä¸€å®šè¦ä¸¥æ ¼æ¨¡æ‹Ÿ k&#x3D;1ï¼Œåˆ—è¡¨åˆ‡ç‰‡æœ€ç®€å•ï¼›å¦‚æœè¦é™åˆ¶ä¸Šä¸‹æ–‡é•¿åº¦ï¼Œç”¨ä¸‹é¢çš„å†™æ³•ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> trim_messages<br><span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI<br><br><span class="hljs-comment"># 1. å®šä¹‰ä¿®å‰ªå™¨ (Trimmer)</span><br>trimmer = trim_messages(<br>    max_tokens=<span class="hljs-number">2</span>,        <span class="hljs-comment"># è¿™é‡Œåªæ˜¯æ¼”ç¤ºã€‚é€šå¸¸æˆ‘ä»¬é™åˆ¶ Token (å¦‚ 2000)ï¼Œè€Œä¸æ˜¯æ¶ˆæ¯æ•°</span><br>    strategy=<span class="hljs-string">&quot;last&quot;</span>,     <span class="hljs-comment"># ä¿ç•™æœ€æ–°çš„</span><br>    token_counter=<span class="hljs-built_in">len</span>,   <span class="hljs-comment"># ã€æŠ€å·§ã€‘è¿™é‡Œç”¨ len å‡½æ•°ä½œä¸ºè®¡æ•°å™¨ï¼Œå°±å˜æˆäº†â€œé™åˆ¶æ¶ˆæ¯æ¡æ•°â€</span><br>                         <span class="hljs-comment"># max_tokens=2 + token_counter=len æ„å‘³ç€ä¿ç•™æœ€å 2 ä¸ªå¯¹è±¡</span><br>    include_system=<span class="hljs-literal">True</span>, <span class="hljs-comment"># æ°¸è¿œä¿ç•™ç³»ç»Ÿæç¤ºè¯</span><br>    start_on=<span class="hljs-string">&quot;human&quot;</span>     <span class="hljs-comment"># ç¡®ä¿åˆ‡åˆ†åçš„ç¬¬ä¸€å¥æ˜¯äººè¯´çš„ (é¿å… AI è‡ªè¨€è‡ªè¯­)</span><br>)<br><br><span class="hljs-comment"># 2. è°ƒç”¨ä¿®å‰ªå™¨</span><br><span class="hljs-comment"># history.messages åŒ…å« 4 æ¡æ¶ˆæ¯</span><br>pruned_messages = trimmer.invoke(history.messages)<br><br><span class="hljs-built_in">print</span>(pruned_messages)<br><span class="hljs-comment"># è¾“å‡º: [HumanMessage(content=&#x27;å¾ˆé«˜å…´å’Œä½ æˆä¸ºæœ‹å‹ï¼&#x27;), AIMessage(content=&#x27;æ˜¯çš„ï¼Œè®©æˆ‘ä»¬ä¸€èµ·å»å†’é™©å§ï¼&#x27;)]</span><br></code></pre></td></tr></table></figure>

<pre><code class="hljs">[HumanMessage(content=&#39;ä½ å¥½ï¼Œæˆ‘å«çš®çš®é²&#39;, additional_kwargs=&#123;&#125;, response_metadata=&#123;&#125;), AIMessage(content=&#39;ä½ å¥½å•Šï¼Œæˆ‘å«é²è¥¿è¥¿&#39;, additional_kwargs=&#123;&#125;, response_metadata=&#123;&#125;), HumanMessage(content=&#39;å¾ˆé«˜å…´å’Œä½ æˆä¸ºæœ‹å‹ï¼&#39;, additional_kwargs=&#123;&#125;, response_metadata=&#123;&#125;), AIMessage(content=&#39;æ˜¯çš„ï¼Œè®©æˆ‘ä»¬ä¸€èµ·å»å†’é™©å§ï¼&#39;, additional_kwargs=&#123;&#125;, response_metadata=&#123;&#125;)]
[32;1m[1;3m[chain/start][0m [1m[chain:trim_messages] Entering Chain run with input:
[0m[inputs]
[36;1m[1;3m[chain/end][0m [1m[chain:trim_messages] [1ms] Exiting Chain run with output:
[0m[outputs]
[HumanMessage(content=&#39;å¾ˆé«˜å…´å’Œä½ æˆä¸ºæœ‹å‹ï¼&#39;, additional_kwargs=&#123;&#125;, response_metadata=&#123;&#125;), AIMessage(content=&#39;æ˜¯çš„ï¼Œè®©æˆ‘ä»¬ä¸€èµ·å»å†’é™©å§ï¼&#39;, additional_kwargs=&#123;&#125;, response_metadata=&#123;&#125;)]
</code></pre>
<h3 id="ç¬¬ä¸€éƒ¨åˆ†ï¼šé€šä¿—æ˜“æ‡‚ç‰ˆï¼ˆæ‰“æ¯”æ–¹ï¼‰"><a href="#ç¬¬ä¸€éƒ¨åˆ†ï¼šé€šä¿—æ˜“æ‡‚ç‰ˆï¼ˆæ‰“æ¯”æ–¹ï¼‰" class="headerlink" title="ç¬¬ä¸€éƒ¨åˆ†ï¼šé€šä¿—æ˜“æ‡‚ç‰ˆï¼ˆæ‰“æ¯”æ–¹ï¼‰"></a>ç¬¬ä¸€éƒ¨åˆ†ï¼šé€šä¿—æ˜“æ‡‚ç‰ˆï¼ˆæ‰“æ¯”æ–¹ï¼‰</h3><p>æƒ³è±¡ä½ æ­£åœ¨é›‡ä½£ä¸€ä¸ª**â€œè¶…çº§ç§˜ä¹¦â€**ï¼ˆAIï¼‰æ¥å¸®ä½ å¤„ç†å·¥ä½œã€‚</p>
<ol>
<li><strong><code>BaseChatMessageHistory</code>ï¼ˆè®°äº‹æœ¬çš„æ ‡å‡†&#x2F;è§„èŒƒï¼‰</strong></li>
</ol>
<ul>
<li>è¿™æ˜¯ä¸€ä¸ª<strong>æŠ½è±¡çš„æ¦‚å¿µ</strong>ã€‚å®ƒå°±åƒæ˜¯å…¬å¸è§„å®šï¼šâ€œæ‰€æœ‰çš„è®°äº‹æœ¬ï¼Œå¿…é¡»å…·å¤‡â€˜å†™å­—â€™å’Œâ€˜ç¿»é¡µâ€™çš„åŠŸèƒ½â€ã€‚å®ƒä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„æœ¬å­ï¼Œè€Œæ˜¯ä¸€ä»½<strong>ç”Ÿäº§è¯´æ˜ä¹¦</strong>ã€‚</li>
</ul>
<ol start="2">
<li><strong><code>ChatMessageHistory</code>ï¼ˆæ™®é€šçš„è‰ç¨¿æœ¬ï¼‰</strong></li>
</ol>
<ul>
<li>è¿™æ˜¯æ ¹æ®ä¸Šé¢é‚£ä¸ªè§„èŒƒé€ å‡ºæ¥çš„<strong>çœŸå®çš„æœ¬å­</strong>ã€‚</li>
<li>ç‰¹ç‚¹æ˜¯ï¼šå®ƒæ˜¯ä¸€ä¸ª<strong>ä¸´æ—¶</strong>çš„æœ¬å­ï¼ˆå­˜æ”¾åœ¨å†…å­˜é‡Œï¼‰ã€‚ä½ å“ªæ€•èŠäº†ä¸€æ•´å¤©ï¼Œåªè¦ç§˜ä¹¦ä¸‹ç­ï¼ˆç¨‹åºé‡å¯ï¼‰ï¼Œè¿™ä¸ªæœ¬å­å°±è¢«æ‰”æ‰äº†ï¼Œé‡Œé¢è®°å½•çš„ä¸œè¥¿å…¨æ²¡äº†ã€‚</li>
</ul>
<ol start="3">
<li><strong><code>RunnablePassthrough</code>ï¼ˆé€æ˜ä¼ é€å¸¦ï¼‰</strong></li>
</ol>
<ul>
<li>æƒ³è±¡ä¸€æ¡ä¼ é€å¸¦ã€‚å®ƒçš„ä½œç”¨å°±æ˜¯**â€œä»€ä¹ˆéƒ½ä¸åšï¼Œç›´æ¥é€ä¼ â€**ã€‚</li>
<li><strong>ä¸ºä»€ä¹ˆè¦å®ƒï¼Ÿ</strong> æœ‰æ—¶å€™ä½ éœ€è¦æŠŠâ€œç”¨æˆ·çš„é—®é¢˜â€åŒæ—¶ä¼ ç»™ä¸¤ä¸ªåœ°æ–¹ï¼šä¸€ä¸ªåœ°æ–¹æ‹¿å»å­˜æ¡£ï¼Œå¦ä¸€ä¸ªåœ°æ–¹æ‹¿å»ç»™ AI å›ç­”ã€‚è¿™æ—¶å€™å°±éœ€è¦è¿™ä¸ªä¼ é€å¸¦ï¼Œä¿è¯æ•°æ®èƒ½é¡ºç•…åœ°æµä¸‹å»ï¼Œæˆ–è€…ç”¨æ¥åœ¨ä¼ é€å¸¦ä¸Šä¸´æ—¶åŠ ç‚¹ä¸œè¥¿ï¼ˆæ¯”å¦‚åŠ ä¸ªæ ‡ç­¾ï¼‰ã€‚</li>
</ul>
<ol start="4">
<li><strong><code>MessagesPlaceholder</code>ï¼ˆé¢„ç•™çš„ç©ºåº§ä½ï¼‰</strong></li>
</ol>
<ul>
<li>ä½ åœ¨å†™ä¼šè®®æµç¨‹ï¼ˆPrompt æ¨¡æ¿ï¼‰æ—¶ï¼Œä½ ä¸çŸ¥é“å…·ä½“çš„èŠå¤©è®°å½•æœ‰å¤šå°‘æ¡ã€‚</li>
<li>æ‰€ä»¥ä½ åœ¨æµç¨‹è¡¨ä¸Šæ”¾äº†ä¸€ä¸ª**â€œå ä½ç‰Œâ€**ï¼Œä¸Šé¢å†™ç€ï¼šâ€œè¿™é‡Œé¢„ç•™ç»™ä¹‹å‰çš„èŠå¤©è®°å½•â€ã€‚ç­‰çœŸæ­£å¼€ä¼šæ—¶ï¼Œç§˜ä¹¦ä¼šæŠŠå†å²è®°å½•æ¬è¿‡æ¥å¡«åœ¨è¿™ä¸ªä½ç½®ã€‚</li>
</ul>
<ol start="5">
<li><strong><code>RunnableLambda</code>ï¼ˆè‡ªå®šä¹‰çš„å°å·¥å…·ï¼‰</strong></li>
</ol>
<ul>
<li>LangChain çš„æµæ°´çº¿åŸæœ¬åªèƒ½è£…æ ‡å‡†çš„é›¶ä»¶ã€‚ä½†å¦‚æœä½ æƒ³åœ¨æµæ°´çº¿ä¸Šæ’ä¸€ä¸ªè‡ªå·±æ‰‹æ“çš„å¥‡å½¢æ€ªçŠ¶çš„å·¥å…·ï¼ˆæ¯”å¦‚ä½ å†™çš„é‚£ä¸ª <code>filter_messages</code> å‡½æ•°ï¼‰ï¼Œä½ å°±éœ€è¦ç”¨ä¸ª<strong>è½¬æ¥å¤´</strong>æŠŠå®ƒåŒ…ä¸€ä¸‹ã€‚</li>
<li><code>RunnableLambda</code> å°±æ˜¯è¿™ä¸ª<strong>è½¬æ¥å¤´</strong>ï¼Œå®ƒæŠŠä½ çš„æ™®é€š Python ä»£ç å˜æˆæµæ°´çº¿èƒ½è¯†åˆ«çš„é›¶ä»¶ã€‚</li>
</ul>
<ol start="6">
<li><strong><code>RunnableWithMessageHistory</code>ï¼ˆè®°å¿†æ€»ç®¡ï¼‰</strong></li>
</ol>
<ul>
<li>è¿™æ˜¯<strong>æœ€å‰å®³çš„æŒ‡æŒ¥å®˜</strong>ã€‚å®ƒæŠŠä¸Šé¢çš„ä¸œè¥¿éƒ½ç®¡èµ·æ¥äº†ã€‚</li>
<li>å½“ç”¨æˆ·è¯´è¯æ—¶ï¼Œå®ƒè´Ÿè´£ï¼š</li>
</ul>
<ol>
<li>æ ¹æ®ç”¨æˆ·çš„ IDï¼Œå»ä»“åº“é‡Œæ‰¾åˆ°å¯¹åº”çš„è®°äº‹æœ¬ï¼ˆ<code>ChatMessageHistory</code>ï¼‰ã€‚</li>
<li>æŠŠä»¥å‰èŠçš„å†…å®¹æ‹¿å‡ºæ¥ï¼Œæ”¾åœ¨å ä½ç‰Œï¼ˆ<code>MessagesPlaceholder</code>ï¼‰çš„ä½ç½®ã€‚</li>
<li>è®© AI å›ç­”ã€‚</li>
<li>æŠŠç”¨æˆ·çš„æ–°é—®é¢˜å’Œ AI çš„æ–°å›ç­”ï¼Œå†å†™å›è®°äº‹æœ¬é‡Œã€‚</li>
</ol>
<h3 id="ç¬¬äºŒéƒ¨åˆ†ï¼šä¸“ä¸šè¯¦è§£ç‰ˆï¼ˆä½œç”¨ã€ç”¨æ³•ã€å‚æ•°ï¼‰"><a href="#ç¬¬äºŒéƒ¨åˆ†ï¼šä¸“ä¸šè¯¦è§£ç‰ˆï¼ˆä½œç”¨ã€ç”¨æ³•ã€å‚æ•°ï¼‰" class="headerlink" title="ç¬¬äºŒéƒ¨åˆ†ï¼šä¸“ä¸šè¯¦è§£ç‰ˆï¼ˆä½œç”¨ã€ç”¨æ³•ã€å‚æ•°ï¼‰"></a>ç¬¬äºŒéƒ¨åˆ†ï¼šä¸“ä¸šè¯¦è§£ç‰ˆï¼ˆä½œç”¨ã€ç”¨æ³•ã€å‚æ•°ï¼‰</h3><h4 id="1-BaseChatMessageHistory"><a href="#1-BaseChatMessageHistory" class="headerlink" title="1. BaseChatMessageHistory"></a>1. BaseChatMessageHistory</h4><ul>
<li><strong>ä½œç”¨</strong>ï¼šè¿™æ˜¯ä¸€ä¸ª<strong>æŠ½è±¡åŸºç±» (Abstract Base Class)</strong>ã€‚å®ƒå®šä¹‰äº†ä»»ä½•â€œå†å²è®°å½•å­˜å‚¨ç±»â€å¿…é¡»å®ç°çš„æ–¹æ³•ï¼Œä¸»è¦æ˜¯ <code>add_message()</code>ï¼ˆæ·»åŠ æ¶ˆæ¯ï¼‰å’Œ <code>messages</code>ï¼ˆè·å–æ‰€æœ‰æ¶ˆæ¯ï¼‰ã€‚</li>
<li><strong>ç”¨æ³•</strong>ï¼šä½ é€šå¸¸<strong>ä¸ä¼šç›´æ¥ä½¿ç”¨</strong>å®ƒï¼Œè€Œæ˜¯é€šè¿‡ç»§æ‰¿å®ƒæ¥å¼€å‘è‡ªå®šä¹‰çš„å­˜å‚¨åç«¯ï¼ˆä¾‹å¦‚ï¼Œä½ æƒ³æŠŠèŠå¤©è®°å½•å­˜åˆ° Redisã€MySQL æˆ– MongoDB ä¸­ï¼Œå°±éœ€è¦ç»§æ‰¿è¿™ä¸ªç±»ï¼‰ã€‚</li>
<li><strong>å‚æ•°</strong>ï¼šæ— ï¼ˆä½œä¸ºä¸€ä¸ªæ¥å£è§„èŒƒï¼‰ã€‚</li>
</ul>
<h4 id="2-ChatMessageHistory"><a href="#2-ChatMessageHistory" class="headerlink" title="2. ChatMessageHistory"></a>2. ChatMessageHistory</h4><ul>
<li><strong>ä½œç”¨</strong>ï¼šè¿™æ˜¯ <code>BaseChatMessageHistory</code> çš„ä¸€ä¸ª<strong>å†…å­˜çº§å®ç°</strong>ï¼ˆIn-memory implementationï¼‰ã€‚å®ƒæŠŠæ¶ˆæ¯å­˜å‚¨åœ¨ Python çš„ <code>List</code>ï¼ˆåˆ—è¡¨ï¼‰é‡Œã€‚</li>
<li><strong>ç”¨æ³•</strong>ï¼šä¸»è¦ç”¨äº<strong>æµ‹è¯•ã€æ¼”ç¤ºæˆ–è½»é‡çº§è„šæœ¬</strong>ã€‚</li>
<li><strong>æ³¨æ„</strong>ï¼šå› ä¸ºå®ƒå­˜åœ¨å†…å­˜é‡Œï¼Œç¨‹åºä¸€æ—¦é‡å¯ï¼Œå†å²è®°å½•å°±ä¸¢å¤±äº†ã€‚</li>
<li><strong>å‚æ•°</strong>ï¼šé€šå¸¸ä¸éœ€è¦ä¼ å‚ï¼Œå®ä¾‹åŒ–å³å¯ä½¿ç”¨ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">history = ChatMessageHistory()<br>history.add_user_message(<span class="hljs-string">&quot;Hi&quot;</span>)<br></code></pre></td></tr></table></figure>

<h4 id="3-RunnablePassthrough"><a href="#3-RunnablePassthrough" class="headerlink" title="3. RunnablePassthrough"></a>3. RunnablePassthrough</h4><ul>
<li><strong>ä½œç”¨</strong>ï¼šLCEL é“¾ä¸­çš„â€œé€ä¼ â€ç»„ä»¶ã€‚å®ƒæ¥æ”¶è¾“å…¥ï¼Œå¹¶å°†å…¶åŸæ ·è¾“å‡ºã€‚é€šå¸¸é…åˆ <code>.assign()</code> ä½¿ç”¨ï¼Œç”¨äºåœ¨ä¸æ”¹å˜åŸæœ‰è¾“å…¥æ•°æ®æµçš„æƒ…å†µä¸‹ï¼Œ<strong>å¢åŠ æ–°çš„é”®å€¼å¯¹</strong>ï¼ˆä¾‹å¦‚å°†æ£€ç´¢åˆ°çš„æ–‡æ¡£ context åŠ å…¥åˆ°å­—å…¸ä¸­ï¼‰ã€‚</li>
<li><strong>ç”¨æ³•</strong>ï¼š</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åœºæ™¯ï¼šè¾“å…¥æ˜¯ &#123;&quot;question&quot;: &quot;...&quot;&#125;ï¼Œæƒ³æŠŠ question é€ä¼ ç»™ä¸‹ä¸€æ­¥ï¼ŒåŒæ—¶ä¹Ÿæƒ³ä¿ç•™åŸå§‹ dict</span><br>chain = RunnablePassthrough() | prompt | llm<br></code></pre></td></tr></table></figure>
<p>è¡¨ç¤ºï¼šåœ¨ä¼ æ¥çš„dataï¼Œç»è¿‡è¿™ä¸€å±‚æ—¶ï¼Œä¸åªæ˜¯ç•™ä¸‹ç»“æœï¼Œè€Œæ˜¯ï¼Œå¸¦ç€åŸå§‹çš„è¾“å…¥ä¸€èµ·å‘ä¸‹ä¼ ã€‚ã€å¯ä»¥ç”¨äºæ£€ç´¢å¢å¼ºRAGåœºæ™¯ï¼šæˆ‘ä»¬éœ€è¦æ ¹æ®ç”¨æˆ·çš„é—®é¢˜ï¼ˆquestionï¼‰å»æœç´¢èµ„æ–™ï¼ˆcontextï¼‰ï¼Œç„¶åæŠŠä¸¤è€…éƒ½ç»™ AIã€‚ã€‘</p>
<ul>
<li><strong>å‚æ•°</strong>ï¼šå¯ä»¥ä¸ä¼ ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>RunnablePassthrough.assign(...)</code> æ¥æ·»åŠ é¢å¤–æ•°æ®ã€‚</li>
</ul>
<h4 id="4-MessagesPlaceholder"><a href="#4-MessagesPlaceholder" class="headerlink" title="4. MessagesPlaceholder"></a>4. MessagesPlaceholder</h4><ul>
<li><strong>ä½œç”¨</strong>ï¼šç”¨äº <code>PromptTemplate</code>ï¼ˆæç¤ºè¯æ¨¡æ¿ï¼‰ä¸­ã€‚å®ƒå‘Šè¯‰æ ¼å¼åŒ–å™¨ï¼šâ€œè¿™é‡Œä¸æ˜¯æ™®é€šçš„å­—ç¬¦ä¸²å˜é‡ï¼Œè€Œæ˜¯ä¸€ä¸ª<strong>æ¶ˆæ¯å¯¹è±¡åˆ—è¡¨</strong>ï¼ˆList of BaseMessageï¼‰â€ã€‚</li>
<li><strong>ç”¨æ³•</strong>ï¼šå¿…é¡»æ”¾åœ¨ Prompt ä¸­ä½ å¸Œæœ›æ’å…¥å†å²è®°å½•çš„ä½ç½®ã€‚</li>
<li><strong>å‚æ•°</strong>ï¼š</li>
<li><code>variable_name</code> (å¿…å¡«)ï¼šå¯¹åº”è¾“å…¥å­—å…¸ä¸­çš„ keyï¼Œé€šå¸¸å« <code>&quot;history&quot;</code> æˆ– <code>&quot;chat_history&quot;</code>ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">prompt = ChatPromptTemplate.from_messages([<br>    (<span class="hljs-string">&quot;system&quot;</span>, <span class="hljs-string">&quot;You are a bot.&quot;</span>),<br>    MessagesPlaceholder(variable_name=<span class="hljs-string">&quot;history&quot;</span>), <span class="hljs-comment"># å†å²è®°å½•æ’åœ¨è¿™é‡Œ</span><br>    (<span class="hljs-string">&quot;human&quot;</span>, <span class="hljs-string">&quot;&#123;input&#125;&quot;</span>)<br>])<br></code></pre></td></tr></table></figure>

<h4 id="5-RunnableLambda"><a href="#5-RunnableLambda" class="headerlink" title="5. RunnableLambda"></a>5. RunnableLambda</h4><ul>
<li><strong>ä½œç”¨</strong>ï¼šå°†æ ‡å‡†çš„ Python å‡½æ•°ï¼ˆFunctionï¼‰åŒ…è£…æˆ LangChain çš„ <code>Runnable</code> å¯¹è±¡ã€‚è¿™ä½¿å¾—ä½ çš„è‡ªå®šä¹‰å‡½æ•°å¯ä»¥ä½¿ç”¨ <code>.invoke()</code>, <code>.batch()</code>, <code>.stream()</code> ç­‰æ ‡å‡†æ¥å£ï¼Œå¹¶èƒ½åµŒå…¥åˆ° <code>chain</code> ç®¡é“ä¸­ã€‚</li>
<li><strong>ç”¨æ³•</strong>ï¼š</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">my_func</span>(<span class="hljs-params">x</span>): <span class="hljs-keyword">return</span> x + <span class="hljs-number">1</span><br>runnable = RunnableLambda(my_func)<br></code></pre></td></tr></table></figure>
<ul>
<li><strong>å‚æ•°</strong>ï¼š</li>
<li>å¿…å¡«ï¼šä¸€ä¸ªå¯è°ƒç”¨çš„å‡½æ•°å¯¹è±¡ã€‚</li>
</ul>
<h4 id="6-RunnableWithMessageHistory"><a href="#6-RunnableWithMessageHistory" class="headerlink" title="6. RunnableWithMessageHistory"></a>6. RunnableWithMessageHistory</h4><ul>
<li><strong>ä½œç”¨</strong>ï¼šè¿™æ˜¯å¤„ç†å¯¹è¯è®°å¿†çš„<strong>æ ¸å¿ƒåŒ…è£…å™¨</strong>ã€‚å®ƒè´Ÿè´£è‡ªåŠ¨åŒ–ç®¡ç†å†å²è®°å½•çš„è¯»å–å’Œå†™å…¥ã€‚å®ƒåŒ…è£¹ä¸€ä¸ªåŸºç¡€çš„ Chainï¼Œå¹¶åœ¨æ‰§è¡Œå‰åè‡ªåŠ¨æ³¨å…¥å†å²è®°å½•å’Œä¿å­˜æ–°æ¶ˆæ¯ã€‚</li>
<li><strong>ç”¨æ³•</strong>ï¼šå®ƒæ˜¯é“¾çš„æœ€å¤–å±‚ã€‚</li>
<li><strong>å‚æ•°</strong>ï¼š</li>
<li><code>runnable</code> (å¿…å¡«)ï¼šä½ è¦åŒ…è£¹çš„é‚£ä¸ªåŸºç¡€é“¾ï¼ˆprompt | llmï¼‰ã€‚</li>
<li><code>get_session_history</code> (å¿…å¡«)ï¼šä¸€ä¸ªå·¥å‚å‡½æ•°ã€‚ä½ éœ€è¦å®šä¹‰è¿™ä¸ªå‡½æ•°ï¼Œå‘Šè¯‰å®ƒâ€œç»™å®šä¸€ä¸ª session_idï¼Œå»å“ªé‡Œæ‰¾å¯¹åº”çš„ <code>ChatMessageHistory</code> å¯¹è±¡â€ã€‚</li>
<li><code>input_messages_key</code> (é€‰å¡«)ï¼šè¾“å…¥å­—å…¸ä¸­å“ªä¸ª key æ˜¯ç”¨æˆ·çš„æ–°é—®é¢˜ã€‚</li>
<li><code>history_messages_key</code> (é€‰å¡«)ï¼šPrompt ä¸­å“ªä¸ª key æ˜¯ç”¨æ¥æ”¾å†å²è®°å½•çš„ï¼ˆå¯¹åº” MessagesPlaceholder çš„åå­—ï¼‰ã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 2.2 åœ¨å¯¹è¯é“¾ä¸­åº”ç”¨çª—å£å‚¨å­˜</span><br><span class="hljs-keyword">import</span> sys<br><span class="hljs-comment"># 3. å¤„ç†æ¨¡å—å¯¼å…¥ (ä¿æŒæ‚¨åŸæœ‰çš„é€»è¾‘)</span><br><span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;tool&#x27;</span> <span class="hljs-keyword">in</span> sys.modules:<br>    <span class="hljs-keyword">del</span> sys.modules[<span class="hljs-string">&#x27;tool&#x27;</span>]<br><span class="hljs-comment"># if &#x27;utils_zh&#x27; in sys.modules:</span><br><span class="hljs-comment">#     del sys.modules[&#x27;utils_zh&#x27;]</span><br><span class="hljs-comment"># é‡æ–°å¯¼å…¥æ¨¡å—</span><br>sys.path.append(<span class="hljs-string">&#x27;/home/py/shared/StudyChatgpt&#x27;</span>)<br><span class="hljs-keyword">from</span> tool <span class="hljs-keyword">import</span> get_chat_model2<br><span class="hljs-comment"># åˆå§‹åŒ–å¤§æ¨¡å‹å¯¹è±¡ï¼ˆè¿™åªæ˜¯ä¸€ä¸ªæ‰§è¡Œè€…ï¼Œå®ƒè‡ªå·±ä¸è®°äº‹ï¼‰</span><br>llm = get_chat_model2(temperature=<span class="hljs-number">0.0</span>)<br><br><span class="hljs-keyword">from</span> langchain.<span class="hljs-built_in">globals</span> <span class="hljs-keyword">import</span> set_debug<br><span class="hljs-keyword">from</span> langchain_community.chat_message_histories <span class="hljs-keyword">import</span> ChatMessageHistory<br><span class="hljs-keyword">from</span> langchain_core.chat_history <span class="hljs-keyword">import</span> BaseChatMessageHistory<br><span class="hljs-keyword">from</span> langchain_core.runnables.history <span class="hljs-keyword">import</span> RunnableWithMessageHistory<br><span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate, MessagesPlaceholder<br><span class="hljs-keyword">from</span> langchain_core.runnables <span class="hljs-keyword">import</span> RunnableLambda, RunnablePassthrough<br><br><br><br><span class="hljs-comment"># ================= åŸºç¡€è®¾ç½® =================</span><br><span class="hljs-comment"># å¼€å¯è°ƒè¯•æ¨¡å¼ï¼Œè¿™ä¼šè®©ä½ åœ¨æ§åˆ¶å°çœ‹åˆ°ç»¿è‰²çš„è¯¦ç»†æ—¥å¿—ï¼ˆPrompt æ˜¯æ€ä¹ˆæ‹¼çš„ï¼ŒToken ç”¨äº†å¤šå°‘ç­‰ï¼‰</span><br>set_debug(<span class="hljs-literal">True</span>)<br><br><span class="hljs-comment"># 1. å®šä¹‰å­˜å‚¨ (æ¨¡æ‹Ÿæ•°æ®åº“)</span><br>store = &#123;&#125;<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_session_history</span>(<span class="hljs-params">session_id: <span class="hljs-built_in">str</span></span>) -&gt; BaseChatMessageHistory:<br>    <span class="hljs-keyword">if</span> session_id <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> store:<br>        <span class="hljs-comment"># å¦‚æœè¿™ä¸ª session_id ç¬¬ä¸€æ¬¡æ¥ï¼Œç»™ä»–å‘ä¸ªæ–°æœ¬å­ï¼ˆåˆ›å»ºæ–°å†å²å¯¹è±¡ï¼‰</span><br>        store[session_id] = ChatMessageHistory()<br>    <span class="hljs-keyword">return</span> store[session_id]<br><br><span class="hljs-comment"># ================= æ ¸å¿ƒé€»è¾‘ï¼šå®ç°çª—å£è®°å¿† =================</span><br><br><span class="hljs-comment"># 2. å®šä¹‰ä¸€ä¸ªè¿‡æ»¤å™¨å‡½æ•° </span><br><span class="hljs-comment"># input_dict ä¼šåŒ…å«ä» history è¯»å‡ºæ¥çš„å®Œæ•´æ¶ˆæ¯åˆ—è¡¨</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">filter_messages</span>(<span class="hljs-params">input_dict</span>):<br>    history = input_dict.get(<span class="hljs-string">&quot;history&quot;</span>, [])<br>    <span class="hljs-comment"># ã€é‡ç‚¹ã€‘è¿™é‡Œå®ç° history.messages[-2:] çš„é€»è¾‘</span><br>    <span class="hljs-comment"># k=2 ä»£è¡¨ä¿ç•™æœ€è¿‘2æ¡æ¶ˆæ¯ï¼ˆé€šå¸¸æ˜¯ä¸€é—®ä¸€ç­”ï¼‰</span><br>    <span class="hljs-comment"># å¦‚æœä½ æƒ³ä¿ç•™æœ€è¿‘2è½®å¯¹è¯ï¼ˆ4æ¡æ¶ˆæ¯ï¼‰ï¼Œè¿™å°±æ”¹æˆ -4</span><br>    k = <span class="hljs-number">2</span> <br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(history) &gt; k:<br>        input_dict[<span class="hljs-string">&quot;history&quot;</span>] = history[-k:]<br>    <br>    <span class="hljs-keyword">return</span> input_dict<br><br><span class="hljs-comment"># 3. å®šä¹‰ Prompt</span><br><span class="hljs-comment"># å¿…é¡»æ˜¾å¼å®šä¹‰ history å ä½ç¬¦ï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½åœ¨å®ƒå¡«å…¥ LLM ä¹‹å‰æ‹¦æˆªå®ƒ</span><br>prompt = ChatPromptTemplate.from_messages([<br>    <span class="hljs-comment"># è¿™é‡Œæ”¾ç½®ç³»ç»Ÿæç¤ºè¯(å¯é€‰)</span><br>    (<span class="hljs-string">&quot;system&quot;</span>, <span class="hljs-string">&quot;ä½ æ˜¯ä¸€ä¸ªä¹äºåŠ©äººçš„åŠ©æ‰‹ã€‚&quot;</span>),<br>    <span class="hljs-comment"># å†å²è®°å½•å ä½ç¬¦ï¼Œå˜é‡åå¿…é¡»å’Œä¸‹é¢ RunnableWithMessageHistory è®¾ç½®çš„ä¸€è‡´</span><br>    MessagesPlaceholder(variable_name=<span class="hljs-string">&quot;history&quot;</span>), <br>    <span class="hljs-comment"># ç”¨æˆ·å½“å‰è¾“å…¥</span><br>    (<span class="hljs-string">&quot;human&quot;</span>, <span class="hljs-string">&quot;&#123;input&#125;&quot;</span>),<br>])<br><br><span class="hljs-comment"># 4. ç»„è£…å†…éƒ¨é“¾</span><br><span class="hljs-comment"># é€»è¾‘æµå‘ï¼šè¾“å…¥ -&gt; è‡ªåŠ¨è·å–å…¨é‡å†å² -&gt; filter_messages (åˆ‡ç‰‡) -&gt; prompt (å¡«æ§½) -&gt; llm</span><br>chain = (<br>    RunnablePassthrough() <span class="hljs-comment"># é€ä¼ è¾“å…¥</span><br>    | RunnableLambda(filter_messages) <span class="hljs-comment"># åº”ç”¨çª—å£åˆ‡ç‰‡</span><br>    | prompt <br>    | llm<br>)<br><br><span class="hljs-comment"># 5. åŒ…è£…å†å²è®°å½•åŠŸèƒ½</span><br>conversation = RunnableWithMessageHistory(<br>    runnable=chain,<br>    get_session_history=get_session_history,<br>    input_messages_key=<span class="hljs-string">&quot;input&quot;</span>,   <span class="hljs-comment"># å‘Šè¯‰å®ƒå“ªä¸ª key æ˜¯ç”¨æˆ·è¾“å…¥</span><br>    history_messages_key=<span class="hljs-string">&quot;history&quot;</span> <span class="hljs-comment"># å‘Šè¯‰å®ƒæŠŠå†å²è®°å½•æ³¨å…¥åˆ°å“ªä¸ª key (å¯¹åº” Prompt é‡Œçš„å˜é‡å)</span><br>)<br></code></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ================= æµ‹è¯•è¿è¡Œ =================</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç¬¬ä¸€è½®å¯¹è¯ï¼š&quot;</span>)<br>conversation.invoke(<br>    &#123;<span class="hljs-string">&quot;input&quot;</span>: <span class="hljs-string">&quot;ä½ å¥½, æˆ‘å«çš®çš®é²&quot;</span>&#125;, <br>    config=&#123;<span class="hljs-string">&quot;configurable&quot;</span>: &#123;<span class="hljs-string">&quot;session_id&quot;</span>: <span class="hljs-string">&quot;session_123&quot;</span>&#125;&#125;<br>)<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">ç¬¬ä¸€è½®å¯¹è¯ï¼š
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä½ å¥½, æˆ‘å«çš®çš®é²&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä½ å¥½, æˆ‘å«çš®çš®é²&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt;] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä½ å¥½, æˆ‘å«çš®çš®é²&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:load_history] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä½ å¥½, æˆ‘å«çš®çš®é²&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:load_history] [1ms] Exiting Chain run with output:
[0m&#123;
  &quot;output&quot;: []
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt;] [2ms] Exiting Chain run with output:
[0m&#123;
  &quot;history&quot;: []
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history] [3ms] Exiting Chain run with output:
[0m&#123;
  &quot;input&quot;: &quot;ä½ å¥½, æˆ‘å«çš®çš®é²&quot;,
  &quot;history&quot;: []
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä½ å¥½, æˆ‘å«çš®çš®é²&quot;,
  &quot;history&quot;: []
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä½ å¥½, æˆ‘å«çš®çš®é²&quot;,
  &quot;history&quot;: []
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;&gt;] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä½ å¥½, æˆ‘å«çš®çš®é²&quot;,
  &quot;history&quot;: []
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;&gt; &gt; chain:RunnableParallel&lt;&gt;] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä½ å¥½, æˆ‘å«çš®çš®é²&quot;,
  &quot;history&quot;: []
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;&gt; &gt; chain:RunnableParallel&lt;&gt;] [1ms] Exiting Chain run with output:
[0m&#123;&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;&gt;] [2ms] Exiting Chain run with output:
[0m&#123;
  &quot;input&quot;: &quot;ä½ å¥½, æˆ‘å«çš®çš®é²&quot;,
  &quot;history&quot;: []
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:filter_messages] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä½ å¥½, æˆ‘å«çš®çš®é²&quot;,
  &quot;history&quot;: []
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:filter_messages] [1ms] Exiting Chain run with output:
[0m&#123;
  &quot;input&quot;: &quot;ä½ å¥½, æˆ‘å«çš®çš®é²&quot;,
  &quot;history&quot;: []
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] Entering Prompt run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä½ å¥½, æˆ‘å«çš®çš®é²&quot;,
  &quot;history&quot;: []
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] [1ms] Exiting Prompt run with output:
[0m[outputs]
[32;1m[1;3m[llm/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] Entering LLM run with input:
[0m&#123;
  &quot;prompts&quot;: [
    &quot;System: ä½ æ˜¯ä¸€ä¸ªä¹äºåŠ©äººçš„åŠ©æ‰‹ã€‚\nHuman: ä½ å¥½, æˆ‘å«çš®çš®é²&quot;
  ]
&#125;
[36;1m[1;3m[llm/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] [1.06s] Exiting LLM run with output:
[0m&#123;
  &quot;generations&quot;: [
    [
      &#123;
        &quot;text&quot;: &quot;ä½ å¥½ï¼Œçš®çš®é²ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ã€‚ä½ å¬è¯´è¿‡ã€Šçš®çš®é²ä¼ ã€‹å—ï¼Ÿè¿™æ˜¯éƒ‘æ¸Šæ´çˆ·çˆ·åˆ›ä½œçš„ä¸€ç³»åˆ—ç«¥è¯æ•…äº‹ï¼Œè®²è¿°äº†çš®çš®é²å’Œä»–çš„æœ‹å‹ä»¬çš„å†’é™©æ•…äº‹ã€‚&quot;,
        &quot;generation_info&quot;: &#123;
          &quot;finish_reason&quot;: &quot;stop&quot;,
          &quot;logprobs&quot;: null
        &#125;,
        &quot;type&quot;: &quot;ChatGeneration&quot;,
        &quot;message&quot;: &#123;
          &quot;lc&quot;: 1,
          &quot;type&quot;: &quot;constructor&quot;,
          &quot;id&quot;: [
            &quot;langchain&quot;,
            &quot;schema&quot;,
            &quot;messages&quot;,
            &quot;AIMessage&quot;
          ],
          &quot;kwargs&quot;: &#123;
            &quot;content&quot;: &quot;ä½ å¥½ï¼Œçš®çš®é²ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ã€‚ä½ å¬è¯´è¿‡ã€Šçš®çš®é²ä¼ ã€‹å—ï¼Ÿè¿™æ˜¯éƒ‘æ¸Šæ´çˆ·çˆ·åˆ›ä½œçš„ä¸€ç³»åˆ—ç«¥è¯æ•…äº‹ï¼Œè®²è¿°äº†çš®çš®é²å’Œä»–çš„æœ‹å‹ä»¬çš„å†’é™©æ•…äº‹ã€‚&quot;,
            &quot;additional_kwargs&quot;: &#123;
              &quot;refusal&quot;: null
            &#125;,
            &quot;response_metadata&quot;: &#123;
              &quot;token_usage&quot;: &#123;
                &quot;completion_tokens&quot;: 41,
                &quot;prompt_tokens&quot;: 29,
                &quot;total_tokens&quot;: 70,
                &quot;completion_tokens_details&quot;: null,
                &quot;prompt_tokens_details&quot;: null
              &#125;,
              &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
              &quot;system_fingerprint&quot;: &quot;&quot;,
              &quot;id&quot;: &quot;019b2a1efee2dc8e447ee18f51d4fb5a&quot;,
              &quot;service_tier&quot;: null,
              &quot;finish_reason&quot;: &quot;stop&quot;,
              &quot;logprobs&quot;: null
            &#125;,
            &quot;type&quot;: &quot;ai&quot;,
            &quot;id&quot;: &quot;run--7d860365-13fa-4a01-b54e-c225f1028694-0&quot;,
            &quot;usage_metadata&quot;: &#123;
              &quot;input_tokens&quot;: 29,
              &quot;output_tokens&quot;: 41,
              &quot;total_tokens&quot;: 70,
              &quot;input_token_details&quot;: &#123;&#125;,
              &quot;output_token_details&quot;: &#123;&#125;
            &#125;,
            &quot;tool_calls&quot;: [],
            &quot;invalid_tool_calls&quot;: []
          &#125;
        &#125;
      &#125;
    ]
  ],
  &quot;llm_output&quot;: &#123;
    &quot;token_usage&quot;: &#123;
      &quot;completion_tokens&quot;: 41,
      &quot;prompt_tokens&quot;: 29,
      &quot;total_tokens&quot;: 70,
      &quot;completion_tokens_details&quot;: null,
      &quot;prompt_tokens_details&quot;: null
    &#125;,
    &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
    &quot;system_fingerprint&quot;: &quot;&quot;,
    &quot;id&quot;: &quot;019b2a1efee2dc8e447ee18f51d4fb5a&quot;,
    &quot;service_tier&quot;: null
  &#125;,
  &quot;run&quot;: null,
  &quot;type&quot;: &quot;LLMResult&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence] [1.06s] Exiting Chain run with output:
[0m[outputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async] [1.06s] Exiting Chain run with output:
[0m[outputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory] [1.07s] Exiting Chain run with output:
[0m[outputs]





AIMessage(content=&#39;ä½ å¥½ï¼Œçš®çš®é²ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ã€‚ä½ å¬è¯´è¿‡ã€Šçš®çš®é²ä¼ ã€‹å—ï¼Ÿè¿™æ˜¯éƒ‘æ¸Šæ´çˆ·çˆ·åˆ›ä½œçš„ä¸€ç³»åˆ—ç«¥è¯æ•…äº‹ï¼Œè®²è¿°äº†çš®çš®é²å’Œä»–çš„æœ‹å‹ä»¬çš„å†’é™©æ•…äº‹ã€‚&#39;, additional_kwargs=&#123;&#39;refusal&#39;: None&#125;, response_metadata=&#123;&#39;token_usage&#39;: &#123;&#39;completion_tokens&#39;: 41, &#39;prompt_tokens&#39;: 29, &#39;total_tokens&#39;: 70, &#39;completion_tokens_details&#39;: None, &#39;prompt_tokens_details&#39;: None&#125;, &#39;model_name&#39;: &#39;Qwen/Qwen2.5-7B-Instruct&#39;, &#39;system_fingerprint&#39;: &#39;&#39;, &#39;id&#39;: &#39;019b2a1efee2dc8e447ee18f51d4fb5a&#39;, &#39;service_tier&#39;: None, &#39;finish_reason&#39;: &#39;stop&#39;, &#39;logprobs&#39;: None&#125;, id=&#39;run--7d860365-13fa-4a01-b54e-c225f1028694-0&#39;, usage_metadata=&#123;&#39;input_tokens&#39;: 29, &#39;output_tokens&#39;: 41, &#39;total_tokens&#39;: 70, &#39;input_token_details&#39;: &#123;&#125;, &#39;output_token_details&#39;: &#123;&#125;&#125;)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç¬¬äºŒè½®å¯¹è¯ï¼š&quot;</span>)<br>conversation.invoke(<br>    &#123;<span class="hljs-string">&quot;input&quot;</span>: <span class="hljs-string">&quot;1+1ç­‰äºå¤šå°‘ï¼Ÿ&quot;</span>&#125;, <br>    config=&#123;<span class="hljs-string">&quot;configurable&quot;</span>: &#123;<span class="hljs-string">&quot;session_id&quot;</span>: <span class="hljs-string">&quot;session_123&quot;</span>&#125;&#125;<br>)<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">ç¬¬äºŒè½®å¯¹è¯ï¼š
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;1+1ç­‰äºå¤šå°‘ï¼Ÿ&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;1+1ç­‰äºå¤šå°‘ï¼Ÿ&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt;] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;1+1ç­‰äºå¤šå°‘ï¼Ÿ&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:load_history] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;1+1ç­‰äºå¤šå°‘ï¼Ÿ&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:load_history] [1ms] Exiting Chain run with output:
[0m[outputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt;] [3ms] Exiting Chain run with output:
[0m[outputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history] [4ms] Exiting Chain run with output:
[0m[outputs]
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async] Entering Chain run with input:
[0m[inputs]
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence] Entering Chain run with input:
[0m[inputs]
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnablePassthrough] Entering Chain run with input:
[0m[inputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnablePassthrough] [1ms] Exiting Chain run with output:
[0m[outputs]
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:filter_messages] Entering Chain run with input:
[0m[inputs]
[HumanMessage(content=&#39;ä½ å¥½, æˆ‘å«çš®çš®é²&#39;, additional_kwargs=&#123;&#125;, response_metadata=&#123;&#125;), AIMessage(content=&#39;ä½ å¥½ï¼Œçš®çš®é²ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ã€‚æˆ‘æ˜¯ä¸€ä¸ªä¹äºåŠ©äººçš„AIåŠ©æ‰‹ï¼Œä½ å¯ä»¥éšæ—¶å’Œæˆ‘èŠå¤©æˆ–è€…å¯»æ±‚å¸®åŠ©ã€‚ä½ æœ€è¿‘æœ‰ä»€ä¹ˆæœ‰è¶£çš„äº‹æƒ…æˆ–è€…é—®é¢˜æƒ³è¦åˆ†äº«å—ï¼Ÿ&#39;, additional_kwargs=&#123;&#39;refusal&#39;: None&#125;, response_metadata=&#123;&#39;token_usage&#39;: &#123;&#39;completion_tokens&#39;: 39, &#39;prompt_tokens&#39;: 29, &#39;total_tokens&#39;: 68, &#39;completion_tokens_details&#39;: None, &#39;prompt_tokens_details&#39;: None&#125;, &#39;model_name&#39;: &#39;Qwen/Qwen2.5-7B-Instruct&#39;, &#39;system_fingerprint&#39;: &#39;&#39;, &#39;id&#39;: &#39;019b2a08af8738bea14488843eb61bfa&#39;, &#39;service_tier&#39;: None, &#39;finish_reason&#39;: &#39;stop&#39;, &#39;logprobs&#39;: None&#125;, id=&#39;run--413a2029-eb8e-4ea5-beca-e59538e97603-0&#39;, usage_metadata=&#123;&#39;input_tokens&#39;: 29, &#39;output_tokens&#39;: 39, &#39;total_tokens&#39;: 68, &#39;input_token_details&#39;: &#123;&#125;, &#39;output_token_details&#39;: &#123;&#125;&#125;)]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:filter_messages] [1ms] Exiting Chain run with output:
[0m[outputs]
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] Entering Prompt run with input:
[0m[inputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] [1ms] Exiting Prompt run with output:
[0m[outputs]
[32;1m[1;3m[llm/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] Entering LLM run with input:
[0m&#123;
  &quot;prompts&quot;: [
    &quot;System: ä½ æ˜¯ä¸€ä¸ªä¹äºåŠ©äººçš„åŠ©æ‰‹ã€‚\nHuman: ä½ å¥½, æˆ‘å«çš®çš®é²\nAI: ä½ å¥½ï¼Œçš®çš®é²ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ã€‚æˆ‘æ˜¯ä¸€ä¸ªä¹äºåŠ©äººçš„AIåŠ©æ‰‹ï¼Œä½ å¯ä»¥éšæ—¶å’Œæˆ‘èŠå¤©æˆ–è€…å¯»æ±‚å¸®åŠ©ã€‚ä½ æœ€è¿‘æœ‰ä»€ä¹ˆæœ‰è¶£çš„äº‹æƒ…æˆ–è€…é—®é¢˜æƒ³è¦åˆ†äº«å—ï¼Ÿ\nHuman: 1+1ç­‰äºå¤šå°‘ï¼Ÿ&quot;
  ]
&#125;
[36;1m[1;3m[llm/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] [482ms] Exiting LLM run with output:
[0m&#123;
  &quot;generations&quot;: [
    [
      &#123;
        &quot;text&quot;: &quot;1+1ç­‰äº2ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬çš„åŠ æ³•è¿ç®—ã€‚å¦‚æœä½ æœ‰å…¶ä»–é—®é¢˜æˆ–è€…éœ€è¦å¸®åŠ©çš„äº‹æƒ…ï¼Œéšæ—¶å‘Šè¯‰æˆ‘å“¦ï¼&quot;,
        &quot;generation_info&quot;: &#123;
          &quot;finish_reason&quot;: &quot;stop&quot;,
          &quot;logprobs&quot;: null
        &#125;,
        &quot;type&quot;: &quot;ChatGeneration&quot;,
        &quot;message&quot;: &#123;
          &quot;lc&quot;: 1,
          &quot;type&quot;: &quot;constructor&quot;,
          &quot;id&quot;: [
            &quot;langchain&quot;,
            &quot;schema&quot;,
            &quot;messages&quot;,
            &quot;AIMessage&quot;
          ],
          &quot;kwargs&quot;: &#123;
            &quot;content&quot;: &quot;1+1ç­‰äº2ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬çš„åŠ æ³•è¿ç®—ã€‚å¦‚æœä½ æœ‰å…¶ä»–é—®é¢˜æˆ–è€…éœ€è¦å¸®åŠ©çš„äº‹æƒ…ï¼Œéšæ—¶å‘Šè¯‰æˆ‘å“¦ï¼&quot;,
            &quot;additional_kwargs&quot;: &#123;
              &quot;refusal&quot;: null
            &#125;,
            &quot;response_metadata&quot;: &#123;
              &quot;token_usage&quot;: &#123;
                &quot;completion_tokens&quot;: 26,
                &quot;prompt_tokens&quot;: 84,
                &quot;total_tokens&quot;: 110,
                &quot;completion_tokens_details&quot;: null,
                &quot;prompt_tokens_details&quot;: null
              &#125;,
              &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
              &quot;system_fingerprint&quot;: &quot;&quot;,
              &quot;id&quot;: &quot;019b2a08cf754854202d36fea5826472&quot;,
              &quot;service_tier&quot;: null,
              &quot;finish_reason&quot;: &quot;stop&quot;,
              &quot;logprobs&quot;: null
            &#125;,
            &quot;type&quot;: &quot;ai&quot;,
            &quot;id&quot;: &quot;run--bdd79e88-3ec3-4a8e-8912-98b5d6c4c0d0-0&quot;,
            &quot;usage_metadata&quot;: &#123;
              &quot;input_tokens&quot;: 84,
              &quot;output_tokens&quot;: 26,
              &quot;total_tokens&quot;: 110,
              &quot;input_token_details&quot;: &#123;&#125;,
              &quot;output_token_details&quot;: &#123;&#125;
            &#125;,
            &quot;tool_calls&quot;: [],
            &quot;invalid_tool_calls&quot;: []
          &#125;
        &#125;
      &#125;
    ]
  ],
  &quot;llm_output&quot;: &#123;
    &quot;token_usage&quot;: &#123;
      &quot;completion_tokens&quot;: 26,
      &quot;prompt_tokens&quot;: 84,
      &quot;total_tokens&quot;: 110,
      &quot;completion_tokens_details&quot;: null,
      &quot;prompt_tokens_details&quot;: null
    &#125;,
    &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
    &quot;system_fingerprint&quot;: &quot;&quot;,
    &quot;id&quot;: &quot;019b2a08cf754854202d36fea5826472&quot;,
    &quot;service_tier&quot;: null
  &#125;,
  &quot;run&quot;: null,
  &quot;type&quot;: &quot;LLMResult&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence] [487ms] Exiting Chain run with output:
[0m[outputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async] [489ms] Exiting Chain run with output:
[0m[outputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory] [494ms] Exiting Chain run with output:
[0m[outputs]





AIMessage(content=&#39;1+1ç­‰äº2ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬çš„åŠ æ³•è¿ç®—ã€‚å¦‚æœä½ æœ‰å…¶ä»–é—®é¢˜æˆ–è€…éœ€è¦å¸®åŠ©çš„äº‹æƒ…ï¼Œéšæ—¶å‘Šè¯‰æˆ‘å“¦ï¼&#39;, additional_kwargs=&#123;&#39;refusal&#39;: None&#125;, response_metadata=&#123;&#39;token_usage&#39;: &#123;&#39;completion_tokens&#39;: 26, &#39;prompt_tokens&#39;: 84, &#39;total_tokens&#39;: 110, &#39;completion_tokens_details&#39;: None, &#39;prompt_tokens_details&#39;: None&#125;, &#39;model_name&#39;: &#39;Qwen/Qwen2.5-7B-Instruct&#39;, &#39;system_fingerprint&#39;: &#39;&#39;, &#39;id&#39;: &#39;019b2a08cf754854202d36fea5826472&#39;, &#39;service_tier&#39;: None, &#39;finish_reason&#39;: &#39;stop&#39;, &#39;logprobs&#39;: None&#125;, id=&#39;run--bdd79e88-3ec3-4a8e-8912-98b5d6c4c0d0-0&#39;, usage_metadata=&#123;&#39;input_tokens&#39;: 84, &#39;output_tokens&#39;: 26, &#39;total_tokens&#39;: 110, &#39;input_token_details&#39;: &#123;&#125;, &#39;output_token_details&#39;: &#123;&#125;&#125;)
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç¬¬ä¸‰è½®å¯¹è¯ï¼š&quot;</span>)<br>response = conversation.invoke(<br>    &#123;<span class="hljs-string">&quot;input&quot;</span>: <span class="hljs-string">&quot;æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ&quot;</span>&#125;, <br>    config=&#123;<span class="hljs-string">&quot;configurable&quot;</span>: &#123;<span class="hljs-string">&quot;session_id&quot;</span>: <span class="hljs-string">&quot;session_123&quot;</span>&#125;&#125;<br>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\nAI å›å¤: <span class="hljs-subst">&#123;response.content&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">ç¬¬ä¸‰è½®å¯¹è¯ï¼š
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt;] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:load_history] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:load_history] [1ms] Exiting Chain run with output:
[0m[outputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt;] [2ms] Exiting Chain run with output:
[0m[outputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history] [3ms] Exiting Chain run with output:
[0m[outputs]
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async] Entering Chain run with input:
[0m[inputs]
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence] Entering Chain run with input:
[0m[inputs]
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnablePassthrough] Entering Chain run with input:
[0m[inputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnablePassthrough] [1ms] Exiting Chain run with output:
[0m[outputs]
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:filter_messages] Entering Chain run with input:
[0m[inputs]
[HumanMessage(content=&#39;ä½ å¥½, æˆ‘å«çš®çš®é²&#39;, additional_kwargs=&#123;&#125;, response_metadata=&#123;&#125;), AIMessage(content=&#39;ä½ å¥½ï¼Œçš®çš®é²ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ã€‚æˆ‘æ˜¯ä¸€ä¸ªä¹äºåŠ©äººçš„AIåŠ©æ‰‹ï¼Œä½ å¯ä»¥éšæ—¶å’Œæˆ‘èŠå¤©æˆ–è€…å¯»æ±‚å¸®åŠ©ã€‚ä½ æœ€è¿‘æœ‰ä»€ä¹ˆæœ‰è¶£çš„äº‹æƒ…æˆ–è€…é—®é¢˜æƒ³è¦åˆ†äº«å—ï¼Ÿ&#39;, additional_kwargs=&#123;&#39;refusal&#39;: None&#125;, response_metadata=&#123;&#39;token_usage&#39;: &#123;&#39;completion_tokens&#39;: 39, &#39;prompt_tokens&#39;: 29, &#39;total_tokens&#39;: 68, &#39;completion_tokens_details&#39;: None, &#39;prompt_tokens_details&#39;: None&#125;, &#39;model_name&#39;: &#39;Qwen/Qwen2.5-7B-Instruct&#39;, &#39;system_fingerprint&#39;: &#39;&#39;, &#39;id&#39;: &#39;019b2a08af8738bea14488843eb61bfa&#39;, &#39;service_tier&#39;: None, &#39;finish_reason&#39;: &#39;stop&#39;, &#39;logprobs&#39;: None&#125;, id=&#39;run--413a2029-eb8e-4ea5-beca-e59538e97603-0&#39;, usage_metadata=&#123;&#39;input_tokens&#39;: 29, &#39;output_tokens&#39;: 39, &#39;total_tokens&#39;: 68, &#39;input_token_details&#39;: &#123;&#125;, &#39;output_token_details&#39;: &#123;&#125;&#125;), HumanMessage(content=&#39;1+1ç­‰äºå¤šå°‘ï¼Ÿ&#39;, additional_kwargs=&#123;&#125;, response_metadata=&#123;&#125;), AIMessage(content=&#39;1+1ç­‰äº2ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬çš„åŠ æ³•è¿ç®—ã€‚å¦‚æœä½ æœ‰å…¶ä»–é—®é¢˜æˆ–è€…éœ€è¦å¸®åŠ©çš„äº‹æƒ…ï¼Œéšæ—¶å‘Šè¯‰æˆ‘å“¦ï¼&#39;, additional_kwargs=&#123;&#39;refusal&#39;: None&#125;, response_metadata=&#123;&#39;token_usage&#39;: &#123;&#39;completion_tokens&#39;: 26, &#39;prompt_tokens&#39;: 84, &#39;total_tokens&#39;: 110, &#39;completion_tokens_details&#39;: None, &#39;prompt_tokens_details&#39;: None&#125;, &#39;model_name&#39;: &#39;Qwen/Qwen2.5-7B-Instruct&#39;, &#39;system_fingerprint&#39;: &#39;&#39;, &#39;id&#39;: &#39;019b2a08cf754854202d36fea5826472&#39;, &#39;service_tier&#39;: None, &#39;finish_reason&#39;: &#39;stop&#39;, &#39;logprobs&#39;: None&#125;, id=&#39;run--bdd79e88-3ec3-4a8e-8912-98b5d6c4c0d0-0&#39;, usage_metadata=&#123;&#39;input_tokens&#39;: 84, &#39;output_tokens&#39;: 26, &#39;total_tokens&#39;: 110, &#39;input_token_details&#39;: &#123;&#125;, &#39;output_token_details&#39;: &#123;&#125;&#125;)]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:filter_messages] [1ms] Exiting Chain run with output:
[0m[outputs]
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] Entering Prompt run with input:
[0m[inputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] [1ms] Exiting Prompt run with output:
[0m[outputs]
[32;1m[1;3m[llm/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] Entering LLM run with input:
[0m&#123;
  &quot;prompts&quot;: [
    &quot;System: ä½ æ˜¯ä¸€ä¸ªä¹äºåŠ©äººçš„åŠ©æ‰‹ã€‚\nHuman: 1+1ç­‰äºå¤šå°‘ï¼Ÿ\nAI: 1+1ç­‰äº2ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬çš„åŠ æ³•è¿ç®—ã€‚å¦‚æœä½ æœ‰å…¶ä»–é—®é¢˜æˆ–è€…éœ€è¦å¸®åŠ©çš„äº‹æƒ…ï¼Œéšæ—¶å‘Šè¯‰æˆ‘å“¦ï¼\nHuman: æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ&quot;
  ]
&#125;
[36;1m[1;3m[llm/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] [1.01s] Exiting LLM run with output:
[0m&#123;
  &quot;generations&quot;: [
    [
      &#123;
        &quot;text&quot;: &quot;è¦å›ç­”ä½ â€œæˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿâ€è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘éœ€è¦çŸ¥é“ä½ çš„åå­—ã€‚ä½ å¯ä»¥å‘Šè¯‰æˆ‘ä½ çš„åå­—ï¼Œæˆ–è€…å‘Šè¯‰æˆ‘æ›´å¤šå…³äºä½ è‡ªå·±çš„ä¿¡æ¯ï¼Œè¿™æ ·æˆ‘æ‰èƒ½æ›´å¥½åœ°å¸®åŠ©ä½ ã€‚&quot;,
        &quot;generation_info&quot;: &#123;
          &quot;finish_reason&quot;: &quot;stop&quot;,
          &quot;logprobs&quot;: null
        &#125;,
        &quot;type&quot;: &quot;ChatGeneration&quot;,
        &quot;message&quot;: &#123;
          &quot;lc&quot;: 1,
          &quot;type&quot;: &quot;constructor&quot;,
          &quot;id&quot;: [
            &quot;langchain&quot;,
            &quot;schema&quot;,
            &quot;messages&quot;,
            &quot;AIMessage&quot;
          ],
          &quot;kwargs&quot;: &#123;
            &quot;content&quot;: &quot;è¦å›ç­”ä½ â€œæˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿâ€è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘éœ€è¦çŸ¥é“ä½ çš„åå­—ã€‚ä½ å¯ä»¥å‘Šè¯‰æˆ‘ä½ çš„åå­—ï¼Œæˆ–è€…å‘Šè¯‰æˆ‘æ›´å¤šå…³äºä½ è‡ªå·±çš„ä¿¡æ¯ï¼Œè¿™æ ·æˆ‘æ‰èƒ½æ›´å¥½åœ°å¸®åŠ©ä½ ã€‚&quot;,
            &quot;additional_kwargs&quot;: &#123;
              &quot;refusal&quot;: null
            &#125;,
            &quot;response_metadata&quot;: &#123;
              &quot;token_usage&quot;: &#123;
                &quot;completion_tokens&quot;: 37,
                &quot;prompt_tokens&quot;: 68,
                &quot;total_tokens&quot;: 105,
                &quot;completion_tokens_details&quot;: null,
                &quot;prompt_tokens_details&quot;: null
              &#125;,
              &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
              &quot;system_fingerprint&quot;: &quot;&quot;,
              &quot;id&quot;: &quot;019b2a08efca0066184738c72ec816ca&quot;,
              &quot;service_tier&quot;: null,
              &quot;finish_reason&quot;: &quot;stop&quot;,
              &quot;logprobs&quot;: null
            &#125;,
            &quot;type&quot;: &quot;ai&quot;,
            &quot;id&quot;: &quot;run--631bae4a-78a5-47a6-8d96-1ee16545f6ef-0&quot;,
            &quot;usage_metadata&quot;: &#123;
              &quot;input_tokens&quot;: 68,
              &quot;output_tokens&quot;: 37,
              &quot;total_tokens&quot;: 105,
              &quot;input_token_details&quot;: &#123;&#125;,
              &quot;output_token_details&quot;: &#123;&#125;
            &#125;,
            &quot;tool_calls&quot;: [],
            &quot;invalid_tool_calls&quot;: []
          &#125;
        &#125;
      &#125;
    ]
  ],
  &quot;llm_output&quot;: &#123;
    &quot;token_usage&quot;: &#123;
      &quot;completion_tokens&quot;: 37,
      &quot;prompt_tokens&quot;: 68,
      &quot;total_tokens&quot;: 105,
      &quot;completion_tokens_details&quot;: null,
      &quot;prompt_tokens_details&quot;: null
    &#125;,
    &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
    &quot;system_fingerprint&quot;: &quot;&quot;,
    &quot;id&quot;: &quot;019b2a08efca0066184738c72ec816ca&quot;,
    &quot;service_tier&quot;: null
  &#125;,
  &quot;run&quot;: null,
  &quot;type&quot;: &quot;LLMResult&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence] [1.01s] Exiting Chain run with output:
[0m[outputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async] [1.02s] Exiting Chain run with output:
[0m[outputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory] [1.02s] Exiting Chain run with output:
[0m[outputs]

AI å›å¤: è¦å›ç­”ä½ â€œæˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿâ€è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘éœ€è¦çŸ¥é“ä½ çš„åå­—ã€‚ä½ å¯ä»¥å‘Šè¯‰æˆ‘ä½ çš„åå­—ï¼Œæˆ–è€…å‘Šè¯‰æˆ‘æ›´å¤šå…³äºä½ è‡ªå·±çš„ä¿¡æ¯ï¼Œè¿™æ ·æˆ‘æ‰èƒ½æ›´å¥½åœ°å¸®åŠ©ä½ ã€‚
</code></pre>
<h1 id="ä¸‰ã€å¯¹è¯å­—ç¬¦ç¼“å­˜å‚¨å­˜"><a href="#ä¸‰ã€å¯¹è¯å­—ç¬¦ç¼“å­˜å‚¨å­˜" class="headerlink" title="ä¸‰ã€å¯¹è¯å­—ç¬¦ç¼“å­˜å‚¨å­˜"></a>ä¸‰ã€å¯¹è¯å­—ç¬¦ç¼“å­˜å‚¨å­˜</h1><p>ä½¿ç”¨å¯¹è¯å­—ç¬¦ç¼“å­˜è®°å¿†ï¼Œå†…å­˜å°†é™åˆ¶ä¿å­˜çš„tokenæ•°é‡ã€‚å¦‚æœå­—ç¬¦æ•°é‡è¶…å‡ºæŒ‡å®šæ•°ç›®ï¼Œå®ƒä¼šåˆ‡æ‰è¿™ä¸ªå¯¹è¯çš„æ—©æœŸéƒ¨åˆ† ä»¥ä¿ç•™ä¸æœ€è¿‘çš„äº¤æµç›¸å¯¹åº”çš„å­—ç¬¦æ•°é‡ï¼Œä½†ä¸è¶…è¿‡å­—ç¬¦é™åˆ¶ã€‚</p>
<p>æ·»åŠ å¯¹è¯åˆ°Tokenç¼“å­˜å‚¨å­˜,é™åˆ¶tokenæ•°é‡ï¼Œè¿›è¡Œæµ‹è¯•</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><span class="hljs-comment"># 3. å¤„ç†æ¨¡å—å¯¼å…¥ (ä¿æŒæ‚¨åŸæœ‰çš„é€»è¾‘)</span><br><span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;tool&#x27;</span> <span class="hljs-keyword">in</span> sys.modules:<br>    <span class="hljs-keyword">del</span> sys.modules[<span class="hljs-string">&#x27;tool&#x27;</span>]<br><span class="hljs-comment"># if &#x27;utils_zh&#x27; in sys.modules:</span><br><span class="hljs-comment">#     del sys.modules[&#x27;utils_zh&#x27;]</span><br><span class="hljs-comment"># é‡æ–°å¯¼å…¥æ¨¡å—</span><br>sys.path.append(<span class="hljs-string">&#x27;/home/py/shared/StudyChatgpt&#x27;</span>)<br><span class="hljs-keyword">from</span> tool <span class="hljs-keyword">import</span> get_chat_model2<br><span class="hljs-comment"># åˆå§‹åŒ–å¤§æ¨¡å‹å¯¹è±¡ï¼ˆè¿™åªæ˜¯ä¸€ä¸ªæ‰§è¡Œè€…ï¼Œå®ƒè‡ªå·±ä¸è®°äº‹ï¼‰</span><br>llm = get_chat_model2(temperature=<span class="hljs-number">0.0</span>)<br><br><span class="hljs-keyword">from</span> langchain_core.chat_history <span class="hljs-keyword">import</span> InMemoryChatMessageHistory<br><span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> trim_messages<br><br><span class="hljs-comment"># 1. è‡ªå®šä¹‰ä¸€ä¸ªç®€å•çš„è®¡æ•°å™¨å‡½æ•°</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">simple_char_counter</span>(<span class="hljs-params">messages</span>):<br>    total_tokens = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> msg <span class="hljs-keyword">in</span> messages:<br>        <span class="hljs-comment"># ç²—ç•¥ä¼°ç®—é€»è¾‘ï¼š</span><br>        <span class="hljs-comment"># Qwen2.5 å®é™…ä¸Šéå¸¸é«˜æ•ˆï¼Œä¸­æ–‡å¤§çº¦ 0.6~0.8 ä¸ª token/å­—</span><br>        <span class="hljs-comment"># æˆ‘ä»¬æŒ‰ 1ä¸ªå­— = 1ä¸ªtoken ç®—ï¼Œè¿™æ˜¯ä¸€ä¸ª&quot;å®‰å…¨&quot;çš„é«˜ä¼°(conservative estimate)</span><br>        <span class="hljs-comment"># è¿™æ ·åªä¼šè®©ä½ æˆªæ–­å¾—ç¨å¾®æ—©ä¸€ç‚¹ç‚¹ï¼Œç»å¯¹ä¸ä¼šçˆ†æ˜¾å­˜</span><br>        total_tokens += <span class="hljs-built_in">len</span>(msg.content)<br>    <span class="hljs-keyword">return</span> total_tokens<br><br><span class="hljs-comment"># 2. åˆå§‹åŒ–å†å²è®°å½•å­˜å‚¨ (æ›¿ä»£ memory.save_context)</span><br>history = InMemoryChatMessageHistory()<br><br><span class="hljs-comment"># 3. æ¨¡æ‹Ÿå­˜å…¥æ•°æ®</span><br>history.add_user_message(<span class="hljs-string">&quot;æœè¾ç™½å¸å½©äº‘é—´ï¼Œ&quot;</span>)<br>history.add_ai_message(<span class="hljs-string">&quot;åƒé‡Œæ±Ÿé™µä¸€æ—¥è¿˜ã€‚&quot;</span>)<br>history.add_user_message(<span class="hljs-string">&quot;ä¸¤å²¸çŒ¿å£°å•¼ä¸ä½ï¼Œ&quot;</span>)<br>history.add_ai_message(<span class="hljs-string">&quot;è½»èˆŸå·²è¿‡ä¸‡é‡å±±ã€‚&quot;</span>)<br><br><span class="hljs-comment"># 4. å®šä¹‰ä¿®å‰ªå™¨ (æ›¿ä»£ max_token_limit=30)</span><br><span class="hljs-comment"># strategy=&quot;last&quot;: ä¿ç•™æœ€æ–°çš„æ¶ˆæ¯</span><br>trimmer = trim_messages(<br>    max_tokens=<span class="hljs-number">30</span>,        <span class="hljs-comment"># ä½ çš„é™åˆ¶</span><br>    strategy=<span class="hljs-string">&quot;last&quot;</span>,      <span class="hljs-comment"># ä¿ç•™æœ€æ–°çš„ï¼Œåˆ æ‰æ—§çš„</span><br>    token_counter=simple_char_counter, <span class="hljs-comment"># &lt;--- ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°</span><br>    include_system=<span class="hljs-literal">True</span>,  <span class="hljs-comment"># å¦‚æœæœ‰ç³»ç»Ÿæç¤ºè¯ï¼Œæ˜¯å¦åŒ…å«åœ¨è®¡ç®—å†…</span><br>    allow_partial=<span class="hljs-literal">False</span>,  <span class="hljs-comment"># æ˜¯å¦å…è®¸åˆ‡æ–­ä¸€æ¡å®Œæ•´çš„æ¶ˆæ¯(Falseè¡¨ç¤ºè¦ä¹ˆå…¨ç•™è¦ä¹ˆå…¨åˆ )</span><br>)<br><br><span class="hljs-comment"># 5. æ‰§è¡Œä¿®å‰ª (æ›¿ä»£ memory.load_memory_variables)</span><br><span class="hljs-comment"># æ³¨æ„ï¼šè¿™å°†è¿”å›ä¸€ä¸ªä¿®å‰ªåçš„ Message åˆ—è¡¨</span><br>selected_messages = trimmer.invoke(history.messages)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;åŸå§‹æ¶ˆæ¯æ•°: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(history.messages)&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ä¿®å‰ªåæ¶ˆæ¯æ•°: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(selected_messages)&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;--- ä¿®å‰ªåçš„å†…å®¹ ---&quot;</span>)<br><span class="hljs-keyword">for</span> msg <span class="hljs-keyword">in</span> selected_messages:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;msg.<span class="hljs-built_in">type</span>&#125;</span>: <span class="hljs-subst">&#123;msg.content&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">[32;1m[1;3m[chain/start][0m [1m[chain:trim_messages] Entering Chain run with input:
[0m[inputs]
[36;1m[1;3m[chain/end][0m [1m[chain:trim_messages] [1ms] Exiting Chain run with output:
[0m[outputs]
åŸå§‹æ¶ˆæ¯æ•°: 4
ä¿®å‰ªåæ¶ˆæ¯æ•°: 3
--- ä¿®å‰ªåçš„å†…å®¹ ---
ai: åƒé‡Œæ±Ÿé™µä¸€æ—¥è¿˜ã€‚
human: ä¸¤å²¸çŒ¿å£°å•¼ä¸ä½ï¼Œ
ai: è½»èˆŸå·²è¿‡ä¸‡é‡å±±ã€‚
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><span class="hljs-comment"># 3. å¤„ç†æ¨¡å—å¯¼å…¥ (ä¿æŒæ‚¨åŸæœ‰çš„é€»è¾‘)</span><br><span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;tool&#x27;</span> <span class="hljs-keyword">in</span> sys.modules:<br>    <span class="hljs-keyword">del</span> sys.modules[<span class="hljs-string">&#x27;tool&#x27;</span>]<br><span class="hljs-comment"># if &#x27;utils_zh&#x27; in sys.modules:</span><br><span class="hljs-comment">#     del sys.modules[&#x27;utils_zh&#x27;]</span><br><span class="hljs-comment"># é‡æ–°å¯¼å…¥æ¨¡å—</span><br>sys.path.append(<span class="hljs-string">&#x27;/home/py/shared/StudyChatgpt&#x27;</span>)<br><span class="hljs-keyword">from</span> tool <span class="hljs-keyword">import</span> get_chat_model2<br><span class="hljs-comment"># åˆå§‹åŒ–å¤§æ¨¡å‹å¯¹è±¡ï¼ˆè¿™åªæ˜¯ä¸€ä¸ªæ‰§è¡Œè€…ï¼Œå®ƒè‡ªå·±ä¸è®°äº‹ï¼‰</span><br>llm = get_chat_model2(temperature=<span class="hljs-number">0.0</span>)<br><br><span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate, MessagesPlaceholder<br><span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> trim_messages<br><span class="hljs-keyword">from</span> langchain_core.runnables.history <span class="hljs-keyword">import</span> RunnableWithMessageHistory<br><span class="hljs-keyword">from</span> langchain_core.chat_history <span class="hljs-keyword">import</span> InMemoryChatMessageHistory<br><span class="hljs-keyword">from</span> operator <span class="hljs-keyword">import</span> itemgetter<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">simple_char_counter</span>(<span class="hljs-params">messages</span>):<br>    total_tokens = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> msg <span class="hljs-keyword">in</span> messages:<br>        <span class="hljs-comment"># ç²—ç•¥ä¼°ç®—é€»è¾‘ï¼š</span><br>        <span class="hljs-comment"># Qwen2.5 å®é™…ä¸Šéå¸¸é«˜æ•ˆï¼Œä¸­æ–‡å¤§çº¦ 0.6~0.8 ä¸ª token/å­—</span><br>        <span class="hljs-comment"># æˆ‘ä»¬æŒ‰ 1ä¸ªå­— = 1ä¸ªtoken ç®—ï¼Œè¿™æ˜¯ä¸€ä¸ª&quot;å®‰å…¨&quot;çš„é«˜ä¼°(conservative estimate)</span><br>        <span class="hljs-comment"># è¿™æ ·åªä¼šè®©ä½ æˆªæ–­å¾—ç¨å¾®æ—©ä¸€ç‚¹ç‚¹ï¼Œç»å¯¹ä¸ä¼šçˆ†æ˜¾å­˜</span><br>        total_tokens += <span class="hljs-built_in">len</span>(msg.content)<br>    <span class="hljs-keyword">return</span> total_tokens<br><br>trimmer = trim_messages(<br>    max_tokens=<span class="hljs-number">10</span>,<br>    strategy=<span class="hljs-string">&quot;last&quot;</span>,<br>    token_counter=simple_char_counter,<br>    start_on=<span class="hljs-string">&quot;human&quot;</span>, <span class="hljs-comment"># ç¡®ä¿æˆªæ–­åçš„ç¬¬ä¸€å¥è¯æ˜¯ç”¨æˆ·è¯´çš„ï¼ˆå¯é€‰ï¼‰</span><br>    include_system=<span class="hljs-literal">True</span>,  <span class="hljs-comment"># å¦‚æœæœ‰ç³»ç»Ÿæç¤ºè¯ï¼Œæ˜¯å¦åŒ…å«åœ¨è®¡ç®—å†…</span><br>    allow_partial=<span class="hljs-literal">False</span>,  <span class="hljs-comment"># æ˜¯å¦å…è®¸åˆ‡æ–­ä¸€æ¡å®Œæ•´çš„æ¶ˆæ¯(Falseè¡¨ç¤ºè¦ä¹ˆå…¨ç•™è¦ä¹ˆå…¨åˆ )</span><br>)<br><br><span class="hljs-comment"># --- 2. æ„å»º Chain ---</span><br><span class="hljs-comment"># æ³¨æ„ï¼štrimmer è¢«æ”¾åœ¨äº† prompt ä¹‹å‰ï¼</span><br><span class="hljs-comment"># é€»è¾‘æµï¼šè¾“å…¥ -&gt; è¯»å–å†å² -&gt; è£å‰ªå†å²(trimmer) -&gt; æ”¾å…¥Prompt -&gt; LLM</span><br>prompt = ChatPromptTemplate.from_messages([<br>    (<span class="hljs-string">&quot;system&quot;</span>, <span class="hljs-string">&quot;ä½ æ˜¯ä¸€ä¸ªèƒŒè¯—åŠ©æ‰‹ã€‚&quot;</span>),<br>    MessagesPlaceholder(variable_name=<span class="hljs-string">&quot;history&quot;</span>), <br>    (<span class="hljs-string">&quot;human&quot;</span>, <span class="hljs-string">&quot;&#123;input&#125;&quot;</span>),<br>])<br><br><span class="hljs-comment"># ä½¿ç”¨ LCEL ç®¡é“è¿æ¥</span><br>chain = (<br>    RunnablePassthrough.assign(<br>        <span class="hljs-comment">#åœ¨è¿™é‡Œå¯¹ history è¿›è¡Œä¿®å‰ª</span><br>        history=itemgetter(<span class="hljs-string">&quot;history&quot;</span>) | trimmer <br>    )<br>    | prompt<br>    | llm<br>)<br><br><span class="hljs-comment"># --- 3. ç®¡ç†å†å²è®°å½• ---</span><br>store = &#123;&#125; <span class="hljs-comment"># æ¨¡æ‹Ÿæ•°æ®åº“</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_session_history</span>(<span class="hljs-params">session_id: <span class="hljs-built_in">str</span></span>):<br>    <span class="hljs-keyword">if</span> session_id <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> store:<br>        store[session_id] = InMemoryChatMessageHistory()<br>    <span class="hljs-keyword">return</span> store[session_id]<br><br>chain_with_history = RunnableWithMessageHistory(<br>    chain,<br>    get_session_history,<br>    input_messages_key=<span class="hljs-string">&quot;input&quot;</span>,<br>    history_messages_key=<span class="hljs-string">&quot;history&quot;</span>,<br>)<br><br><span class="hljs-comment"># --- 4. æµ‹è¯• ---</span><br><span class="hljs-comment"># è¿™ä¸€æ­¥ä¼šè‡ªåŠ¨æŠŠå¯¹è¯å­˜å…¥ historyï¼Œå¹¶ä¸”åœ¨ä¸‹ä¸€æ¬¡å¯¹è¯æ—¶è‡ªåŠ¨è§¦å‘ trimmer</span><br>config = &#123;<span class="hljs-string">&quot;configurable&quot;</span>: &#123;<span class="hljs-string">&quot;session_id&quot;</span>: <span class="hljs-string">&quot;test_1&quot;</span>&#125;&#125;<br><br><span class="hljs-comment"># ç¬¬ä¸€è½®</span><br>chain_with_history.invoke(&#123;<span class="hljs-string">&quot;input&quot;</span>: <span class="hljs-string">&quot;æœè¾ç™½å¸å½©äº‘é—´ï¼Œ&quot;</span>&#125;, config) <br><br><span class="hljs-comment"># ç¬¬äºŒè½®</span><br>chain_with_history.invoke(&#123;<span class="hljs-string">&quot;input&quot;</span>: <span class="hljs-string">&quot;ä¸¤å²¸çŒ¿å£°å•¼ä¸ä½ï¼Œ&quot;</span>&#125;, config) <br><br><span class="hljs-comment"># æŸ¥çœ‹å†…å­˜ä¸­å®é™…å­˜å‚¨äº†å¤šå°‘ï¼ˆå†…å­˜é‡Œæ˜¯å…¨çš„ï¼Œä½†å‘ç»™ LLM åªæœ‰æœ€å 30 tokensï¼‰</span><br><span class="hljs-built_in">print</span>(store[<span class="hljs-string">&quot;test_1&quot;</span>].messages)<br><br>response = chain_with_history.invoke(&#123;<span class="hljs-string">&quot;input&quot;</span>: <span class="hljs-string">&quot;è¿™é¦–è¯—çš„ä½œè€…æ˜¯è°ï¼Ÿ&quot;</span>&#125;, config)<br><span class="hljs-built_in">print</span>(response.content)<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;æœè¾ç™½å¸å½©äº‘é—´ï¼Œ&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;æœè¾ç™½å¸å½©äº‘é—´ï¼Œ&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt;] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;æœè¾ç™½å¸å½©äº‘é—´ï¼Œ&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:load_history] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;æœè¾ç™½å¸å½©äº‘é—´ï¼Œ&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:load_history] [1ms] Exiting Chain run with output:
[0m&#123;
  &quot;output&quot;: []
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt;] [2ms] Exiting Chain run with output:
[0m&#123;
  &quot;history&quot;: []
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history] [3ms] Exiting Chain run with output:
[0m&#123;
  &quot;input&quot;: &quot;æœè¾ç™½å¸å½©äº‘é—´ï¼Œ&quot;,
  &quot;history&quot;: []
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;æœè¾ç™½å¸å½©äº‘é—´ï¼Œ&quot;,
  &quot;history&quot;: []
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;æœè¾ç™½å¸å½©äº‘é—´ï¼Œ&quot;,
  &quot;history&quot;: []
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt;] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;æœè¾ç™½å¸å½©äº‘é—´ï¼Œ&quot;,
  &quot;history&quot;: []
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt; &gt; chain:RunnableParallel&lt;history&gt;] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;æœè¾ç™½å¸å½©äº‘é—´ï¼Œ&quot;,
  &quot;history&quot;: []
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt; &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:RunnableSequence] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;æœè¾ç™½å¸å½©äº‘é—´ï¼Œ&quot;,
  &quot;history&quot;: []
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt; &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:RunnableSequence &gt; chain:RunnableLambda] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;æœè¾ç™½å¸å½©äº‘é—´ï¼Œ&quot;,
  &quot;history&quot;: []
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt; &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:RunnableSequence &gt; chain:RunnableLambda] [1ms] Exiting Chain run with output:
[0m&#123;
  &quot;output&quot;: []
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt; &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:RunnableSequence &gt; chain:trim_messages] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: []
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt; &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:RunnableSequence &gt; chain:trim_messages] [1ms] Exiting Chain run with output:
[0m&#123;
  &quot;output&quot;: []
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt; &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:RunnableSequence] [2ms] Exiting Chain run with output:
[0m&#123;
  &quot;output&quot;: []
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt; &gt; chain:RunnableParallel&lt;history&gt;] [3ms] Exiting Chain run with output:
[0m&#123;
  &quot;history&quot;: []
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt;] [4ms] Exiting Chain run with output:
[0m&#123;
  &quot;input&quot;: &quot;æœè¾ç™½å¸å½©äº‘é—´ï¼Œ&quot;,
  &quot;history&quot;: []
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] Entering Prompt run with input:
[0m&#123;
  &quot;input&quot;: &quot;æœè¾ç™½å¸å½©äº‘é—´ï¼Œ&quot;,
  &quot;history&quot;: []
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] [1ms] Exiting Prompt run with output:
[0m[outputs]
[32;1m[1;3m[llm/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] Entering LLM run with input:
[0m&#123;
  &quot;prompts&quot;: [
    &quot;System: ä½ æ˜¯ä¸€ä¸ªèƒŒè¯—åŠ©æ‰‹ã€‚\nHuman: æœè¾ç™½å¸å½©äº‘é—´ï¼Œ&quot;
  ]
&#125;
[36;1m[1;3m[llm/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] [688ms] Exiting LLM run with output:
[0m&#123;
  &quot;generations&quot;: [
    [
      &#123;
        &quot;text&quot;: &quot;æœè¾ç™½å¸å½©äº‘é—´ï¼Œåƒé‡Œæ±Ÿé™µä¸€æ—¥è¿˜ã€‚è¿™æ˜¯æç™½çš„ã€Šæ—©å‘ç™½å¸åŸã€‹ä¸­çš„è¯—å¥ã€‚&quot;,
        &quot;generation_info&quot;: &#123;
          &quot;finish_reason&quot;: &quot;stop&quot;,
          &quot;logprobs&quot;: null
        &#125;,
        &quot;type&quot;: &quot;ChatGeneration&quot;,
        &quot;message&quot;: &#123;
          &quot;lc&quot;: 1,
          &quot;type&quot;: &quot;constructor&quot;,
          &quot;id&quot;: [
            &quot;langchain&quot;,
            &quot;schema&quot;,
            &quot;messages&quot;,
            &quot;AIMessage&quot;
          ],
          &quot;kwargs&quot;: &#123;
            &quot;content&quot;: &quot;æœè¾ç™½å¸å½©äº‘é—´ï¼Œåƒé‡Œæ±Ÿé™µä¸€æ—¥è¿˜ã€‚è¿™æ˜¯æç™½çš„ã€Šæ—©å‘ç™½å¸åŸã€‹ä¸­çš„è¯—å¥ã€‚&quot;,
            &quot;additional_kwargs&quot;: &#123;
              &quot;refusal&quot;: null
            &#125;,
            &quot;response_metadata&quot;: &#123;
              &quot;token_usage&quot;: &#123;
                &quot;completion_tokens&quot;: 27,
                &quot;prompt_tokens&quot;: 27,
                &quot;total_tokens&quot;: 54,
                &quot;completion_tokens_details&quot;: null,
                &quot;prompt_tokens_details&quot;: null
              &#125;,
              &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
              &quot;system_fingerprint&quot;: &quot;&quot;,
              &quot;id&quot;: &quot;019b2a538a46c3031a12ce1103a9562e&quot;,
              &quot;service_tier&quot;: null,
              &quot;finish_reason&quot;: &quot;stop&quot;,
              &quot;logprobs&quot;: null
            &#125;,
            &quot;type&quot;: &quot;ai&quot;,
            &quot;id&quot;: &quot;run--4deecc10-d2fc-40dc-b865-df5a7871faf1-0&quot;,
            &quot;usage_metadata&quot;: &#123;
              &quot;input_tokens&quot;: 27,
              &quot;output_tokens&quot;: 27,
              &quot;total_tokens&quot;: 54,
              &quot;input_token_details&quot;: &#123;&#125;,
              &quot;output_token_details&quot;: &#123;&#125;
            &#125;,
            &quot;tool_calls&quot;: [],
            &quot;invalid_tool_calls&quot;: []
          &#125;
        &#125;
      &#125;
    ]
  ],
  &quot;llm_output&quot;: &#123;
    &quot;token_usage&quot;: &#123;
      &quot;completion_tokens&quot;: 27,
      &quot;prompt_tokens&quot;: 27,
      &quot;total_tokens&quot;: 54,
      &quot;completion_tokens_details&quot;: null,
      &quot;prompt_tokens_details&quot;: null
    &#125;,
    &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
    &quot;system_fingerprint&quot;: &quot;&quot;,
    &quot;id&quot;: &quot;019b2a538a46c3031a12ce1103a9562e&quot;,
    &quot;service_tier&quot;: null
  &#125;,
  &quot;run&quot;: null,
  &quot;type&quot;: &quot;LLMResult&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence] [696ms] Exiting Chain run with output:
[0m[outputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async] [697ms] Exiting Chain run with output:
[0m[outputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory] [700ms] Exiting Chain run with output:
[0m[outputs]
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä¸¤å²¸çŒ¿å£°å•¼ä¸ä½ï¼Œ&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä¸¤å²¸çŒ¿å£°å•¼ä¸ä½ï¼Œ&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt;] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä¸¤å²¸çŒ¿å£°å•¼ä¸ä½ï¼Œ&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:load_history] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä¸¤å²¸çŒ¿å£°å•¼ä¸ä½ï¼Œ&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:load_history] [1ms] Exiting Chain run with output:
[0m[outputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt;] [2ms] Exiting Chain run with output:
[0m[outputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history] [2ms] Exiting Chain run with output:
[0m[outputs]
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async] Entering Chain run with input:
[0m[inputs]
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence] Entering Chain run with input:
[0m[inputs]
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt;] Entering Chain run with input:
[0m[inputs]
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt; &gt; chain:RunnableParallel&lt;history&gt;] Entering Chain run with input:
[0m[inputs]
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt; &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:RunnableSequence] Entering Chain run with input:
[0m[inputs]
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt; &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:RunnableSequence &gt; chain:RunnableLambda] Entering Chain run with input:
[0m[inputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt; &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:RunnableSequence &gt; chain:RunnableLambda] [1ms] Exiting Chain run with output:
[0m[outputs]
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt; &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:RunnableSequence &gt; chain:trim_messages] Entering Chain run with input:
[0m[inputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt; &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:RunnableSequence &gt; chain:trim_messages] [1ms] Exiting Chain run with output:
[0m&#123;
  &quot;output&quot;: []
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt; &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:RunnableSequence] [2ms] Exiting Chain run with output:
[0m&#123;
  &quot;output&quot;: []
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt; &gt; chain:RunnableParallel&lt;history&gt;] [3ms] Exiting Chain run with output:
[0m&#123;
  &quot;history&quot;: []
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt;] [4ms] Exiting Chain run with output:
[0m&#123;
  &quot;input&quot;: &quot;ä¸¤å²¸çŒ¿å£°å•¼ä¸ä½ï¼Œ&quot;,
  &quot;history&quot;: []
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] Entering Prompt run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä¸¤å²¸çŒ¿å£°å•¼ä¸ä½ï¼Œ&quot;,
  &quot;history&quot;: []
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] [1ms] Exiting Prompt run with output:
[0m[outputs]
[32;1m[1;3m[llm/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] Entering LLM run with input:
[0m&#123;
  &quot;prompts&quot;: [
    &quot;System: ä½ æ˜¯ä¸€ä¸ªèƒŒè¯—åŠ©æ‰‹ã€‚\nHuman: ä¸¤å²¸çŒ¿å£°å•¼ä¸ä½ï¼Œ&quot;
  ]
&#125;
[36;1m[1;3m[llm/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] [534ms] Exiting LLM run with output:
[0m&#123;
  &quot;generations&quot;: [
    [
      &#123;
        &quot;text&quot;: &quot;ä¸¤å²¸çŒ¿å£°å•¼ä¸ä½ï¼Œè½»èˆŸå·²è¿‡ä¸‡é‡å±±ã€‚è¿™æ˜¯æç™½çš„ã€Šæ—©å‘ç™½å¸åŸã€‹ä¸­çš„è¯—å¥ã€‚&quot;,
        &quot;generation_info&quot;: &#123;
          &quot;finish_reason&quot;: &quot;stop&quot;,
          &quot;logprobs&quot;: null
        &#125;,
        &quot;type&quot;: &quot;ChatGeneration&quot;,
        &quot;message&quot;: &#123;
          &quot;lc&quot;: 1,
          &quot;type&quot;: &quot;constructor&quot;,
          &quot;id&quot;: [
            &quot;langchain&quot;,
            &quot;schema&quot;,
            &quot;messages&quot;,
            &quot;AIMessage&quot;
          ],
          &quot;kwargs&quot;: &#123;
            &quot;content&quot;: &quot;ä¸¤å²¸çŒ¿å£°å•¼ä¸ä½ï¼Œè½»èˆŸå·²è¿‡ä¸‡é‡å±±ã€‚è¿™æ˜¯æç™½çš„ã€Šæ—©å‘ç™½å¸åŸã€‹ä¸­çš„è¯—å¥ã€‚&quot;,
            &quot;additional_kwargs&quot;: &#123;
              &quot;refusal&quot;: null
            &#125;,
            &quot;response_metadata&quot;: &#123;
              &quot;token_usage&quot;: &#123;
                &quot;completion_tokens&quot;: 27,
                &quot;prompt_tokens&quot;: 25,
                &quot;total_tokens&quot;: 52,
                &quot;completion_tokens_details&quot;: null,
                &quot;prompt_tokens_details&quot;: null
              &#125;,
              &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
              &quot;system_fingerprint&quot;: &quot;&quot;,
              &quot;id&quot;: &quot;019b2a538c9b28ea4527841d147dd390&quot;,
              &quot;service_tier&quot;: null,
              &quot;finish_reason&quot;: &quot;stop&quot;,
              &quot;logprobs&quot;: null
            &#125;,
            &quot;type&quot;: &quot;ai&quot;,
            &quot;id&quot;: &quot;run--b6dab10c-0486-4502-a2ab-bc834a170b0a-0&quot;,
            &quot;usage_metadata&quot;: &#123;
              &quot;input_tokens&quot;: 25,
              &quot;output_tokens&quot;: 27,
              &quot;total_tokens&quot;: 52,
              &quot;input_token_details&quot;: &#123;&#125;,
              &quot;output_token_details&quot;: &#123;&#125;
            &#125;,
            &quot;tool_calls&quot;: [],
            &quot;invalid_tool_calls&quot;: []
          &#125;
        &#125;
      &#125;
    ]
  ],
  &quot;llm_output&quot;: &#123;
    &quot;token_usage&quot;: &#123;
      &quot;completion_tokens&quot;: 27,
      &quot;prompt_tokens&quot;: 25,
      &quot;total_tokens&quot;: 52,
      &quot;completion_tokens_details&quot;: null,
      &quot;prompt_tokens_details&quot;: null
    &#125;,
    &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
    &quot;system_fingerprint&quot;: &quot;&quot;,
    &quot;id&quot;: &quot;019b2a538c9b28ea4527841d147dd390&quot;,
    &quot;service_tier&quot;: null
  &#125;,
  &quot;run&quot;: null,
  &quot;type&quot;: &quot;LLMResult&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence] [542ms] Exiting Chain run with output:
[0m[outputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async] [543ms] Exiting Chain run with output:
[0m[outputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory] [546ms] Exiting Chain run with output:
[0m[outputs]
[HumanMessage(content=&#39;æœè¾ç™½å¸å½©äº‘é—´ï¼Œ&#39;, additional_kwargs=&#123;&#125;, response_metadata=&#123;&#125;), AIMessage(content=&#39;æœè¾ç™½å¸å½©äº‘é—´ï¼Œåƒé‡Œæ±Ÿé™µä¸€æ—¥è¿˜ã€‚è¿™æ˜¯æç™½çš„ã€Šæ—©å‘ç™½å¸åŸã€‹ä¸­çš„è¯—å¥ã€‚&#39;, additional_kwargs=&#123;&#39;refusal&#39;: None&#125;, response_metadata=&#123;&#39;token_usage&#39;: &#123;&#39;completion_tokens&#39;: 27, &#39;prompt_tokens&#39;: 27, &#39;total_tokens&#39;: 54, &#39;completion_tokens_details&#39;: None, &#39;prompt_tokens_details&#39;: None&#125;, &#39;model_name&#39;: &#39;Qwen/Qwen2.5-7B-Instruct&#39;, &#39;system_fingerprint&#39;: &#39;&#39;, &#39;id&#39;: &#39;019b2a538a46c3031a12ce1103a9562e&#39;, &#39;service_tier&#39;: None, &#39;finish_reason&#39;: &#39;stop&#39;, &#39;logprobs&#39;: None&#125;, id=&#39;run--4deecc10-d2fc-40dc-b865-df5a7871faf1-0&#39;, usage_metadata=&#123;&#39;input_tokens&#39;: 27, &#39;output_tokens&#39;: 27, &#39;total_tokens&#39;: 54, &#39;input_token_details&#39;: &#123;&#125;, &#39;output_token_details&#39;: &#123;&#125;&#125;), HumanMessage(content=&#39;ä¸¤å²¸çŒ¿å£°å•¼ä¸ä½ï¼Œ&#39;, additional_kwargs=&#123;&#125;, response_metadata=&#123;&#125;), AIMessage(content=&#39;ä¸¤å²¸çŒ¿å£°å•¼ä¸ä½ï¼Œè½»èˆŸå·²è¿‡ä¸‡é‡å±±ã€‚è¿™æ˜¯æç™½çš„ã€Šæ—©å‘ç™½å¸åŸã€‹ä¸­çš„è¯—å¥ã€‚&#39;, additional_kwargs=&#123;&#39;refusal&#39;: None&#125;, response_metadata=&#123;&#39;token_usage&#39;: &#123;&#39;completion_tokens&#39;: 27, &#39;prompt_tokens&#39;: 25, &#39;total_tokens&#39;: 52, &#39;completion_tokens_details&#39;: None, &#39;prompt_tokens_details&#39;: None&#125;, &#39;model_name&#39;: &#39;Qwen/Qwen2.5-7B-Instruct&#39;, &#39;system_fingerprint&#39;: &#39;&#39;, &#39;id&#39;: &#39;019b2a538c9b28ea4527841d147dd390&#39;, &#39;service_tier&#39;: None, &#39;finish_reason&#39;: &#39;stop&#39;, &#39;logprobs&#39;: None&#125;, id=&#39;run--b6dab10c-0486-4502-a2ab-bc834a170b0a-0&#39;, usage_metadata=&#123;&#39;input_tokens&#39;: 25, &#39;output_tokens&#39;: 27, &#39;total_tokens&#39;: 52, &#39;input_token_details&#39;: &#123;&#125;, &#39;output_token_details&#39;: &#123;&#125;&#125;)]
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;è¿™é¦–è¯—çš„ä½œè€…æ˜¯è°ï¼Ÿ&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;è¿™é¦–è¯—çš„ä½œè€…æ˜¯è°ï¼Ÿ&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt;] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;è¿™é¦–è¯—çš„ä½œè€…æ˜¯è°ï¼Ÿ&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:load_history] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;è¿™é¦–è¯—çš„ä½œè€…æ˜¯è°ï¼Ÿ&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:load_history] [1ms] Exiting Chain run with output:
[0m[outputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history &gt; chain:RunnableParallel&lt;history&gt;] [2ms] Exiting Chain run with output:
[0m[outputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:insert_history] [3ms] Exiting Chain run with output:
[0m[outputs]
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async] Entering Chain run with input:
[0m[inputs]
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence] Entering Chain run with input:
[0m[inputs]
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt;] Entering Chain run with input:
[0m[inputs]
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt; &gt; chain:RunnableParallel&lt;history&gt;] Entering Chain run with input:
[0m[inputs]
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt; &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:RunnableSequence] Entering Chain run with input:
[0m[inputs]
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt; &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:RunnableSequence &gt; chain:RunnableLambda] Entering Chain run with input:
[0m[inputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt; &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:RunnableSequence &gt; chain:RunnableLambda] [1ms] Exiting Chain run with output:
[0m[outputs]
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt; &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:RunnableSequence &gt; chain:trim_messages] Entering Chain run with input:
[0m[inputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt; &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:RunnableSequence &gt; chain:trim_messages] [1ms] Exiting Chain run with output:
[0m&#123;
  &quot;output&quot;: []
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt; &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:RunnableSequence] [3ms] Exiting Chain run with output:
[0m&#123;
  &quot;output&quot;: []
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt; &gt; chain:RunnableParallel&lt;history&gt;] [5ms] Exiting Chain run with output:
[0m&#123;
  &quot;history&quot;: []
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt;] [6ms] Exiting Chain run with output:
[0m&#123;
  &quot;input&quot;: &quot;è¿™é¦–è¯—çš„ä½œè€…æ˜¯è°ï¼Ÿ&quot;,
  &quot;history&quot;: []
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] Entering Prompt run with input:
[0m&#123;
  &quot;input&quot;: &quot;è¿™é¦–è¯—çš„ä½œè€…æ˜¯è°ï¼Ÿ&quot;,
  &quot;history&quot;: []
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] [1ms] Exiting Prompt run with output:
[0m[outputs]
[32;1m[1;3m[llm/start][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] Entering LLM run with input:
[0m&#123;
  &quot;prompts&quot;: [
    &quot;System: ä½ æ˜¯ä¸€ä¸ªèƒŒè¯—åŠ©æ‰‹ã€‚\nHuman: è¿™é¦–è¯—çš„ä½œè€…æ˜¯è°ï¼Ÿ&quot;
  ]
&#125;
[36;1m[1;3m[llm/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] [671ms] Exiting LLM run with output:
[0m&#123;
  &quot;generations&quot;: [
    [
      &#123;
        &quot;text&quot;: &quot;æ‚¨è¿˜æ²¡æœ‰æä¾›è¯—æ­Œçš„å†…å®¹æˆ–ä¿¡æ¯ï¼Œæˆ‘æ— æ³•ç›´æ¥åˆ¤æ–­è¿™é¦–è¯—çš„ä½œè€…ã€‚è¯·æä¾›æ›´å¤šçš„ç»†èŠ‚æˆ–è€…è¯—å¥å†…å®¹ï¼Œæˆ‘ä¼šå°½åŠ›å¸®åŠ©æ‚¨ã€‚&quot;,
        &quot;generation_info&quot;: &#123;
          &quot;finish_reason&quot;: &quot;stop&quot;,
          &quot;logprobs&quot;: null
        &#125;,
        &quot;type&quot;: &quot;ChatGeneration&quot;,
        &quot;message&quot;: &#123;
          &quot;lc&quot;: 1,
          &quot;type&quot;: &quot;constructor&quot;,
          &quot;id&quot;: [
            &quot;langchain&quot;,
            &quot;schema&quot;,
            &quot;messages&quot;,
            &quot;AIMessage&quot;
          ],
          &quot;kwargs&quot;: &#123;
            &quot;content&quot;: &quot;æ‚¨è¿˜æ²¡æœ‰æä¾›è¯—æ­Œçš„å†…å®¹æˆ–ä¿¡æ¯ï¼Œæˆ‘æ— æ³•ç›´æ¥åˆ¤æ–­è¿™é¦–è¯—çš„ä½œè€…ã€‚è¯·æä¾›æ›´å¤šçš„ç»†èŠ‚æˆ–è€…è¯—å¥å†…å®¹ï¼Œæˆ‘ä¼šå°½åŠ›å¸®åŠ©æ‚¨ã€‚&quot;,
            &quot;additional_kwargs&quot;: &#123;
              &quot;refusal&quot;: null
            &#125;,
            &quot;response_metadata&quot;: &#123;
              &quot;token_usage&quot;: &#123;
                &quot;completion_tokens&quot;: 30,
                &quot;prompt_tokens&quot;: 25,
                &quot;total_tokens&quot;: 55,
                &quot;completion_tokens_details&quot;: null,
                &quot;prompt_tokens_details&quot;: null
              &#125;,
              &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
              &quot;system_fingerprint&quot;: &quot;&quot;,
              &quot;id&quot;: &quot;019b2a538f0f3a3432da1906b59283df&quot;,
              &quot;service_tier&quot;: null,
              &quot;finish_reason&quot;: &quot;stop&quot;,
              &quot;logprobs&quot;: null
            &#125;,
            &quot;type&quot;: &quot;ai&quot;,
            &quot;id&quot;: &quot;run--1210c63a-e6c3-40d5-8c38-8214b45499c0-0&quot;,
            &quot;usage_metadata&quot;: &#123;
              &quot;input_tokens&quot;: 25,
              &quot;output_tokens&quot;: 30,
              &quot;total_tokens&quot;: 55,
              &quot;input_token_details&quot;: &#123;&#125;,
              &quot;output_token_details&quot;: &#123;&#125;
            &#125;,
            &quot;tool_calls&quot;: [],
            &quot;invalid_tool_calls&quot;: []
          &#125;
        &#125;
      &#125;
    ]
  ],
  &quot;llm_output&quot;: &#123;
    &quot;token_usage&quot;: &#123;
      &quot;completion_tokens&quot;: 30,
      &quot;prompt_tokens&quot;: 25,
      &quot;total_tokens&quot;: 55,
      &quot;completion_tokens_details&quot;: null,
      &quot;prompt_tokens_details&quot;: null
    &#125;,
    &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
    &quot;system_fingerprint&quot;: &quot;&quot;,
    &quot;id&quot;: &quot;019b2a538f0f3a3432da1906b59283df&quot;,
    &quot;service_tier&quot;: null
  &#125;,
  &quot;run&quot;: null,
  &quot;type&quot;: &quot;LLMResult&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async &gt; chain:RunnableSequence] [680ms] Exiting Chain run with output:
[0m[outputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory &gt; chain:check_sync_or_async] [681ms] Exiting Chain run with output:
[0m[outputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableWithMessageHistory] [685ms] Exiting Chain run with output:
[0m[outputs]
æ‚¨è¿˜æ²¡æœ‰æä¾›è¯—æ­Œçš„å†…å®¹æˆ–ä¿¡æ¯ï¼Œæˆ‘æ— æ³•ç›´æ¥åˆ¤æ–­è¿™é¦–è¯—çš„ä½œè€…ã€‚è¯·æä¾›æ›´å¤šçš„ç»†èŠ‚æˆ–è€…è¯—å¥å†…å®¹ï¼Œæˆ‘ä¼šå°½åŠ›å¸®åŠ©æ‚¨ã€‚
</code></pre>
<p>store (ä½ çš„æ•°æ®åº“&#x2F;æ—¥è®°æœ¬)ï¼šè¿™é‡Œæ°¸è¿œè®°å½•æ‰€æœ‰çš„å¯¹è¯ï¼Œä¸ç®¡å¤šé•¿ã€‚å®ƒè´Ÿè´£â€œè®°ä¸‹æ¥å‘ç”Ÿè¿‡ä»€ä¹ˆâ€ã€‚å­˜å‚¨ï¼š å“ªæ€•ä½ è®¾ç½®äº† max_tokens&#x3D;10ï¼ˆåªèƒ½è®°10ä¸ªå­—ï¼‰ï¼ŒLangChain ä¾ç„¶ä¼šæŠŠå®Œæ•´çš„å¯¹è¯å­˜è¿› store é‡Œã€‚å› ä¸ºå®ƒæ€•ä½ ä»¥åæƒ³æŸ¥é˜…è®°å½•ã€‚<br>[HumanMessage(content&#x3D;â€™æœè¾ç™½å¸å½©äº‘é—´ï¼Œâ€™, additional_kwargs&#x3D;{}, response_metadata&#x3D;{}), AIMessage(content&#x3D;â€™æœè¾ç™½å¸å½©äº‘é—´ï¼Œåƒé‡Œæ±Ÿé™µä¸€æ—¥è¿˜ã€‚ä¸¤å²¸çŒ¿å£°å•¼ä¸ä½ï¼Œè½»èˆŸå·²è¿‡ä¸‡é‡å±±ã€‚è¿™æ˜¯å”ä»£è¯—äººæç™½çš„ã€Šæ—©å‘ç™½å¸åŸã€‹ã€‚â€™, additional_kwargs&#x3D;{â€˜refusalâ€™: None}, response_metadata&#x3D;{â€˜token_usageâ€™: {â€˜completion_tokensâ€™: 41, â€˜prompt_tokensâ€™: 27, â€˜total_tokensâ€™: 68, â€˜completion_tokens_detailsâ€™: None, â€˜prompt_tokens_detailsâ€™: None}, â€˜model_nameâ€™: â€˜Qwen&#x2F;Qwen2.5-7B-Instructâ€™, â€˜system_fingerprintâ€™: â€˜â€™, â€˜idâ€™: â€˜019b2a502a03a4c6dafffa84862a7c79â€™, â€˜service_tierâ€™: None, â€˜finish_reasonâ€™: â€˜stopâ€™, â€˜logprobsâ€™: None}, id&#x3D;â€™runâ€“669eaf62-14e2-4644-8c0b-ceb08533b80e-0â€™, usage_metadata&#x3D;{â€˜input_tokensâ€™: 27, â€˜output_tokensâ€™: 41, â€˜total_tokensâ€™: 68, â€˜input_token_detailsâ€™: {}, â€˜output_token_detailsâ€™: {}}), HumanMessage(content&#x3D;â€™ä¸¤å²¸çŒ¿å£°å•¼ä¸ä½ï¼Œâ€™, additional_kwargs&#x3D;{}, response_metadata&#x3D;{}), AIMessage(content&#x3D;â€™ä¸¤å²¸çŒ¿å£°å•¼ä¸ä½ï¼Œè½»èˆŸå·²è¿‡ä¸‡é‡å±±ã€‚è¿™æ˜¯æç™½çš„ã€Šæ—©å‘ç™½å¸åŸã€‹ä¸­çš„è¯—å¥ã€‚â€™, additional_kwargs&#x3D;{â€˜refusalâ€™: None}, response_metadata&#x3D;{â€˜token_usageâ€™: {â€˜completion_tokensâ€™: 27, â€˜prompt_tokensâ€™: 25, â€˜total_tokensâ€™: 52, â€˜completion_tokens_detailsâ€™: None, â€˜prompt_tokens_detailsâ€™: None}, â€˜model_nameâ€™: â€˜Qwen&#x2F;Qwen2.5-7B-Instructâ€™, â€˜system_fingerprintâ€™: â€˜â€™, â€˜idâ€™: â€˜019b2a502ccdd81bcf23d38eff1e16f8â€™, â€˜service_tierâ€™: None, â€˜finish_reasonâ€™: â€˜stopâ€™, â€˜logprobsâ€™: None}, id&#x3D;â€™runâ€“5cda2e65-575b-482b-87ee-b109f293c365-0â€™, usage_metadata&#x3D;{â€˜input_tokensâ€™: 25, â€˜output_tokensâ€™: 27, â€˜total_tokensâ€™: 52, â€˜input_token_detailsâ€™: {}, â€˜output_token_detailsâ€™: {}})]<br>ä½†æ˜¯Trimmer (ä½ çš„å‰ªåˆ€&#x2F;çŸ­æœŸè®°å¿†)ï¼šå®ƒåªåœ¨æŠŠè¯ä¼ ç»™ AI ä¹‹å‰çš„é‚£ä¸€ç¬é—´èµ·ä½œç”¨ã€‚<br>åœ¨ç¬¬äºŒè½®å¯¹è¯æ—¶ï¼Œtrimmer æ‹¿ç€å‰ªåˆ€ä»‹å…¥äº†ã€‚<br>å®ƒå‘ç°å†å²è®°å½•å¤ªé•¿ï¼ˆè¶…è¿‡10ä¸ªå­—ï¼‰ï¼Œäºæ˜¯å’”åš“ä¸€ä¸‹ï¼ŒæŠŠç¬¬ä¸€è½®å¯¹è¯ï¼ˆâ€œæœè¾ç™½å¸â€¦â€é‚£ä¸¤å¥ï¼‰ç»™å‰ªæ‰äº†ã€‚<br>çœŸæ­£å‘ç»™å¤§æ¨¡å‹ï¼ˆLLMï¼‰çš„ï¼Œåªæœ‰æœ€åé‚£å¥â€œä¸¤å²¸çŒ¿å£°å•¼ä¸ä½ï¼Œâ€ã€‚<br>å¦‚æœ Trimmer ç”Ÿæ•ˆï¼ˆå‰ªå¾—åªå‰©â€œè¿™é¦–è¯—çš„ä½œè€…æ˜¯è°ï¼Ÿâ€ï¼‰ï¼ŒAI ä¼šä¸€è„¸æ‡µé€¼é—®ä½ ï¼šâ€œè¯·é—®æ‚¨æŒ‡çš„æ˜¯å“ªé¦–è¯—ï¼Ÿâ€ã€‚ å¦‚æœ Trimmer æ²¡ç”Ÿæ•ˆï¼ˆè®°ä½äº†å†å²ï¼‰ï¼ŒAI ä¼šå›ç­”ï¼šâ€œæ˜¯æç™½ã€‚â€</p>
<h4 id="å››ã€å¯¹è¯æ‘˜è¦ç¼“å­˜å‚¨å­˜"><a href="#å››ã€å¯¹è¯æ‘˜è¦ç¼“å­˜å‚¨å­˜" class="headerlink" title="å››ã€å¯¹è¯æ‘˜è¦ç¼“å­˜å‚¨å­˜"></a>å››ã€å¯¹è¯æ‘˜è¦ç¼“å­˜å‚¨å­˜</h4><p>å¯¹è¯æ‘˜è¦ç¼“å­˜å‚¨å­˜ï¼Œä½¿ç”¨ LLM å¯¹åˆ°ç›®å‰ä¸ºæ­¢å†å²å¯¹è¯è‡ªåŠ¨æ€»ç»“æ‘˜è¦ï¼Œå¹¶å°†å…¶ä¿å­˜ä¸‹æ¥ã€‚</p>
<p>4.1 ä½¿ç”¨å¯¹è¯æ‘˜è¦ç¼“å­˜å‚¨å­˜</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;tool&#x27;</span> <span class="hljs-keyword">in</span> sys.modules:<br>    <span class="hljs-keyword">del</span> sys.modules[<span class="hljs-string">&#x27;tool&#x27;</span>]<br><span class="hljs-comment"># if &#x27;utils_zh&#x27; in sys.modules:</span><br><span class="hljs-comment">#     del sys.modules[&#x27;utils_zh&#x27;]</span><br><span class="hljs-comment"># é‡æ–°å¯¼å…¥æ¨¡å—</span><br>sys.path.append(<span class="hljs-string">&#x27;/home/py/shared/StudyChatgpt&#x27;</span>)<br><span class="hljs-keyword">from</span> tool <span class="hljs-keyword">import</span> get_chat_model2<br><span class="hljs-comment"># åˆå§‹åŒ–å¤§æ¨¡å‹å¯¹è±¡ï¼ˆè¿™åªæ˜¯ä¸€ä¸ªæ‰§è¡Œè€…ï¼Œå®ƒè‡ªå·±ä¸è®°äº‹ï¼‰</span><br>llm = get_chat_model2(temperature=<span class="hljs-number">0.0</span>)<br><br><span class="hljs-keyword">from</span> langchain.memory <span class="hljs-keyword">import</span> ConversationSummaryBufferMemory<br><span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate, MessagesPlaceholder<br><span class="hljs-keyword">from</span> langchain_core.runnables <span class="hljs-keyword">import</span> RunnablePassthrough, RunnableLambda<br><span class="hljs-keyword">from</span> langchain_core.output_parsers <span class="hljs-keyword">import</span> StrOutputParser<br><br><br><span class="hljs-comment"># 2. å‡†å¤‡æ•°æ®</span><br>schedule = <span class="hljs-string">&quot;åœ¨å…«ç‚¹ä½ å’Œä½ çš„äº§å“å›¢é˜Ÿæœ‰ä¸€ä¸ªä¼šè®®ã€‚ \</span><br><span class="hljs-string">ä½ éœ€è¦åšä¸€ä¸ªPPTã€‚ \</span><br><span class="hljs-string">ä¸Šåˆ9ç‚¹åˆ°12ç‚¹ä½ éœ€è¦å¿™äºLangChainã€‚\</span><br><span class="hljs-string">Langchainæ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å·¥å…·ï¼Œå› æ­¤ä½ çš„é¡¹ç›®è¿›å±•çš„éå¸¸å¿«ã€‚\</span><br><span class="hljs-string">ä¸­åˆï¼Œåœ¨æ„å¤§åˆ©é¤å…ä¸ä¸€ä½å¼€è½¦æ¥çš„é¡¾å®¢å…±è¿›åˆé¤ \</span><br><span class="hljs-string">èµ°äº†ä¸€ä¸ªå¤šå°æ—¶çš„è·¯ç¨‹ä¸ä½ è§é¢ï¼Œåªä¸ºäº†è§£æœ€æ–°çš„ AIã€‚ \</span><br><span class="hljs-string">ç¡®ä¿ä½ å¸¦äº†ç¬”è®°æœ¬ç”µè„‘å¯ä»¥å±•ç¤ºæœ€æ–°çš„ LLM æ ·ä¾‹.&quot;</span><br><br><span class="hljs-comment"># 3. åˆå§‹åŒ–è®°å¿† (è¿™é‡Œæœ‰ä¸€ä¸ªå…³é”®ä¿®æ”¹ï¼šreturn_messages=True)</span><br><span class="hljs-comment"># ä¸ºäº†é…åˆ ChatModel (å¯¹è¯æ¨¡å‹)ï¼Œæˆ‘ä»¬éœ€è¦ memory è¿”å›æ¶ˆæ¯å¯¹è±¡åˆ—è¡¨ï¼Œè€Œä¸æ˜¯çº¯å­—ç¬¦ä¸²</span><br>memory = ConversationSummaryBufferMemory(<br>    llm=llm, <br>    max_token_limit=<span class="hljs-number">100</span>, <br>    return_messages=<span class="hljs-literal">True</span> <br>)<br><br><span class="hljs-comment"># é¢„å­˜ä¸Šä¸‹æ–‡</span><br>memory.save_context(&#123;<span class="hljs-string">&quot;input&quot;</span>: <span class="hljs-string">&quot;ä½ å¥½ï¼Œæˆ‘å«çš®çš®é²&quot;</span>&#125;, &#123;<span class="hljs-string">&quot;output&quot;</span>: <span class="hljs-string">&quot;ä½ å¥½å•Šï¼Œæˆ‘å«é²è¥¿è¥¿&quot;</span>&#125;)<br>memory.save_context(&#123;<span class="hljs-string">&quot;input&quot;</span>: <span class="hljs-string">&quot;å¾ˆé«˜å…´å’Œä½ æˆä¸ºæœ‹å‹ï¼&quot;</span>&#125;, &#123;<span class="hljs-string">&quot;output&quot;</span>: <span class="hljs-string">&quot;æ˜¯çš„ï¼Œè®©æˆ‘ä»¬ä¸€èµ·å»å†’é™©å§ï¼&quot;</span>&#125;)<br>memory.save_context(&#123;<span class="hljs-string">&quot;input&quot;</span>: <span class="hljs-string">&quot;ä»Šå¤©çš„æ—¥ç¨‹å®‰æ’æ˜¯ä»€ä¹ˆï¼Ÿ&quot;</span>&#125;, &#123;<span class="hljs-string">&quot;output&quot;</span>: <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;schedule&#125;</span>&quot;</span>&#125;)<br><br><span class="hljs-comment"># æŸ¥çœ‹å½“å‰è®°å¿†çŠ¶æ€ (ä½ å¯ä»¥çœ‹åˆ°æ‘˜è¦æœºåˆ¶å·²ç»è§¦å‘äº†)</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;--- å½“å‰è®°å¿†çŠ¶æ€ ---&quot;</span>)<br><span class="hljs-built_in">print</span>(memory.load_memory_variables(&#123;&#125;)[<span class="hljs-string">&#x27;history&#x27;</span>])<br><br><span class="hljs-comment"># ==========================================</span><br><span class="hljs-comment"># 4. æ„å»º LCEL é“¾ (æ›¿ä»£ ConversationChain)</span><br><span class="hljs-comment"># ==========================================</span><br><br><span class="hljs-comment"># 4.1 å®šä¹‰ Prompt</span><br>prompt = ChatPromptTemplate.from_messages([<br>    (<span class="hljs-string">&quot;system&quot;</span>, <span class="hljs-string">&quot;ä½ æ˜¯ä¸€ä¸ªå‹å¥½çš„AIåŠ©æ‰‹ã€‚&quot;</span>),<br>    <span class="hljs-comment"># MessagesPlaceholder ç”¨æ¥æ¥æ”¶ memory ä¸­çš„å†å²è®°å½•</span><br>    <span class="hljs-comment"># è¿™é‡Œçš„ history åŒ…å«ï¼š[SystemMessage(æ‘˜è¦), HumanMessage, AIMessage...]</span><br>    MessagesPlaceholder(variable_name=<span class="hljs-string">&quot;history&quot;</span>),<br>    (<span class="hljs-string">&quot;human&quot;</span>, <span class="hljs-string">&quot;&#123;input&#125;&quot;</span>)<br>])<br><br><span class="hljs-comment"># 4.2 å®šä¹‰ Chain</span><br><span class="hljs-comment"># ä½¿ç”¨ RunnablePassthrough.assign åŠ¨æ€åœ°ä» memory ä¸­è¯»å– history</span><br>chain = (<br>    RunnablePassthrough.assign(<br>        history=RunnableLambda(<span class="hljs-keyword">lambda</span> x: memory.load_memory_variables(&#123;&#125;)[<span class="hljs-string">&quot;history&quot;</span>])<br>    )<br>    | prompt<br>    | llm<br>    | StrOutputParser()  <span class="hljs-comment"># ä¼šæŠŠè¿™ä¸ªå¯¹è±¡çš„å¤–å£³å‰¥æ‰ï¼Œåªå–å‡º content é‡Œé¢çš„å†…å®¹ï¼ˆçº¯æ–‡æœ¬å­—ç¬¦ä¸²ï¼‰ã€‚</span><br>)<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">[32;1m[1;3m[chain/start][0m [1m[chain:LLMChain] Entering Chain run with input:
[0m&#123;
  &quot;summary&quot;: &quot;&quot;,
  &quot;new_lines&quot;: &quot;Human: ä½ å¥½ï¼Œæˆ‘å«çš®çš®é²\nAI: ä½ å¥½å•Šï¼Œæˆ‘å«é²è¥¿è¥¿\nHuman: å¾ˆé«˜å…´å’Œä½ æˆä¸ºæœ‹å‹ï¼\nAI: æ˜¯çš„ï¼Œè®©æˆ‘ä»¬ä¸€èµ·å»å†’é™©å§ï¼\nHuman: ä»Šå¤©çš„æ—¥ç¨‹å®‰æ’æ˜¯ä»€ä¹ˆï¼Ÿ\nAI: åœ¨å…«ç‚¹ä½ å’Œä½ çš„äº§å“å›¢é˜Ÿæœ‰ä¸€ä¸ªä¼šè®®ã€‚ ä½ éœ€è¦åšä¸€ä¸ªPPTã€‚ ä¸Šåˆ9ç‚¹åˆ°12ç‚¹ä½ éœ€è¦å¿™äºLangChainã€‚Langchainæ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å·¥å…·ï¼Œå› æ­¤ä½ çš„é¡¹ç›®è¿›å±•çš„éå¸¸å¿«ã€‚ä¸­åˆï¼Œåœ¨æ„å¤§åˆ©é¤å…ä¸ä¸€ä½å¼€è½¦æ¥çš„é¡¾å®¢å…±è¿›åˆé¤ èµ°äº†ä¸€ä¸ªå¤šå°æ—¶çš„è·¯ç¨‹ä¸ä½ è§é¢ï¼Œåªä¸ºäº†è§£æœ€æ–°çš„ AIã€‚ ç¡®ä¿ä½ å¸¦äº†ç¬”è®°æœ¬ç”µè„‘å¯ä»¥å±•ç¤ºæœ€æ–°çš„ LLM æ ·ä¾‹.&quot;
&#125;
[32;1m[1;3m[llm/start][0m [1m[chain:LLMChain &gt; llm:ChatOpenAI] Entering LLM run with input:
[0m&#123;
  &quot;prompts&quot;: [
    &quot;Human: Progressively summarize the lines of conversation provided, adding onto the previous summary returning a new summary.\n\nEXAMPLE\nCurrent summary:\nThe human asks what the AI thinks of artificial intelligence. The AI thinks artificial intelligence is a force for good.\n\nNew lines of conversation:\nHuman: Why do you think artificial intelligence is a force for good?\nAI: Because artificial intelligence will help humans reach their full potential.\n\nNew summary:\nThe human asks what the AI thinks of artificial intelligence. The AI thinks artificial intelligence is a force for good because it will help humans reach their full potential.\nEND OF EXAMPLE\n\nCurrent summary:\n\n\nNew lines of conversation:\nHuman: ä½ å¥½ï¼Œæˆ‘å«çš®çš®é²\nAI: ä½ å¥½å•Šï¼Œæˆ‘å«é²è¥¿è¥¿\nHuman: å¾ˆé«˜å…´å’Œä½ æˆä¸ºæœ‹å‹ï¼\nAI: æ˜¯çš„ï¼Œè®©æˆ‘ä»¬ä¸€èµ·å»å†’é™©å§ï¼\nHuman: ä»Šå¤©çš„æ—¥ç¨‹å®‰æ’æ˜¯ä»€ä¹ˆï¼Ÿ\nAI: åœ¨å…«ç‚¹ä½ å’Œä½ çš„äº§å“å›¢é˜Ÿæœ‰ä¸€ä¸ªä¼šè®®ã€‚ ä½ éœ€è¦åšä¸€ä¸ªPPTã€‚ ä¸Šåˆ9ç‚¹åˆ°12ç‚¹ä½ éœ€è¦å¿™äºLangChainã€‚Langchainæ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å·¥å…·ï¼Œå› æ­¤ä½ çš„é¡¹ç›®è¿›å±•çš„éå¸¸å¿«ã€‚ä¸­åˆï¼Œåœ¨æ„å¤§åˆ©é¤å…ä¸ä¸€ä½å¼€è½¦æ¥çš„é¡¾å®¢å…±è¿›åˆé¤ èµ°äº†ä¸€ä¸ªå¤šå°æ—¶çš„è·¯ç¨‹ä¸ä½ è§é¢ï¼Œåªä¸ºäº†è§£æœ€æ–°çš„ AIã€‚ ç¡®ä¿ä½ å¸¦äº†ç¬”è®°æœ¬ç”µè„‘å¯ä»¥å±•ç¤ºæœ€æ–°çš„ LLM æ ·ä¾‹.\n\nNew summary:&quot;
  ]
&#125;
[36;1m[1;3m[llm/end][0m [1m[chain:LLMChain &gt; llm:ChatOpenAI] [1.25s] Exiting LLM run with output:
[0m&#123;
  &quot;generations&quot;: [
    [
      &#123;
        &quot;text&quot;: &quot;ä½ å¥½ï¼Œçš®çš®é²å’Œé²è¥¿è¥¿äº’è‡´é—®å€™å¹¶å†³å®šä¸€èµ·å»å†’é™©ã€‚ä»Šå¤©çš„æ—¥ç¨‹å®‰æ’åŒ…æ‹¬ä¸Šåˆ8ç‚¹ä¸äº§å“å›¢é˜Ÿçš„ä¼šè®®ï¼Œéœ€è¦å‡†å¤‡PPTï¼›ä¸Šåˆ9ç‚¹åˆ°12ç‚¹ä¸“æ³¨äºLangChainé¡¹ç›®ï¼Œå› ä¸ºLangChainæ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å·¥å…·ï¼Œä½¿å¾—é¡¹ç›®è¿›å±•è¿…é€Ÿï¼›ä¸­åˆåœ¨æ„å¤§åˆ©é¤å…ä¸ä¸€ä½å¼€è½¦æ¥çš„é¡¾å®¢ä¼šé¢ï¼Œé¡¾å®¢èµ°äº†ä¸€ä¸ªå¤šå°æ—¶çš„è·¯ç¨‹åªä¸ºäº†è§£æœ€æ–°çš„AIæŠ€æœ¯ï¼Œå¹¶ä¸”éœ€è¦å¸¦ä¸Šç¬”è®°æœ¬ç”µè„‘å±•ç¤ºæœ€æ–°çš„LLMæ ·ä¾‹ã€‚&quot;,
        &quot;generation_info&quot;: &#123;
          &quot;finish_reason&quot;: &quot;stop&quot;,
          &quot;logprobs&quot;: null
        &#125;,
        &quot;type&quot;: &quot;ChatGeneration&quot;,
        &quot;message&quot;: &#123;
          &quot;lc&quot;: 1,
          &quot;type&quot;: &quot;constructor&quot;,
          &quot;id&quot;: [
            &quot;langchain&quot;,
            &quot;schema&quot;,
            &quot;messages&quot;,
            &quot;AIMessage&quot;
          ],
          &quot;kwargs&quot;: &#123;
            &quot;content&quot;: &quot;ä½ å¥½ï¼Œçš®çš®é²å’Œé²è¥¿è¥¿äº’è‡´é—®å€™å¹¶å†³å®šä¸€èµ·å»å†’é™©ã€‚ä»Šå¤©çš„æ—¥ç¨‹å®‰æ’åŒ…æ‹¬ä¸Šåˆ8ç‚¹ä¸äº§å“å›¢é˜Ÿçš„ä¼šè®®ï¼Œéœ€è¦å‡†å¤‡PPTï¼›ä¸Šåˆ9ç‚¹åˆ°12ç‚¹ä¸“æ³¨äºLangChainé¡¹ç›®ï¼Œå› ä¸ºLangChainæ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å·¥å…·ï¼Œä½¿å¾—é¡¹ç›®è¿›å±•è¿…é€Ÿï¼›ä¸­åˆåœ¨æ„å¤§åˆ©é¤å…ä¸ä¸€ä½å¼€è½¦æ¥çš„é¡¾å®¢ä¼šé¢ï¼Œé¡¾å®¢èµ°äº†ä¸€ä¸ªå¤šå°æ—¶çš„è·¯ç¨‹åªä¸ºäº†è§£æœ€æ–°çš„AIæŠ€æœ¯ï¼Œå¹¶ä¸”éœ€è¦å¸¦ä¸Šç¬”è®°æœ¬ç”µè„‘å±•ç¤ºæœ€æ–°çš„LLMæ ·ä¾‹ã€‚&quot;,
            &quot;additional_kwargs&quot;: &#123;
              &quot;refusal&quot;: null
            &#125;,
            &quot;response_metadata&quot;: &#123;
              &quot;token_usage&quot;: &#123;
                &quot;completion_tokens&quot;: 96,
                &quot;prompt_tokens&quot;: 304,
                &quot;total_tokens&quot;: 400,
                &quot;completion_tokens_details&quot;: null,
                &quot;prompt_tokens_details&quot;: null
              &#125;,
              &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
              &quot;system_fingerprint&quot;: &quot;&quot;,
              &quot;id&quot;: &quot;019b2a6b1fb023986a2cdecee5227d66&quot;,
              &quot;service_tier&quot;: null,
              &quot;finish_reason&quot;: &quot;stop&quot;,
              &quot;logprobs&quot;: null
            &#125;,
            &quot;type&quot;: &quot;ai&quot;,
            &quot;id&quot;: &quot;run--a670c7eb-ca44-4d5b-a970-c6671137de14-0&quot;,
            &quot;usage_metadata&quot;: &#123;
              &quot;input_tokens&quot;: 304,
              &quot;output_tokens&quot;: 96,
              &quot;total_tokens&quot;: 400,
              &quot;input_token_details&quot;: &#123;&#125;,
              &quot;output_token_details&quot;: &#123;&#125;
            &#125;,
            &quot;tool_calls&quot;: [],
            &quot;invalid_tool_calls&quot;: []
          &#125;
        &#125;
      &#125;
    ]
  ],
  &quot;llm_output&quot;: &#123;
    &quot;token_usage&quot;: &#123;
      &quot;completion_tokens&quot;: 96,
      &quot;prompt_tokens&quot;: 304,
      &quot;total_tokens&quot;: 400,
      &quot;completion_tokens_details&quot;: null,
      &quot;prompt_tokens_details&quot;: null
    &#125;,
    &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
    &quot;system_fingerprint&quot;: &quot;&quot;,
    &quot;id&quot;: &quot;019b2a6b1fb023986a2cdecee5227d66&quot;,
    &quot;service_tier&quot;: null
  &#125;,
  &quot;run&quot;: null,
  &quot;type&quot;: &quot;LLMResult&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:LLMChain] [1.25s] Exiting Chain run with output:
[0m&#123;
  &quot;text&quot;: &quot;ä½ å¥½ï¼Œçš®çš®é²å’Œé²è¥¿è¥¿äº’è‡´é—®å€™å¹¶å†³å®šä¸€èµ·å»å†’é™©ã€‚ä»Šå¤©çš„æ—¥ç¨‹å®‰æ’åŒ…æ‹¬ä¸Šåˆ8ç‚¹ä¸äº§å“å›¢é˜Ÿçš„ä¼šè®®ï¼Œéœ€è¦å‡†å¤‡PPTï¼›ä¸Šåˆ9ç‚¹åˆ°12ç‚¹ä¸“æ³¨äºLangChainé¡¹ç›®ï¼Œå› ä¸ºLangChainæ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å·¥å…·ï¼Œä½¿å¾—é¡¹ç›®è¿›å±•è¿…é€Ÿï¼›ä¸­åˆåœ¨æ„å¤§åˆ©é¤å…ä¸ä¸€ä½å¼€è½¦æ¥çš„é¡¾å®¢ä¼šé¢ï¼Œé¡¾å®¢èµ°äº†ä¸€ä¸ªå¤šå°æ—¶çš„è·¯ç¨‹åªä¸ºäº†è§£æœ€æ–°çš„AIæŠ€æœ¯ï¼Œå¹¶ä¸”éœ€è¦å¸¦ä¸Šç¬”è®°æœ¬ç”µè„‘å±•ç¤ºæœ€æ–°çš„LLMæ ·ä¾‹ã€‚&quot;
&#125;
--- å½“å‰è®°å¿†çŠ¶æ€ ---
[SystemMessage(content=&#39;ä½ å¥½ï¼Œçš®çš®é²å’Œé²è¥¿è¥¿äº’è‡´é—®å€™å¹¶å†³å®šä¸€èµ·å»å†’é™©ã€‚ä»Šå¤©çš„æ—¥ç¨‹å®‰æ’åŒ…æ‹¬ä¸Šåˆ8ç‚¹ä¸äº§å“å›¢é˜Ÿçš„ä¼šè®®ï¼Œéœ€è¦å‡†å¤‡PPTï¼›ä¸Šåˆ9ç‚¹åˆ°12ç‚¹ä¸“æ³¨äºLangChainé¡¹ç›®ï¼Œå› ä¸ºLangChainæ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å·¥å…·ï¼Œä½¿å¾—é¡¹ç›®è¿›å±•è¿…é€Ÿï¼›ä¸­åˆåœ¨æ„å¤§åˆ©é¤å…ä¸ä¸€ä½å¼€è½¦æ¥çš„é¡¾å®¢ä¼šé¢ï¼Œé¡¾å®¢èµ°äº†ä¸€ä¸ªå¤šå°æ—¶çš„è·¯ç¨‹åªä¸ºäº†è§£æœ€æ–°çš„AIæŠ€æœ¯ï¼Œå¹¶ä¸”éœ€è¦å¸¦ä¸Šç¬”è®°æœ¬ç”µè„‘å±•ç¤ºæœ€æ–°çš„LLMæ ·ä¾‹ã€‚&#39;, additional_kwargs=&#123;&#125;, response_metadata=&#123;&#125;)]
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 5. æ‰§è¡Œå¯¹è¯</span><br>user_input = <span class="hljs-string">&quot;å±•ç¤ºä»€ä¹ˆæ ·çš„æ ·ä¾‹æœ€å¥½å‘¢ï¼Ÿ&quot;</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\nUser: <span class="hljs-subst">&#123;user_input&#125;</span>&quot;</span>)<br><br><span class="hljs-comment"># è°ƒç”¨é“¾</span><br>response = chain.invoke(&#123;<span class="hljs-string">&quot;input&quot;</span>: user_input&#125;)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;AI: <span class="hljs-subst">&#123;response&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure>


<pre><code class="hljs">User: å±•ç¤ºä»€ä¹ˆæ ·çš„æ ·ä¾‹æœ€å¥½å‘¢ï¼Ÿ
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;å±•ç¤ºä»€ä¹ˆæ ·çš„æ ·ä¾‹æœ€å¥½å‘¢ï¼Ÿ&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt;] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;å±•ç¤ºä»€ä¹ˆæ ·çš„æ ·ä¾‹æœ€å¥½å‘¢ï¼Ÿ&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt; &gt; chain:RunnableParallel&lt;history&gt;] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;å±•ç¤ºä»€ä¹ˆæ ·çš„æ ·ä¾‹æœ€å¥½å‘¢ï¼Ÿ&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt; &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:RunnableLambda] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;å±•ç¤ºä»€ä¹ˆæ ·çš„æ ·ä¾‹æœ€å¥½å‘¢ï¼Ÿ&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt; &gt; chain:RunnableParallel&lt;history&gt; &gt; chain:RunnableLambda] [1ms] Exiting Chain run with output:
[0m[outputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt; &gt; chain:RunnableParallel&lt;history&gt;] [2ms] Exiting Chain run with output:
[0m[outputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;history&gt;] [3ms] Exiting Chain run with output:
[0m[outputs]
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; prompt:ChatPromptTemplate] Entering Prompt run with input:
[0m[inputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; prompt:ChatPromptTemplate] [1ms] Exiting Prompt run with output:
[0m[outputs]
[32;1m[1;3m[llm/start][0m [1m[chain:RunnableSequence &gt; llm:ChatOpenAI] Entering LLM run with input:
[0m&#123;
  &quot;prompts&quot;: [
    &quot;System: ä½ æ˜¯ä¸€ä¸ªå‹å¥½çš„AIåŠ©æ‰‹ã€‚\nSystem: ä½ å¥½ï¼Œçš®çš®é²å’Œé²è¥¿è¥¿äº’è‡´é—®å€™å¹¶å†³å®šä¸€èµ·å»å†’é™©ã€‚ä»Šå¤©çš„æ—¥ç¨‹å®‰æ’åŒ…æ‹¬ä¸Šåˆ8ç‚¹ä¸äº§å“å›¢é˜Ÿçš„ä¼šè®®ï¼Œéœ€è¦å‡†å¤‡PPTï¼›ä¸Šåˆ9ç‚¹åˆ°12ç‚¹ä¸“æ³¨äºLangChainé¡¹ç›®ï¼Œå› ä¸ºLangChainæ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å·¥å…·ï¼Œä½¿å¾—é¡¹ç›®è¿›å±•è¿…é€Ÿï¼›ä¸­åˆåœ¨æ„å¤§åˆ©é¤å…ä¸ä¸€ä½å¼€è½¦æ¥çš„é¡¾å®¢ä¼šé¢ï¼Œé¡¾å®¢èµ°äº†ä¸€ä¸ªå¤šå°æ—¶çš„è·¯ç¨‹åªä¸ºäº†è§£æœ€æ–°çš„AIæŠ€æœ¯ï¼Œå¹¶ä¸”éœ€è¦å¸¦ä¸Šç¬”è®°æœ¬ç”µè„‘å±•ç¤ºæœ€æ–°çš„LLMæ ·ä¾‹ã€‚\nHuman: å±•ç¤ºä»€ä¹ˆæ ·çš„æ ·ä¾‹æœ€å¥½å‘¢ï¼Ÿ&quot;
  ]
&#125;
[36;1m[1;3m[llm/end][0m [1m[chain:RunnableSequence &gt; llm:ChatOpenAI] [10.02s] Exiting LLM run with output:
[0m&#123;
  &quot;generations&quot;: [
    [
      &#123;
        &quot;text&quot;: &quot;ä¸ºäº†ç»™é¡¾å®¢ç•™ä¸‹æ·±åˆ»å°è±¡å¹¶å±•ç¤ºæœ€æ–°çš„LLMæ ·ä¾‹ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸€äº›èƒ½å¤Ÿä½“ç°LangChainå’ŒLLMå¼ºå¤§åŠŸèƒ½å’Œæ½œåŠ›çš„ç¤ºä¾‹ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å»ºè®®ï¼š\n\n1. **å¯¹è¯ç”Ÿæˆ**ï¼šå±•ç¤ºä¸€ä¸ªåŸºäºLangChainçš„å¯¹è¯ç³»ç»Ÿï¼Œå®ƒå¯ä»¥ç”Ÿæˆè‡ªç„¶æµç•…çš„å¯¹è¯ï¼Œæ¨¡æ‹ŸçœŸå®çš„äººç±»å¯¹è¯ã€‚ä½ å¯ä»¥å±•ç¤ºä¸€äº›å¯¹è¯åœºæ™¯ï¼Œå¦‚å®¢æˆ·æœåŠ¡ã€è™šæ‹ŸåŠ©æ‰‹ç­‰ã€‚\n\n2. **çŸ¥è¯†å›¾è°±æ„å»º**ï¼šå±•ç¤ºå¦‚ä½•ä½¿ç”¨LangChainå’ŒLLMæ„å»ºä¸€ä¸ªçŸ¥è¯†å›¾è°±ï¼Œå±•ç¤ºå…¶å¦‚ä½•ä»å¤§é‡æ–‡æœ¬æ•°æ®ä¸­æå–å…³é”®ä¿¡æ¯ï¼Œå¹¶æ„å»ºå‡ºç»“æ„åŒ–çš„çŸ¥è¯†ç½‘ç»œã€‚\n\n3. **ä»£ç ç”Ÿæˆ**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿè‡ªåŠ¨ç”Ÿæˆä»£ç çš„ç¤ºä¾‹ï¼Œæ¯”å¦‚æ ¹æ®ç”¨æˆ·çš„éœ€æ±‚ç”ŸæˆPythonã€Javaæˆ–å…¶ä»–ç¼–ç¨‹è¯­è¨€çš„ä»£ç ã€‚è¿™å¯ä»¥å±•ç¤ºLLMçš„å¼ºå¤§ä»£ç ç”Ÿæˆèƒ½åŠ›ã€‚\n\n4. **å¤šè½®å¯¹è¯ç®¡ç†**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿå¤„ç†å¤šè½®å¯¹è¯çš„ç³»ç»Ÿï¼Œæ¯”å¦‚åœ¨å®¢æˆ·æœåŠ¡åœºæ™¯ä¸­ï¼Œèƒ½å¤Ÿç†è§£ç”¨æˆ·çš„éœ€æ±‚å¹¶é€æ­¥å¼•å¯¼ç”¨æˆ·å®Œæˆä»»åŠ¡ã€‚\n\n5. **æƒ…æ„Ÿåˆ†æ**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿè¿›è¡Œæƒ…æ„Ÿåˆ†æçš„ç¤ºä¾‹ï¼Œæ¯”å¦‚åˆ†æç¤¾äº¤åª’ä½“ä¸Šçš„è¯„è®ºï¼Œè¯†åˆ«å…¶ä¸­çš„æƒ…æ„Ÿå€¾å‘ï¼Œå¹¶ç»™å‡ºç›¸åº”çš„åé¦ˆã€‚\n\n6. **å†…å®¹ç”Ÿæˆ**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿç”Ÿæˆæ–‡ç« ã€æ•…äº‹ã€è¯—æ­Œç­‰å†…å®¹çš„ç¤ºä¾‹ï¼Œå±•ç¤ºå…¶åˆ›é€ åŠ›å’Œå¤šæ ·æ€§ã€‚\n\n7. **é—®ç­”ç³»ç»Ÿ**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿå›ç­”å¤æ‚é—®é¢˜çš„é—®ç­”ç³»ç»Ÿï¼Œæ¯”å¦‚åŸºäºç‰¹å®šé¢†åŸŸçš„çŸ¥è¯†åº“è¿›è¡Œé—®ç­”ï¼Œå±•ç¤ºå…¶åœ¨ç‰¹å®šé¢†åŸŸçš„æ·±åº¦ç†è§£å’Œæ¨ç†èƒ½åŠ›ã€‚\n\n8. **ä»£ç è§£é‡Šå’Œä¼˜åŒ–**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿè§£é‡Šä»£ç é€»è¾‘å’Œæä¾›ä¼˜åŒ–å»ºè®®çš„ç¤ºä¾‹ï¼Œå¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°ç†è§£å’Œä¼˜åŒ–ä»£ç ã€‚\n\né€‰æ‹©åˆé€‚çš„æ ·ä¾‹æ—¶ï¼Œå¯ä»¥æ ¹æ®é¡¾å®¢çš„å…·ä½“éœ€æ±‚å’Œå…´è¶£è¿›è¡Œè°ƒæ•´ã€‚ç¡®ä¿æ ·ä¾‹èƒ½å¤Ÿæ¸…æ™°åœ°å±•ç¤ºLangChainå’ŒLLMçš„ä¼˜åŠ¿ï¼Œå¹¶ä¸”æ˜“äºç†è§£ã€‚åŒæ—¶ï¼Œå‡†å¤‡å¥½è¯¦ç»†çš„è§£é‡Šå’ŒèƒŒæ™¯ä¿¡æ¯ï¼Œä»¥ä¾¿é¡¾å®¢èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£è¿™äº›æŠ€æœ¯çš„åº”ç”¨åœºæ™¯å’Œæ½œåŠ›ã€‚&quot;,
        &quot;generation_info&quot;: &#123;
          &quot;finish_reason&quot;: &quot;stop&quot;,
          &quot;logprobs&quot;: null
        &#125;,
        &quot;type&quot;: &quot;ChatGeneration&quot;,
        &quot;message&quot;: &#123;
          &quot;lc&quot;: 1,
          &quot;type&quot;: &quot;constructor&quot;,
          &quot;id&quot;: [
            &quot;langchain&quot;,
            &quot;schema&quot;,
            &quot;messages&quot;,
            &quot;AIMessage&quot;
          ],
          &quot;kwargs&quot;: &#123;
            &quot;content&quot;: &quot;ä¸ºäº†ç»™é¡¾å®¢ç•™ä¸‹æ·±åˆ»å°è±¡å¹¶å±•ç¤ºæœ€æ–°çš„LLMæ ·ä¾‹ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸€äº›èƒ½å¤Ÿä½“ç°LangChainå’ŒLLMå¼ºå¤§åŠŸèƒ½å’Œæ½œåŠ›çš„ç¤ºä¾‹ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å»ºè®®ï¼š\n\n1. **å¯¹è¯ç”Ÿæˆ**ï¼šå±•ç¤ºä¸€ä¸ªåŸºäºLangChainçš„å¯¹è¯ç³»ç»Ÿï¼Œå®ƒå¯ä»¥ç”Ÿæˆè‡ªç„¶æµç•…çš„å¯¹è¯ï¼Œæ¨¡æ‹ŸçœŸå®çš„äººç±»å¯¹è¯ã€‚ä½ å¯ä»¥å±•ç¤ºä¸€äº›å¯¹è¯åœºæ™¯ï¼Œå¦‚å®¢æˆ·æœåŠ¡ã€è™šæ‹ŸåŠ©æ‰‹ç­‰ã€‚\n\n2. **çŸ¥è¯†å›¾è°±æ„å»º**ï¼šå±•ç¤ºå¦‚ä½•ä½¿ç”¨LangChainå’ŒLLMæ„å»ºä¸€ä¸ªçŸ¥è¯†å›¾è°±ï¼Œå±•ç¤ºå…¶å¦‚ä½•ä»å¤§é‡æ–‡æœ¬æ•°æ®ä¸­æå–å…³é”®ä¿¡æ¯ï¼Œå¹¶æ„å»ºå‡ºç»“æ„åŒ–çš„çŸ¥è¯†ç½‘ç»œã€‚\n\n3. **ä»£ç ç”Ÿæˆ**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿè‡ªåŠ¨ç”Ÿæˆä»£ç çš„ç¤ºä¾‹ï¼Œæ¯”å¦‚æ ¹æ®ç”¨æˆ·çš„éœ€æ±‚ç”ŸæˆPythonã€Javaæˆ–å…¶ä»–ç¼–ç¨‹è¯­è¨€çš„ä»£ç ã€‚è¿™å¯ä»¥å±•ç¤ºLLMçš„å¼ºå¤§ä»£ç ç”Ÿæˆèƒ½åŠ›ã€‚\n\n4. **å¤šè½®å¯¹è¯ç®¡ç†**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿå¤„ç†å¤šè½®å¯¹è¯çš„ç³»ç»Ÿï¼Œæ¯”å¦‚åœ¨å®¢æˆ·æœåŠ¡åœºæ™¯ä¸­ï¼Œèƒ½å¤Ÿç†è§£ç”¨æˆ·çš„éœ€æ±‚å¹¶é€æ­¥å¼•å¯¼ç”¨æˆ·å®Œæˆä»»åŠ¡ã€‚\n\n5. **æƒ…æ„Ÿåˆ†æ**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿè¿›è¡Œæƒ…æ„Ÿåˆ†æçš„ç¤ºä¾‹ï¼Œæ¯”å¦‚åˆ†æç¤¾äº¤åª’ä½“ä¸Šçš„è¯„è®ºï¼Œè¯†åˆ«å…¶ä¸­çš„æƒ…æ„Ÿå€¾å‘ï¼Œå¹¶ç»™å‡ºç›¸åº”çš„åé¦ˆã€‚\n\n6. **å†…å®¹ç”Ÿæˆ**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿç”Ÿæˆæ–‡ç« ã€æ•…äº‹ã€è¯—æ­Œç­‰å†…å®¹çš„ç¤ºä¾‹ï¼Œå±•ç¤ºå…¶åˆ›é€ åŠ›å’Œå¤šæ ·æ€§ã€‚\n\n7. **é—®ç­”ç³»ç»Ÿ**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿå›ç­”å¤æ‚é—®é¢˜çš„é—®ç­”ç³»ç»Ÿï¼Œæ¯”å¦‚åŸºäºç‰¹å®šé¢†åŸŸçš„çŸ¥è¯†åº“è¿›è¡Œé—®ç­”ï¼Œå±•ç¤ºå…¶åœ¨ç‰¹å®šé¢†åŸŸçš„æ·±åº¦ç†è§£å’Œæ¨ç†èƒ½åŠ›ã€‚\n\n8. **ä»£ç è§£é‡Šå’Œä¼˜åŒ–**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿè§£é‡Šä»£ç é€»è¾‘å’Œæä¾›ä¼˜åŒ–å»ºè®®çš„ç¤ºä¾‹ï¼Œå¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°ç†è§£å’Œä¼˜åŒ–ä»£ç ã€‚\n\né€‰æ‹©åˆé€‚çš„æ ·ä¾‹æ—¶ï¼Œå¯ä»¥æ ¹æ®é¡¾å®¢çš„å…·ä½“éœ€æ±‚å’Œå…´è¶£è¿›è¡Œè°ƒæ•´ã€‚ç¡®ä¿æ ·ä¾‹èƒ½å¤Ÿæ¸…æ™°åœ°å±•ç¤ºLangChainå’ŒLLMçš„ä¼˜åŠ¿ï¼Œå¹¶ä¸”æ˜“äºç†è§£ã€‚åŒæ—¶ï¼Œå‡†å¤‡å¥½è¯¦ç»†çš„è§£é‡Šå’ŒèƒŒæ™¯ä¿¡æ¯ï¼Œä»¥ä¾¿é¡¾å®¢èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£è¿™äº›æŠ€æœ¯çš„åº”ç”¨åœºæ™¯å’Œæ½œåŠ›ã€‚&quot;,
            &quot;additional_kwargs&quot;: &#123;
              &quot;refusal&quot;: null
            &#125;,
            &quot;response_metadata&quot;: &#123;
              &quot;token_usage&quot;: &#123;
                &quot;completion_tokens&quot;: 378,
                &quot;prompt_tokens&quot;: 129,
                &quot;total_tokens&quot;: 507,
                &quot;completion_tokens_details&quot;: null,
                &quot;prompt_tokens_details&quot;: null
              &#125;,
              &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
              &quot;system_fingerprint&quot;: &quot;&quot;,
              &quot;id&quot;: &quot;019b2a6bda30f3a3a3966e53c5b36155&quot;,
              &quot;service_tier&quot;: null,
              &quot;finish_reason&quot;: &quot;stop&quot;,
              &quot;logprobs&quot;: null
            &#125;,
            &quot;type&quot;: &quot;ai&quot;,
            &quot;id&quot;: &quot;run--fe4e670f-8ea6-4e0c-92ac-bea82e80253d-0&quot;,
            &quot;usage_metadata&quot;: &#123;
              &quot;input_tokens&quot;: 129,
              &quot;output_tokens&quot;: 378,
              &quot;total_tokens&quot;: 507,
              &quot;input_token_details&quot;: &#123;&#125;,
              &quot;output_token_details&quot;: &#123;&#125;
            &#125;,
            &quot;tool_calls&quot;: [],
            &quot;invalid_tool_calls&quot;: []
          &#125;
        &#125;
      &#125;
    ]
  ],
  &quot;llm_output&quot;: &#123;
    &quot;token_usage&quot;: &#123;
      &quot;completion_tokens&quot;: 378,
      &quot;prompt_tokens&quot;: 129,
      &quot;total_tokens&quot;: 507,
      &quot;completion_tokens_details&quot;: null,
      &quot;prompt_tokens_details&quot;: null
    &#125;,
    &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
    &quot;system_fingerprint&quot;: &quot;&quot;,
    &quot;id&quot;: &quot;019b2a6bda30f3a3a3966e53c5b36155&quot;,
    &quot;service_tier&quot;: null
  &#125;,
  &quot;run&quot;: null,
  &quot;type&quot;: &quot;LLMResult&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; parser:StrOutputParser] Entering Parser run with input:
[0m[inputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; parser:StrOutputParser] [1ms] Exiting Parser run with output:
[0m&#123;
  &quot;output&quot;: &quot;ä¸ºäº†ç»™é¡¾å®¢ç•™ä¸‹æ·±åˆ»å°è±¡å¹¶å±•ç¤ºæœ€æ–°çš„LLMæ ·ä¾‹ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸€äº›èƒ½å¤Ÿä½“ç°LangChainå’ŒLLMå¼ºå¤§åŠŸèƒ½å’Œæ½œåŠ›çš„ç¤ºä¾‹ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å»ºè®®ï¼š\n\n1. **å¯¹è¯ç”Ÿæˆ**ï¼šå±•ç¤ºä¸€ä¸ªåŸºäºLangChainçš„å¯¹è¯ç³»ç»Ÿï¼Œå®ƒå¯ä»¥ç”Ÿæˆè‡ªç„¶æµç•…çš„å¯¹è¯ï¼Œæ¨¡æ‹ŸçœŸå®çš„äººç±»å¯¹è¯ã€‚ä½ å¯ä»¥å±•ç¤ºä¸€äº›å¯¹è¯åœºæ™¯ï¼Œå¦‚å®¢æˆ·æœåŠ¡ã€è™šæ‹ŸåŠ©æ‰‹ç­‰ã€‚\n\n2. **çŸ¥è¯†å›¾è°±æ„å»º**ï¼šå±•ç¤ºå¦‚ä½•ä½¿ç”¨LangChainå’ŒLLMæ„å»ºä¸€ä¸ªçŸ¥è¯†å›¾è°±ï¼Œå±•ç¤ºå…¶å¦‚ä½•ä»å¤§é‡æ–‡æœ¬æ•°æ®ä¸­æå–å…³é”®ä¿¡æ¯ï¼Œå¹¶æ„å»ºå‡ºç»“æ„åŒ–çš„çŸ¥è¯†ç½‘ç»œã€‚\n\n3. **ä»£ç ç”Ÿæˆ**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿè‡ªåŠ¨ç”Ÿæˆä»£ç çš„ç¤ºä¾‹ï¼Œæ¯”å¦‚æ ¹æ®ç”¨æˆ·çš„éœ€æ±‚ç”ŸæˆPythonã€Javaæˆ–å…¶ä»–ç¼–ç¨‹è¯­è¨€çš„ä»£ç ã€‚è¿™å¯ä»¥å±•ç¤ºLLMçš„å¼ºå¤§ä»£ç ç”Ÿæˆèƒ½åŠ›ã€‚\n\n4. **å¤šè½®å¯¹è¯ç®¡ç†**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿå¤„ç†å¤šè½®å¯¹è¯çš„ç³»ç»Ÿï¼Œæ¯”å¦‚åœ¨å®¢æˆ·æœåŠ¡åœºæ™¯ä¸­ï¼Œèƒ½å¤Ÿç†è§£ç”¨æˆ·çš„éœ€æ±‚å¹¶é€æ­¥å¼•å¯¼ç”¨æˆ·å®Œæˆä»»åŠ¡ã€‚\n\n5. **æƒ…æ„Ÿåˆ†æ**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿè¿›è¡Œæƒ…æ„Ÿåˆ†æçš„ç¤ºä¾‹ï¼Œæ¯”å¦‚åˆ†æç¤¾äº¤åª’ä½“ä¸Šçš„è¯„è®ºï¼Œè¯†åˆ«å…¶ä¸­çš„æƒ…æ„Ÿå€¾å‘ï¼Œå¹¶ç»™å‡ºç›¸åº”çš„åé¦ˆã€‚\n\n6. **å†…å®¹ç”Ÿæˆ**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿç”Ÿæˆæ–‡ç« ã€æ•…äº‹ã€è¯—æ­Œç­‰å†…å®¹çš„ç¤ºä¾‹ï¼Œå±•ç¤ºå…¶åˆ›é€ åŠ›å’Œå¤šæ ·æ€§ã€‚\n\n7. **é—®ç­”ç³»ç»Ÿ**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿå›ç­”å¤æ‚é—®é¢˜çš„é—®ç­”ç³»ç»Ÿï¼Œæ¯”å¦‚åŸºäºç‰¹å®šé¢†åŸŸçš„çŸ¥è¯†åº“è¿›è¡Œé—®ç­”ï¼Œå±•ç¤ºå…¶åœ¨ç‰¹å®šé¢†åŸŸçš„æ·±åº¦ç†è§£å’Œæ¨ç†èƒ½åŠ›ã€‚\n\n8. **ä»£ç è§£é‡Šå’Œä¼˜åŒ–**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿè§£é‡Šä»£ç é€»è¾‘å’Œæä¾›ä¼˜åŒ–å»ºè®®çš„ç¤ºä¾‹ï¼Œå¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°ç†è§£å’Œä¼˜åŒ–ä»£ç ã€‚\n\né€‰æ‹©åˆé€‚çš„æ ·ä¾‹æ—¶ï¼Œå¯ä»¥æ ¹æ®é¡¾å®¢çš„å…·ä½“éœ€æ±‚å’Œå…´è¶£è¿›è¡Œè°ƒæ•´ã€‚ç¡®ä¿æ ·ä¾‹èƒ½å¤Ÿæ¸…æ™°åœ°å±•ç¤ºLangChainå’ŒLLMçš„ä¼˜åŠ¿ï¼Œå¹¶ä¸”æ˜“äºç†è§£ã€‚åŒæ—¶ï¼Œå‡†å¤‡å¥½è¯¦ç»†çš„è§£é‡Šå’ŒèƒŒæ™¯ä¿¡æ¯ï¼Œä»¥ä¾¿é¡¾å®¢èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£è¿™äº›æŠ€æœ¯çš„åº”ç”¨åœºæ™¯å’Œæ½œåŠ›ã€‚&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence] [10.03s] Exiting Chain run with output:
[0m&#123;
  &quot;output&quot;: &quot;ä¸ºäº†ç»™é¡¾å®¢ç•™ä¸‹æ·±åˆ»å°è±¡å¹¶å±•ç¤ºæœ€æ–°çš„LLMæ ·ä¾‹ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸€äº›èƒ½å¤Ÿä½“ç°LangChainå’ŒLLMå¼ºå¤§åŠŸèƒ½å’Œæ½œåŠ›çš„ç¤ºä¾‹ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å»ºè®®ï¼š\n\n1. **å¯¹è¯ç”Ÿæˆ**ï¼šå±•ç¤ºä¸€ä¸ªåŸºäºLangChainçš„å¯¹è¯ç³»ç»Ÿï¼Œå®ƒå¯ä»¥ç”Ÿæˆè‡ªç„¶æµç•…çš„å¯¹è¯ï¼Œæ¨¡æ‹ŸçœŸå®çš„äººç±»å¯¹è¯ã€‚ä½ å¯ä»¥å±•ç¤ºä¸€äº›å¯¹è¯åœºæ™¯ï¼Œå¦‚å®¢æˆ·æœåŠ¡ã€è™šæ‹ŸåŠ©æ‰‹ç­‰ã€‚\n\n2. **çŸ¥è¯†å›¾è°±æ„å»º**ï¼šå±•ç¤ºå¦‚ä½•ä½¿ç”¨LangChainå’ŒLLMæ„å»ºä¸€ä¸ªçŸ¥è¯†å›¾è°±ï¼Œå±•ç¤ºå…¶å¦‚ä½•ä»å¤§é‡æ–‡æœ¬æ•°æ®ä¸­æå–å…³é”®ä¿¡æ¯ï¼Œå¹¶æ„å»ºå‡ºç»“æ„åŒ–çš„çŸ¥è¯†ç½‘ç»œã€‚\n\n3. **ä»£ç ç”Ÿæˆ**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿè‡ªåŠ¨ç”Ÿæˆä»£ç çš„ç¤ºä¾‹ï¼Œæ¯”å¦‚æ ¹æ®ç”¨æˆ·çš„éœ€æ±‚ç”ŸæˆPythonã€Javaæˆ–å…¶ä»–ç¼–ç¨‹è¯­è¨€çš„ä»£ç ã€‚è¿™å¯ä»¥å±•ç¤ºLLMçš„å¼ºå¤§ä»£ç ç”Ÿæˆèƒ½åŠ›ã€‚\n\n4. **å¤šè½®å¯¹è¯ç®¡ç†**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿå¤„ç†å¤šè½®å¯¹è¯çš„ç³»ç»Ÿï¼Œæ¯”å¦‚åœ¨å®¢æˆ·æœåŠ¡åœºæ™¯ä¸­ï¼Œèƒ½å¤Ÿç†è§£ç”¨æˆ·çš„éœ€æ±‚å¹¶é€æ­¥å¼•å¯¼ç”¨æˆ·å®Œæˆä»»åŠ¡ã€‚\n\n5. **æƒ…æ„Ÿåˆ†æ**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿè¿›è¡Œæƒ…æ„Ÿåˆ†æçš„ç¤ºä¾‹ï¼Œæ¯”å¦‚åˆ†æç¤¾äº¤åª’ä½“ä¸Šçš„è¯„è®ºï¼Œè¯†åˆ«å…¶ä¸­çš„æƒ…æ„Ÿå€¾å‘ï¼Œå¹¶ç»™å‡ºç›¸åº”çš„åé¦ˆã€‚\n\n6. **å†…å®¹ç”Ÿæˆ**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿç”Ÿæˆæ–‡ç« ã€æ•…äº‹ã€è¯—æ­Œç­‰å†…å®¹çš„ç¤ºä¾‹ï¼Œå±•ç¤ºå…¶åˆ›é€ åŠ›å’Œå¤šæ ·æ€§ã€‚\n\n7. **é—®ç­”ç³»ç»Ÿ**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿå›ç­”å¤æ‚é—®é¢˜çš„é—®ç­”ç³»ç»Ÿï¼Œæ¯”å¦‚åŸºäºç‰¹å®šé¢†åŸŸçš„çŸ¥è¯†åº“è¿›è¡Œé—®ç­”ï¼Œå±•ç¤ºå…¶åœ¨ç‰¹å®šé¢†åŸŸçš„æ·±åº¦ç†è§£å’Œæ¨ç†èƒ½åŠ›ã€‚\n\n8. **ä»£ç è§£é‡Šå’Œä¼˜åŒ–**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿè§£é‡Šä»£ç é€»è¾‘å’Œæä¾›ä¼˜åŒ–å»ºè®®çš„ç¤ºä¾‹ï¼Œå¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°ç†è§£å’Œä¼˜åŒ–ä»£ç ã€‚\n\né€‰æ‹©åˆé€‚çš„æ ·ä¾‹æ—¶ï¼Œå¯ä»¥æ ¹æ®é¡¾å®¢çš„å…·ä½“éœ€æ±‚å’Œå…´è¶£è¿›è¡Œè°ƒæ•´ã€‚ç¡®ä¿æ ·ä¾‹èƒ½å¤Ÿæ¸…æ™°åœ°å±•ç¤ºLangChainå’ŒLLMçš„ä¼˜åŠ¿ï¼Œå¹¶ä¸”æ˜“äºç†è§£ã€‚åŒæ—¶ï¼Œå‡†å¤‡å¥½è¯¦ç»†çš„è§£é‡Šå’ŒèƒŒæ™¯ä¿¡æ¯ï¼Œä»¥ä¾¿é¡¾å®¢èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£è¿™äº›æŠ€æœ¯çš„åº”ç”¨åœºæ™¯å’Œæ½œåŠ›ã€‚&quot;
&#125;
AI: ä¸ºäº†ç»™é¡¾å®¢ç•™ä¸‹æ·±åˆ»å°è±¡å¹¶å±•ç¤ºæœ€æ–°çš„LLMæ ·ä¾‹ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸€äº›èƒ½å¤Ÿä½“ç°LangChainå’ŒLLMå¼ºå¤§åŠŸèƒ½å’Œæ½œåŠ›çš„ç¤ºä¾‹ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å»ºè®®ï¼š

1. **å¯¹è¯ç”Ÿæˆ**ï¼šå±•ç¤ºä¸€ä¸ªåŸºäºLangChainçš„å¯¹è¯ç³»ç»Ÿï¼Œå®ƒå¯ä»¥ç”Ÿæˆè‡ªç„¶æµç•…çš„å¯¹è¯ï¼Œæ¨¡æ‹ŸçœŸå®çš„äººç±»å¯¹è¯ã€‚ä½ å¯ä»¥å±•ç¤ºä¸€äº›å¯¹è¯åœºæ™¯ï¼Œå¦‚å®¢æˆ·æœåŠ¡ã€è™šæ‹ŸåŠ©æ‰‹ç­‰ã€‚

2. **çŸ¥è¯†å›¾è°±æ„å»º**ï¼šå±•ç¤ºå¦‚ä½•ä½¿ç”¨LangChainå’ŒLLMæ„å»ºä¸€ä¸ªçŸ¥è¯†å›¾è°±ï¼Œå±•ç¤ºå…¶å¦‚ä½•ä»å¤§é‡æ–‡æœ¬æ•°æ®ä¸­æå–å…³é”®ä¿¡æ¯ï¼Œå¹¶æ„å»ºå‡ºç»“æ„åŒ–çš„çŸ¥è¯†ç½‘ç»œã€‚

3. **ä»£ç ç”Ÿæˆ**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿè‡ªåŠ¨ç”Ÿæˆä»£ç çš„ç¤ºä¾‹ï¼Œæ¯”å¦‚æ ¹æ®ç”¨æˆ·çš„éœ€æ±‚ç”ŸæˆPythonã€Javaæˆ–å…¶ä»–ç¼–ç¨‹è¯­è¨€çš„ä»£ç ã€‚è¿™å¯ä»¥å±•ç¤ºLLMçš„å¼ºå¤§ä»£ç ç”Ÿæˆèƒ½åŠ›ã€‚

4. **å¤šè½®å¯¹è¯ç®¡ç†**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿå¤„ç†å¤šè½®å¯¹è¯çš„ç³»ç»Ÿï¼Œæ¯”å¦‚åœ¨å®¢æˆ·æœåŠ¡åœºæ™¯ä¸­ï¼Œèƒ½å¤Ÿç†è§£ç”¨æˆ·çš„éœ€æ±‚å¹¶é€æ­¥å¼•å¯¼ç”¨æˆ·å®Œæˆä»»åŠ¡ã€‚

5. **æƒ…æ„Ÿåˆ†æ**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿè¿›è¡Œæƒ…æ„Ÿåˆ†æçš„ç¤ºä¾‹ï¼Œæ¯”å¦‚åˆ†æç¤¾äº¤åª’ä½“ä¸Šçš„è¯„è®ºï¼Œè¯†åˆ«å…¶ä¸­çš„æƒ…æ„Ÿå€¾å‘ï¼Œå¹¶ç»™å‡ºç›¸åº”çš„åé¦ˆã€‚

6. **å†…å®¹ç”Ÿæˆ**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿç”Ÿæˆæ–‡ç« ã€æ•…äº‹ã€è¯—æ­Œç­‰å†…å®¹çš„ç¤ºä¾‹ï¼Œå±•ç¤ºå…¶åˆ›é€ åŠ›å’Œå¤šæ ·æ€§ã€‚

7. **é—®ç­”ç³»ç»Ÿ**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿå›ç­”å¤æ‚é—®é¢˜çš„é—®ç­”ç³»ç»Ÿï¼Œæ¯”å¦‚åŸºäºç‰¹å®šé¢†åŸŸçš„çŸ¥è¯†åº“è¿›è¡Œé—®ç­”ï¼Œå±•ç¤ºå…¶åœ¨ç‰¹å®šé¢†åŸŸçš„æ·±åº¦ç†è§£å’Œæ¨ç†èƒ½åŠ›ã€‚

8. **ä»£ç è§£é‡Šå’Œä¼˜åŒ–**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿè§£é‡Šä»£ç é€»è¾‘å’Œæä¾›ä¼˜åŒ–å»ºè®®çš„ç¤ºä¾‹ï¼Œå¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°ç†è§£å’Œä¼˜åŒ–ä»£ç ã€‚

é€‰æ‹©åˆé€‚çš„æ ·ä¾‹æ—¶ï¼Œå¯ä»¥æ ¹æ®é¡¾å®¢çš„å…·ä½“éœ€æ±‚å’Œå…´è¶£è¿›è¡Œè°ƒæ•´ã€‚ç¡®ä¿æ ·ä¾‹èƒ½å¤Ÿæ¸…æ™°åœ°å±•ç¤ºLangChainå’ŒLLMçš„ä¼˜åŠ¿ï¼Œå¹¶ä¸”æ˜“äºç†è§£ã€‚åŒæ—¶ï¼Œå‡†å¤‡å¥½è¯¦ç»†çš„è§£é‡Šå’ŒèƒŒæ™¯ä¿¡æ¯ï¼Œä»¥ä¾¿é¡¾å®¢èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£è¿™äº›æŠ€æœ¯çš„åº”ç”¨åœºæ™¯å’Œæ½œåŠ›ã€‚
</code></pre>
<p>é€‰æ‹©åˆé€‚çš„æ ·ä¾‹æ—¶ï¼Œå¯ä»¥æ ¹æ®é¡¾å®¢çš„å…·ä½“éœ€æ±‚å’Œå…´è¶£è¿›è¡Œè°ƒæ•´ã€‚ç¡®ä¿æ ·ä¾‹èƒ½å¤Ÿæ¸…æ™°åœ°å±•ç¤ºLangChainå’ŒLLMçš„ä¼˜åŠ¿ï¼Œå¹¶ä¸”æ˜“äºç†è§£ã€‚åŒæ—¶ï¼Œå‡†å¤‡å¥½è¯¦ç»†çš„è§£é‡Šå’ŒèƒŒæ™¯ä¿¡æ¯ï¼Œä»¥ä¾¿é¡¾å®¢èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£è¿™äº›æŠ€æœ¯çš„åº”ç”¨åœºæ™¯å’Œæ½œåŠ›ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 6. !!! å…³é”®æ­¥éª¤ï¼šæ‰‹åŠ¨ä¿å­˜ä¸Šä¸‹æ–‡ !!!</span><br><span class="hljs-comment"># åœ¨ LCEL ä¸­ï¼Œå¦‚æœä¸æ˜¯ç”¨ RunnableWithMessageHistory åŒ…è£…å™¨ï¼Œ</span><br><span class="hljs-comment"># æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨æŠŠæ–°çš„ä¸€è½®å¯¹è¯å­˜å› memoryï¼Œä»¥ä¾¿è§¦å‘ä¸‹ä¸€æ¬¡çš„æ‘˜è¦è®¡ç®—ã€‚</span><br>memory.save_context(&#123;<span class="hljs-string">&quot;input&quot;</span>: user_input&#125;, &#123;<span class="hljs-string">&quot;output&quot;</span>: response&#125;)<br><br><span class="hljs-comment"># å†æ¬¡æŸ¥çœ‹è®°å¿† (ç¡®è®¤æ–°çš„å¯¹è¯è¢«åŠ å…¥ï¼Œä¸”æ‘˜è¦å¯èƒ½æ›´æ–°)</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n--- æ›´æ–°åçš„è®°å¿†çŠ¶æ€ ---&quot;</span>)<br><span class="hljs-built_in">print</span>(memory.load_memory_variables(&#123;&#125;)[<span class="hljs-string">&#x27;history&#x27;</span>])<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">[32;1m[1;3m[chain/start][0m [1m[chain:LLMChain] Entering Chain run with input:
[0m&#123;
  &quot;summary&quot;: &quot;ä½ å¥½ï¼Œçš®çš®é²å’Œé²è¥¿è¥¿äº’è‡´é—®å€™å¹¶å†³å®šä¸€èµ·å»å†’é™©ã€‚ä»Šå¤©çš„æ—¥ç¨‹å®‰æ’åŒ…æ‹¬ä¸Šåˆ8ç‚¹ä¸äº§å“å›¢é˜Ÿçš„ä¼šè®®ï¼Œéœ€è¦å‡†å¤‡PPTï¼›ä¸Šåˆ9ç‚¹åˆ°12ç‚¹ä¸“æ³¨äºLangChainé¡¹ç›®ï¼Œå› ä¸ºLangChainæ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å·¥å…·ï¼Œä½¿å¾—é¡¹ç›®è¿›å±•è¿…é€Ÿï¼›ä¸­åˆåœ¨æ„å¤§åˆ©é¤å…ä¸ä¸€ä½å¼€è½¦æ¥çš„é¡¾å®¢ä¼šé¢ï¼Œé¡¾å®¢èµ°äº†ä¸€ä¸ªå¤šå°æ—¶çš„è·¯ç¨‹åªä¸ºäº†è§£æœ€æ–°çš„AIæŠ€æœ¯ï¼Œå¹¶ä¸”éœ€è¦å¸¦ä¸Šç¬”è®°æœ¬ç”µè„‘å±•ç¤ºæœ€æ–°çš„LLMæ ·ä¾‹ã€‚&quot;,
  &quot;new_lines&quot;: &quot;Human: å±•ç¤ºä»€ä¹ˆæ ·çš„æ ·ä¾‹æœ€å¥½å‘¢ï¼Ÿ\nAI: ä¸ºäº†ç»™é¡¾å®¢ç•™ä¸‹æ·±åˆ»å°è±¡å¹¶å±•ç¤ºæœ€æ–°çš„LLMæ ·ä¾‹ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸€äº›èƒ½å¤Ÿä½“ç°LangChainå’ŒLLMå¼ºå¤§åŠŸèƒ½å’Œæ½œåŠ›çš„ç¤ºä¾‹ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å»ºè®®ï¼š\n\n1. **å¯¹è¯ç”Ÿæˆ**ï¼šå±•ç¤ºä¸€ä¸ªåŸºäºLangChainçš„å¯¹è¯ç³»ç»Ÿï¼Œå®ƒå¯ä»¥ç”Ÿæˆè‡ªç„¶æµç•…çš„å¯¹è¯ï¼Œæ¨¡æ‹ŸçœŸå®çš„äººç±»å¯¹è¯ã€‚ä½ å¯ä»¥å±•ç¤ºä¸€äº›å¯¹è¯åœºæ™¯ï¼Œå¦‚å®¢æˆ·æœåŠ¡ã€è™šæ‹ŸåŠ©æ‰‹ç­‰ã€‚\n\n2. **çŸ¥è¯†å›¾è°±æ„å»º**ï¼šå±•ç¤ºå¦‚ä½•ä½¿ç”¨LangChainå’ŒLLMæ„å»ºä¸€ä¸ªçŸ¥è¯†å›¾è°±ï¼Œå±•ç¤ºå…¶å¦‚ä½•ä»å¤§é‡æ–‡æœ¬æ•°æ®ä¸­æå–å…³é”®ä¿¡æ¯ï¼Œå¹¶æ„å»ºå‡ºç»“æ„åŒ–çš„çŸ¥è¯†ç½‘ç»œã€‚\n\n3. **ä»£ç ç”Ÿæˆ**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿè‡ªåŠ¨ç”Ÿæˆä»£ç çš„ç¤ºä¾‹ï¼Œæ¯”å¦‚æ ¹æ®ç”¨æˆ·çš„éœ€æ±‚ç”ŸæˆPythonã€Javaæˆ–å…¶ä»–ç¼–ç¨‹è¯­è¨€çš„ä»£ç ã€‚è¿™å¯ä»¥å±•ç¤ºLLMçš„å¼ºå¤§ä»£ç ç”Ÿæˆèƒ½åŠ›ã€‚\n\n4. **å¤šè½®å¯¹è¯ç®¡ç†**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿå¤„ç†å¤šè½®å¯¹è¯çš„ç³»ç»Ÿï¼Œæ¯”å¦‚åœ¨å®¢æˆ·æœåŠ¡åœºæ™¯ä¸­ï¼Œèƒ½å¤Ÿç†è§£ç”¨æˆ·çš„éœ€æ±‚å¹¶é€æ­¥å¼•å¯¼ç”¨æˆ·å®Œæˆä»»åŠ¡ã€‚\n\n5. **æƒ…æ„Ÿåˆ†æ**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿè¿›è¡Œæƒ…æ„Ÿåˆ†æçš„ç¤ºä¾‹ï¼Œæ¯”å¦‚åˆ†æç¤¾äº¤åª’ä½“ä¸Šçš„è¯„è®ºï¼Œè¯†åˆ«å…¶ä¸­çš„æƒ…æ„Ÿå€¾å‘ï¼Œå¹¶ç»™å‡ºç›¸åº”çš„åé¦ˆã€‚\n\n6. **å†…å®¹ç”Ÿæˆ**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿç”Ÿæˆæ–‡ç« ã€æ•…äº‹ã€è¯—æ­Œç­‰å†…å®¹çš„ç¤ºä¾‹ï¼Œå±•ç¤ºå…¶åˆ›é€ åŠ›å’Œå¤šæ ·æ€§ã€‚\n\n7. **é—®ç­”ç³»ç»Ÿ**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿå›ç­”å¤æ‚é—®é¢˜çš„é—®ç­”ç³»ç»Ÿï¼Œæ¯”å¦‚åŸºäºç‰¹å®šé¢†åŸŸçš„çŸ¥è¯†åº“è¿›è¡Œé—®ç­”ï¼Œå±•ç¤ºå…¶åœ¨ç‰¹å®šé¢†åŸŸçš„æ·±åº¦ç†è§£å’Œæ¨ç†èƒ½åŠ›ã€‚\n\n8. **ä»£ç è§£é‡Šå’Œä¼˜åŒ–**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿè§£é‡Šä»£ç é€»è¾‘å’Œæä¾›ä¼˜åŒ–å»ºè®®çš„ç¤ºä¾‹ï¼Œå¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°ç†è§£å’Œä¼˜åŒ–ä»£ç ã€‚\n\né€‰æ‹©åˆé€‚çš„æ ·ä¾‹æ—¶ï¼Œå¯ä»¥æ ¹æ®é¡¾å®¢çš„å…·ä½“éœ€æ±‚å’Œå…´è¶£è¿›è¡Œè°ƒæ•´ã€‚ç¡®ä¿æ ·ä¾‹èƒ½å¤Ÿæ¸…æ™°åœ°å±•ç¤ºLangChainå’ŒLLMçš„ä¼˜åŠ¿ï¼Œå¹¶ä¸”æ˜“äºç†è§£ã€‚åŒæ—¶ï¼Œå‡†å¤‡å¥½è¯¦ç»†çš„è§£é‡Šå’ŒèƒŒæ™¯ä¿¡æ¯ï¼Œä»¥ä¾¿é¡¾å®¢èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£è¿™äº›æŠ€æœ¯çš„åº”ç”¨åœºæ™¯å’Œæ½œåŠ›ã€‚&quot;
&#125;
[32;1m[1;3m[llm/start][0m [1m[chain:LLMChain &gt; llm:ChatOpenAI] Entering LLM run with input:
[0m&#123;
  &quot;prompts&quot;: [
    &quot;Human: Progressively summarize the lines of conversation provided, adding onto the previous summary returning a new summary.\n\nEXAMPLE\nCurrent summary:\nThe human asks what the AI thinks of artificial intelligence. The AI thinks artificial intelligence is a force for good.\n\nNew lines of conversation:\nHuman: Why do you think artificial intelligence is a force for good?\nAI: Because artificial intelligence will help humans reach their full potential.\n\nNew summary:\nThe human asks what the AI thinks of artificial intelligence. The AI thinks artificial intelligence is a force for good because it will help humans reach their full potential.\nEND OF EXAMPLE\n\nCurrent summary:\nä½ å¥½ï¼Œçš®çš®é²å’Œé²è¥¿è¥¿äº’è‡´é—®å€™å¹¶å†³å®šä¸€èµ·å»å†’é™©ã€‚ä»Šå¤©çš„æ—¥ç¨‹å®‰æ’åŒ…æ‹¬ä¸Šåˆ8ç‚¹ä¸äº§å“å›¢é˜Ÿçš„ä¼šè®®ï¼Œéœ€è¦å‡†å¤‡PPTï¼›ä¸Šåˆ9ç‚¹åˆ°12ç‚¹ä¸“æ³¨äºLangChainé¡¹ç›®ï¼Œå› ä¸ºLangChainæ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å·¥å…·ï¼Œä½¿å¾—é¡¹ç›®è¿›å±•è¿…é€Ÿï¼›ä¸­åˆåœ¨æ„å¤§åˆ©é¤å…ä¸ä¸€ä½å¼€è½¦æ¥çš„é¡¾å®¢ä¼šé¢ï¼Œé¡¾å®¢èµ°äº†ä¸€ä¸ªå¤šå°æ—¶çš„è·¯ç¨‹åªä¸ºäº†è§£æœ€æ–°çš„AIæŠ€æœ¯ï¼Œå¹¶ä¸”éœ€è¦å¸¦ä¸Šç¬”è®°æœ¬ç”µè„‘å±•ç¤ºæœ€æ–°çš„LLMæ ·ä¾‹ã€‚\n\nNew lines of conversation:\nHuman: å±•ç¤ºä»€ä¹ˆæ ·çš„æ ·ä¾‹æœ€å¥½å‘¢ï¼Ÿ\nAI: ä¸ºäº†ç»™é¡¾å®¢ç•™ä¸‹æ·±åˆ»å°è±¡å¹¶å±•ç¤ºæœ€æ–°çš„LLMæ ·ä¾‹ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸€äº›èƒ½å¤Ÿä½“ç°LangChainå’ŒLLMå¼ºå¤§åŠŸèƒ½å’Œæ½œåŠ›çš„ç¤ºä¾‹ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å»ºè®®ï¼š\n\n1. **å¯¹è¯ç”Ÿæˆ**ï¼šå±•ç¤ºä¸€ä¸ªåŸºäºLangChainçš„å¯¹è¯ç³»ç»Ÿï¼Œå®ƒå¯ä»¥ç”Ÿæˆè‡ªç„¶æµç•…çš„å¯¹è¯ï¼Œæ¨¡æ‹ŸçœŸå®çš„äººç±»å¯¹è¯ã€‚ä½ å¯ä»¥å±•ç¤ºä¸€äº›å¯¹è¯åœºæ™¯ï¼Œå¦‚å®¢æˆ·æœåŠ¡ã€è™šæ‹ŸåŠ©æ‰‹ç­‰ã€‚\n\n2. **çŸ¥è¯†å›¾è°±æ„å»º**ï¼šå±•ç¤ºå¦‚ä½•ä½¿ç”¨LangChainå’ŒLLMæ„å»ºä¸€ä¸ªçŸ¥è¯†å›¾è°±ï¼Œå±•ç¤ºå…¶å¦‚ä½•ä»å¤§é‡æ–‡æœ¬æ•°æ®ä¸­æå–å…³é”®ä¿¡æ¯ï¼Œå¹¶æ„å»ºå‡ºç»“æ„åŒ–çš„çŸ¥è¯†ç½‘ç»œã€‚\n\n3. **ä»£ç ç”Ÿæˆ**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿè‡ªåŠ¨ç”Ÿæˆä»£ç çš„ç¤ºä¾‹ï¼Œæ¯”å¦‚æ ¹æ®ç”¨æˆ·çš„éœ€æ±‚ç”ŸæˆPythonã€Javaæˆ–å…¶ä»–ç¼–ç¨‹è¯­è¨€çš„ä»£ç ã€‚è¿™å¯ä»¥å±•ç¤ºLLMçš„å¼ºå¤§ä»£ç ç”Ÿæˆèƒ½åŠ›ã€‚\n\n4. **å¤šè½®å¯¹è¯ç®¡ç†**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿå¤„ç†å¤šè½®å¯¹è¯çš„ç³»ç»Ÿï¼Œæ¯”å¦‚åœ¨å®¢æˆ·æœåŠ¡åœºæ™¯ä¸­ï¼Œèƒ½å¤Ÿç†è§£ç”¨æˆ·çš„éœ€æ±‚å¹¶é€æ­¥å¼•å¯¼ç”¨æˆ·å®Œæˆä»»åŠ¡ã€‚\n\n5. **æƒ…æ„Ÿåˆ†æ**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿè¿›è¡Œæƒ…æ„Ÿåˆ†æçš„ç¤ºä¾‹ï¼Œæ¯”å¦‚åˆ†æç¤¾äº¤åª’ä½“ä¸Šçš„è¯„è®ºï¼Œè¯†åˆ«å…¶ä¸­çš„æƒ…æ„Ÿå€¾å‘ï¼Œå¹¶ç»™å‡ºç›¸åº”çš„åé¦ˆã€‚\n\n6. **å†…å®¹ç”Ÿæˆ**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿç”Ÿæˆæ–‡ç« ã€æ•…äº‹ã€è¯—æ­Œç­‰å†…å®¹çš„ç¤ºä¾‹ï¼Œå±•ç¤ºå…¶åˆ›é€ åŠ›å’Œå¤šæ ·æ€§ã€‚\n\n7. **é—®ç­”ç³»ç»Ÿ**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿå›ç­”å¤æ‚é—®é¢˜çš„é—®ç­”ç³»ç»Ÿï¼Œæ¯”å¦‚åŸºäºç‰¹å®šé¢†åŸŸçš„çŸ¥è¯†åº“è¿›è¡Œé—®ç­”ï¼Œå±•ç¤ºå…¶åœ¨ç‰¹å®šé¢†åŸŸçš„æ·±åº¦ç†è§£å’Œæ¨ç†èƒ½åŠ›ã€‚\n\n8. **ä»£ç è§£é‡Šå’Œä¼˜åŒ–**ï¼šå±•ç¤ºä¸€ä¸ªèƒ½å¤Ÿè§£é‡Šä»£ç é€»è¾‘å’Œæä¾›ä¼˜åŒ–å»ºè®®çš„ç¤ºä¾‹ï¼Œå¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°ç†è§£å’Œä¼˜åŒ–ä»£ç ã€‚\n\né€‰æ‹©åˆé€‚çš„æ ·ä¾‹æ—¶ï¼Œå¯ä»¥æ ¹æ®é¡¾å®¢çš„å…·ä½“éœ€æ±‚å’Œå…´è¶£è¿›è¡Œè°ƒæ•´ã€‚ç¡®ä¿æ ·ä¾‹èƒ½å¤Ÿæ¸…æ™°åœ°å±•ç¤ºLangChainå’ŒLLMçš„ä¼˜åŠ¿ï¼Œå¹¶ä¸”æ˜“äºç†è§£ã€‚åŒæ—¶ï¼Œå‡†å¤‡å¥½è¯¦ç»†çš„è§£é‡Šå’ŒèƒŒæ™¯ä¿¡æ¯ï¼Œä»¥ä¾¿é¡¾å®¢èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£è¿™äº›æŠ€æœ¯çš„åº”ç”¨åœºæ™¯å’Œæ½œåŠ›ã€‚\n\nNew summary:&quot;
  ]
&#125;
[36;1m[1;3m[llm/end][0m [1m[chain:LLMChain &gt; llm:ChatOpenAI] [2.54s] Exiting LLM run with output:
[0m&#123;
  &quot;generations&quot;: [
    [
      &#123;
        &quot;text&quot;: &quot;ä½ å¥½ï¼Œçš®çš®é²å’Œé²è¥¿è¥¿äº’è‡´é—®å€™å¹¶å†³å®šä¸€èµ·å»å†’é™©ã€‚ä»Šå¤©çš„æ—¥ç¨‹å®‰æ’åŒ…æ‹¬ä¸Šåˆ8ç‚¹ä¸äº§å“å›¢é˜Ÿçš„ä¼šè®®ï¼Œéœ€è¦å‡†å¤‡PPTï¼›ä¸Šåˆ9ç‚¹åˆ°12ç‚¹ä¸“æ³¨äºLangChainé¡¹ç›®ï¼Œå› ä¸ºLangChainæ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å·¥å…·ï¼Œä½¿å¾—é¡¹ç›®è¿›å±•è¿…é€Ÿï¼›ä¸­åˆåœ¨æ„å¤§åˆ©é¤å…ä¸ä¸€ä½å¼€è½¦æ¥çš„é¡¾å®¢ä¼šé¢ï¼Œé¡¾å®¢èµ°äº†ä¸€ä¸ªå¤šå°æ—¶çš„è·¯ç¨‹åªä¸ºäº†è§£æœ€æ–°çš„AIæŠ€æœ¯ï¼Œå¹¶ä¸”éœ€è¦å¸¦ä¸Šç¬”è®°æœ¬ç”µè„‘å±•ç¤ºæœ€æ–°çš„LLMæ ·ä¾‹ã€‚ä¸ºäº†ç»™é¡¾å®¢ç•™ä¸‹æ·±åˆ»å°è±¡å¹¶å±•ç¤ºæœ€æ–°çš„LLMæ ·ä¾‹ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸€äº›èƒ½å¤Ÿä½“ç°LangChainå’ŒLLMå¼ºå¤§åŠŸèƒ½å’Œæ½œåŠ›çš„ç¤ºä¾‹ï¼Œå¦‚å¯¹è¯ç”Ÿæˆã€çŸ¥è¯†å›¾è°±æ„å»ºã€ä»£ç ç”Ÿæˆã€å¤šè½®å¯¹è¯ç®¡ç†ã€æƒ…æ„Ÿåˆ†æã€å†…å®¹ç”Ÿæˆã€é—®ç­”ç³»ç»Ÿå’Œä»£ç è§£é‡Šä¸ä¼˜åŒ–ç­‰ã€‚é€‰æ‹©åˆé€‚çš„æ ·ä¾‹æ—¶ï¼Œå¯ä»¥æ ¹æ®é¡¾å®¢çš„å…·ä½“éœ€æ±‚å’Œå…´è¶£è¿›è¡Œè°ƒæ•´ï¼Œç¡®ä¿æ ·ä¾‹èƒ½å¤Ÿæ¸…æ™°åœ°å±•ç¤ºLangChainå’ŒLLMçš„ä¼˜åŠ¿ï¼Œå¹¶ä¸”æ˜“äºç†è§£ã€‚åŒæ—¶ï¼Œå‡†å¤‡å¥½è¯¦ç»†çš„è§£é‡Šå’ŒèƒŒæ™¯ä¿¡æ¯ï¼Œä»¥ä¾¿é¡¾å®¢èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£è¿™äº›æŠ€æœ¯çš„åº”ç”¨åœºæ™¯å’Œæ½œåŠ›ã€‚&quot;,
        &quot;generation_info&quot;: &#123;
          &quot;finish_reason&quot;: &quot;stop&quot;,
          &quot;logprobs&quot;: null
        &#125;,
        &quot;type&quot;: &quot;ChatGeneration&quot;,
        &quot;message&quot;: &#123;
          &quot;lc&quot;: 1,
          &quot;type&quot;: &quot;constructor&quot;,
          &quot;id&quot;: [
            &quot;langchain&quot;,
            &quot;schema&quot;,
            &quot;messages&quot;,
            &quot;AIMessage&quot;
          ],
          &quot;kwargs&quot;: &#123;
            &quot;content&quot;: &quot;ä½ å¥½ï¼Œçš®çš®é²å’Œé²è¥¿è¥¿äº’è‡´é—®å€™å¹¶å†³å®šä¸€èµ·å»å†’é™©ã€‚ä»Šå¤©çš„æ—¥ç¨‹å®‰æ’åŒ…æ‹¬ä¸Šåˆ8ç‚¹ä¸äº§å“å›¢é˜Ÿçš„ä¼šè®®ï¼Œéœ€è¦å‡†å¤‡PPTï¼›ä¸Šåˆ9ç‚¹åˆ°12ç‚¹ä¸“æ³¨äºLangChainé¡¹ç›®ï¼Œå› ä¸ºLangChainæ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å·¥å…·ï¼Œä½¿å¾—é¡¹ç›®è¿›å±•è¿…é€Ÿï¼›ä¸­åˆåœ¨æ„å¤§åˆ©é¤å…ä¸ä¸€ä½å¼€è½¦æ¥çš„é¡¾å®¢ä¼šé¢ï¼Œé¡¾å®¢èµ°äº†ä¸€ä¸ªå¤šå°æ—¶çš„è·¯ç¨‹åªä¸ºäº†è§£æœ€æ–°çš„AIæŠ€æœ¯ï¼Œå¹¶ä¸”éœ€è¦å¸¦ä¸Šç¬”è®°æœ¬ç”µè„‘å±•ç¤ºæœ€æ–°çš„LLMæ ·ä¾‹ã€‚ä¸ºäº†ç»™é¡¾å®¢ç•™ä¸‹æ·±åˆ»å°è±¡å¹¶å±•ç¤ºæœ€æ–°çš„LLMæ ·ä¾‹ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸€äº›èƒ½å¤Ÿä½“ç°LangChainå’ŒLLMå¼ºå¤§åŠŸèƒ½å’Œæ½œåŠ›çš„ç¤ºä¾‹ï¼Œå¦‚å¯¹è¯ç”Ÿæˆã€çŸ¥è¯†å›¾è°±æ„å»ºã€ä»£ç ç”Ÿæˆã€å¤šè½®å¯¹è¯ç®¡ç†ã€æƒ…æ„Ÿåˆ†æã€å†…å®¹ç”Ÿæˆã€é—®ç­”ç³»ç»Ÿå’Œä»£ç è§£é‡Šä¸ä¼˜åŒ–ç­‰ã€‚é€‰æ‹©åˆé€‚çš„æ ·ä¾‹æ—¶ï¼Œå¯ä»¥æ ¹æ®é¡¾å®¢çš„å…·ä½“éœ€æ±‚å’Œå…´è¶£è¿›è¡Œè°ƒæ•´ï¼Œç¡®ä¿æ ·ä¾‹èƒ½å¤Ÿæ¸…æ™°åœ°å±•ç¤ºLangChainå’ŒLLMçš„ä¼˜åŠ¿ï¼Œå¹¶ä¸”æ˜“äºç†è§£ã€‚åŒæ—¶ï¼Œå‡†å¤‡å¥½è¯¦ç»†çš„è§£é‡Šå’ŒèƒŒæ™¯ä¿¡æ¯ï¼Œä»¥ä¾¿é¡¾å®¢èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£è¿™äº›æŠ€æœ¯çš„åº”ç”¨åœºæ™¯å’Œæ½œåŠ›ã€‚&quot;,
            &quot;additional_kwargs&quot;: &#123;
              &quot;refusal&quot;: null
            &#125;,
            &quot;response_metadata&quot;: &#123;
              &quot;token_usage&quot;: &#123;
                &quot;completion_tokens&quot;: 215,
                &quot;prompt_tokens&quot;: 645,
                &quot;total_tokens&quot;: 860,
                &quot;completion_tokens_details&quot;: null,
                &quot;prompt_tokens_details&quot;: null
              &#125;,
              &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
              &quot;system_fingerprint&quot;: &quot;&quot;,
              &quot;id&quot;: &quot;019b2aa70b2f88f618147d0e47344c38&quot;,
              &quot;service_tier&quot;: null,
              &quot;finish_reason&quot;: &quot;stop&quot;,
              &quot;logprobs&quot;: null
            &#125;,
            &quot;type&quot;: &quot;ai&quot;,
            &quot;id&quot;: &quot;run--f1ebd5d8-7d8d-41d8-8f04-82023ade770e-0&quot;,
            &quot;usage_metadata&quot;: &#123;
              &quot;input_tokens&quot;: 645,
              &quot;output_tokens&quot;: 215,
              &quot;total_tokens&quot;: 860,
              &quot;input_token_details&quot;: &#123;&#125;,
              &quot;output_token_details&quot;: &#123;&#125;
            &#125;,
            &quot;tool_calls&quot;: [],
            &quot;invalid_tool_calls&quot;: []
          &#125;
        &#125;
      &#125;
    ]
  ],
  &quot;llm_output&quot;: &#123;
    &quot;token_usage&quot;: &#123;
      &quot;completion_tokens&quot;: 215,
      &quot;prompt_tokens&quot;: 645,
      &quot;total_tokens&quot;: 860,
      &quot;completion_tokens_details&quot;: null,
      &quot;prompt_tokens_details&quot;: null
    &#125;,
    &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
    &quot;system_fingerprint&quot;: &quot;&quot;,
    &quot;id&quot;: &quot;019b2aa70b2f88f618147d0e47344c38&quot;,
    &quot;service_tier&quot;: null
  &#125;,
  &quot;run&quot;: null,
  &quot;type&quot;: &quot;LLMResult&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:LLMChain] [2.54s] Exiting Chain run with output:
[0m&#123;
  &quot;text&quot;: &quot;ä½ å¥½ï¼Œçš®çš®é²å’Œé²è¥¿è¥¿äº’è‡´é—®å€™å¹¶å†³å®šä¸€èµ·å»å†’é™©ã€‚ä»Šå¤©çš„æ—¥ç¨‹å®‰æ’åŒ…æ‹¬ä¸Šåˆ8ç‚¹ä¸äº§å“å›¢é˜Ÿçš„ä¼šè®®ï¼Œéœ€è¦å‡†å¤‡PPTï¼›ä¸Šåˆ9ç‚¹åˆ°12ç‚¹ä¸“æ³¨äºLangChainé¡¹ç›®ï¼Œå› ä¸ºLangChainæ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å·¥å…·ï¼Œä½¿å¾—é¡¹ç›®è¿›å±•è¿…é€Ÿï¼›ä¸­åˆåœ¨æ„å¤§åˆ©é¤å…ä¸ä¸€ä½å¼€è½¦æ¥çš„é¡¾å®¢ä¼šé¢ï¼Œé¡¾å®¢èµ°äº†ä¸€ä¸ªå¤šå°æ—¶çš„è·¯ç¨‹åªä¸ºäº†è§£æœ€æ–°çš„AIæŠ€æœ¯ï¼Œå¹¶ä¸”éœ€è¦å¸¦ä¸Šç¬”è®°æœ¬ç”µè„‘å±•ç¤ºæœ€æ–°çš„LLMæ ·ä¾‹ã€‚ä¸ºäº†ç»™é¡¾å®¢ç•™ä¸‹æ·±åˆ»å°è±¡å¹¶å±•ç¤ºæœ€æ–°çš„LLMæ ·ä¾‹ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸€äº›èƒ½å¤Ÿä½“ç°LangChainå’ŒLLMå¼ºå¤§åŠŸèƒ½å’Œæ½œåŠ›çš„ç¤ºä¾‹ï¼Œå¦‚å¯¹è¯ç”Ÿæˆã€çŸ¥è¯†å›¾è°±æ„å»ºã€ä»£ç ç”Ÿæˆã€å¤šè½®å¯¹è¯ç®¡ç†ã€æƒ…æ„Ÿåˆ†æã€å†…å®¹ç”Ÿæˆã€é—®ç­”ç³»ç»Ÿå’Œä»£ç è§£é‡Šä¸ä¼˜åŒ–ç­‰ã€‚é€‰æ‹©åˆé€‚çš„æ ·ä¾‹æ—¶ï¼Œå¯ä»¥æ ¹æ®é¡¾å®¢çš„å…·ä½“éœ€æ±‚å’Œå…´è¶£è¿›è¡Œè°ƒæ•´ï¼Œç¡®ä¿æ ·ä¾‹èƒ½å¤Ÿæ¸…æ™°åœ°å±•ç¤ºLangChainå’ŒLLMçš„ä¼˜åŠ¿ï¼Œå¹¶ä¸”æ˜“äºç†è§£ã€‚åŒæ—¶ï¼Œå‡†å¤‡å¥½è¯¦ç»†çš„è§£é‡Šå’ŒèƒŒæ™¯ä¿¡æ¯ï¼Œä»¥ä¾¿é¡¾å®¢èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£è¿™äº›æŠ€æœ¯çš„åº”ç”¨åœºæ™¯å’Œæ½œåŠ›ã€‚&quot;
&#125;

--- æ›´æ–°åçš„è®°å¿†çŠ¶æ€ ---
[SystemMessage(content=&#39;ä½ å¥½ï¼Œçš®çš®é²å’Œé²è¥¿è¥¿äº’è‡´é—®å€™å¹¶å†³å®šä¸€èµ·å»å†’é™©ã€‚ä»Šå¤©çš„æ—¥ç¨‹å®‰æ’åŒ…æ‹¬ä¸Šåˆ8ç‚¹ä¸äº§å“å›¢é˜Ÿçš„ä¼šè®®ï¼Œéœ€è¦å‡†å¤‡PPTï¼›ä¸Šåˆ9ç‚¹åˆ°12ç‚¹ä¸“æ³¨äºLangChainé¡¹ç›®ï¼Œå› ä¸ºLangChainæ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å·¥å…·ï¼Œä½¿å¾—é¡¹ç›®è¿›å±•è¿…é€Ÿï¼›ä¸­åˆåœ¨æ„å¤§åˆ©é¤å…ä¸ä¸€ä½å¼€è½¦æ¥çš„é¡¾å®¢ä¼šé¢ï¼Œé¡¾å®¢èµ°äº†ä¸€ä¸ªå¤šå°æ—¶çš„è·¯ç¨‹åªä¸ºäº†è§£æœ€æ–°çš„AIæŠ€æœ¯ï¼Œå¹¶ä¸”éœ€è¦å¸¦ä¸Šç¬”è®°æœ¬ç”µè„‘å±•ç¤ºæœ€æ–°çš„LLMæ ·ä¾‹ã€‚ä¸ºäº†ç»™é¡¾å®¢ç•™ä¸‹æ·±åˆ»å°è±¡å¹¶å±•ç¤ºæœ€æ–°çš„LLMæ ·ä¾‹ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸€äº›èƒ½å¤Ÿä½“ç°LangChainå’ŒLLMå¼ºå¤§åŠŸèƒ½å’Œæ½œåŠ›çš„ç¤ºä¾‹ï¼Œå¦‚å¯¹è¯ç”Ÿæˆã€çŸ¥è¯†å›¾è°±æ„å»ºã€ä»£ç ç”Ÿæˆã€å¤šè½®å¯¹è¯ç®¡ç†ã€æƒ…æ„Ÿåˆ†æã€å†…å®¹ç”Ÿæˆã€é—®ç­”ç³»ç»Ÿå’Œä»£ç è§£é‡Šä¸ä¼˜åŒ–ç­‰ã€‚é€‰æ‹©åˆé€‚çš„æ ·ä¾‹æ—¶ï¼Œå¯ä»¥æ ¹æ®é¡¾å®¢çš„å…·ä½“éœ€æ±‚å’Œå…´è¶£è¿›è¡Œè°ƒæ•´ï¼Œç¡®ä¿æ ·ä¾‹èƒ½å¤Ÿæ¸…æ™°åœ°å±•ç¤ºLangChainå’ŒLLMçš„ä¼˜åŠ¿ï¼Œå¹¶ä¸”æ˜“äºç†è§£ã€‚åŒæ—¶ï¼Œå‡†å¤‡å¥½è¯¦ç»†çš„è§£é‡Šå’ŒèƒŒæ™¯ä¿¡æ¯ï¼Œä»¥ä¾¿é¡¾å®¢èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£è¿™äº›æŠ€æœ¯çš„åº”ç”¨åœºæ™¯å’Œæ½œåŠ›ã€‚&#39;, additional_kwargs=&#123;&#125;, response_metadata=&#123;&#125;)]
</code></pre>
<p>[SystemMessage(content&#x3D;â€™ä½ å¥½ï¼Œçš®çš®é²å’Œé²è¥¿è¥¿äº’è‡´é—®å€™å¹¶å†³å®šä¸€èµ·å»å†’é™©ã€‚ä»Šå¤©çš„æ—¥ç¨‹å®‰æ’åŒ…æ‹¬ä¸Šåˆ8ç‚¹ä¸äº§å“å›¢é˜Ÿçš„ä¼šè®®ï¼Œéœ€è¦å‡†å¤‡PPTï¼›ä¸Šåˆ9ç‚¹åˆ°12ç‚¹ä¸“æ³¨äºLangChainé¡¹ç›®ï¼Œå› ä¸ºLangChainæ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å·¥å…·ï¼Œä½¿å¾—é¡¹ç›®è¿›å±•è¿…é€Ÿï¼›ä¸­åˆåœ¨æ„å¤§åˆ©é¤å…ä¸ä¸€ä½å¼€è½¦æ¥çš„é¡¾å®¢ä¼šé¢ï¼Œé¡¾å®¢èµ°äº†ä¸€ä¸ªå¤šå°æ—¶çš„è·¯ç¨‹åªä¸ºäº†è§£æœ€æ–°çš„AIæŠ€æœ¯ï¼Œå¹¶ä¸”éœ€è¦å¸¦ä¸Šç¬”è®°æœ¬ç”µè„‘å±•ç¤ºæœ€æ–°çš„LLMæ ·ä¾‹ã€‚ä¸ºäº†ç»™é¡¾å®¢ç•™ä¸‹æ·±åˆ»å°è±¡å¹¶å±•ç¤ºæœ€æ–°çš„LLMæ ·ä¾‹ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸€äº›èƒ½å¤Ÿä½“ç°LangChainå’ŒLLMå¼ºå¤§åŠŸèƒ½å’Œæ½œåŠ›çš„ç¤ºä¾‹ï¼Œå¦‚å¯¹è¯ç”Ÿæˆã€çŸ¥è¯†å›¾è°±æ„å»ºã€ä»£ç ç”Ÿæˆã€å¤šè½®å¯¹è¯ç®¡ç†ã€æƒ…æ„Ÿåˆ†æã€å†…å®¹ç”Ÿæˆã€é—®ç­”ç³»ç»Ÿå’Œä»£ç è§£é‡Šä¸ä¼˜åŒ–ç­‰ã€‚é€‰æ‹©åˆé€‚çš„æ ·ä¾‹æ—¶ï¼Œå¯ä»¥æ ¹æ®é¡¾å®¢çš„å…·ä½“éœ€æ±‚å’Œå…´è¶£è¿›è¡Œè°ƒæ•´ï¼Œç¡®ä¿æ ·ä¾‹èƒ½å¤Ÿæ¸…æ™°åœ°å±•ç¤ºLangChainå’ŒLLMçš„ä¼˜åŠ¿ï¼Œå¹¶ä¸”æ˜“äºç†è§£ã€‚åŒæ—¶ï¼Œå‡†å¤‡å¥½è¯¦ç»†çš„è§£é‡Šå’ŒèƒŒæ™¯ä¿¡æ¯ï¼Œä»¥ä¾¿é¡¾å®¢èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£è¿™äº›æŠ€æœ¯çš„åº”ç”¨åœºæ™¯å’Œæ½œåŠ›ã€‚â€™, additional_kwargs&#x3D;{}, response_metadata&#x3D;{})]</p>
<h2 id="å››ã€å¤§è¯­è¨€æ¨¡å‹é“¾ï¼ˆLLMChainï¼‰"><a href="#å››ã€å¤§è¯­è¨€æ¨¡å‹é“¾ï¼ˆLLMChainï¼‰" class="headerlink" title="å››ã€å¤§è¯­è¨€æ¨¡å‹é“¾ï¼ˆLLMChainï¼‰"></a>å››ã€å¤§è¯­è¨€æ¨¡å‹é“¾ï¼ˆLLMChainï¼‰</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><span class="hljs-comment"># å‡è®¾ tool æ¨¡å—å·²ç»é€‚é…äº†æ–°ç‰ˆï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ª BaseChatModel å®ä¾‹</span><br>sys.path.append(<span class="hljs-string">&#x27;/home/py/shared/StudyChatgpt&#x27;</span>)<br><span class="hljs-keyword">from</span> tool <span class="hljs-keyword">import</span> get_chat_model2<br><br><span class="hljs-comment"># 1. åˆå§‹åŒ–æ¨¡å‹</span><br>llm = get_chat_model2(temperature=<span class="hljs-number">0.0</span>)<br><br><span class="hljs-comment"># 2. å¯¼å…¥æ–°ç‰ˆç»„ä»¶</span><br><span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate<br><span class="hljs-keyword">from</span> langchain_core.output_parsers <span class="hljs-keyword">import</span> StrOutputParser <span class="hljs-comment"># ç”¨äºå°†æ¨¡å‹è¾“å‡ºçš„æ¶ˆæ¯å¯¹è±¡è½¬ä¸ºå­—ç¬¦ä¸²</span><br><br><span class="hljs-comment"># 3. åˆå§‹åŒ–æç¤ºæ¨¡ç‰ˆ (è¯­æ³•ä¸å˜)</span><br>prompt = ChatPromptTemplate.from_template(<span class="hljs-string">&quot;æè¿°åˆ¶é€ &#123;product&#125;çš„ä¸€ä¸ªå…¬å¸çš„æœ€ä½³åç§°æ˜¯ä»€ä¹ˆ?&quot;</span>)<br><br><span class="hljs-comment"># 4. æ„å»ºå¤§è¯­è¨€æ¨¡å‹é“¾ (LCEL é£æ ¼)</span><br><span class="hljs-comment"># æµç¨‹ï¼šPrompt -&gt; LLM -&gt; OutputParser (æŠŠ Message è½¬ä¸º String)</span><br>chain = prompt | llm | StrOutputParser()<br><br><span class="hljs-comment"># 5. è¿è¡Œé“¾</span><br><span class="hljs-comment"># æ ¸å¿ƒå˜åŒ–ï¼šä½¿ç”¨ .invoke() æ›¿ä»£ .run()ï¼Œä¸”å‚æ•°é€šå¸¸ä»¥å­—å…¸å½¢å¼ä¼ å…¥</span><br>product = <span class="hljs-string">&quot;å¤§å·åºŠå•å¥—è£…&quot;</span><br>response = chain.invoke(&#123;<span class="hljs-string">&quot;product&quot;</span>: product&#125;)<br><br><span class="hljs-built_in">print</span>(response)<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence] Entering Chain run with input:
[0m&#123;
  &quot;product&quot;: &quot;å¤§å·åºŠå•å¥—è£…&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; prompt:ChatPromptTemplate] Entering Prompt run with input:
[0m&#123;
  &quot;product&quot;: &quot;å¤§å·åºŠå•å¥—è£…&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; prompt:ChatPromptTemplate] [1ms] Exiting Prompt run with output:
[0m[outputs]
[32;1m[1;3m[llm/start][0m [1m[chain:RunnableSequence &gt; llm:ChatOpenAI] Entering LLM run with input:
[0m&#123;
  &quot;prompts&quot;: [
    &quot;Human: æè¿°åˆ¶é€ å¤§å·åºŠå•å¥—è£…çš„ä¸€ä¸ªå…¬å¸çš„æœ€ä½³åç§°æ˜¯ä»€ä¹ˆ?&quot;
  ]
&#125;


[36;1m[1;3m[llm/end][0m [1m[chain:RunnableSequence &gt; llm:ChatOpenAI] [10.19s] Exiting LLM run with output:
[0m&#123;
  &quot;generations&quot;: [
    [
      &#123;
        &quot;text&quot;: &quot;ä¸ºåˆ¶é€ å¤§å·åºŠå•å¥—è£…çš„å…¬å¸é€‰æ‹©ä¸€ä¸ªåç§°æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ¥ç¡®ä¿åç§°æ—¢å¸å¼•äººåˆå…·æœ‰å¸‚åœºç«äº‰åŠ›ï¼š\n\n1. **å“ç‰Œå®šä½**ï¼šé¦–å…ˆæ˜ç¡®å…¬å¸çš„å“ç‰Œå®šä½ï¼Œæ˜¯é«˜ç«¯å¥¢åã€ç®€çº¦å®ç”¨è¿˜æ˜¯ç¯ä¿è‡ªç„¶ç­‰ã€‚è¿™å°†ç›´æ¥å½±å“åç§°çš„é€‰æ‹©ã€‚\n\n2. **ç›®æ ‡å®¢æˆ·ç¾¤ä½“**ï¼šäº†è§£ç›®æ ‡å®¢æˆ·ç¾¤ä½“çš„éœ€æ±‚å’Œåå¥½ï¼Œé€‰æ‹©èƒ½å¤Ÿå¸å¼•ä»–ä»¬çš„åç§°ã€‚\n\n3. **æ˜“äºè®°å¿†å’Œå‘éŸ³**ï¼šä¸€ä¸ªå¥½çš„å…¬å¸åç§°åº”è¯¥å®¹æ˜“è®°å¿†å’Œå‘éŸ³ï¼Œä¾¿äºå®¢æˆ·ä¼ æ’­å’Œè®°å¿†ã€‚\n\n4. **ç‹¬ç‰¹æ€§**ï¼šç¡®ä¿åç§°å…·æœ‰ä¸€å®šçš„ç‹¬ç‰¹æ€§ï¼Œé¿å…ä¸å¸‚åœºä¸Šå·²æœ‰çš„å“ç‰Œåç§°è¿‡äºç›¸ä¼¼ï¼Œä»¥å‡å°‘æ··æ·†ã€‚\n\n5. **æ–‡åŒ–é€‚åº”æ€§**ï¼šè€ƒè™‘åˆ°å…¬å¸å¯èƒ½é¢å‘çš„å›½é™…å¸‚åœºï¼Œåç§°åº”å…·æœ‰ä¸€å®šçš„æ–‡åŒ–é€‚åº”æ€§ï¼Œé¿å…ä½¿ç”¨å¯èƒ½å¼•èµ·è¯¯è§£æˆ–è´Ÿé¢è”æƒ³çš„è¯æ±‡ã€‚\n\nåŸºäºä»¥ä¸Šå‡ ç‚¹ï¼Œè¿™é‡Œæä¾›å‡ ä¸ªç¤ºä¾‹åç§°ä¾›å‚è€ƒï¼š\n\n- **â€œå¤§åºŠä¹‹é€‰â€**ï¼šå¼ºè°ƒäº§å“é€‚åˆå¤§å·åºŠï¼Œç®€æ´æ˜äº†ã€‚\n- **â€œå·¨åŒ åºŠå“â€**ï¼šçªå‡ºäº§å“çš„é«˜å“è´¨å’Œä¸“ä¸šæ€§ã€‚\n- **â€œå®½èˆ’åºŠè‰ºâ€**ï¼šç»“åˆäº†â€œå¤§å·åºŠâ€çš„ç‰¹ç‚¹å’Œè‰ºæœ¯æ„Ÿï¼Œé€‚åˆè¿½æ±‚å“è´¨ç”Ÿæ´»çš„æ¶ˆè´¹è€…ã€‚\n- **â€œå·¨åºŠå°šå“â€**ï¼šç»“åˆäº†â€œå¤§å·åºŠâ€å’Œâ€œé«˜ç«¯â€çš„æ¦‚å¿µï¼Œé€‚åˆé«˜ç«¯å¸‚åœºã€‚\n- **â€œå®½åºŠä¹‹é€‰â€**ï¼šç®€æ´ç›´æ¥ï¼Œå¼ºè°ƒé€‚åˆå¤§å·åºŠã€‚\n\næœ€ç»ˆé€‰æ‹©å“ªä¸ªåç§°ï¼Œè¿˜éœ€è¦ç»“åˆå…¬å¸çš„å…·ä½“å®šä½ã€ç›®æ ‡å¸‚åœºç­‰å› ç´ ç»¼åˆè€ƒè™‘ã€‚å¸Œæœ›è¿™äº›å»ºè®®å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼&quot;,
        &quot;generation_info&quot;: &#123;
          &quot;finish_reason&quot;: &quot;stop&quot;,
          &quot;logprobs&quot;: null
        &#125;,
        &quot;type&quot;: &quot;ChatGeneration&quot;,
        &quot;message&quot;: &#123;
          &quot;lc&quot;: 1,
          &quot;type&quot;: &quot;constructor&quot;,
          &quot;id&quot;: [
            &quot;langchain&quot;,
            &quot;schema&quot;,
            &quot;messages&quot;,
            &quot;AIMessage&quot;
          ],
          &quot;kwargs&quot;: &#123;
            &quot;content&quot;: &quot;ä¸ºåˆ¶é€ å¤§å·åºŠå•å¥—è£…çš„å…¬å¸é€‰æ‹©ä¸€ä¸ªåç§°æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ¥ç¡®ä¿åç§°æ—¢å¸å¼•äººåˆå…·æœ‰å¸‚åœºç«äº‰åŠ›ï¼š\n\n1. **å“ç‰Œå®šä½**ï¼šé¦–å…ˆæ˜ç¡®å…¬å¸çš„å“ç‰Œå®šä½ï¼Œæ˜¯é«˜ç«¯å¥¢åã€ç®€çº¦å®ç”¨è¿˜æ˜¯ç¯ä¿è‡ªç„¶ç­‰ã€‚è¿™å°†ç›´æ¥å½±å“åç§°çš„é€‰æ‹©ã€‚\n\n2. **ç›®æ ‡å®¢æˆ·ç¾¤ä½“**ï¼šäº†è§£ç›®æ ‡å®¢æˆ·ç¾¤ä½“çš„éœ€æ±‚å’Œåå¥½ï¼Œé€‰æ‹©èƒ½å¤Ÿå¸å¼•ä»–ä»¬çš„åç§°ã€‚\n\n3. **æ˜“äºè®°å¿†å’Œå‘éŸ³**ï¼šä¸€ä¸ªå¥½çš„å…¬å¸åç§°åº”è¯¥å®¹æ˜“è®°å¿†å’Œå‘éŸ³ï¼Œä¾¿äºå®¢æˆ·ä¼ æ’­å’Œè®°å¿†ã€‚\n\n4. **ç‹¬ç‰¹æ€§**ï¼šç¡®ä¿åç§°å…·æœ‰ä¸€å®šçš„ç‹¬ç‰¹æ€§ï¼Œé¿å…ä¸å¸‚åœºä¸Šå·²æœ‰çš„å“ç‰Œåç§°è¿‡äºç›¸ä¼¼ï¼Œä»¥å‡å°‘æ··æ·†ã€‚\n\n5. **æ–‡åŒ–é€‚åº”æ€§**ï¼šè€ƒè™‘åˆ°å…¬å¸å¯èƒ½é¢å‘çš„å›½é™…å¸‚åœºï¼Œåç§°åº”å…·æœ‰ä¸€å®šçš„æ–‡åŒ–é€‚åº”æ€§ï¼Œé¿å…ä½¿ç”¨å¯èƒ½å¼•èµ·è¯¯è§£æˆ–è´Ÿé¢è”æƒ³çš„è¯æ±‡ã€‚\n\nåŸºäºä»¥ä¸Šå‡ ç‚¹ï¼Œè¿™é‡Œæä¾›å‡ ä¸ªç¤ºä¾‹åç§°ä¾›å‚è€ƒï¼š\n\n- **â€œå¤§åºŠä¹‹é€‰â€**ï¼šå¼ºè°ƒäº§å“é€‚åˆå¤§å·åºŠï¼Œç®€æ´æ˜äº†ã€‚\n- **â€œå·¨åŒ åºŠå“â€**ï¼šçªå‡ºäº§å“çš„é«˜å“è´¨å’Œä¸“ä¸šæ€§ã€‚\n- **â€œå®½èˆ’åºŠè‰ºâ€**ï¼šç»“åˆäº†â€œå¤§å·åºŠâ€çš„ç‰¹ç‚¹å’Œè‰ºæœ¯æ„Ÿï¼Œé€‚åˆè¿½æ±‚å“è´¨ç”Ÿæ´»çš„æ¶ˆè´¹è€…ã€‚\n- **â€œå·¨åºŠå°šå“â€**ï¼šç»“åˆäº†â€œå¤§å·åºŠâ€å’Œâ€œé«˜ç«¯â€çš„æ¦‚å¿µï¼Œé€‚åˆé«˜ç«¯å¸‚åœºã€‚\n- **â€œå®½åºŠä¹‹é€‰â€**ï¼šç®€æ´ç›´æ¥ï¼Œå¼ºè°ƒé€‚åˆå¤§å·åºŠã€‚\n\næœ€ç»ˆé€‰æ‹©å“ªä¸ªåç§°ï¼Œè¿˜éœ€è¦ç»“åˆå…¬å¸çš„å…·ä½“å®šä½ã€ç›®æ ‡å¸‚åœºç­‰å› ç´ ç»¼åˆè€ƒè™‘ã€‚å¸Œæœ›è¿™äº›å»ºè®®å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼&quot;,
            &quot;additional_kwargs&quot;: &#123;
              &quot;refusal&quot;: null
            &#125;,
            &quot;response_metadata&quot;: &#123;
              &quot;token_usage&quot;: &#123;
                &quot;completion_tokens&quot;: 317,
                &quot;prompt_tokens&quot;: 42,
                &quot;total_tokens&quot;: 359,
                &quot;completion_tokens_details&quot;: null,
                &quot;prompt_tokens_details&quot;: null
              &#125;,
              &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
              &quot;system_fingerprint&quot;: &quot;&quot;,
              &quot;id&quot;: &quot;019b2b5681d30b76ad2767dc94cb3a57&quot;,
              &quot;service_tier&quot;: null,
              &quot;finish_reason&quot;: &quot;stop&quot;,
              &quot;logprobs&quot;: null
            &#125;,
            &quot;type&quot;: &quot;ai&quot;,
            &quot;id&quot;: &quot;run--54d4ae4f-8312-4772-8641-4843d1ea0b28-0&quot;,
            &quot;usage_metadata&quot;: &#123;
              &quot;input_tokens&quot;: 42,
              &quot;output_tokens&quot;: 317,
              &quot;total_tokens&quot;: 359,
              &quot;input_token_details&quot;: &#123;&#125;,
              &quot;output_token_details&quot;: &#123;&#125;
            &#125;,
            &quot;tool_calls&quot;: [],
            &quot;invalid_tool_calls&quot;: []
          &#125;
        &#125;
      &#125;
    ]
  ],
  &quot;llm_output&quot;: &#123;
    &quot;token_usage&quot;: &#123;
      &quot;completion_tokens&quot;: 317,
      &quot;prompt_tokens&quot;: 42,
      &quot;total_tokens&quot;: 359,
      &quot;completion_tokens_details&quot;: null,
      &quot;prompt_tokens_details&quot;: null
    &#125;,
    &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
    &quot;system_fingerprint&quot;: &quot;&quot;,
    &quot;id&quot;: &quot;019b2b5681d30b76ad2767dc94cb3a57&quot;,
    &quot;service_tier&quot;: null
  &#125;,
  &quot;run&quot;: null,
  &quot;type&quot;: &quot;LLMResult&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; parser:StrOutputParser] Entering Parser run with input:
[0m[inputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; parser:StrOutputParser] [0ms] Exiting Parser run with output:
[0m&#123;
  &quot;output&quot;: &quot;ä¸ºåˆ¶é€ å¤§å·åºŠå•å¥—è£…çš„å…¬å¸é€‰æ‹©ä¸€ä¸ªåç§°æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ¥ç¡®ä¿åç§°æ—¢å¸å¼•äººåˆå…·æœ‰å¸‚åœºç«äº‰åŠ›ï¼š\n\n1. **å“ç‰Œå®šä½**ï¼šé¦–å…ˆæ˜ç¡®å…¬å¸çš„å“ç‰Œå®šä½ï¼Œæ˜¯é«˜ç«¯å¥¢åã€ç®€çº¦å®ç”¨è¿˜æ˜¯ç¯ä¿è‡ªç„¶ç­‰ã€‚è¿™å°†ç›´æ¥å½±å“åç§°çš„é€‰æ‹©ã€‚\n\n2. **ç›®æ ‡å®¢æˆ·ç¾¤ä½“**ï¼šäº†è§£ç›®æ ‡å®¢æˆ·ç¾¤ä½“çš„éœ€æ±‚å’Œåå¥½ï¼Œé€‰æ‹©èƒ½å¤Ÿå¸å¼•ä»–ä»¬çš„åç§°ã€‚\n\n3. **æ˜“äºè®°å¿†å’Œå‘éŸ³**ï¼šä¸€ä¸ªå¥½çš„å…¬å¸åç§°åº”è¯¥å®¹æ˜“è®°å¿†å’Œå‘éŸ³ï¼Œä¾¿äºå®¢æˆ·ä¼ æ’­å’Œè®°å¿†ã€‚\n\n4. **ç‹¬ç‰¹æ€§**ï¼šç¡®ä¿åç§°å…·æœ‰ä¸€å®šçš„ç‹¬ç‰¹æ€§ï¼Œé¿å…ä¸å¸‚åœºä¸Šå·²æœ‰çš„å“ç‰Œåç§°è¿‡äºç›¸ä¼¼ï¼Œä»¥å‡å°‘æ··æ·†ã€‚\n\n5. **æ–‡åŒ–é€‚åº”æ€§**ï¼šè€ƒè™‘åˆ°å…¬å¸å¯èƒ½é¢å‘çš„å›½é™…å¸‚åœºï¼Œåç§°åº”å…·æœ‰ä¸€å®šçš„æ–‡åŒ–é€‚åº”æ€§ï¼Œé¿å…ä½¿ç”¨å¯èƒ½å¼•èµ·è¯¯è§£æˆ–è´Ÿé¢è”æƒ³çš„è¯æ±‡ã€‚\n\nåŸºäºä»¥ä¸Šå‡ ç‚¹ï¼Œè¿™é‡Œæä¾›å‡ ä¸ªç¤ºä¾‹åç§°ä¾›å‚è€ƒï¼š\n\n- **â€œå¤§åºŠä¹‹é€‰â€**ï¼šå¼ºè°ƒäº§å“é€‚åˆå¤§å·åºŠï¼Œç®€æ´æ˜äº†ã€‚\n- **â€œå·¨åŒ åºŠå“â€**ï¼šçªå‡ºäº§å“çš„é«˜å“è´¨å’Œä¸“ä¸šæ€§ã€‚\n- **â€œå®½èˆ’åºŠè‰ºâ€**ï¼šç»“åˆäº†â€œå¤§å·åºŠâ€çš„ç‰¹ç‚¹å’Œè‰ºæœ¯æ„Ÿï¼Œé€‚åˆè¿½æ±‚å“è´¨ç”Ÿæ´»çš„æ¶ˆè´¹è€…ã€‚\n- **â€œå·¨åºŠå°šå“â€**ï¼šç»“åˆäº†â€œå¤§å·åºŠâ€å’Œâ€œé«˜ç«¯â€çš„æ¦‚å¿µï¼Œé€‚åˆé«˜ç«¯å¸‚åœºã€‚\n- **â€œå®½åºŠä¹‹é€‰â€**ï¼šç®€æ´ç›´æ¥ï¼Œå¼ºè°ƒé€‚åˆå¤§å·åºŠã€‚\n\næœ€ç»ˆé€‰æ‹©å“ªä¸ªåç§°ï¼Œè¿˜éœ€è¦ç»“åˆå…¬å¸çš„å…·ä½“å®šä½ã€ç›®æ ‡å¸‚åœºç­‰å› ç´ ç»¼åˆè€ƒè™‘ã€‚å¸Œæœ›è¿™äº›å»ºè®®å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence] [10.19s] Exiting Chain run with output:
[0m&#123;
  &quot;output&quot;: &quot;ä¸ºåˆ¶é€ å¤§å·åºŠå•å¥—è£…çš„å…¬å¸é€‰æ‹©ä¸€ä¸ªåç§°æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ¥ç¡®ä¿åç§°æ—¢å¸å¼•äººåˆå…·æœ‰å¸‚åœºç«äº‰åŠ›ï¼š\n\n1. **å“ç‰Œå®šä½**ï¼šé¦–å…ˆæ˜ç¡®å…¬å¸çš„å“ç‰Œå®šä½ï¼Œæ˜¯é«˜ç«¯å¥¢åã€ç®€çº¦å®ç”¨è¿˜æ˜¯ç¯ä¿è‡ªç„¶ç­‰ã€‚è¿™å°†ç›´æ¥å½±å“åç§°çš„é€‰æ‹©ã€‚\n\n2. **ç›®æ ‡å®¢æˆ·ç¾¤ä½“**ï¼šäº†è§£ç›®æ ‡å®¢æˆ·ç¾¤ä½“çš„éœ€æ±‚å’Œåå¥½ï¼Œé€‰æ‹©èƒ½å¤Ÿå¸å¼•ä»–ä»¬çš„åç§°ã€‚\n\n3. **æ˜“äºè®°å¿†å’Œå‘éŸ³**ï¼šä¸€ä¸ªå¥½çš„å…¬å¸åç§°åº”è¯¥å®¹æ˜“è®°å¿†å’Œå‘éŸ³ï¼Œä¾¿äºå®¢æˆ·ä¼ æ’­å’Œè®°å¿†ã€‚\n\n4. **ç‹¬ç‰¹æ€§**ï¼šç¡®ä¿åç§°å…·æœ‰ä¸€å®šçš„ç‹¬ç‰¹æ€§ï¼Œé¿å…ä¸å¸‚åœºä¸Šå·²æœ‰çš„å“ç‰Œåç§°è¿‡äºç›¸ä¼¼ï¼Œä»¥å‡å°‘æ··æ·†ã€‚\n\n5. **æ–‡åŒ–é€‚åº”æ€§**ï¼šè€ƒè™‘åˆ°å…¬å¸å¯èƒ½é¢å‘çš„å›½é™…å¸‚åœºï¼Œåç§°åº”å…·æœ‰ä¸€å®šçš„æ–‡åŒ–é€‚åº”æ€§ï¼Œé¿å…ä½¿ç”¨å¯èƒ½å¼•èµ·è¯¯è§£æˆ–è´Ÿé¢è”æƒ³çš„è¯æ±‡ã€‚\n\nåŸºäºä»¥ä¸Šå‡ ç‚¹ï¼Œè¿™é‡Œæä¾›å‡ ä¸ªç¤ºä¾‹åç§°ä¾›å‚è€ƒï¼š\n\n- **â€œå¤§åºŠä¹‹é€‰â€**ï¼šå¼ºè°ƒäº§å“é€‚åˆå¤§å·åºŠï¼Œç®€æ´æ˜äº†ã€‚\n- **â€œå·¨åŒ åºŠå“â€**ï¼šçªå‡ºäº§å“çš„é«˜å“è´¨å’Œä¸“ä¸šæ€§ã€‚\n- **â€œå®½èˆ’åºŠè‰ºâ€**ï¼šç»“åˆäº†â€œå¤§å·åºŠâ€çš„ç‰¹ç‚¹å’Œè‰ºæœ¯æ„Ÿï¼Œé€‚åˆè¿½æ±‚å“è´¨ç”Ÿæ´»çš„æ¶ˆè´¹è€…ã€‚\n- **â€œå·¨åºŠå°šå“â€**ï¼šç»“åˆäº†â€œå¤§å·åºŠâ€å’Œâ€œé«˜ç«¯â€çš„æ¦‚å¿µï¼Œé€‚åˆé«˜ç«¯å¸‚åœºã€‚\n- **â€œå®½åºŠä¹‹é€‰â€**ï¼šç®€æ´ç›´æ¥ï¼Œå¼ºè°ƒé€‚åˆå¤§å·åºŠã€‚\n\næœ€ç»ˆé€‰æ‹©å“ªä¸ªåç§°ï¼Œè¿˜éœ€è¦ç»“åˆå…¬å¸çš„å…·ä½“å®šä½ã€ç›®æ ‡å¸‚åœºç­‰å› ç´ ç»¼åˆè€ƒè™‘ã€‚å¸Œæœ›è¿™äº›å»ºè®®å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼&quot;
&#125;
ä¸ºåˆ¶é€ å¤§å·åºŠå•å¥—è£…çš„å…¬å¸é€‰æ‹©ä¸€ä¸ªåç§°æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ¥ç¡®ä¿åç§°æ—¢å¸å¼•äººåˆå…·æœ‰å¸‚åœºç«äº‰åŠ›ï¼š

1. **å“ç‰Œå®šä½**ï¼šé¦–å…ˆæ˜ç¡®å…¬å¸çš„å“ç‰Œå®šä½ï¼Œæ˜¯é«˜ç«¯å¥¢åã€ç®€çº¦å®ç”¨è¿˜æ˜¯ç¯ä¿è‡ªç„¶ç­‰ã€‚è¿™å°†ç›´æ¥å½±å“åç§°çš„é€‰æ‹©ã€‚

2. **ç›®æ ‡å®¢æˆ·ç¾¤ä½“**ï¼šäº†è§£ç›®æ ‡å®¢æˆ·ç¾¤ä½“çš„éœ€æ±‚å’Œåå¥½ï¼Œé€‰æ‹©èƒ½å¤Ÿå¸å¼•ä»–ä»¬çš„åç§°ã€‚

3. **æ˜“äºè®°å¿†å’Œå‘éŸ³**ï¼šä¸€ä¸ªå¥½çš„å…¬å¸åç§°åº”è¯¥å®¹æ˜“è®°å¿†å’Œå‘éŸ³ï¼Œä¾¿äºå®¢æˆ·ä¼ æ’­å’Œè®°å¿†ã€‚

4. **ç‹¬ç‰¹æ€§**ï¼šç¡®ä¿åç§°å…·æœ‰ä¸€å®šçš„ç‹¬ç‰¹æ€§ï¼Œé¿å…ä¸å¸‚åœºä¸Šå·²æœ‰çš„å“ç‰Œåç§°è¿‡äºç›¸ä¼¼ï¼Œä»¥å‡å°‘æ··æ·†ã€‚

5. **æ–‡åŒ–é€‚åº”æ€§**ï¼šè€ƒè™‘åˆ°å…¬å¸å¯èƒ½é¢å‘çš„å›½é™…å¸‚åœºï¼Œåç§°åº”å…·æœ‰ä¸€å®šçš„æ–‡åŒ–é€‚åº”æ€§ï¼Œé¿å…ä½¿ç”¨å¯èƒ½å¼•èµ·è¯¯è§£æˆ–è´Ÿé¢è”æƒ³çš„è¯æ±‡ã€‚

åŸºäºä»¥ä¸Šå‡ ç‚¹ï¼Œè¿™é‡Œæä¾›å‡ ä¸ªç¤ºä¾‹åç§°ä¾›å‚è€ƒï¼š

- **â€œå¤§åºŠä¹‹é€‰â€**ï¼šå¼ºè°ƒäº§å“é€‚åˆå¤§å·åºŠï¼Œç®€æ´æ˜äº†ã€‚
- **â€œå·¨åŒ åºŠå“â€**ï¼šçªå‡ºäº§å“çš„é«˜å“è´¨å’Œä¸“ä¸šæ€§ã€‚
- **â€œå®½èˆ’åºŠè‰ºâ€**ï¼šç»“åˆäº†â€œå¤§å·åºŠâ€çš„ç‰¹ç‚¹å’Œè‰ºæœ¯æ„Ÿï¼Œé€‚åˆè¿½æ±‚å“è´¨ç”Ÿæ´»çš„æ¶ˆè´¹è€…ã€‚
- **â€œå·¨åºŠå°šå“â€**ï¼šç»“åˆäº†â€œå¤§å·åºŠâ€å’Œâ€œé«˜ç«¯â€çš„æ¦‚å¿µï¼Œé€‚åˆé«˜ç«¯å¸‚åœºã€‚
- **â€œå®½åºŠä¹‹é€‰â€**ï¼šç®€æ´ç›´æ¥ï¼Œå¼ºè°ƒé€‚åˆå¤§å·åºŠã€‚

æœ€ç»ˆé€‰æ‹©å“ªä¸ªåç§°ï¼Œè¿˜éœ€è¦ç»“åˆå…¬å¸çš„å…·ä½“å®šä½ã€ç›®æ ‡å¸‚åœºç­‰å› ç´ ç»¼åˆè€ƒè™‘ã€‚å¸Œæœ›è¿™äº›å»ºè®®å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼
</code></pre>
<h3 id="äºŒã€ç®€å•é¡ºåºé“¾"><a href="#äºŒã€ç®€å•é¡ºåºé“¾" class="headerlink" title="äºŒã€ç®€å•é¡ºåºé“¾"></a>äºŒã€ç®€å•é¡ºåºé“¾</h3><p>åˆ©ç”¨ç®¡é“ç¬¦ | ç›´æ¥ä¸²è”ã€‚ç”±äºç¬¬äºŒä¸ª prompt éœ€è¦å˜é‡åï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸­é—´åšä¸€ä¸ªç®€å•çš„å­—å…¸æ˜ å°„ã€‚<br>RunnablePassthrough.assign(â€¦) æ˜¯å¤„ç†å¤šå˜é‡é“¾çš„ç¥å™¨ã€‚å®ƒæ¥æ”¶ä¸Šä¸€æ­¥çš„å­—å…¸ï¼Œæ‰§è¡Œä½ å®šä¹‰çš„é€»è¾‘ï¼ŒæŠŠç»“æœå­˜å…¥æ–° Keyï¼Œç„¶åæŠŠåˆå¹¶åçš„å­—å…¸ä¼ ç»™ä¸‹ä¸€æ­¥ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br>sys.path.append(<span class="hljs-string">&#x27;/home/py/shared/StudyChatgpt&#x27;</span>)<br><span class="hljs-keyword">from</span> tool <span class="hljs-keyword">import</span> get_chat_model2<br><br><span class="hljs-comment"># 1. åˆå§‹åŒ–æ¨¡å‹</span><br>llm = get_chat_model2(temperature=<span class="hljs-number">0.0</span>)<br><br><span class="hljs-comment"># 2. å¯¼å…¥ v0.3 æ ¸å¿ƒç»„ä»¶</span><br><span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate<br><span class="hljs-keyword">from</span> langchain_core.output_parsers <span class="hljs-keyword">import</span> StrOutputParser<br><span class="hljs-keyword">from</span> langchain_core.runnables <span class="hljs-keyword">import</span> RunnablePassthrough, RunnableLambda<br><br><span class="hljs-comment"># ç”¨äºè°ƒè¯•æ‰“å°</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">print_step</span>(<span class="hljs-params">output</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;--- Step Output: <span class="hljs-subst">&#123;output&#125;</span> ---&quot;</span>)<br>    <span class="hljs-keyword">return</span> output<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;=== 2. ç®€å•é¡ºåºé“¾ (LCELç‰ˆ) ===&quot;</span>)<br><br><span class="hljs-comment"># æ­¥éª¤ 1ï¼šç”Ÿæˆå…¬å¸åç§°</span><br>prompt1 = ChatPromptTemplate.from_template(<span class="hljs-string">&quot;æè¿°åˆ¶é€ &#123;product&#125;çš„ä¸€ä¸ªå…¬å¸çš„æœ€å¥½çš„åç§°æ˜¯ä»€ä¹ˆ&quot;</span>)<br><span class="hljs-comment"># è¿™ä¸ªé“¾ä¼šè¾“å‡ºçº¯å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ &quot;ä¼˜åºŠåˆ¶é€ å…¬å¸&quot;</span><br>chain_one = prompt1 | llm | StrOutputParser()<br><br><span class="hljs-comment"># æ­¥éª¤ 2ï¼šç”Ÿæˆæè¿°</span><br>prompt2 = ChatPromptTemplate.from_template(<span class="hljs-string">&quot;å†™ä¸€ä¸ª20å­—çš„æè¿°å¯¹äºä¸‹é¢è¿™ä¸ªå…¬å¸ï¼š&#123;company_name&#125;çš„&quot;</span>)<br><span class="hljs-comment"># è¿™é‡Œä¸éœ€è¦å®šä¹‰ chain_twoï¼Œæˆ‘ä»¬ç›´æ¥ç»„åˆ</span><br><br><span class="hljs-comment"># ç»„åˆé“¾</span><br><span class="hljs-comment"># é€»è¾‘ï¼šè¾“å…¥ &#123;&quot;product&quot;: &quot;...&quot;&#125; -&gt; chain_one ç®—å‡ºåå­— -&gt; ä¼ ç»™ prompt2 çš„ company_name</span><br>overall_simple_chain = (<br>    &#123;<span class="hljs-string">&quot;company_name&quot;</span>: chain_one&#125; | prompt2 | llm | StrOutputParser()<br>)<br><br><span class="hljs-comment"># è¿è¡Œ</span><br>product = <span class="hljs-string">&quot;å¤§å·åºŠå•å¥—è£…&quot;</span><br>result = overall_simple_chain.invoke(&#123;<span class="hljs-string">&quot;product&quot;</span>: product&#125;)<br><span class="hljs-built_in">print</span>(result)<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">=== 2. ç®€å•é¡ºåºé“¾ (LCELç‰ˆ) ===
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence] Entering Chain run with input:
[0m&#123;
  &quot;product&quot;: &quot;å¤§å·åºŠå•å¥—è£…&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableParallel&lt;company_name&gt;] Entering Chain run with input:
[0m&#123;
  &quot;product&quot;: &quot;å¤§å·åºŠå•å¥—è£…&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableParallel&lt;company_name&gt; &gt; chain:RunnableSequence] Entering Chain run with input:
[0m&#123;
  &quot;product&quot;: &quot;å¤§å·åºŠå•å¥—è£…&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableParallel&lt;company_name&gt; &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] Entering Prompt run with input:
[0m&#123;
  &quot;product&quot;: &quot;å¤§å·åºŠå•å¥—è£…&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableParallel&lt;company_name&gt; &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] [0ms] Exiting Prompt run with output:
[0m[outputs]
[32;1m[1;3m[llm/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableParallel&lt;company_name&gt; &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] Entering LLM run with input:
[0m&#123;
  &quot;prompts&quot;: [
    &quot;Human: æè¿°åˆ¶é€ å¤§å·åºŠå•å¥—è£…çš„ä¸€ä¸ªå…¬å¸çš„æœ€å¥½çš„åç§°æ˜¯ä»€ä¹ˆ&quot;
  ]
&#125;
[36;1m[1;3m[llm/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableParallel&lt;company_name&gt; &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] [2.85s] Exiting LLM run with output:
[0m&#123;
  &quot;generations&quot;: [
    [
      &#123;
        &quot;text&quot;: &quot;ä¸ºä¸€å®¶åˆ¶é€ å¤§å·åºŠå•å¥—è£…çš„å…¬å¸é€‰æ‹©ä¸€ä¸ªåç§°æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼šå“ç‰Œå®šä½ã€ç›®æ ‡å¸‚åœºã€äº§å“ç‰¹è‰²ä»¥åŠæ˜“äºè®°å¿†å’Œå‘éŸ³ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å»ºè®®çš„åç§°ï¼š\n\n1. **GrandSleep** - å¼ºè°ƒâ€œå¤§å·â€å’Œâ€œç¡çœ â€ï¼Œé€‚åˆè¿½æ±‚é«˜å“è´¨ç¡çœ ä½“éªŒçš„æ¶ˆè´¹è€…ã€‚\n2. **ComfortBeds** - ç»“åˆäº†â€œèˆ’é€‚â€å’Œâ€œåºŠâ€çš„æ¦‚å¿µï¼Œä¼ è¾¾å‡ºäº§å“çš„èˆ’é€‚æ€§å’Œè´¨é‡ã€‚\n3. **LuxeLinen** - â€œLuxeâ€ä»£è¡¨å¥¢åï¼Œâ€œLinenâ€ä»£è¡¨åºŠå•ï¼Œé€‚åˆé«˜ç«¯å¸‚åœºã€‚\n4. **BigBedBoutique** - å¼ºè°ƒâ€œå¤§å·åºŠâ€å’Œâ€œç²¾å“åº—â€ï¼Œé€‚åˆæ³¨é‡ä¸ªæ€§åŒ–å’Œè®¾è®¡æ„Ÿçš„æ¶ˆè´¹è€…ã€‚\n5. **SleepGiant** - ç»“åˆâ€œç¡çœ â€å’Œâ€œå·¨äººâ€ï¼Œä¼ è¾¾å‡ºäº§å“çš„å¼ºå¤§å’Œèˆ’é€‚ã€‚\n6. **EpicSheets** - â€œEpicâ€æœ‰å²è¯—èˆ¬çš„æ„å‘³ï¼Œé€‚åˆè¿½æ±‚ç‹¬ç‰¹å’Œé«˜å“è´¨çš„æ¶ˆè´¹è€…ã€‚\n7. **CozyCove** - â€œCozyâ€ä»£è¡¨èˆ’é€‚ï¼Œâ€œCoveâ€æœ‰å°æµ·æ¹¾çš„æ„æ€ï¼Œé€‚åˆè¥é€ æ¸©é¦¨èˆ’é€‚çš„ç¡çœ ç¯å¢ƒã€‚\n8. **DreamWeaver** - ç»“åˆâ€œæ¢¦æƒ³â€å’Œâ€œç¼–ç»‡â€ï¼Œä¼ è¾¾å‡ºäº§å“èƒ½å¤Ÿå¸®åŠ©æ¶ˆè´¹è€…å®ç°ç¾å¥½ç¡çœ çš„æ¢¦æƒ³ã€‚\n9. **BedsByBella** - å¦‚æœå…¬å¸æœ‰ç‰¹å®šçš„å“ç‰Œæ•…äº‹æˆ–ç†å¿µï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼çš„åå­—ï¼Œå¼ºè°ƒå“ç‰Œä¸ªæ€§ã€‚\n10. **BigBedBeds** - ç›´æ¥è€Œæœ‰åŠ›ï¼Œé€‚åˆç›´æ¥ä¼ è¾¾äº§å“ç‰¹æ€§çš„å“ç‰Œã€‚\n\né€‰æ‹©åç§°æ—¶ï¼Œè¿˜éœ€è¦è€ƒè™‘åç§°çš„å¯ç”¨æ€§ï¼ˆæ˜¯å¦å·²è¢«å…¶ä»–å…¬å¸æ³¨å†Œï¼‰ã€æ–‡åŒ–æ•æ„Ÿæ€§ä»¥åŠæ˜¯å¦å®¹æ˜“æ‹¼å†™å’Œè®°å¿†ã€‚&quot;,
        &quot;generation_info&quot;: &#123;
          &quot;finish_reason&quot;: &quot;stop&quot;,
          &quot;logprobs&quot;: null
        &#125;,
        &quot;type&quot;: &quot;ChatGeneration&quot;,
        &quot;message&quot;: &#123;
          &quot;lc&quot;: 1,
          &quot;type&quot;: &quot;constructor&quot;,
          &quot;id&quot;: [
            &quot;langchain&quot;,
            &quot;schema&quot;,
            &quot;messages&quot;,
            &quot;AIMessage&quot;
          ],
          &quot;kwargs&quot;: &#123;
            &quot;content&quot;: &quot;ä¸ºä¸€å®¶åˆ¶é€ å¤§å·åºŠå•å¥—è£…çš„å…¬å¸é€‰æ‹©ä¸€ä¸ªåç§°æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼šå“ç‰Œå®šä½ã€ç›®æ ‡å¸‚åœºã€äº§å“ç‰¹è‰²ä»¥åŠæ˜“äºè®°å¿†å’Œå‘éŸ³ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å»ºè®®çš„åç§°ï¼š\n\n1. **GrandSleep** - å¼ºè°ƒâ€œå¤§å·â€å’Œâ€œç¡çœ â€ï¼Œé€‚åˆè¿½æ±‚é«˜å“è´¨ç¡çœ ä½“éªŒçš„æ¶ˆè´¹è€…ã€‚\n2. **ComfortBeds** - ç»“åˆäº†â€œèˆ’é€‚â€å’Œâ€œåºŠâ€çš„æ¦‚å¿µï¼Œä¼ è¾¾å‡ºäº§å“çš„èˆ’é€‚æ€§å’Œè´¨é‡ã€‚\n3. **LuxeLinen** - â€œLuxeâ€ä»£è¡¨å¥¢åï¼Œâ€œLinenâ€ä»£è¡¨åºŠå•ï¼Œé€‚åˆé«˜ç«¯å¸‚åœºã€‚\n4. **BigBedBoutique** - å¼ºè°ƒâ€œå¤§å·åºŠâ€å’Œâ€œç²¾å“åº—â€ï¼Œé€‚åˆæ³¨é‡ä¸ªæ€§åŒ–å’Œè®¾è®¡æ„Ÿçš„æ¶ˆè´¹è€…ã€‚\n5. **SleepGiant** - ç»“åˆâ€œç¡çœ â€å’Œâ€œå·¨äººâ€ï¼Œä¼ è¾¾å‡ºäº§å“çš„å¼ºå¤§å’Œèˆ’é€‚ã€‚\n6. **EpicSheets** - â€œEpicâ€æœ‰å²è¯—èˆ¬çš„æ„å‘³ï¼Œé€‚åˆè¿½æ±‚ç‹¬ç‰¹å’Œé«˜å“è´¨çš„æ¶ˆè´¹è€…ã€‚\n7. **CozyCove** - â€œCozyâ€ä»£è¡¨èˆ’é€‚ï¼Œâ€œCoveâ€æœ‰å°æµ·æ¹¾çš„æ„æ€ï¼Œé€‚åˆè¥é€ æ¸©é¦¨èˆ’é€‚çš„ç¡çœ ç¯å¢ƒã€‚\n8. **DreamWeaver** - ç»“åˆâ€œæ¢¦æƒ³â€å’Œâ€œç¼–ç»‡â€ï¼Œä¼ è¾¾å‡ºäº§å“èƒ½å¤Ÿå¸®åŠ©æ¶ˆè´¹è€…å®ç°ç¾å¥½ç¡çœ çš„æ¢¦æƒ³ã€‚\n9. **BedsByBella** - å¦‚æœå…¬å¸æœ‰ç‰¹å®šçš„å“ç‰Œæ•…äº‹æˆ–ç†å¿µï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼çš„åå­—ï¼Œå¼ºè°ƒå“ç‰Œä¸ªæ€§ã€‚\n10. **BigBedBeds** - ç›´æ¥è€Œæœ‰åŠ›ï¼Œé€‚åˆç›´æ¥ä¼ è¾¾äº§å“ç‰¹æ€§çš„å“ç‰Œã€‚\n\né€‰æ‹©åç§°æ—¶ï¼Œè¿˜éœ€è¦è€ƒè™‘åç§°çš„å¯ç”¨æ€§ï¼ˆæ˜¯å¦å·²è¢«å…¶ä»–å…¬å¸æ³¨å†Œï¼‰ã€æ–‡åŒ–æ•æ„Ÿæ€§ä»¥åŠæ˜¯å¦å®¹æ˜“æ‹¼å†™å’Œè®°å¿†ã€‚&quot;,
            &quot;additional_kwargs&quot;: &#123;
              &quot;refusal&quot;: null
            &#125;,
            &quot;response_metadata&quot;: &#123;
              &quot;token_usage&quot;: &#123;
                &quot;completion_tokens&quot;: 343,
                &quot;prompt_tokens&quot;: 41,
                &quot;total_tokens&quot;: 384,
                &quot;completion_tokens_details&quot;: null,
                &quot;prompt_tokens_details&quot;: null
              &#125;,
              &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
              &quot;system_fingerprint&quot;: &quot;&quot;,
              &quot;id&quot;: &quot;019b2bfdd48341f6529089e87cf377c4&quot;,
              &quot;service_tier&quot;: null,
              &quot;finish_reason&quot;: &quot;stop&quot;,
              &quot;logprobs&quot;: null
            &#125;,
            &quot;type&quot;: &quot;ai&quot;,
            &quot;id&quot;: &quot;run--6657a08d-1450-4cac-8f1b-3ebf64c22a85-0&quot;,
            &quot;usage_metadata&quot;: &#123;
              &quot;input_tokens&quot;: 41,
              &quot;output_tokens&quot;: 343,
              &quot;total_tokens&quot;: 384,
              &quot;input_token_details&quot;: &#123;&#125;,
              &quot;output_token_details&quot;: &#123;&#125;
            &#125;,
            &quot;tool_calls&quot;: [],
            &quot;invalid_tool_calls&quot;: []
          &#125;
        &#125;
      &#125;
    ]
  ],
  &quot;llm_output&quot;: &#123;
    &quot;token_usage&quot;: &#123;
      &quot;completion_tokens&quot;: 343,
      &quot;prompt_tokens&quot;: 41,
      &quot;total_tokens&quot;: 384,
      &quot;completion_tokens_details&quot;: null,
      &quot;prompt_tokens_details&quot;: null
    &#125;,
    &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
    &quot;system_fingerprint&quot;: &quot;&quot;,
    &quot;id&quot;: &quot;019b2bfdd48341f6529089e87cf377c4&quot;,
    &quot;service_tier&quot;: null
  &#125;,
  &quot;run&quot;: null,
  &quot;type&quot;: &quot;LLMResult&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableParallel&lt;company_name&gt; &gt; chain:RunnableSequence &gt; parser:StrOutputParser] Entering Parser run with input:
[0m[inputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableParallel&lt;company_name&gt; &gt; chain:RunnableSequence &gt; parser:StrOutputParser] [0ms] Exiting Parser run with output:
[0m&#123;
  &quot;output&quot;: &quot;ä¸ºä¸€å®¶åˆ¶é€ å¤§å·åºŠå•å¥—è£…çš„å…¬å¸é€‰æ‹©ä¸€ä¸ªåç§°æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼šå“ç‰Œå®šä½ã€ç›®æ ‡å¸‚åœºã€äº§å“ç‰¹è‰²ä»¥åŠæ˜“äºè®°å¿†å’Œå‘éŸ³ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å»ºè®®çš„åç§°ï¼š\n\n1. **GrandSleep** - å¼ºè°ƒâ€œå¤§å·â€å’Œâ€œç¡çœ â€ï¼Œé€‚åˆè¿½æ±‚é«˜å“è´¨ç¡çœ ä½“éªŒçš„æ¶ˆè´¹è€…ã€‚\n2. **ComfortBeds** - ç»“åˆäº†â€œèˆ’é€‚â€å’Œâ€œåºŠâ€çš„æ¦‚å¿µï¼Œä¼ è¾¾å‡ºäº§å“çš„èˆ’é€‚æ€§å’Œè´¨é‡ã€‚\n3. **LuxeLinen** - â€œLuxeâ€ä»£è¡¨å¥¢åï¼Œâ€œLinenâ€ä»£è¡¨åºŠå•ï¼Œé€‚åˆé«˜ç«¯å¸‚åœºã€‚\n4. **BigBedBoutique** - å¼ºè°ƒâ€œå¤§å·åºŠâ€å’Œâ€œç²¾å“åº—â€ï¼Œé€‚åˆæ³¨é‡ä¸ªæ€§åŒ–å’Œè®¾è®¡æ„Ÿçš„æ¶ˆè´¹è€…ã€‚\n5. **SleepGiant** - ç»“åˆâ€œç¡çœ â€å’Œâ€œå·¨äººâ€ï¼Œä¼ è¾¾å‡ºäº§å“çš„å¼ºå¤§å’Œèˆ’é€‚ã€‚\n6. **EpicSheets** - â€œEpicâ€æœ‰å²è¯—èˆ¬çš„æ„å‘³ï¼Œé€‚åˆè¿½æ±‚ç‹¬ç‰¹å’Œé«˜å“è´¨çš„æ¶ˆè´¹è€…ã€‚\n7. **CozyCove** - â€œCozyâ€ä»£è¡¨èˆ’é€‚ï¼Œâ€œCoveâ€æœ‰å°æµ·æ¹¾çš„æ„æ€ï¼Œé€‚åˆè¥é€ æ¸©é¦¨èˆ’é€‚çš„ç¡çœ ç¯å¢ƒã€‚\n8. **DreamWeaver** - ç»“åˆâ€œæ¢¦æƒ³â€å’Œâ€œç¼–ç»‡â€ï¼Œä¼ è¾¾å‡ºäº§å“èƒ½å¤Ÿå¸®åŠ©æ¶ˆè´¹è€…å®ç°ç¾å¥½ç¡çœ çš„æ¢¦æƒ³ã€‚\n9. **BedsByBella** - å¦‚æœå…¬å¸æœ‰ç‰¹å®šçš„å“ç‰Œæ•…äº‹æˆ–ç†å¿µï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼çš„åå­—ï¼Œå¼ºè°ƒå“ç‰Œä¸ªæ€§ã€‚\n10. **BigBedBeds** - ç›´æ¥è€Œæœ‰åŠ›ï¼Œé€‚åˆç›´æ¥ä¼ è¾¾äº§å“ç‰¹æ€§çš„å“ç‰Œã€‚\n\né€‰æ‹©åç§°æ—¶ï¼Œè¿˜éœ€è¦è€ƒè™‘åç§°çš„å¯ç”¨æ€§ï¼ˆæ˜¯å¦å·²è¢«å…¶ä»–å…¬å¸æ³¨å†Œï¼‰ã€æ–‡åŒ–æ•æ„Ÿæ€§ä»¥åŠæ˜¯å¦å®¹æ˜“æ‹¼å†™å’Œè®°å¿†ã€‚&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableParallel&lt;company_name&gt; &gt; chain:RunnableSequence] [2.86s] Exiting Chain run with output:
[0m&#123;
  &quot;output&quot;: &quot;ä¸ºä¸€å®¶åˆ¶é€ å¤§å·åºŠå•å¥—è£…çš„å…¬å¸é€‰æ‹©ä¸€ä¸ªåç§°æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼šå“ç‰Œå®šä½ã€ç›®æ ‡å¸‚åœºã€äº§å“ç‰¹è‰²ä»¥åŠæ˜“äºè®°å¿†å’Œå‘éŸ³ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å»ºè®®çš„åç§°ï¼š\n\n1. **GrandSleep** - å¼ºè°ƒâ€œå¤§å·â€å’Œâ€œç¡çœ â€ï¼Œé€‚åˆè¿½æ±‚é«˜å“è´¨ç¡çœ ä½“éªŒçš„æ¶ˆè´¹è€…ã€‚\n2. **ComfortBeds** - ç»“åˆäº†â€œèˆ’é€‚â€å’Œâ€œåºŠâ€çš„æ¦‚å¿µï¼Œä¼ è¾¾å‡ºäº§å“çš„èˆ’é€‚æ€§å’Œè´¨é‡ã€‚\n3. **LuxeLinen** - â€œLuxeâ€ä»£è¡¨å¥¢åï¼Œâ€œLinenâ€ä»£è¡¨åºŠå•ï¼Œé€‚åˆé«˜ç«¯å¸‚åœºã€‚\n4. **BigBedBoutique** - å¼ºè°ƒâ€œå¤§å·åºŠâ€å’Œâ€œç²¾å“åº—â€ï¼Œé€‚åˆæ³¨é‡ä¸ªæ€§åŒ–å’Œè®¾è®¡æ„Ÿçš„æ¶ˆè´¹è€…ã€‚\n5. **SleepGiant** - ç»“åˆâ€œç¡çœ â€å’Œâ€œå·¨äººâ€ï¼Œä¼ è¾¾å‡ºäº§å“çš„å¼ºå¤§å’Œèˆ’é€‚ã€‚\n6. **EpicSheets** - â€œEpicâ€æœ‰å²è¯—èˆ¬çš„æ„å‘³ï¼Œé€‚åˆè¿½æ±‚ç‹¬ç‰¹å’Œé«˜å“è´¨çš„æ¶ˆè´¹è€…ã€‚\n7. **CozyCove** - â€œCozyâ€ä»£è¡¨èˆ’é€‚ï¼Œâ€œCoveâ€æœ‰å°æµ·æ¹¾çš„æ„æ€ï¼Œé€‚åˆè¥é€ æ¸©é¦¨èˆ’é€‚çš„ç¡çœ ç¯å¢ƒã€‚\n8. **DreamWeaver** - ç»“åˆâ€œæ¢¦æƒ³â€å’Œâ€œç¼–ç»‡â€ï¼Œä¼ è¾¾å‡ºäº§å“èƒ½å¤Ÿå¸®åŠ©æ¶ˆè´¹è€…å®ç°ç¾å¥½ç¡çœ çš„æ¢¦æƒ³ã€‚\n9. **BedsByBella** - å¦‚æœå…¬å¸æœ‰ç‰¹å®šçš„å“ç‰Œæ•…äº‹æˆ–ç†å¿µï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼çš„åå­—ï¼Œå¼ºè°ƒå“ç‰Œä¸ªæ€§ã€‚\n10. **BigBedBeds** - ç›´æ¥è€Œæœ‰åŠ›ï¼Œé€‚åˆç›´æ¥ä¼ è¾¾äº§å“ç‰¹æ€§çš„å“ç‰Œã€‚\n\né€‰æ‹©åç§°æ—¶ï¼Œè¿˜éœ€è¦è€ƒè™‘åç§°çš„å¯ç”¨æ€§ï¼ˆæ˜¯å¦å·²è¢«å…¶ä»–å…¬å¸æ³¨å†Œï¼‰ã€æ–‡åŒ–æ•æ„Ÿæ€§ä»¥åŠæ˜¯å¦å®¹æ˜“æ‹¼å†™å’Œè®°å¿†ã€‚&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableParallel&lt;company_name&gt;] [2.86s] Exiting Chain run with output:
[0m&#123;
  &quot;company_name&quot;: &quot;ä¸ºä¸€å®¶åˆ¶é€ å¤§å·åºŠå•å¥—è£…çš„å…¬å¸é€‰æ‹©ä¸€ä¸ªåç§°æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼šå“ç‰Œå®šä½ã€ç›®æ ‡å¸‚åœºã€äº§å“ç‰¹è‰²ä»¥åŠæ˜“äºè®°å¿†å’Œå‘éŸ³ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å»ºè®®çš„åç§°ï¼š\n\n1. **GrandSleep** - å¼ºè°ƒâ€œå¤§å·â€å’Œâ€œç¡çœ â€ï¼Œé€‚åˆè¿½æ±‚é«˜å“è´¨ç¡çœ ä½“éªŒçš„æ¶ˆè´¹è€…ã€‚\n2. **ComfortBeds** - ç»“åˆäº†â€œèˆ’é€‚â€å’Œâ€œåºŠâ€çš„æ¦‚å¿µï¼Œä¼ è¾¾å‡ºäº§å“çš„èˆ’é€‚æ€§å’Œè´¨é‡ã€‚\n3. **LuxeLinen** - â€œLuxeâ€ä»£è¡¨å¥¢åï¼Œâ€œLinenâ€ä»£è¡¨åºŠå•ï¼Œé€‚åˆé«˜ç«¯å¸‚åœºã€‚\n4. **BigBedBoutique** - å¼ºè°ƒâ€œå¤§å·åºŠâ€å’Œâ€œç²¾å“åº—â€ï¼Œé€‚åˆæ³¨é‡ä¸ªæ€§åŒ–å’Œè®¾è®¡æ„Ÿçš„æ¶ˆè´¹è€…ã€‚\n5. **SleepGiant** - ç»“åˆâ€œç¡çœ â€å’Œâ€œå·¨äººâ€ï¼Œä¼ è¾¾å‡ºäº§å“çš„å¼ºå¤§å’Œèˆ’é€‚ã€‚\n6. **EpicSheets** - â€œEpicâ€æœ‰å²è¯—èˆ¬çš„æ„å‘³ï¼Œé€‚åˆè¿½æ±‚ç‹¬ç‰¹å’Œé«˜å“è´¨çš„æ¶ˆè´¹è€…ã€‚\n7. **CozyCove** - â€œCozyâ€ä»£è¡¨èˆ’é€‚ï¼Œâ€œCoveâ€æœ‰å°æµ·æ¹¾çš„æ„æ€ï¼Œé€‚åˆè¥é€ æ¸©é¦¨èˆ’é€‚çš„ç¡çœ ç¯å¢ƒã€‚\n8. **DreamWeaver** - ç»“åˆâ€œæ¢¦æƒ³â€å’Œâ€œç¼–ç»‡â€ï¼Œä¼ è¾¾å‡ºäº§å“èƒ½å¤Ÿå¸®åŠ©æ¶ˆè´¹è€…å®ç°ç¾å¥½ç¡çœ çš„æ¢¦æƒ³ã€‚\n9. **BedsByBella** - å¦‚æœå…¬å¸æœ‰ç‰¹å®šçš„å“ç‰Œæ•…äº‹æˆ–ç†å¿µï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼çš„åå­—ï¼Œå¼ºè°ƒå“ç‰Œä¸ªæ€§ã€‚\n10. **BigBedBeds** - ç›´æ¥è€Œæœ‰åŠ›ï¼Œé€‚åˆç›´æ¥ä¼ è¾¾äº§å“ç‰¹æ€§çš„å“ç‰Œã€‚\n\né€‰æ‹©åç§°æ—¶ï¼Œè¿˜éœ€è¦è€ƒè™‘åç§°çš„å¯ç”¨æ€§ï¼ˆæ˜¯å¦å·²è¢«å…¶ä»–å…¬å¸æ³¨å†Œï¼‰ã€æ–‡åŒ–æ•æ„Ÿæ€§ä»¥åŠæ˜¯å¦å®¹æ˜“æ‹¼å†™å’Œè®°å¿†ã€‚&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; prompt:ChatPromptTemplate] Entering Prompt run with input:
[0m&#123;
  &quot;company_name&quot;: &quot;ä¸ºä¸€å®¶åˆ¶é€ å¤§å·åºŠå•å¥—è£…çš„å…¬å¸é€‰æ‹©ä¸€ä¸ªåç§°æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼šå“ç‰Œå®šä½ã€ç›®æ ‡å¸‚åœºã€äº§å“ç‰¹è‰²ä»¥åŠæ˜“äºè®°å¿†å’Œå‘éŸ³ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å»ºè®®çš„åç§°ï¼š\n\n1. **GrandSleep** - å¼ºè°ƒâ€œå¤§å·â€å’Œâ€œç¡çœ â€ï¼Œé€‚åˆè¿½æ±‚é«˜å“è´¨ç¡çœ ä½“éªŒçš„æ¶ˆè´¹è€…ã€‚\n2. **ComfortBeds** - ç»“åˆäº†â€œèˆ’é€‚â€å’Œâ€œåºŠâ€çš„æ¦‚å¿µï¼Œä¼ è¾¾å‡ºäº§å“çš„èˆ’é€‚æ€§å’Œè´¨é‡ã€‚\n3. **LuxeLinen** - â€œLuxeâ€ä»£è¡¨å¥¢åï¼Œâ€œLinenâ€ä»£è¡¨åºŠå•ï¼Œé€‚åˆé«˜ç«¯å¸‚åœºã€‚\n4. **BigBedBoutique** - å¼ºè°ƒâ€œå¤§å·åºŠâ€å’Œâ€œç²¾å“åº—â€ï¼Œé€‚åˆæ³¨é‡ä¸ªæ€§åŒ–å’Œè®¾è®¡æ„Ÿçš„æ¶ˆè´¹è€…ã€‚\n5. **SleepGiant** - ç»“åˆâ€œç¡çœ â€å’Œâ€œå·¨äººâ€ï¼Œä¼ è¾¾å‡ºäº§å“çš„å¼ºå¤§å’Œèˆ’é€‚ã€‚\n6. **EpicSheets** - â€œEpicâ€æœ‰å²è¯—èˆ¬çš„æ„å‘³ï¼Œé€‚åˆè¿½æ±‚ç‹¬ç‰¹å’Œé«˜å“è´¨çš„æ¶ˆè´¹è€…ã€‚\n7. **CozyCove** - â€œCozyâ€ä»£è¡¨èˆ’é€‚ï¼Œâ€œCoveâ€æœ‰å°æµ·æ¹¾çš„æ„æ€ï¼Œé€‚åˆè¥é€ æ¸©é¦¨èˆ’é€‚çš„ç¡çœ ç¯å¢ƒã€‚\n8. **DreamWeaver** - ç»“åˆâ€œæ¢¦æƒ³â€å’Œâ€œç¼–ç»‡â€ï¼Œä¼ è¾¾å‡ºäº§å“èƒ½å¤Ÿå¸®åŠ©æ¶ˆè´¹è€…å®ç°ç¾å¥½ç¡çœ çš„æ¢¦æƒ³ã€‚\n9. **BedsByBella** - å¦‚æœå…¬å¸æœ‰ç‰¹å®šçš„å“ç‰Œæ•…äº‹æˆ–ç†å¿µï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼çš„åå­—ï¼Œå¼ºè°ƒå“ç‰Œä¸ªæ€§ã€‚\n10. **BigBedBeds** - ç›´æ¥è€Œæœ‰åŠ›ï¼Œé€‚åˆç›´æ¥ä¼ è¾¾äº§å“ç‰¹æ€§çš„å“ç‰Œã€‚\n\né€‰æ‹©åç§°æ—¶ï¼Œè¿˜éœ€è¦è€ƒè™‘åç§°çš„å¯ç”¨æ€§ï¼ˆæ˜¯å¦å·²è¢«å…¶ä»–å…¬å¸æ³¨å†Œï¼‰ã€æ–‡åŒ–æ•æ„Ÿæ€§ä»¥åŠæ˜¯å¦å®¹æ˜“æ‹¼å†™å’Œè®°å¿†ã€‚&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; prompt:ChatPromptTemplate] [1ms] Exiting Prompt run with output:
[0m[outputs]
[32;1m[1;3m[llm/start][0m [1m[chain:RunnableSequence &gt; llm:ChatOpenAI] Entering LLM run with input:
[0m&#123;
  &quot;prompts&quot;: [
    &quot;Human: å†™ä¸€ä¸ª20å­—çš„æè¿°å¯¹äºä¸‹é¢è¿™ä¸ªå…¬å¸ï¼šä¸ºä¸€å®¶åˆ¶é€ å¤§å·åºŠå•å¥—è£…çš„å…¬å¸é€‰æ‹©ä¸€ä¸ªåç§°æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼šå“ç‰Œå®šä½ã€ç›®æ ‡å¸‚åœºã€äº§å“ç‰¹è‰²ä»¥åŠæ˜“äºè®°å¿†å’Œå‘éŸ³ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å»ºè®®çš„åç§°ï¼š\n\n1. **GrandSleep** - å¼ºè°ƒâ€œå¤§å·â€å’Œâ€œç¡çœ â€ï¼Œé€‚åˆè¿½æ±‚é«˜å“è´¨ç¡çœ ä½“éªŒçš„æ¶ˆè´¹è€…ã€‚\n2. **ComfortBeds** - ç»“åˆäº†â€œèˆ’é€‚â€å’Œâ€œåºŠâ€çš„æ¦‚å¿µï¼Œä¼ è¾¾å‡ºäº§å“çš„èˆ’é€‚æ€§å’Œè´¨é‡ã€‚\n3. **LuxeLinen** - â€œLuxeâ€ä»£è¡¨å¥¢åï¼Œâ€œLinenâ€ä»£è¡¨åºŠå•ï¼Œé€‚åˆé«˜ç«¯å¸‚åœºã€‚\n4. **BigBedBoutique** - å¼ºè°ƒâ€œå¤§å·åºŠâ€å’Œâ€œç²¾å“åº—â€ï¼Œé€‚åˆæ³¨é‡ä¸ªæ€§åŒ–å’Œè®¾è®¡æ„Ÿçš„æ¶ˆè´¹è€…ã€‚\n5. **SleepGiant** - ç»“åˆâ€œç¡çœ â€å’Œâ€œå·¨äººâ€ï¼Œä¼ è¾¾å‡ºäº§å“çš„å¼ºå¤§å’Œèˆ’é€‚ã€‚\n6. **EpicSheets** - â€œEpicâ€æœ‰å²è¯—èˆ¬çš„æ„å‘³ï¼Œé€‚åˆè¿½æ±‚ç‹¬ç‰¹å’Œé«˜å“è´¨çš„æ¶ˆè´¹è€…ã€‚\n7. **CozyCove** - â€œCozyâ€ä»£è¡¨èˆ’é€‚ï¼Œâ€œCoveâ€æœ‰å°æµ·æ¹¾çš„æ„æ€ï¼Œé€‚åˆè¥é€ æ¸©é¦¨èˆ’é€‚çš„ç¡çœ ç¯å¢ƒã€‚\n8. **DreamWeaver** - ç»“åˆâ€œæ¢¦æƒ³â€å’Œâ€œç¼–ç»‡â€ï¼Œä¼ è¾¾å‡ºäº§å“èƒ½å¤Ÿå¸®åŠ©æ¶ˆè´¹è€…å®ç°ç¾å¥½ç¡çœ çš„æ¢¦æƒ³ã€‚\n9. **BedsByBella** - å¦‚æœå…¬å¸æœ‰ç‰¹å®šçš„å“ç‰Œæ•…äº‹æˆ–ç†å¿µï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼çš„åå­—ï¼Œå¼ºè°ƒå“ç‰Œä¸ªæ€§ã€‚\n10. **BigBedBeds** - ç›´æ¥è€Œæœ‰åŠ›ï¼Œé€‚åˆç›´æ¥ä¼ è¾¾äº§å“ç‰¹æ€§çš„å“ç‰Œã€‚\n\né€‰æ‹©åç§°æ—¶ï¼Œè¿˜éœ€è¦è€ƒè™‘åç§°çš„å¯ç”¨æ€§ï¼ˆæ˜¯å¦å·²è¢«å…¶ä»–å…¬å¸æ³¨å†Œï¼‰ã€æ–‡åŒ–æ•æ„Ÿæ€§ä»¥åŠæ˜¯å¦å®¹æ˜“æ‹¼å†™å’Œè®°å¿†ã€‚çš„&quot;
  ]
&#125;
[36;1m[1;3m[llm/end][0m [1m[chain:RunnableSequence &gt; llm:ChatOpenAI] [246ms] Exiting LLM run with output:
[0m&#123;
  &quot;generations&quot;: [
    [
      &#123;
        &quot;text&quot;: &quot;GrandSleepï¼šå¤§å·åºŠå•ä¸“å®¶ï¼Œé«˜å“è´¨ç¡çœ ä½“éªŒé¦–é€‰ã€‚&quot;,
        &quot;generation_info&quot;: &#123;
          &quot;finish_reason&quot;: &quot;stop&quot;,
          &quot;logprobs&quot;: null
        &#125;,
        &quot;type&quot;: &quot;ChatGeneration&quot;,
        &quot;message&quot;: &#123;
          &quot;lc&quot;: 1,
          &quot;type&quot;: &quot;constructor&quot;,
          &quot;id&quot;: [
            &quot;langchain&quot;,
            &quot;schema&quot;,
            &quot;messages&quot;,
            &quot;AIMessage&quot;
          ],
          &quot;kwargs&quot;: &#123;
            &quot;content&quot;: &quot;GrandSleepï¼šå¤§å·åºŠå•ä¸“å®¶ï¼Œé«˜å“è´¨ç¡çœ ä½“éªŒé¦–é€‰ã€‚&quot;,
            &quot;additional_kwargs&quot;: &#123;
              &quot;refusal&quot;: null
            &#125;,
            &quot;response_metadata&quot;: &#123;
              &quot;token_usage&quot;: &#123;
                &quot;completion_tokens&quot;: 14,
                &quot;prompt_tokens&quot;: 385,
                &quot;total_tokens&quot;: 399,
                &quot;completion_tokens_details&quot;: null,
                &quot;prompt_tokens_details&quot;: null
              &#125;,
              &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
              &quot;system_fingerprint&quot;: &quot;&quot;,
              &quot;id&quot;: &quot;019b2bfdded734eda3dbee520962da1b&quot;,
              &quot;service_tier&quot;: null,
              &quot;finish_reason&quot;: &quot;stop&quot;,
              &quot;logprobs&quot;: null
            &#125;,
            &quot;type&quot;: &quot;ai&quot;,
            &quot;id&quot;: &quot;run--8feccbb0-7492-46f6-8903-87528377c629-0&quot;,
            &quot;usage_metadata&quot;: &#123;
              &quot;input_tokens&quot;: 385,
              &quot;output_tokens&quot;: 14,
              &quot;total_tokens&quot;: 399,
              &quot;input_token_details&quot;: &#123;&#125;,
              &quot;output_token_details&quot;: &#123;&#125;
            &#125;,
            &quot;tool_calls&quot;: [],
            &quot;invalid_tool_calls&quot;: []
          &#125;
        &#125;
      &#125;
    ]
  ],
  &quot;llm_output&quot;: &#123;
    &quot;token_usage&quot;: &#123;
      &quot;completion_tokens&quot;: 14,
      &quot;prompt_tokens&quot;: 385,
      &quot;total_tokens&quot;: 399,
      &quot;completion_tokens_details&quot;: null,
      &quot;prompt_tokens_details&quot;: null
    &#125;,
    &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
    &quot;system_fingerprint&quot;: &quot;&quot;,
    &quot;id&quot;: &quot;019b2bfdded734eda3dbee520962da1b&quot;,
    &quot;service_tier&quot;: null
  &#125;,
  &quot;run&quot;: null,
  &quot;type&quot;: &quot;LLMResult&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; parser:StrOutputParser] Entering Parser run with input:
[0m[inputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; parser:StrOutputParser] [0ms] Exiting Parser run with output:
[0m&#123;
  &quot;output&quot;: &quot;GrandSleepï¼šå¤§å·åºŠå•ä¸“å®¶ï¼Œé«˜å“è´¨ç¡çœ ä½“éªŒé¦–é€‰ã€‚&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence] [3.11s] Exiting Chain run with output:
[0m&#123;
  &quot;output&quot;: &quot;GrandSleepï¼šå¤§å·åºŠå•ä¸“å®¶ï¼Œé«˜å“è´¨ç¡çœ ä½“éªŒé¦–é€‰ã€‚&quot;
&#125;
GrandSleepï¼šå¤§å·åºŠå•ä¸“å®¶ï¼Œé«˜å“è´¨ç¡çœ ä½“éªŒé¦–é€‰ã€‚
</code></pre>
<p>ä¸‰ã€ å¤æ‚é¡ºåºé“¾ (Sequential Chain) æ”¹å†™<br>æ—§é€»è¾‘ï¼šä½¿ç”¨ SequentialChain ç®¡ç†å¤šä¸ªè¾“å…¥è¾“å‡ºå˜é‡ï¼ˆinput_variables, output_variablesï¼‰ã€‚<br>v0.3 æ–°é€»è¾‘ (LCEL)ï¼šä½¿ç”¨ RunnablePassthrough.assignã€‚å®ƒçš„ä½œç”¨å°±åƒç»™æ•°æ®æµâ€œæ·»åŠ æ–°åˆ—â€ã€‚<br>å®ƒä¼šä¿ç•™ä¹‹å‰çš„è¾“å…¥ï¼Œå¹¶æŠŠæ–°è®¡ç®—çš„ç»“æœåŠ è¿›å»ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n=== 3. å¤æ‚é¡ºåºé“¾ (LCELç‰ˆ) ===&quot;</span>)<br><br><span class="hljs-comment"># 3.1 å®šä¹‰æ‰€æœ‰ Prompt</span><br>prompt_trans = ChatPromptTemplate.from_template(<span class="hljs-string">&quot;æŠŠä¸‹é¢çš„è¯„è®ºreviewç¿»è¯‘æˆè‹±æ–‡:\n\n&#123;Review&#125;&quot;</span>)<br>prompt_summ = ChatPromptTemplate.from_template(<span class="hljs-string">&quot;è¯·ä½ ç”¨ä¸€å¥è¯æ¥æ€»ç»“ä¸‹é¢çš„è¯„è®ºreview:\n\n&#123;English_Review&#125;&quot;</span>)<br>prompt_lang = ChatPromptTemplate.from_template(<span class="hljs-string">&quot;ä¸‹é¢çš„è¯„è®ºreviewä½¿ç”¨çš„ä»€ä¹ˆè¯­è¨€:\n\n&#123;Review&#125;&quot;</span>)<br>prompt_follow = ChatPromptTemplate.from_template(<span class="hljs-string">&quot;ä½¿ç”¨ç‰¹å®šçš„è¯­è¨€å¯¹ä¸‹é¢çš„æ€»ç»“å†™ä¸€ä¸ªåç»­å›å¤:\n\næ€»ç»“: &#123;summary&#125;\n\nè¯­è¨€: &#123;language&#125;&quot;</span>)<br><br><span class="hljs-comment"># 3.2 æ„å»ºé“¾</span><br><span class="hljs-comment"># å…³é”®ç‚¹ï¼šä½¿ç”¨ .assign() æ¥é€æ­¥ç§¯ç´¯æ•°æ®ï¼Œè€Œä¸æ˜¯æ›¿æ¢æ•°æ®</span><br><br><span class="hljs-comment"># æ­¥éª¤1ï¼šç¿»è¯‘ (ä¿ç•™ Reviewï¼Œæ–°å¢ English_Review)</span><br>chain_step1 = RunnablePassthrough.assign(<br>    English_Review=prompt_trans | llm | StrOutputParser()<br>)<br><br><span class="hljs-comment"># æ­¥éª¤2ï¼šæ€»ç»“ (ä¿ç•™ Review, English_Reviewï¼Œæ–°å¢ summary)</span><br>chain_step2 = RunnablePassthrough.assign(<br>    summary=prompt_summ | llm | StrOutputParser()<br>)<br><br><span class="hljs-comment"># æ­¥éª¤3ï¼šè¯†åˆ«è¯­è¨€ (ä¿ç•™å‰é¢æ‰€æœ‰ï¼Œæ–°å¢ language)</span><br><span class="hljs-comment"># æ³¨æ„ï¼šè¿™é‡Œéœ€è¦åŸå§‹ Reviewï¼Œå› ä¸º .assign ä¼šä¿ç•™ä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥ prompt_lang èƒ½ç›´æ¥å–åˆ° &#123;Review&#125;</span><br>chain_step3 = RunnablePassthrough.assign(<br>    language=prompt_lang | llm | StrOutputParser()<br>)<br><br><span class="hljs-comment"># æ­¥éª¤4ï¼šå†™å›å¤ (ä¿ç•™å‰é¢æ‰€æœ‰ï¼Œæ–°å¢ followup_message)</span><br>chain_step4 = RunnablePassthrough.assign(<br>    followup_message=prompt_follow | llm | StrOutputParser()<br>)<br><br><span class="hljs-comment"># ä¸²è”èµ·æ¥</span><br>overall_chain = chain_step1 | chain_step2 | chain_step3 | chain_step4<br><br><span class="hljs-comment"># 3.3 è¿è¡Œ</span><br>review_text = <span class="hljs-string">&quot;Je trouve le goÃ»t mÃ©diocre. La mousse ne tient pas, c&#x27;est bizarre.&quot;</span><br>result = overall_chain.invoke(&#123;<span class="hljs-string">&quot;Review&quot;</span>: review_text&#125;)<br><br><span class="hljs-comment"># æ‰“å°ç»“æœ (LCEL é»˜è®¤è¿”å›åŒ…å«æ‰€æœ‰å­—æ®µçš„å­—å…¸)</span><br><span class="hljs-keyword">import</span> json<br><span class="hljs-built_in">print</span>(json.dumps(result, indent=<span class="hljs-number">2</span>, ensure_ascii=<span class="hljs-literal">False</span>))<br><span class="hljs-built_in">print</span>(json.dumps(result))<br></code></pre></td></tr></table></figure>


<pre><code class="hljs">=== 3. å¤æ‚é¡ºåºé“¾ (LCELç‰ˆ) ===
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence] Entering Chain run with input:
[0m&#123;
  &quot;Review&quot;: &quot;Je trouve le goÃ»t mÃ©diocre. La mousse ne tient pas, c&#39;est bizarre.&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;English_Review&gt;] Entering Chain run with input:
[0m&#123;
  &quot;Review&quot;: &quot;Je trouve le goÃ»t mÃ©diocre. La mousse ne tient pas, c&#39;est bizarre.&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;English_Review&gt; &gt; chain:RunnableParallel&lt;English_Review&gt;] Entering Chain run with input:
[0m&#123;
  &quot;Review&quot;: &quot;Je trouve le goÃ»t mÃ©diocre. La mousse ne tient pas, c&#39;est bizarre.&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;English_Review&gt; &gt; chain:RunnableParallel&lt;English_Review&gt; &gt; chain:RunnableSequence] Entering Chain run with input:
[0m&#123;
  &quot;Review&quot;: &quot;Je trouve le goÃ»t mÃ©diocre. La mousse ne tient pas, c&#39;est bizarre.&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;English_Review&gt; &gt; chain:RunnableParallel&lt;English_Review&gt; &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] Entering Prompt run with input:
[0m&#123;
  &quot;Review&quot;: &quot;Je trouve le goÃ»t mÃ©diocre. La mousse ne tient pas, c&#39;est bizarre.&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;English_Review&gt; &gt; chain:RunnableParallel&lt;English_Review&gt; &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] [0ms] Exiting Prompt run with output:
[0m[outputs]
[32;1m[1;3m[llm/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;English_Review&gt; &gt; chain:RunnableParallel&lt;English_Review&gt; &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] Entering LLM run with input:
[0m&#123;
  &quot;prompts&quot;: [
    &quot;Human: æŠŠä¸‹é¢çš„è¯„è®ºreviewç¿»è¯‘æˆè‹±æ–‡:\n\nJe trouve le goÃ»t mÃ©diocre. La mousse ne tient pas, c&#39;est bizarre.&quot;
  ]
&#125;
[36;1m[1;3m[llm/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;English_Review&gt; &gt; chain:RunnableParallel&lt;English_Review&gt; &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] [363ms] Exiting LLM run with output:
[0m&#123;
  &quot;generations&quot;: [
    [
      &#123;
        &quot;text&quot;: &quot;I find the taste mediocre. The foam doesn&#39;t last, it&#39;s strange.&quot;,
        &quot;generation_info&quot;: &#123;
          &quot;finish_reason&quot;: &quot;stop&quot;,
          &quot;logprobs&quot;: null
        &#125;,
        &quot;type&quot;: &quot;ChatGeneration&quot;,
        &quot;message&quot;: &#123;
          &quot;lc&quot;: 1,
          &quot;type&quot;: &quot;constructor&quot;,
          &quot;id&quot;: [
            &quot;langchain&quot;,
            &quot;schema&quot;,
            &quot;messages&quot;,
            &quot;AIMessage&quot;
          ],
          &quot;kwargs&quot;: &#123;
            &quot;content&quot;: &quot;I find the taste mediocre. The foam doesn&#39;t last, it&#39;s strange.&quot;,
            &quot;additional_kwargs&quot;: &#123;
              &quot;refusal&quot;: null
            &#125;,
            &quot;response_metadata&quot;: &#123;
              &quot;token_usage&quot;: &#123;
                &quot;completion_tokens&quot;: 16,
                &quot;prompt_tokens&quot;: 58,
                &quot;total_tokens&quot;: 74,
                &quot;completion_tokens_details&quot;: null,
                &quot;prompt_tokens_details&quot;: null
              &#125;,
              &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
              &quot;system_fingerprint&quot;: &quot;&quot;,
              &quot;id&quot;: &quot;019b2c0ab8a4488ebf56914c69084800&quot;,
              &quot;service_tier&quot;: null,
              &quot;finish_reason&quot;: &quot;stop&quot;,
              &quot;logprobs&quot;: null
            &#125;,
            &quot;type&quot;: &quot;ai&quot;,
            &quot;id&quot;: &quot;run--512b3fdd-c334-451e-8e1d-ddea878c5f5d-0&quot;,
            &quot;usage_metadata&quot;: &#123;
              &quot;input_tokens&quot;: 58,
              &quot;output_tokens&quot;: 16,
              &quot;total_tokens&quot;: 74,
              &quot;input_token_details&quot;: &#123;&#125;,
              &quot;output_token_details&quot;: &#123;&#125;
            &#125;,
            &quot;tool_calls&quot;: [],
            &quot;invalid_tool_calls&quot;: []
          &#125;
        &#125;
      &#125;
    ]
  ],
  &quot;llm_output&quot;: &#123;
    &quot;token_usage&quot;: &#123;
      &quot;completion_tokens&quot;: 16,
      &quot;prompt_tokens&quot;: 58,
      &quot;total_tokens&quot;: 74,
      &quot;completion_tokens_details&quot;: null,
      &quot;prompt_tokens_details&quot;: null
    &#125;,
    &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
    &quot;system_fingerprint&quot;: &quot;&quot;,
    &quot;id&quot;: &quot;019b2c0ab8a4488ebf56914c69084800&quot;,
    &quot;service_tier&quot;: null
  &#125;,
  &quot;run&quot;: null,
  &quot;type&quot;: &quot;LLMResult&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;English_Review&gt; &gt; chain:RunnableParallel&lt;English_Review&gt; &gt; chain:RunnableSequence &gt; parser:StrOutputParser] Entering Parser run with input:
[0m[inputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;English_Review&gt; &gt; chain:RunnableParallel&lt;English_Review&gt; &gt; chain:RunnableSequence &gt; parser:StrOutputParser] [1ms] Exiting Parser run with output:
[0m&#123;
  &quot;output&quot;: &quot;I find the taste mediocre. The foam doesn&#39;t last, it&#39;s strange.&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;English_Review&gt; &gt; chain:RunnableParallel&lt;English_Review&gt; &gt; chain:RunnableSequence] [368ms] Exiting Chain run with output:
[0m&#123;
  &quot;output&quot;: &quot;I find the taste mediocre. The foam doesn&#39;t last, it&#39;s strange.&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;English_Review&gt; &gt; chain:RunnableParallel&lt;English_Review&gt;] [370ms] Exiting Chain run with output:
[0m&#123;
  &quot;English_Review&quot;: &quot;I find the taste mediocre. The foam doesn&#39;t last, it&#39;s strange.&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;English_Review&gt;] [371ms] Exiting Chain run with output:
[0m&#123;
  &quot;Review&quot;: &quot;Je trouve le goÃ»t mÃ©diocre. La mousse ne tient pas, c&#39;est bizarre.&quot;,
  &quot;English_Review&quot;: &quot;I find the taste mediocre. The foam doesn&#39;t last, it&#39;s strange.&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;summary&gt;] Entering Chain run with input:
[0m&#123;
  &quot;Review&quot;: &quot;Je trouve le goÃ»t mÃ©diocre. La mousse ne tient pas, c&#39;est bizarre.&quot;,
  &quot;English_Review&quot;: &quot;I find the taste mediocre. The foam doesn&#39;t last, it&#39;s strange.&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;summary&gt; &gt; chain:RunnableParallel&lt;summary&gt;] Entering Chain run with input:
[0m&#123;
  &quot;Review&quot;: &quot;Je trouve le goÃ»t mÃ©diocre. La mousse ne tient pas, c&#39;est bizarre.&quot;,
  &quot;English_Review&quot;: &quot;I find the taste mediocre. The foam doesn&#39;t last, it&#39;s strange.&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;summary&gt; &gt; chain:RunnableParallel&lt;summary&gt; &gt; chain:RunnableSequence] Entering Chain run with input:
[0m&#123;
  &quot;Review&quot;: &quot;Je trouve le goÃ»t mÃ©diocre. La mousse ne tient pas, c&#39;est bizarre.&quot;,
  &quot;English_Review&quot;: &quot;I find the taste mediocre. The foam doesn&#39;t last, it&#39;s strange.&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;summary&gt; &gt; chain:RunnableParallel&lt;summary&gt; &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] Entering Prompt run with input:
[0m&#123;
  &quot;Review&quot;: &quot;Je trouve le goÃ»t mÃ©diocre. La mousse ne tient pas, c&#39;est bizarre.&quot;,
  &quot;English_Review&quot;: &quot;I find the taste mediocre. The foam doesn&#39;t last, it&#39;s strange.&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;summary&gt; &gt; chain:RunnableParallel&lt;summary&gt; &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] [2ms] Exiting Prompt run with output:
[0m[outputs]
[32;1m[1;3m[llm/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;summary&gt; &gt; chain:RunnableParallel&lt;summary&gt; &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] Entering LLM run with input:
[0m&#123;
  &quot;prompts&quot;: [
    &quot;Human: è¯·ä½ ç”¨ä¸€å¥è¯æ¥æ€»ç»“ä¸‹é¢çš„è¯„è®ºreview:\n\nI find the taste mediocre. The foam doesn&#39;t last, it&#39;s strange.&quot;
  ]
&#125;
[36;1m[1;3m[llm/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;summary&gt; &gt; chain:RunnableParallel&lt;summary&gt; &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] [419ms] Exiting LLM run with output:
[0m&#123;
  &quot;generations&quot;: [
    [
      &#123;
        &quot;text&quot;: &quot;è¿™æ¬¾é¥®å“çš„å‘³é“ä¸€èˆ¬ï¼Œæ³¡æ²«ä¹Ÿä¸æŒä¹…ï¼Œæ„Ÿè§‰æœ‰äº›å¥‡æ€ªã€‚&quot;,
        &quot;generation_info&quot;: &#123;
          &quot;finish_reason&quot;: &quot;stop&quot;,
          &quot;logprobs&quot;: null
        &#125;,
        &quot;type&quot;: &quot;ChatGeneration&quot;,
        &quot;message&quot;: &#123;
          &quot;lc&quot;: 1,
          &quot;type&quot;: &quot;constructor&quot;,
          &quot;id&quot;: [
            &quot;langchain&quot;,
            &quot;schema&quot;,
            &quot;messages&quot;,
            &quot;AIMessage&quot;
          ],
          &quot;kwargs&quot;: &#123;
            &quot;content&quot;: &quot;è¿™æ¬¾é¥®å“çš„å‘³é“ä¸€èˆ¬ï¼Œæ³¡æ²«ä¹Ÿä¸æŒä¹…ï¼Œæ„Ÿè§‰æœ‰äº›å¥‡æ€ªã€‚&quot;,
            &quot;additional_kwargs&quot;: &#123;
              &quot;refusal&quot;: null
            &#125;,
            &quot;response_metadata&quot;: &#123;
              &quot;token_usage&quot;: &#123;
                &quot;completion_tokens&quot;: 13,
                &quot;prompt_tokens&quot;: 55,
                &quot;total_tokens&quot;: 68,
                &quot;completion_tokens_details&quot;: null,
                &quot;prompt_tokens_details&quot;: null
              &#125;,
              &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
              &quot;system_fingerprint&quot;: &quot;&quot;,
              &quot;id&quot;: &quot;019b2c0ab9fc8464b963231a8c3c5135&quot;,
              &quot;service_tier&quot;: null,
              &quot;finish_reason&quot;: &quot;stop&quot;,
              &quot;logprobs&quot;: null
            &#125;,
            &quot;type&quot;: &quot;ai&quot;,
            &quot;id&quot;: &quot;run--53f4fb49-c051-466a-8c02-f42602717bce-0&quot;,
            &quot;usage_metadata&quot;: &#123;
              &quot;input_tokens&quot;: 55,
              &quot;output_tokens&quot;: 13,
              &quot;total_tokens&quot;: 68,
              &quot;input_token_details&quot;: &#123;&#125;,
              &quot;output_token_details&quot;: &#123;&#125;
            &#125;,
            &quot;tool_calls&quot;: [],
            &quot;invalid_tool_calls&quot;: []
          &#125;
        &#125;
      &#125;
    ]
  ],
  &quot;llm_output&quot;: &#123;
    &quot;token_usage&quot;: &#123;
      &quot;completion_tokens&quot;: 13,
      &quot;prompt_tokens&quot;: 55,
      &quot;total_tokens&quot;: 68,
      &quot;completion_tokens_details&quot;: null,
      &quot;prompt_tokens_details&quot;: null
    &#125;,
    &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
    &quot;system_fingerprint&quot;: &quot;&quot;,
    &quot;id&quot;: &quot;019b2c0ab9fc8464b963231a8c3c5135&quot;,
    &quot;service_tier&quot;: null
  &#125;,
  &quot;run&quot;: null,
  &quot;type&quot;: &quot;LLMResult&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;summary&gt; &gt; chain:RunnableParallel&lt;summary&gt; &gt; chain:RunnableSequence &gt; parser:StrOutputParser] Entering Parser run with input:
[0m[inputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;summary&gt; &gt; chain:RunnableParallel&lt;summary&gt; &gt; chain:RunnableSequence &gt; parser:StrOutputParser] [0ms] Exiting Parser run with output:
[0m&#123;
  &quot;output&quot;: &quot;è¿™æ¬¾é¥®å“çš„å‘³é“ä¸€èˆ¬ï¼Œæ³¡æ²«ä¹Ÿä¸æŒä¹…ï¼Œæ„Ÿè§‰æœ‰äº›å¥‡æ€ªã€‚&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;summary&gt; &gt; chain:RunnableParallel&lt;summary&gt; &gt; chain:RunnableSequence] [425ms] Exiting Chain run with output:
[0m&#123;
  &quot;output&quot;: &quot;è¿™æ¬¾é¥®å“çš„å‘³é“ä¸€èˆ¬ï¼Œæ³¡æ²«ä¹Ÿä¸æŒä¹…ï¼Œæ„Ÿè§‰æœ‰äº›å¥‡æ€ªã€‚&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;summary&gt; &gt; chain:RunnableParallel&lt;summary&gt;] [428ms] Exiting Chain run with output:
[0m&#123;
  &quot;summary&quot;: &quot;è¿™æ¬¾é¥®å“çš„å‘³é“ä¸€èˆ¬ï¼Œæ³¡æ²«ä¹Ÿä¸æŒä¹…ï¼Œæ„Ÿè§‰æœ‰äº›å¥‡æ€ªã€‚&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;summary&gt;] [431ms] Exiting Chain run with output:
[0m&#123;
  &quot;Review&quot;: &quot;Je trouve le goÃ»t mÃ©diocre. La mousse ne tient pas, c&#39;est bizarre.&quot;,
  &quot;English_Review&quot;: &quot;I find the taste mediocre. The foam doesn&#39;t last, it&#39;s strange.&quot;,
  &quot;summary&quot;: &quot;è¿™æ¬¾é¥®å“çš„å‘³é“ä¸€èˆ¬ï¼Œæ³¡æ²«ä¹Ÿä¸æŒä¹…ï¼Œæ„Ÿè§‰æœ‰äº›å¥‡æ€ªã€‚&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;language&gt;] Entering Chain run with input:
[0m&#123;
  &quot;Review&quot;: &quot;Je trouve le goÃ»t mÃ©diocre. La mousse ne tient pas, c&#39;est bizarre.&quot;,
  &quot;English_Review&quot;: &quot;I find the taste mediocre. The foam doesn&#39;t last, it&#39;s strange.&quot;,
  &quot;summary&quot;: &quot;è¿™æ¬¾é¥®å“çš„å‘³é“ä¸€èˆ¬ï¼Œæ³¡æ²«ä¹Ÿä¸æŒä¹…ï¼Œæ„Ÿè§‰æœ‰äº›å¥‡æ€ªã€‚&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;language&gt; &gt; chain:RunnableParallel&lt;language&gt;] Entering Chain run with input:
[0m&#123;
  &quot;Review&quot;: &quot;Je trouve le goÃ»t mÃ©diocre. La mousse ne tient pas, c&#39;est bizarre.&quot;,
  &quot;English_Review&quot;: &quot;I find the taste mediocre. The foam doesn&#39;t last, it&#39;s strange.&quot;,
  &quot;summary&quot;: &quot;è¿™æ¬¾é¥®å“çš„å‘³é“ä¸€èˆ¬ï¼Œæ³¡æ²«ä¹Ÿä¸æŒä¹…ï¼Œæ„Ÿè§‰æœ‰äº›å¥‡æ€ªã€‚&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;language&gt; &gt; chain:RunnableParallel&lt;language&gt; &gt; chain:RunnableSequence] Entering Chain run with input:
[0m&#123;
  &quot;Review&quot;: &quot;Je trouve le goÃ»t mÃ©diocre. La mousse ne tient pas, c&#39;est bizarre.&quot;,
  &quot;English_Review&quot;: &quot;I find the taste mediocre. The foam doesn&#39;t last, it&#39;s strange.&quot;,
  &quot;summary&quot;: &quot;è¿™æ¬¾é¥®å“çš„å‘³é“ä¸€èˆ¬ï¼Œæ³¡æ²«ä¹Ÿä¸æŒä¹…ï¼Œæ„Ÿè§‰æœ‰äº›å¥‡æ€ªã€‚&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;language&gt; &gt; chain:RunnableParallel&lt;language&gt; &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] Entering Prompt run with input:
[0m&#123;
  &quot;Review&quot;: &quot;Je trouve le goÃ»t mÃ©diocre. La mousse ne tient pas, c&#39;est bizarre.&quot;,
  &quot;English_Review&quot;: &quot;I find the taste mediocre. The foam doesn&#39;t last, it&#39;s strange.&quot;,
  &quot;summary&quot;: &quot;è¿™æ¬¾é¥®å“çš„å‘³é“ä¸€èˆ¬ï¼Œæ³¡æ²«ä¹Ÿä¸æŒä¹…ï¼Œæ„Ÿè§‰æœ‰äº›å¥‡æ€ªã€‚&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;language&gt; &gt; chain:RunnableParallel&lt;language&gt; &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] [0ms] Exiting Prompt run with output:
[0m[outputs]
[32;1m[1;3m[llm/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;language&gt; &gt; chain:RunnableParallel&lt;language&gt; &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] Entering LLM run with input:
[0m&#123;
  &quot;prompts&quot;: [
    &quot;Human: ä¸‹é¢çš„è¯„è®ºreviewä½¿ç”¨çš„ä»€ä¹ˆè¯­è¨€:\n\nJe trouve le goÃ»t mÃ©diocre. La mousse ne tient pas, c&#39;est bizarre.&quot;
  ]
&#125;
[36;1m[1;3m[llm/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;language&gt; &gt; chain:RunnableParallel&lt;language&gt; &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] [225ms] Exiting LLM run with output:
[0m&#123;
  &quot;generations&quot;: [
    [
      &#123;
        &quot;text&quot;: &quot;è¿™æ®µè¯„è®ºä½¿ç”¨çš„æ˜¯æ³•è¯­ã€‚&quot;,
        &quot;generation_info&quot;: &#123;
          &quot;finish_reason&quot;: &quot;stop&quot;,
          &quot;logprobs&quot;: null
        &#125;,
        &quot;type&quot;: &quot;ChatGeneration&quot;,
        &quot;message&quot;: &#123;
          &quot;lc&quot;: 1,
          &quot;type&quot;: &quot;constructor&quot;,
          &quot;id&quot;: [
            &quot;langchain&quot;,
            &quot;schema&quot;,
            &quot;messages&quot;,
            &quot;AIMessage&quot;
          ],
          &quot;kwargs&quot;: &#123;
            &quot;content&quot;: &quot;è¿™æ®µè¯„è®ºä½¿ç”¨çš„æ˜¯æ³•è¯­ã€‚&quot;,
            &quot;additional_kwargs&quot;: &#123;
              &quot;refusal&quot;: null
            &#125;,
            &quot;response_metadata&quot;: &#123;
              &quot;token_usage&quot;: &#123;
                &quot;completion_tokens&quot;: 7,
                &quot;prompt_tokens&quot;: 57,
                &quot;total_tokens&quot;: 64,
                &quot;completion_tokens_details&quot;: null,
                &quot;prompt_tokens_details&quot;: null
              &#125;,
              &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
              &quot;system_fingerprint&quot;: &quot;&quot;,
              &quot;id&quot;: &quot;019b2c0abb4cddb657e1ddbc3c2de6a3&quot;,
              &quot;service_tier&quot;: null,
              &quot;finish_reason&quot;: &quot;stop&quot;,
              &quot;logprobs&quot;: null
            &#125;,
            &quot;type&quot;: &quot;ai&quot;,
            &quot;id&quot;: &quot;run--47df5eda-c47f-401c-8b84-d2a40fe519b2-0&quot;,
            &quot;usage_metadata&quot;: &#123;
              &quot;input_tokens&quot;: 57,
              &quot;output_tokens&quot;: 7,
              &quot;total_tokens&quot;: 64,
              &quot;input_token_details&quot;: &#123;&#125;,
              &quot;output_token_details&quot;: &#123;&#125;
            &#125;,
            &quot;tool_calls&quot;: [],
            &quot;invalid_tool_calls&quot;: []
          &#125;
        &#125;
      &#125;
    ]
  ],
  &quot;llm_output&quot;: &#123;
    &quot;token_usage&quot;: &#123;
      &quot;completion_tokens&quot;: 7,
      &quot;prompt_tokens&quot;: 57,
      &quot;total_tokens&quot;: 64,
      &quot;completion_tokens_details&quot;: null,
      &quot;prompt_tokens_details&quot;: null
    &#125;,
    &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
    &quot;system_fingerprint&quot;: &quot;&quot;,
    &quot;id&quot;: &quot;019b2c0abb4cddb657e1ddbc3c2de6a3&quot;,
    &quot;service_tier&quot;: null
  &#125;,
  &quot;run&quot;: null,
  &quot;type&quot;: &quot;LLMResult&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;language&gt; &gt; chain:RunnableParallel&lt;language&gt; &gt; chain:RunnableSequence &gt; parser:StrOutputParser] Entering Parser run with input:
[0m[inputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;language&gt; &gt; chain:RunnableParallel&lt;language&gt; &gt; chain:RunnableSequence &gt; parser:StrOutputParser] [0ms] Exiting Parser run with output:
[0m&#123;
  &quot;output&quot;: &quot;è¿™æ®µè¯„è®ºä½¿ç”¨çš„æ˜¯æ³•è¯­ã€‚&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;language&gt; &gt; chain:RunnableParallel&lt;language&gt; &gt; chain:RunnableSequence] [228ms] Exiting Chain run with output:
[0m&#123;
  &quot;output&quot;: &quot;è¿™æ®µè¯„è®ºä½¿ç”¨çš„æ˜¯æ³•è¯­ã€‚&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;language&gt; &gt; chain:RunnableParallel&lt;language&gt;] [229ms] Exiting Chain run with output:
[0m&#123;
  &quot;language&quot;: &quot;è¿™æ®µè¯„è®ºä½¿ç”¨çš„æ˜¯æ³•è¯­ã€‚&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;language&gt;] [229ms] Exiting Chain run with output:
[0m&#123;
  &quot;Review&quot;: &quot;Je trouve le goÃ»t mÃ©diocre. La mousse ne tient pas, c&#39;est bizarre.&quot;,
  &quot;English_Review&quot;: &quot;I find the taste mediocre. The foam doesn&#39;t last, it&#39;s strange.&quot;,
  &quot;summary&quot;: &quot;è¿™æ¬¾é¥®å“çš„å‘³é“ä¸€èˆ¬ï¼Œæ³¡æ²«ä¹Ÿä¸æŒä¹…ï¼Œæ„Ÿè§‰æœ‰äº›å¥‡æ€ªã€‚&quot;,
  &quot;language&quot;: &quot;è¿™æ®µè¯„è®ºä½¿ç”¨çš„æ˜¯æ³•è¯­ã€‚&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;followup_message&gt;] Entering Chain run with input:
[0m&#123;
  &quot;Review&quot;: &quot;Je trouve le goÃ»t mÃ©diocre. La mousse ne tient pas, c&#39;est bizarre.&quot;,
  &quot;English_Review&quot;: &quot;I find the taste mediocre. The foam doesn&#39;t last, it&#39;s strange.&quot;,
  &quot;summary&quot;: &quot;è¿™æ¬¾é¥®å“çš„å‘³é“ä¸€èˆ¬ï¼Œæ³¡æ²«ä¹Ÿä¸æŒä¹…ï¼Œæ„Ÿè§‰æœ‰äº›å¥‡æ€ªã€‚&quot;,
  &quot;language&quot;: &quot;è¿™æ®µè¯„è®ºä½¿ç”¨çš„æ˜¯æ³•è¯­ã€‚&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;followup_message&gt; &gt; chain:RunnableParallel&lt;followup_message&gt;] Entering Chain run with input:
[0m&#123;
  &quot;Review&quot;: &quot;Je trouve le goÃ»t mÃ©diocre. La mousse ne tient pas, c&#39;est bizarre.&quot;,
  &quot;English_Review&quot;: &quot;I find the taste mediocre. The foam doesn&#39;t last, it&#39;s strange.&quot;,
  &quot;summary&quot;: &quot;è¿™æ¬¾é¥®å“çš„å‘³é“ä¸€èˆ¬ï¼Œæ³¡æ²«ä¹Ÿä¸æŒä¹…ï¼Œæ„Ÿè§‰æœ‰äº›å¥‡æ€ªã€‚&quot;,
  &quot;language&quot;: &quot;è¿™æ®µè¯„è®ºä½¿ç”¨çš„æ˜¯æ³•è¯­ã€‚&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;followup_message&gt; &gt; chain:RunnableParallel&lt;followup_message&gt; &gt; chain:RunnableSequence] Entering Chain run with input:
[0m&#123;
  &quot;Review&quot;: &quot;Je trouve le goÃ»t mÃ©diocre. La mousse ne tient pas, c&#39;est bizarre.&quot;,
  &quot;English_Review&quot;: &quot;I find the taste mediocre. The foam doesn&#39;t last, it&#39;s strange.&quot;,
  &quot;summary&quot;: &quot;è¿™æ¬¾é¥®å“çš„å‘³é“ä¸€èˆ¬ï¼Œæ³¡æ²«ä¹Ÿä¸æŒä¹…ï¼Œæ„Ÿè§‰æœ‰äº›å¥‡æ€ªã€‚&quot;,
  &quot;language&quot;: &quot;è¿™æ®µè¯„è®ºä½¿ç”¨çš„æ˜¯æ³•è¯­ã€‚&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;followup_message&gt; &gt; chain:RunnableParallel&lt;followup_message&gt; &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] Entering Prompt run with input:
[0m&#123;
  &quot;Review&quot;: &quot;Je trouve le goÃ»t mÃ©diocre. La mousse ne tient pas, c&#39;est bizarre.&quot;,
  &quot;English_Review&quot;: &quot;I find the taste mediocre. The foam doesn&#39;t last, it&#39;s strange.&quot;,
  &quot;summary&quot;: &quot;è¿™æ¬¾é¥®å“çš„å‘³é“ä¸€èˆ¬ï¼Œæ³¡æ²«ä¹Ÿä¸æŒä¹…ï¼Œæ„Ÿè§‰æœ‰äº›å¥‡æ€ªã€‚&quot;,
  &quot;language&quot;: &quot;è¿™æ®µè¯„è®ºä½¿ç”¨çš„æ˜¯æ³•è¯­ã€‚&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;followup_message&gt; &gt; chain:RunnableParallel&lt;followup_message&gt; &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] [1ms] Exiting Prompt run with output:
[0m[outputs]
[32;1m[1;3m[llm/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;followup_message&gt; &gt; chain:RunnableParallel&lt;followup_message&gt; &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] Entering LLM run with input:
[0m&#123;
  &quot;prompts&quot;: [
    &quot;Human: ä½¿ç”¨ç‰¹å®šçš„è¯­è¨€å¯¹ä¸‹é¢çš„æ€»ç»“å†™ä¸€ä¸ªåç»­å›å¤:\n\næ€»ç»“: è¿™æ¬¾é¥®å“çš„å‘³é“ä¸€èˆ¬ï¼Œæ³¡æ²«ä¹Ÿä¸æŒä¹…ï¼Œæ„Ÿè§‰æœ‰äº›å¥‡æ€ªã€‚\n\nè¯­è¨€: è¿™æ®µè¯„è®ºä½¿ç”¨çš„æ˜¯æ³•è¯­ã€‚&quot;
  ]
&#125;
[36;1m[1;3m[llm/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;followup_message&gt; &gt; chain:RunnableParallel&lt;followup_message&gt; &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] [447ms] Exiting LLM run with output:
[0m&#123;
  &quot;generations&quot;: [
    [
      &#123;
        &quot;text&quot;: &quot;Ce produit n&#39;a pas vraiment convaincu. Le goÃ»t est moyen, et la mousse ne persiste pas longtemps. C&#39;est un peu Ã©trange.&quot;,
        &quot;generation_info&quot;: &#123;
          &quot;finish_reason&quot;: &quot;stop&quot;,
          &quot;logprobs&quot;: null
        &#125;,
        &quot;type&quot;: &quot;ChatGeneration&quot;,
        &quot;message&quot;: &#123;
          &quot;lc&quot;: 1,
          &quot;type&quot;: &quot;constructor&quot;,
          &quot;id&quot;: [
            &quot;langchain&quot;,
            &quot;schema&quot;,
            &quot;messages&quot;,
            &quot;AIMessage&quot;
          ],
          &quot;kwargs&quot;: &#123;
            &quot;content&quot;: &quot;Ce produit n&#39;a pas vraiment convaincu. Le goÃ»t est moyen, et la mousse ne persiste pas longtemps. C&#39;est un peu Ã©trange.&quot;,
            &quot;additional_kwargs&quot;: &#123;
              &quot;refusal&quot;: null
            &#125;,
            &quot;response_metadata&quot;: &#123;
              &quot;token_usage&quot;: &#123;
                &quot;completion_tokens&quot;: 34,
                &quot;prompt_tokens&quot;: 69,
                &quot;total_tokens&quot;: 103,
                &quot;completion_tokens_details&quot;: null,
                &quot;prompt_tokens_details&quot;: null
              &#125;,
              &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
              &quot;system_fingerprint&quot;: &quot;&quot;,
              &quot;id&quot;: &quot;019b2c0abc3554c1ae26e4fa28e9b9dc&quot;,
              &quot;service_tier&quot;: null,
              &quot;finish_reason&quot;: &quot;stop&quot;,
              &quot;logprobs&quot;: null
            &#125;,
            &quot;type&quot;: &quot;ai&quot;,
            &quot;id&quot;: &quot;run--eee07e4a-aa98-441e-907c-53073e951f7e-0&quot;,
            &quot;usage_metadata&quot;: &#123;
              &quot;input_tokens&quot;: 69,
              &quot;output_tokens&quot;: 34,
              &quot;total_tokens&quot;: 103,
              &quot;input_token_details&quot;: &#123;&#125;,
              &quot;output_token_details&quot;: &#123;&#125;
            &#125;,
            &quot;tool_calls&quot;: [],
            &quot;invalid_tool_calls&quot;: []
          &#125;
        &#125;
      &#125;
    ]
  ],
  &quot;llm_output&quot;: &#123;
    &quot;token_usage&quot;: &#123;
      &quot;completion_tokens&quot;: 34,
      &quot;prompt_tokens&quot;: 69,
      &quot;total_tokens&quot;: 103,
      &quot;completion_tokens_details&quot;: null,
      &quot;prompt_tokens_details&quot;: null
    &#125;,
    &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
    &quot;system_fingerprint&quot;: &quot;&quot;,
    &quot;id&quot;: &quot;019b2c0abc3554c1ae26e4fa28e9b9dc&quot;,
    &quot;service_tier&quot;: null
  &#125;,
  &quot;run&quot;: null,
  &quot;type&quot;: &quot;LLMResult&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;followup_message&gt; &gt; chain:RunnableParallel&lt;followup_message&gt; &gt; chain:RunnableSequence &gt; parser:StrOutputParser] Entering Parser run with input:
[0m[inputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;followup_message&gt; &gt; chain:RunnableParallel&lt;followup_message&gt; &gt; chain:RunnableSequence &gt; parser:StrOutputParser] [1ms] Exiting Parser run with output:
[0m&#123;
  &quot;output&quot;: &quot;Ce produit n&#39;a pas vraiment convaincu. Le goÃ»t est moyen, et la mousse ne persiste pas longtemps. C&#39;est un peu Ã©trange.&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;followup_message&gt; &gt; chain:RunnableParallel&lt;followup_message&gt; &gt; chain:RunnableSequence] [453ms] Exiting Chain run with output:
[0m&#123;
  &quot;output&quot;: &quot;Ce produit n&#39;a pas vraiment convaincu. Le goÃ»t est moyen, et la mousse ne persiste pas longtemps. C&#39;est un peu Ã©trange.&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;followup_message&gt; &gt; chain:RunnableParallel&lt;followup_message&gt;] [455ms] Exiting Chain run with output:
[0m&#123;
  &quot;followup_message&quot;: &quot;Ce produit n&#39;a pas vraiment convaincu. Le goÃ»t est moyen, et la mousse ne persiste pas longtemps. C&#39;est un peu Ã©trange.&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;followup_message&gt;] [456ms] Exiting Chain run with output:
[0m&#123;
  &quot;Review&quot;: &quot;Je trouve le goÃ»t mÃ©diocre. La mousse ne tient pas, c&#39;est bizarre.&quot;,
  &quot;English_Review&quot;: &quot;I find the taste mediocre. The foam doesn&#39;t last, it&#39;s strange.&quot;,
  &quot;summary&quot;: &quot;è¿™æ¬¾é¥®å“çš„å‘³é“ä¸€èˆ¬ï¼Œæ³¡æ²«ä¹Ÿä¸æŒä¹…ï¼Œæ„Ÿè§‰æœ‰äº›å¥‡æ€ªã€‚&quot;,
  &quot;language&quot;: &quot;è¿™æ®µè¯„è®ºä½¿ç”¨çš„æ˜¯æ³•è¯­ã€‚&quot;,
  &quot;followup_message&quot;: &quot;Ce produit n&#39;a pas vraiment convaincu. Le goÃ»t est moyen, et la mousse ne persiste pas longtemps. C&#39;est un peu Ã©trange.&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence] [1.49s] Exiting Chain run with output:
[0m&#123;
  &quot;Review&quot;: &quot;Je trouve le goÃ»t mÃ©diocre. La mousse ne tient pas, c&#39;est bizarre.&quot;,
  &quot;English_Review&quot;: &quot;I find the taste mediocre. The foam doesn&#39;t last, it&#39;s strange.&quot;,
  &quot;summary&quot;: &quot;è¿™æ¬¾é¥®å“çš„å‘³é“ä¸€èˆ¬ï¼Œæ³¡æ²«ä¹Ÿä¸æŒä¹…ï¼Œæ„Ÿè§‰æœ‰äº›å¥‡æ€ªã€‚&quot;,
  &quot;language&quot;: &quot;è¿™æ®µè¯„è®ºä½¿ç”¨çš„æ˜¯æ³•è¯­ã€‚&quot;,
  &quot;followup_message&quot;: &quot;Ce produit n&#39;a pas vraiment convaincu. Le goÃ»t est moyen, et la mousse ne persiste pas longtemps. C&#39;est un peu Ã©trange.&quot;
&#125;
&#123;
  &quot;Review&quot;: &quot;Je trouve le goÃ»t mÃ©diocre. La mousse ne tient pas, c&#39;est bizarre.&quot;,
  &quot;English_Review&quot;: &quot;I find the taste mediocre. The foam doesn&#39;t last, it&#39;s strange.&quot;,
  &quot;summary&quot;: &quot;è¿™æ¬¾é¥®å“çš„å‘³é“ä¸€èˆ¬ï¼Œæ³¡æ²«ä¹Ÿä¸æŒä¹…ï¼Œæ„Ÿè§‰æœ‰äº›å¥‡æ€ªã€‚&quot;,
  &quot;language&quot;: &quot;è¿™æ®µè¯„è®ºä½¿ç”¨çš„æ˜¯æ³•è¯­ã€‚&quot;,
  &quot;followup_message&quot;: &quot;Ce produit n&#39;a pas vraiment convaincu. Le goÃ»t est moyen, et la mousse ne persiste pas longtemps. C&#39;est un peu Ã©trange.&quot;
&#125;
&#123;&quot;Review&quot;: &quot;Je trouve le go\u00fbt m\u00e9diocre. La mousse ne tient pas, c&#39;est bizarre.&quot;, &quot;English_Review&quot;: &quot;I find the taste mediocre. The foam doesn&#39;t last, it&#39;s strange.&quot;, &quot;summary&quot;: &quot;\u8fd9\u6b3e\u996e\u54c1\u7684\u5473\u9053\u4e00\u822c\uff0c\u6ce1\u6cab\u4e5f\u4e0d\u6301\u4e45\uff0c\u611f\u89c9\u6709\u4e9b\u5947\u602a\u3002&quot;, &quot;language&quot;: &quot;\u8fd9\u6bb5\u8bc4\u8bba\u4f7f\u7528\u7684\u662f\u6cd5\u8bed\u3002&quot;, &quot;followup_message&quot;: &quot;Ce produit n&#39;a pas vraiment convaincu. Le go\u00fbt est moyen, et la mousse ne persiste pas longtemps. C&#39;est un peu \u00e9trange.&quot;&#125;
</code></pre>
<p>å››ã€ è·¯ç”±é“¾ (Router Chain) æ”¹å†™<br>åˆ†ç±» + åˆ†æ”¯ã€‚<br>1.å†™ä¸€ä¸ªä¸“é—¨çš„â€œåˆ†ç±»é“¾â€è®© LLM åˆ¤æ–­æ„å›¾ã€‚<br>2.å®šä¹‰ä¸€ä¸ª Python å‡½æ•°ï¼ˆrouteï¼‰ï¼Œæ ¹æ®æ„å›¾è¿”å›å¯¹åº”çš„é“¾ã€‚<br>3.ä½¿ç”¨ RunnableLambda æ‰§è¡Œè¿™ä¸ªè·¯ç”±é€»è¾‘ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n=== 4. è·¯ç”±é“¾ (LCELç‰ˆ - æ¨èç”¨æ³•) ===&quot;</span>)<br><br><span class="hljs-comment"># 4.1 å®šä¹‰ç‰¹å®šé¢†åŸŸçš„ Prompt æ¨¡æ¿</span><br>physics_template = <span class="hljs-string">&quot;&quot;&quot;ä½ æ˜¯ä¸€ä¸ªéå¸¸èªæ˜çš„ç‰©ç†ä¸“å®¶ã€‚è¿™æ˜¯ä¸€ä¸ªé—®é¢˜: &#123;input&#125;&quot;&quot;&quot;</span><br>math_template = <span class="hljs-string">&quot;&quot;&quot;ä½ æ˜¯ä¸€ä¸ªéå¸¸ä¼˜ç§€çš„æ•°å­¦å®¶ã€‚è¿™æ˜¯ä¸€ä¸ªé—®é¢˜ï¼š&#123;input&#125;&quot;&quot;&quot;</span><br>history_template = <span class="hljs-string">&quot;&quot;&quot;ä½ æ˜¯ä¸€ä¸ªéå¸¸ä¼˜ç§€çš„å†å²å­¦å®¶ã€‚è¿™æ˜¯ä¸€ä¸ªé—®é¢˜: &#123;input&#125;&quot;&quot;&quot;</span><br>cs_template = <span class="hljs-string">&quot;&quot;&quot;ä½ æ˜¯ä¸€ä¸ªæˆåŠŸçš„è®¡ç®—æœºç§‘å­¦ä¸“å®¶ã€‚è¿™è¿˜æ˜¯ä¸€ä¸ªè¾“å…¥ï¼š&#123;input&#125;&quot;&quot;&quot;</span><br><br><span class="hljs-comment"># 4.2 å®šä¹‰â€œåˆ†ç±»å™¨â€ Prompt</span><br><span class="hljs-comment"># æˆ‘ä»¬ä¸éœ€è¦è®© LLM è¿”å›å¤æ‚çš„ JSONï¼Œåªéœ€è¦å®ƒè¿”å›åˆ†ç±»åç§°å³å¯</span><br>system_prompt = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">ä½ æ˜¯ä¸€ä¸ªåˆ†ç±»åŠ©æ‰‹ã€‚ç»™å®šç”¨æˆ·çš„é—®é¢˜ï¼Œè¯·é€‰æ‹©æœ€é€‚åˆå›ç­”è¯¥é—®é¢˜çš„ä¸“å®¶ç±»å‹ã€‚</span><br><span class="hljs-string">åªè¾“å‡ºç±»åˆ«åç§°ï¼Œä¸è¦è¾“å‡ºå…¶ä»–ä»»ä½•å†…å®¹ã€‚</span><br><span class="hljs-string">å¯é€‰ç±»åˆ«: physics, math, history, computer_science</span><br><span class="hljs-string">å¦‚æœéƒ½ä¸åŒ¹é…ï¼Œè¾“å‡º: default</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br>router_prompt = ChatPromptTemplate.from_messages([<br>    (<span class="hljs-string">&quot;system&quot;</span>, system_prompt),<br>    (<span class="hljs-string">&quot;human&quot;</span>, <span class="hljs-string">&quot;&#123;input&#125;&quot;</span>)<br>])<br><br><span class="hljs-comment"># 4.3 æ„å»ºå…·ä½“çš„ç›®æ ‡é“¾</span><br><span class="hljs-comment"># æˆ‘ä»¬æŠŠå®ƒä»¬åšæˆä¸€ä¸ªå­—å…¸ï¼Œæ–¹ä¾¿æŸ¥æ‰¾</span><br>chain_map = &#123;<br>    <span class="hljs-string">&quot;physics&quot;</span>: ChatPromptTemplate.from_template(physics_template) | llm | StrOutputParser(),<br>    <span class="hljs-string">&quot;math&quot;</span>: ChatPromptTemplate.from_template(math_template) | llm | StrOutputParser(),<br>    <span class="hljs-string">&quot;history&quot;</span>: ChatPromptTemplate.from_template(history_template) | llm | StrOutputParser(),<br>    <span class="hljs-string">&quot;computer_science&quot;</span>: ChatPromptTemplate.from_template(cs_template) | llm | StrOutputParser(),<br>    <span class="hljs-string">&quot;default&quot;</span>: ChatPromptTemplate.from_template(<span class="hljs-string">&quot;&#123;input&#125;&quot;</span>) | llm | StrOutputParser()<br>&#125;<br><br><span class="hljs-comment"># 4.4 å®šä¹‰è·¯ç”±é€»è¾‘å‡½æ•°</span><br><span class="hljs-comment"># è¿™ä¸ªå‡½æ•°æ¥æ”¶åˆ†ç±»å™¨çš„è¾“å‡ºï¼ˆcategoryï¼‰ï¼Œç„¶åè¿”å›å¯¹åº”çš„ Chain å¯¹è±¡</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">route</span>(<span class="hljs-params">info</span>):<br>    <span class="hljs-comment"># info æ˜¯ä¸Šä¸€æ­¥çš„è¾“å‡ºï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å« &#x27;topic&#x27; å’Œ &#x27;input&#x27;</span><br>    topic = info[<span class="hljs-string">&quot;topic&quot;</span>].lower().strip()  <span class="hljs-comment"># å¤§å†™å­—æ¯è½¬å°å†™å­—æ¯ï¼Œ .strip() å»æ‰å­—ç¬¦ä¸²å¼€å¤´å’Œç»“å°¾çš„ç©ºæ ¼</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;DEBUG: è·¯ç”±åˆ†ç±»ç»“æœ -&gt; <span class="hljs-subst">&#123;topic&#125;</span>&quot;</span>)<br>    <br>    <span class="hljs-comment"># ä»å­—å…¸é‡Œæ‰¾å¯¹åº”çš„é“¾ï¼Œæ‰¾ä¸åˆ°å°±ç”¨ default</span><br>    <span class="hljs-comment"># ä½¿ç”¨get()æ–¹æ³•å¤„ç†å•å±‚å­—å…¸ï¼Œå­—å…¸çš„get()æ–¹æ³•å…è®¸åœ¨é”®ä¸å­˜åœ¨æ—¶è¿”å›ä¸€ä¸ªé»˜è®¤å€¼ï¼Œè€Œä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</span><br>    selected_chain = chain_map.get(topic, chain_map[<span class="hljs-string">&quot;default&quot;</span>])<br>    <span class="hljs-keyword">return</span> selected_chain<br><br><span class="hljs-comment"># 4.5 æ„å»ºå®Œæ•´çš„è·¯ç”±é“¾</span><br><span class="hljs-comment"># ç¬¬ä¸€æ­¥ï¼šè¿è¡Œåˆ†ç±»å™¨ï¼Œè·å– topic</span><br>classification_chain = (<br>    RunnablePassthrough.assign(<br>        topic=router_prompt | llm | StrOutputParser()     <span class="hljs-comment">#è¿™ä¸€æ­¥å®Œæˆï¼Œä¼šå¸¦ç€input å’Œ topicåˆ°ä¸‹ä¸€ä¸ª</span><br>    )<br>    <span class="hljs-comment"># ç¬¬äºŒæ­¥ï¼šä½¿ç”¨ RunnableLambda åŠ¨æ€è°ƒç”¨ route å‡½æ•°</span><br>    <span class="hljs-comment"># æ³¨æ„ï¼šroute å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ª Runnable (é“¾)ï¼ŒLangChain ä¼šè‡ªåŠ¨æ‰§è¡Œè¿”å›çš„è¿™ä¸ªé“¾</span><br>    | RunnableLambda(route)<br>)<br></code></pre></td></tr></table></figure>


<pre><code class="hljs">=== 4. è·¯ç”±é“¾ (LCELç‰ˆ - æ¨èç”¨æ³•) ===
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 4.6 æé—®</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n--- æµ‹è¯•ç‰©ç†é—®é¢˜ ---&quot;</span>)<br><span class="hljs-built_in">print</span>(classification_chain.invoke(&#123;<span class="hljs-string">&quot;input&quot;</span>: <span class="hljs-string">&quot;ä»€ä¹ˆæ˜¯é»‘ä½“è¾å°„ï¼Ÿ&quot;</span>&#125;))<br></code></pre></td></tr></table></figure>


<pre><code class="hljs">--- æµ‹è¯•ç‰©ç†é—®é¢˜ ---
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä»€ä¹ˆæ˜¯é»‘ä½“è¾å°„ï¼Ÿ&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt;] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä»€ä¹ˆæ˜¯é»‘ä½“è¾å°„ï¼Ÿ&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt; &gt; chain:RunnableParallel&lt;topic&gt;] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä»€ä¹ˆæ˜¯é»‘ä½“è¾å°„ï¼Ÿ&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt; &gt; chain:RunnableParallel&lt;topic&gt; &gt; chain:RunnableSequence] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä»€ä¹ˆæ˜¯é»‘ä½“è¾å°„ï¼Ÿ&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt; &gt; chain:RunnableParallel&lt;topic&gt; &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] Entering Prompt run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä»€ä¹ˆæ˜¯é»‘ä½“è¾å°„ï¼Ÿ&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt; &gt; chain:RunnableParallel&lt;topic&gt; &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] [1ms] Exiting Prompt run with output:
[0m[outputs]
[32;1m[1;3m[llm/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt; &gt; chain:RunnableParallel&lt;topic&gt; &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] Entering LLM run with input:
[0m&#123;
  &quot;prompts&quot;: [
    &quot;System: \nä½ æ˜¯ä¸€ä¸ªåˆ†ç±»åŠ©æ‰‹ã€‚ç»™å®šç”¨æˆ·çš„é—®é¢˜ï¼Œè¯·é€‰æ‹©æœ€é€‚åˆå›ç­”è¯¥é—®é¢˜çš„ä¸“å®¶ç±»å‹ã€‚\nåªè¾“å‡ºç±»åˆ«åç§°ï¼Œä¸è¦è¾“å‡ºå…¶ä»–ä»»ä½•å†…å®¹ã€‚\nå¯é€‰ç±»åˆ«: physics, math, history, computer_science\nå¦‚æœéƒ½ä¸åŒ¹é…ï¼Œè¾“å‡º: default\n\nHuman: ä»€ä¹ˆæ˜¯é»‘ä½“è¾å°„ï¼Ÿ&quot;
  ]
&#125;
[36;1m[1;3m[llm/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt; &gt; chain:RunnableParallel&lt;topic&gt; &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] [241ms] Exiting LLM run with output:
[0m&#123;
  &quot;generations&quot;: [
    [
      &#123;
        &quot;text&quot;: &quot;physics&quot;,
        &quot;generation_info&quot;: &#123;
          &quot;finish_reason&quot;: &quot;stop&quot;,
          &quot;logprobs&quot;: null
        &#125;,
        &quot;type&quot;: &quot;ChatGeneration&quot;,
        &quot;message&quot;: &#123;
          &quot;lc&quot;: 1,
          &quot;type&quot;: &quot;constructor&quot;,
          &quot;id&quot;: [
            &quot;langchain&quot;,
            &quot;schema&quot;,
            &quot;messages&quot;,
            &quot;AIMessage&quot;
          ],
          &quot;kwargs&quot;: &#123;
            &quot;content&quot;: &quot;physics&quot;,
            &quot;additional_kwargs&quot;: &#123;
              &quot;refusal&quot;: null
            &#125;,
            &quot;response_metadata&quot;: &#123;
              &quot;token_usage&quot;: &#123;
                &quot;completion_tokens&quot;: 1,
                &quot;prompt_tokens&quot;: 70,
                &quot;total_tokens&quot;: 71,
                &quot;completion_tokens_details&quot;: null,
                &quot;prompt_tokens_details&quot;: null
              &#125;,
              &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
              &quot;system_fingerprint&quot;: &quot;&quot;,
              &quot;id&quot;: &quot;019b2c39e27b1fad317acdebb0772e5d&quot;,
              &quot;service_tier&quot;: null,
              &quot;finish_reason&quot;: &quot;stop&quot;,
              &quot;logprobs&quot;: null
            &#125;,
            &quot;type&quot;: &quot;ai&quot;,
            &quot;id&quot;: &quot;run--21c42047-f032-4f69-a88b-2d4d73f451dc-0&quot;,
            &quot;usage_metadata&quot;: &#123;
              &quot;input_tokens&quot;: 70,
              &quot;output_tokens&quot;: 1,
              &quot;total_tokens&quot;: 71,
              &quot;input_token_details&quot;: &#123;&#125;,
              &quot;output_token_details&quot;: &#123;&#125;
            &#125;,
            &quot;tool_calls&quot;: [],
            &quot;invalid_tool_calls&quot;: []
          &#125;
        &#125;
      &#125;
    ]
  ],
  &quot;llm_output&quot;: &#123;
    &quot;token_usage&quot;: &#123;
      &quot;completion_tokens&quot;: 1,
      &quot;prompt_tokens&quot;: 70,
      &quot;total_tokens&quot;: 71,
      &quot;completion_tokens_details&quot;: null,
      &quot;prompt_tokens_details&quot;: null
    &#125;,
    &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
    &quot;system_fingerprint&quot;: &quot;&quot;,
    &quot;id&quot;: &quot;019b2c39e27b1fad317acdebb0772e5d&quot;,
    &quot;service_tier&quot;: null
  &#125;,
  &quot;run&quot;: null,
  &quot;type&quot;: &quot;LLMResult&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt; &gt; chain:RunnableParallel&lt;topic&gt; &gt; chain:RunnableSequence &gt; parser:StrOutputParser] Entering Parser run with input:
[0m[inputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt; &gt; chain:RunnableParallel&lt;topic&gt; &gt; chain:RunnableSequence &gt; parser:StrOutputParser] [1ms] Exiting Parser run with output:
[0m&#123;
  &quot;output&quot;: &quot;physics&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt; &gt; chain:RunnableParallel&lt;topic&gt; &gt; chain:RunnableSequence] [247ms] Exiting Chain run with output:
[0m&#123;
  &quot;output&quot;: &quot;physics&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt; &gt; chain:RunnableParallel&lt;topic&gt;] [249ms] Exiting Chain run with output:
[0m&#123;
  &quot;topic&quot;: &quot;physics&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt;] [250ms] Exiting Chain run with output:
[0m&#123;
  &quot;input&quot;: &quot;ä»€ä¹ˆæ˜¯é»‘ä½“è¾å°„ï¼Ÿ&quot;,
  &quot;topic&quot;: &quot;physics&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:route] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä»€ä¹ˆæ˜¯é»‘ä½“è¾å°„ï¼Ÿ&quot;,
  &quot;topic&quot;: &quot;physics&quot;
&#125;
DEBUG: è·¯ç”±åˆ†ç±»ç»“æœ -&gt; physics
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:route &gt; chain:RunnableSequence] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä»€ä¹ˆæ˜¯é»‘ä½“è¾å°„ï¼Ÿ&quot;,
  &quot;topic&quot;: &quot;physics&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:route &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] Entering Prompt run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä»€ä¹ˆæ˜¯é»‘ä½“è¾å°„ï¼Ÿ&quot;,
  &quot;topic&quot;: &quot;physics&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:route &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] [1ms] Exiting Prompt run with output:
[0m[outputs]
[32;1m[1;3m[llm/start][0m [1m[chain:RunnableSequence &gt; chain:route &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] Entering LLM run with input:
[0m&#123;
  &quot;prompts&quot;: [
    &quot;Human: ä½ æ˜¯ä¸€ä¸ªéå¸¸èªæ˜çš„ç‰©ç†ä¸“å®¶ã€‚è¿™æ˜¯ä¸€ä¸ªé—®é¢˜: ä»€ä¹ˆæ˜¯é»‘ä½“è¾å°„ï¼Ÿ&quot;
  ]
&#125;
[36;1m[1;3m[llm/end][0m [1m[chain:RunnableSequence &gt; chain:route &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] [2.51s] Exiting LLM run with output:
[0m&#123;
  &quot;generations&quot;: [
    [
      &#123;
        &quot;text&quot;: &quot;é»‘ä½“è¾å°„æ˜¯ç‰©ç†å­¦ä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼ŒæŒ‡çš„æ˜¯ç†æƒ³åŒ–çš„ç‰©ä½“ï¼ˆç§°ä¸ºé»‘ä½“ï¼‰åœ¨ä¸åŒæ¸©åº¦ä¸‹å‘å°„ç”µç£è¾å°„çš„ç°è±¡ã€‚é»‘ä½“æ˜¯ä¸€ç§èƒ½å¤Ÿå®Œå…¨å¸æ”¶å…¥å°„çš„æ‰€æœ‰ç”µç£è¾å°„çš„ç‰©ä½“ï¼Œå› æ­¤å®ƒåœ¨æ‰€æœ‰æ³¢é•¿ä¸Šéƒ½å…·æœ‰ç›¸åŒçš„è¾å°„å¼ºåº¦ã€‚å°½ç®¡åœ¨ç°å®ä¸­å¹¶ä¸å­˜åœ¨å®Œç¾çš„é»‘ä½“ï¼Œä½†ç§‘å­¦å®¶ä»¬é€šè¿‡ç†è®ºå’Œå®éªŒç ”ç©¶ï¼Œå¯¹é»‘ä½“è¾å°„çš„æ€§è´¨æœ‰äº†æ·±å…¥çš„ç†è§£ã€‚\n\né»‘ä½“è¾å°„çš„ç‰¹æ€§å¯ä»¥ç”¨ç»´æ©ä½ç§»å®šå¾‹å’Œæ™®æœ—å…‹å®šå¾‹æ¥æè¿°ã€‚ç»´æ©ä½ç§»å®šå¾‹æŒ‡å‡ºï¼Œé»‘ä½“è¾å°„çš„å³°å€¼æ³¢é•¿ä¸é»‘ä½“çš„ç»å¯¹æ¸©åº¦æˆåæ¯”å…³ç³»ã€‚æ™®æœ—å…‹å®šå¾‹åˆ™æè¿°äº†é»‘ä½“è¾å°„åœ¨ä¸åŒæ³¢é•¿ä¸Šçš„èƒ½é‡åˆ†å¸ƒï¼Œå®ƒè¡¨æ˜è¾å°„å¼ºåº¦éšæ³¢é•¿çš„å˜åŒ–éµå¾ªç‰¹å®šçš„æ•°å­¦å…³ç³»ï¼Œè¿™ä¸€å…³ç³»ä¸æ¸©åº¦æœ‰å…³ã€‚\n\né»‘ä½“è¾å°„çš„ç ”ç©¶ä¸ä»…å¯¹ç†è§£çƒ­è¾å°„çš„åŸºæœ¬åŸç†è‡³å…³é‡è¦ï¼Œè€Œä¸”åœ¨è®¸å¤šå®é™…åº”ç”¨ä¸­ä¹Ÿéå¸¸é‡è¦ï¼Œä¾‹å¦‚åœ¨å¤©ä½“ç‰©ç†å­¦ä¸­ç ”ç©¶æ’æ˜Ÿçš„æ€§è´¨ï¼Œåœ¨ææ–™ç§‘å­¦ä¸­ç ”ç©¶çƒ­ä¼ å¯¼å’Œçƒ­è¾å°„ï¼Œåœ¨å·¥ç¨‹å­¦ä¸­è®¾è®¡é«˜æ•ˆçš„çƒ­äº¤æ¢å™¨ç­‰ã€‚&quot;,
        &quot;generation_info&quot;: &#123;
          &quot;finish_reason&quot;: &quot;stop&quot;,
          &quot;logprobs&quot;: null
        &#125;,
        &quot;type&quot;: &quot;ChatGeneration&quot;,
        &quot;message&quot;: &#123;
          &quot;lc&quot;: 1,
          &quot;type&quot;: &quot;constructor&quot;,
          &quot;id&quot;: [
            &quot;langchain&quot;,
            &quot;schema&quot;,
            &quot;messages&quot;,
            &quot;AIMessage&quot;
          ],
          &quot;kwargs&quot;: &#123;
            &quot;content&quot;: &quot;é»‘ä½“è¾å°„æ˜¯ç‰©ç†å­¦ä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼ŒæŒ‡çš„æ˜¯ç†æƒ³åŒ–çš„ç‰©ä½“ï¼ˆç§°ä¸ºé»‘ä½“ï¼‰åœ¨ä¸åŒæ¸©åº¦ä¸‹å‘å°„ç”µç£è¾å°„çš„ç°è±¡ã€‚é»‘ä½“æ˜¯ä¸€ç§èƒ½å¤Ÿå®Œå…¨å¸æ”¶å…¥å°„çš„æ‰€æœ‰ç”µç£è¾å°„çš„ç‰©ä½“ï¼Œå› æ­¤å®ƒåœ¨æ‰€æœ‰æ³¢é•¿ä¸Šéƒ½å…·æœ‰ç›¸åŒçš„è¾å°„å¼ºåº¦ã€‚å°½ç®¡åœ¨ç°å®ä¸­å¹¶ä¸å­˜åœ¨å®Œç¾çš„é»‘ä½“ï¼Œä½†ç§‘å­¦å®¶ä»¬é€šè¿‡ç†è®ºå’Œå®éªŒç ”ç©¶ï¼Œå¯¹é»‘ä½“è¾å°„çš„æ€§è´¨æœ‰äº†æ·±å…¥çš„ç†è§£ã€‚\n\né»‘ä½“è¾å°„çš„ç‰¹æ€§å¯ä»¥ç”¨ç»´æ©ä½ç§»å®šå¾‹å’Œæ™®æœ—å…‹å®šå¾‹æ¥æè¿°ã€‚ç»´æ©ä½ç§»å®šå¾‹æŒ‡å‡ºï¼Œé»‘ä½“è¾å°„çš„å³°å€¼æ³¢é•¿ä¸é»‘ä½“çš„ç»å¯¹æ¸©åº¦æˆåæ¯”å…³ç³»ã€‚æ™®æœ—å…‹å®šå¾‹åˆ™æè¿°äº†é»‘ä½“è¾å°„åœ¨ä¸åŒæ³¢é•¿ä¸Šçš„èƒ½é‡åˆ†å¸ƒï¼Œå®ƒè¡¨æ˜è¾å°„å¼ºåº¦éšæ³¢é•¿çš„å˜åŒ–éµå¾ªç‰¹å®šçš„æ•°å­¦å…³ç³»ï¼Œè¿™ä¸€å…³ç³»ä¸æ¸©åº¦æœ‰å…³ã€‚\n\né»‘ä½“è¾å°„çš„ç ”ç©¶ä¸ä»…å¯¹ç†è§£çƒ­è¾å°„çš„åŸºæœ¬åŸç†è‡³å…³é‡è¦ï¼Œè€Œä¸”åœ¨è®¸å¤šå®é™…åº”ç”¨ä¸­ä¹Ÿéå¸¸é‡è¦ï¼Œä¾‹å¦‚åœ¨å¤©ä½“ç‰©ç†å­¦ä¸­ç ”ç©¶æ’æ˜Ÿçš„æ€§è´¨ï¼Œåœ¨ææ–™ç§‘å­¦ä¸­ç ”ç©¶çƒ­ä¼ å¯¼å’Œçƒ­è¾å°„ï¼Œåœ¨å·¥ç¨‹å­¦ä¸­è®¾è®¡é«˜æ•ˆçš„çƒ­äº¤æ¢å™¨ç­‰ã€‚&quot;,
            &quot;additional_kwargs&quot;: &#123;
              &quot;refusal&quot;: null
            &#125;,
            &quot;response_metadata&quot;: &#123;
              &quot;token_usage&quot;: &#123;
                &quot;completion_tokens&quot;: 218,
                &quot;prompt_tokens&quot;: 46,
                &quot;total_tokens&quot;: 264,
                &quot;completion_tokens_details&quot;: null,
                &quot;prompt_tokens_details&quot;: null
              &#125;,
              &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
              &quot;system_fingerprint&quot;: &quot;&quot;,
              &quot;id&quot;: &quot;019b2c39e31c4ac83ba0d6b0fccc8eba&quot;,
              &quot;service_tier&quot;: null,
              &quot;finish_reason&quot;: &quot;stop&quot;,
              &quot;logprobs&quot;: null
            &#125;,
            &quot;type&quot;: &quot;ai&quot;,
            &quot;id&quot;: &quot;run--fc856f66-b361-40ad-9986-1097f647d4f6-0&quot;,
            &quot;usage_metadata&quot;: &#123;
              &quot;input_tokens&quot;: 46,
              &quot;output_tokens&quot;: 218,
              &quot;total_tokens&quot;: 264,
              &quot;input_token_details&quot;: &#123;&#125;,
              &quot;output_token_details&quot;: &#123;&#125;
            &#125;,
            &quot;tool_calls&quot;: [],
            &quot;invalid_tool_calls&quot;: []
          &#125;
        &#125;
      &#125;
    ]
  ],
  &quot;llm_output&quot;: &#123;
    &quot;token_usage&quot;: &#123;
      &quot;completion_tokens&quot;: 218,
      &quot;prompt_tokens&quot;: 46,
      &quot;total_tokens&quot;: 264,
      &quot;completion_tokens_details&quot;: null,
      &quot;prompt_tokens_details&quot;: null
    &#125;,
    &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
    &quot;system_fingerprint&quot;: &quot;&quot;,
    &quot;id&quot;: &quot;019b2c39e31c4ac83ba0d6b0fccc8eba&quot;,
    &quot;service_tier&quot;: null
  &#125;,
  &quot;run&quot;: null,
  &quot;type&quot;: &quot;LLMResult&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:route &gt; chain:RunnableSequence &gt; parser:StrOutputParser] Entering Parser run with input:
[0m[inputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:route &gt; chain:RunnableSequence &gt; parser:StrOutputParser] [1ms] Exiting Parser run with output:
[0m&#123;
  &quot;output&quot;: &quot;é»‘ä½“è¾å°„æ˜¯ç‰©ç†å­¦ä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼ŒæŒ‡çš„æ˜¯ç†æƒ³åŒ–çš„ç‰©ä½“ï¼ˆç§°ä¸ºé»‘ä½“ï¼‰åœ¨ä¸åŒæ¸©åº¦ä¸‹å‘å°„ç”µç£è¾å°„çš„ç°è±¡ã€‚é»‘ä½“æ˜¯ä¸€ç§èƒ½å¤Ÿå®Œå…¨å¸æ”¶å…¥å°„çš„æ‰€æœ‰ç”µç£è¾å°„çš„ç‰©ä½“ï¼Œå› æ­¤å®ƒåœ¨æ‰€æœ‰æ³¢é•¿ä¸Šéƒ½å…·æœ‰ç›¸åŒçš„è¾å°„å¼ºåº¦ã€‚å°½ç®¡åœ¨ç°å®ä¸­å¹¶ä¸å­˜åœ¨å®Œç¾çš„é»‘ä½“ï¼Œä½†ç§‘å­¦å®¶ä»¬é€šè¿‡ç†è®ºå’Œå®éªŒç ”ç©¶ï¼Œå¯¹é»‘ä½“è¾å°„çš„æ€§è´¨æœ‰äº†æ·±å…¥çš„ç†è§£ã€‚\n\né»‘ä½“è¾å°„çš„ç‰¹æ€§å¯ä»¥ç”¨ç»´æ©ä½ç§»å®šå¾‹å’Œæ™®æœ—å…‹å®šå¾‹æ¥æè¿°ã€‚ç»´æ©ä½ç§»å®šå¾‹æŒ‡å‡ºï¼Œé»‘ä½“è¾å°„çš„å³°å€¼æ³¢é•¿ä¸é»‘ä½“çš„ç»å¯¹æ¸©åº¦æˆåæ¯”å…³ç³»ã€‚æ™®æœ—å…‹å®šå¾‹åˆ™æè¿°äº†é»‘ä½“è¾å°„åœ¨ä¸åŒæ³¢é•¿ä¸Šçš„èƒ½é‡åˆ†å¸ƒï¼Œå®ƒè¡¨æ˜è¾å°„å¼ºåº¦éšæ³¢é•¿çš„å˜åŒ–éµå¾ªç‰¹å®šçš„æ•°å­¦å…³ç³»ï¼Œè¿™ä¸€å…³ç³»ä¸æ¸©åº¦æœ‰å…³ã€‚\n\né»‘ä½“è¾å°„çš„ç ”ç©¶ä¸ä»…å¯¹ç†è§£çƒ­è¾å°„çš„åŸºæœ¬åŸç†è‡³å…³é‡è¦ï¼Œè€Œä¸”åœ¨è®¸å¤šå®é™…åº”ç”¨ä¸­ä¹Ÿéå¸¸é‡è¦ï¼Œä¾‹å¦‚åœ¨å¤©ä½“ç‰©ç†å­¦ä¸­ç ”ç©¶æ’æ˜Ÿçš„æ€§è´¨ï¼Œåœ¨ææ–™ç§‘å­¦ä¸­ç ”ç©¶çƒ­ä¼ å¯¼å’Œçƒ­è¾å°„ï¼Œåœ¨å·¥ç¨‹å­¦ä¸­è®¾è®¡é«˜æ•ˆçš„çƒ­äº¤æ¢å™¨ç­‰ã€‚&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:route &gt; chain:RunnableSequence] [2.52s] Exiting Chain run with output:
[0m&#123;
  &quot;output&quot;: &quot;é»‘ä½“è¾å°„æ˜¯ç‰©ç†å­¦ä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼ŒæŒ‡çš„æ˜¯ç†æƒ³åŒ–çš„ç‰©ä½“ï¼ˆç§°ä¸ºé»‘ä½“ï¼‰åœ¨ä¸åŒæ¸©åº¦ä¸‹å‘å°„ç”µç£è¾å°„çš„ç°è±¡ã€‚é»‘ä½“æ˜¯ä¸€ç§èƒ½å¤Ÿå®Œå…¨å¸æ”¶å…¥å°„çš„æ‰€æœ‰ç”µç£è¾å°„çš„ç‰©ä½“ï¼Œå› æ­¤å®ƒåœ¨æ‰€æœ‰æ³¢é•¿ä¸Šéƒ½å…·æœ‰ç›¸åŒçš„è¾å°„å¼ºåº¦ã€‚å°½ç®¡åœ¨ç°å®ä¸­å¹¶ä¸å­˜åœ¨å®Œç¾çš„é»‘ä½“ï¼Œä½†ç§‘å­¦å®¶ä»¬é€šè¿‡ç†è®ºå’Œå®éªŒç ”ç©¶ï¼Œå¯¹é»‘ä½“è¾å°„çš„æ€§è´¨æœ‰äº†æ·±å…¥çš„ç†è§£ã€‚\n\né»‘ä½“è¾å°„çš„ç‰¹æ€§å¯ä»¥ç”¨ç»´æ©ä½ç§»å®šå¾‹å’Œæ™®æœ—å…‹å®šå¾‹æ¥æè¿°ã€‚ç»´æ©ä½ç§»å®šå¾‹æŒ‡å‡ºï¼Œé»‘ä½“è¾å°„çš„å³°å€¼æ³¢é•¿ä¸é»‘ä½“çš„ç»å¯¹æ¸©åº¦æˆåæ¯”å…³ç³»ã€‚æ™®æœ—å…‹å®šå¾‹åˆ™æè¿°äº†é»‘ä½“è¾å°„åœ¨ä¸åŒæ³¢é•¿ä¸Šçš„èƒ½é‡åˆ†å¸ƒï¼Œå®ƒè¡¨æ˜è¾å°„å¼ºåº¦éšæ³¢é•¿çš„å˜åŒ–éµå¾ªç‰¹å®šçš„æ•°å­¦å…³ç³»ï¼Œè¿™ä¸€å…³ç³»ä¸æ¸©åº¦æœ‰å…³ã€‚\n\né»‘ä½“è¾å°„çš„ç ”ç©¶ä¸ä»…å¯¹ç†è§£çƒ­è¾å°„çš„åŸºæœ¬åŸç†è‡³å…³é‡è¦ï¼Œè€Œä¸”åœ¨è®¸å¤šå®é™…åº”ç”¨ä¸­ä¹Ÿéå¸¸é‡è¦ï¼Œä¾‹å¦‚åœ¨å¤©ä½“ç‰©ç†å­¦ä¸­ç ”ç©¶æ’æ˜Ÿçš„æ€§è´¨ï¼Œåœ¨ææ–™ç§‘å­¦ä¸­ç ”ç©¶çƒ­ä¼ å¯¼å’Œçƒ­è¾å°„ï¼Œåœ¨å·¥ç¨‹å­¦ä¸­è®¾è®¡é«˜æ•ˆçš„çƒ­äº¤æ¢å™¨ç­‰ã€‚&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:route] [2.52s] Exiting Chain run with output:
[0m&#123;
  &quot;output&quot;: &quot;é»‘ä½“è¾å°„æ˜¯ç‰©ç†å­¦ä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼ŒæŒ‡çš„æ˜¯ç†æƒ³åŒ–çš„ç‰©ä½“ï¼ˆç§°ä¸ºé»‘ä½“ï¼‰åœ¨ä¸åŒæ¸©åº¦ä¸‹å‘å°„ç”µç£è¾å°„çš„ç°è±¡ã€‚é»‘ä½“æ˜¯ä¸€ç§èƒ½å¤Ÿå®Œå…¨å¸æ”¶å…¥å°„çš„æ‰€æœ‰ç”µç£è¾å°„çš„ç‰©ä½“ï¼Œå› æ­¤å®ƒåœ¨æ‰€æœ‰æ³¢é•¿ä¸Šéƒ½å…·æœ‰ç›¸åŒçš„è¾å°„å¼ºåº¦ã€‚å°½ç®¡åœ¨ç°å®ä¸­å¹¶ä¸å­˜åœ¨å®Œç¾çš„é»‘ä½“ï¼Œä½†ç§‘å­¦å®¶ä»¬é€šè¿‡ç†è®ºå’Œå®éªŒç ”ç©¶ï¼Œå¯¹é»‘ä½“è¾å°„çš„æ€§è´¨æœ‰äº†æ·±å…¥çš„ç†è§£ã€‚\n\né»‘ä½“è¾å°„çš„ç‰¹æ€§å¯ä»¥ç”¨ç»´æ©ä½ç§»å®šå¾‹å’Œæ™®æœ—å…‹å®šå¾‹æ¥æè¿°ã€‚ç»´æ©ä½ç§»å®šå¾‹æŒ‡å‡ºï¼Œé»‘ä½“è¾å°„çš„å³°å€¼æ³¢é•¿ä¸é»‘ä½“çš„ç»å¯¹æ¸©åº¦æˆåæ¯”å…³ç³»ã€‚æ™®æœ—å…‹å®šå¾‹åˆ™æè¿°äº†é»‘ä½“è¾å°„åœ¨ä¸åŒæ³¢é•¿ä¸Šçš„èƒ½é‡åˆ†å¸ƒï¼Œå®ƒè¡¨æ˜è¾å°„å¼ºåº¦éšæ³¢é•¿çš„å˜åŒ–éµå¾ªç‰¹å®šçš„æ•°å­¦å…³ç³»ï¼Œè¿™ä¸€å…³ç³»ä¸æ¸©åº¦æœ‰å…³ã€‚\n\né»‘ä½“è¾å°„çš„ç ”ç©¶ä¸ä»…å¯¹ç†è§£çƒ­è¾å°„çš„åŸºæœ¬åŸç†è‡³å…³é‡è¦ï¼Œè€Œä¸”åœ¨è®¸å¤šå®é™…åº”ç”¨ä¸­ä¹Ÿéå¸¸é‡è¦ï¼Œä¾‹å¦‚åœ¨å¤©ä½“ç‰©ç†å­¦ä¸­ç ”ç©¶æ’æ˜Ÿçš„æ€§è´¨ï¼Œåœ¨ææ–™ç§‘å­¦ä¸­ç ”ç©¶çƒ­ä¼ å¯¼å’Œçƒ­è¾å°„ï¼Œåœ¨å·¥ç¨‹å­¦ä¸­è®¾è®¡é«˜æ•ˆçš„çƒ­äº¤æ¢å™¨ç­‰ã€‚&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence] [2.77s] Exiting Chain run with output:
[0m&#123;
  &quot;output&quot;: &quot;é»‘ä½“è¾å°„æ˜¯ç‰©ç†å­¦ä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼ŒæŒ‡çš„æ˜¯ç†æƒ³åŒ–çš„ç‰©ä½“ï¼ˆç§°ä¸ºé»‘ä½“ï¼‰åœ¨ä¸åŒæ¸©åº¦ä¸‹å‘å°„ç”µç£è¾å°„çš„ç°è±¡ã€‚é»‘ä½“æ˜¯ä¸€ç§èƒ½å¤Ÿå®Œå…¨å¸æ”¶å…¥å°„çš„æ‰€æœ‰ç”µç£è¾å°„çš„ç‰©ä½“ï¼Œå› æ­¤å®ƒåœ¨æ‰€æœ‰æ³¢é•¿ä¸Šéƒ½å…·æœ‰ç›¸åŒçš„è¾å°„å¼ºåº¦ã€‚å°½ç®¡åœ¨ç°å®ä¸­å¹¶ä¸å­˜åœ¨å®Œç¾çš„é»‘ä½“ï¼Œä½†ç§‘å­¦å®¶ä»¬é€šè¿‡ç†è®ºå’Œå®éªŒç ”ç©¶ï¼Œå¯¹é»‘ä½“è¾å°„çš„æ€§è´¨æœ‰äº†æ·±å…¥çš„ç†è§£ã€‚\n\né»‘ä½“è¾å°„çš„ç‰¹æ€§å¯ä»¥ç”¨ç»´æ©ä½ç§»å®šå¾‹å’Œæ™®æœ—å…‹å®šå¾‹æ¥æè¿°ã€‚ç»´æ©ä½ç§»å®šå¾‹æŒ‡å‡ºï¼Œé»‘ä½“è¾å°„çš„å³°å€¼æ³¢é•¿ä¸é»‘ä½“çš„ç»å¯¹æ¸©åº¦æˆåæ¯”å…³ç³»ã€‚æ™®æœ—å…‹å®šå¾‹åˆ™æè¿°äº†é»‘ä½“è¾å°„åœ¨ä¸åŒæ³¢é•¿ä¸Šçš„èƒ½é‡åˆ†å¸ƒï¼Œå®ƒè¡¨æ˜è¾å°„å¼ºåº¦éšæ³¢é•¿çš„å˜åŒ–éµå¾ªç‰¹å®šçš„æ•°å­¦å…³ç³»ï¼Œè¿™ä¸€å…³ç³»ä¸æ¸©åº¦æœ‰å…³ã€‚\n\né»‘ä½“è¾å°„çš„ç ”ç©¶ä¸ä»…å¯¹ç†è§£çƒ­è¾å°„çš„åŸºæœ¬åŸç†è‡³å…³é‡è¦ï¼Œè€Œä¸”åœ¨è®¸å¤šå®é™…åº”ç”¨ä¸­ä¹Ÿéå¸¸é‡è¦ï¼Œä¾‹å¦‚åœ¨å¤©ä½“ç‰©ç†å­¦ä¸­ç ”ç©¶æ’æ˜Ÿçš„æ€§è´¨ï¼Œåœ¨ææ–™ç§‘å­¦ä¸­ç ”ç©¶çƒ­ä¼ å¯¼å’Œçƒ­è¾å°„ï¼Œåœ¨å·¥ç¨‹å­¦ä¸­è®¾è®¡é«˜æ•ˆçš„çƒ­äº¤æ¢å™¨ç­‰ã€‚&quot;
&#125;
é»‘ä½“è¾å°„æ˜¯ç‰©ç†å­¦ä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼ŒæŒ‡çš„æ˜¯ç†æƒ³åŒ–çš„ç‰©ä½“ï¼ˆç§°ä¸ºé»‘ä½“ï¼‰åœ¨ä¸åŒæ¸©åº¦ä¸‹å‘å°„ç”µç£è¾å°„çš„ç°è±¡ã€‚é»‘ä½“æ˜¯ä¸€ç§èƒ½å¤Ÿå®Œå…¨å¸æ”¶å…¥å°„çš„æ‰€æœ‰ç”µç£è¾å°„çš„ç‰©ä½“ï¼Œå› æ­¤å®ƒåœ¨æ‰€æœ‰æ³¢é•¿ä¸Šéƒ½å…·æœ‰ç›¸åŒçš„è¾å°„å¼ºåº¦ã€‚å°½ç®¡åœ¨ç°å®ä¸­å¹¶ä¸å­˜åœ¨å®Œç¾çš„é»‘ä½“ï¼Œä½†ç§‘å­¦å®¶ä»¬é€šè¿‡ç†è®ºå’Œå®éªŒç ”ç©¶ï¼Œå¯¹é»‘ä½“è¾å°„çš„æ€§è´¨æœ‰äº†æ·±å…¥çš„ç†è§£ã€‚

é»‘ä½“è¾å°„çš„ç‰¹æ€§å¯ä»¥ç”¨ç»´æ©ä½ç§»å®šå¾‹å’Œæ™®æœ—å…‹å®šå¾‹æ¥æè¿°ã€‚ç»´æ©ä½ç§»å®šå¾‹æŒ‡å‡ºï¼Œé»‘ä½“è¾å°„çš„å³°å€¼æ³¢é•¿ä¸é»‘ä½“çš„ç»å¯¹æ¸©åº¦æˆåæ¯”å…³ç³»ã€‚æ™®æœ—å…‹å®šå¾‹åˆ™æè¿°äº†é»‘ä½“è¾å°„åœ¨ä¸åŒæ³¢é•¿ä¸Šçš„èƒ½é‡åˆ†å¸ƒï¼Œå®ƒè¡¨æ˜è¾å°„å¼ºåº¦éšæ³¢é•¿çš„å˜åŒ–éµå¾ªç‰¹å®šçš„æ•°å­¦å…³ç³»ï¼Œè¿™ä¸€å…³ç³»ä¸æ¸©åº¦æœ‰å…³ã€‚

é»‘ä½“è¾å°„çš„ç ”ç©¶ä¸ä»…å¯¹ç†è§£çƒ­è¾å°„çš„åŸºæœ¬åŸç†è‡³å…³é‡è¦ï¼Œè€Œä¸”åœ¨è®¸å¤šå®é™…åº”ç”¨ä¸­ä¹Ÿéå¸¸é‡è¦ï¼Œä¾‹å¦‚åœ¨å¤©ä½“ç‰©ç†å­¦ä¸­ç ”ç©¶æ’æ˜Ÿçš„æ€§è´¨ï¼Œåœ¨ææ–™ç§‘å­¦ä¸­ç ”ç©¶çƒ­ä¼ å¯¼å’Œçƒ­è¾å°„ï¼Œåœ¨å·¥ç¨‹å­¦ä¸­è®¾è®¡é«˜æ•ˆçš„çƒ­äº¤æ¢å™¨ç­‰ã€‚
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n--- æµ‹è¯•æ•°å­¦é—®é¢˜ ---&quot;</span>)<br><span class="hljs-built_in">print</span>(classification_chain.invoke(&#123;<span class="hljs-string">&quot;input&quot;</span>: <span class="hljs-string">&quot;2+2ç­‰äºå¤šå°‘ï¼Ÿ&quot;</span>&#125;))<br></code></pre></td></tr></table></figure>


<pre><code class="hljs">--- æµ‹è¯•æ•°å­¦é—®é¢˜ ---
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;2+2ç­‰äºå¤šå°‘ï¼Ÿ&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt;] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;2+2ç­‰äºå¤šå°‘ï¼Ÿ&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt; &gt; chain:RunnableParallel&lt;topic&gt;] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;2+2ç­‰äºå¤šå°‘ï¼Ÿ&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt; &gt; chain:RunnableParallel&lt;topic&gt; &gt; chain:RunnableSequence] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;2+2ç­‰äºå¤šå°‘ï¼Ÿ&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt; &gt; chain:RunnableParallel&lt;topic&gt; &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] Entering Prompt run with input:
[0m&#123;
  &quot;input&quot;: &quot;2+2ç­‰äºå¤šå°‘ï¼Ÿ&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt; &gt; chain:RunnableParallel&lt;topic&gt; &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] [2ms] Exiting Prompt run with output:
[0m[outputs]
[32;1m[1;3m[llm/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt; &gt; chain:RunnableParallel&lt;topic&gt; &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] Entering LLM run with input:
[0m&#123;
  &quot;prompts&quot;: [
    &quot;System: \nä½ æ˜¯ä¸€ä¸ªåˆ†ç±»åŠ©æ‰‹ã€‚ç»™å®šç”¨æˆ·çš„é—®é¢˜ï¼Œè¯·é€‰æ‹©æœ€é€‚åˆå›ç­”è¯¥é—®é¢˜çš„ä¸“å®¶ç±»å‹ã€‚\nåªè¾“å‡ºç±»åˆ«åç§°ï¼Œä¸è¦è¾“å‡ºå…¶ä»–ä»»ä½•å†…å®¹ã€‚\nå¯é€‰ç±»åˆ«: physics, math, history, computer_science\nå¦‚æœéƒ½ä¸åŒ¹é…ï¼Œè¾“å‡º: default\n\nHuman: 2+2ç­‰äºå¤šå°‘ï¼Ÿ&quot;
  ]
&#125;
[36;1m[1;3m[llm/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt; &gt; chain:RunnableParallel&lt;topic&gt; &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] [790ms] Exiting LLM run with output:
[0m&#123;
  &quot;generations&quot;: [
    [
      &#123;
        &quot;text&quot;: &quot;math&quot;,
        &quot;generation_info&quot;: &#123;
          &quot;finish_reason&quot;: &quot;stop&quot;,
          &quot;logprobs&quot;: null
        &#125;,
        &quot;type&quot;: &quot;ChatGeneration&quot;,
        &quot;message&quot;: &#123;
          &quot;lc&quot;: 1,
          &quot;type&quot;: &quot;constructor&quot;,
          &quot;id&quot;: [
            &quot;langchain&quot;,
            &quot;schema&quot;,
            &quot;messages&quot;,
            &quot;AIMessage&quot;
          ],
          &quot;kwargs&quot;: &#123;
            &quot;content&quot;: &quot;math&quot;,
            &quot;additional_kwargs&quot;: &#123;
              &quot;refusal&quot;: null
            &#125;,
            &quot;response_metadata&quot;: &#123;
              &quot;token_usage&quot;: &#123;
                &quot;completion_tokens&quot;: 1,
                &quot;prompt_tokens&quot;: 71,
                &quot;total_tokens&quot;: 72,
                &quot;completion_tokens_details&quot;: null,
                &quot;prompt_tokens_details&quot;: null
              &#125;,
              &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
              &quot;system_fingerprint&quot;: &quot;&quot;,
              &quot;id&quot;: &quot;019b2c4932713b361e8cf67058ee6ebe&quot;,
              &quot;service_tier&quot;: null,
              &quot;finish_reason&quot;: &quot;stop&quot;,
              &quot;logprobs&quot;: null
            &#125;,
            &quot;type&quot;: &quot;ai&quot;,
            &quot;id&quot;: &quot;run--27c04844-5c62-4dd8-9ed2-56f538c62439-0&quot;,
            &quot;usage_metadata&quot;: &#123;
              &quot;input_tokens&quot;: 71,
              &quot;output_tokens&quot;: 1,
              &quot;total_tokens&quot;: 72,
              &quot;input_token_details&quot;: &#123;&#125;,
              &quot;output_token_details&quot;: &#123;&#125;
            &#125;,
            &quot;tool_calls&quot;: [],
            &quot;invalid_tool_calls&quot;: []
          &#125;
        &#125;
      &#125;
    ]
  ],
  &quot;llm_output&quot;: &#123;
    &quot;token_usage&quot;: &#123;
      &quot;completion_tokens&quot;: 1,
      &quot;prompt_tokens&quot;: 71,
      &quot;total_tokens&quot;: 72,
      &quot;completion_tokens_details&quot;: null,
      &quot;prompt_tokens_details&quot;: null
    &#125;,
    &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
    &quot;system_fingerprint&quot;: &quot;&quot;,
    &quot;id&quot;: &quot;019b2c4932713b361e8cf67058ee6ebe&quot;,
    &quot;service_tier&quot;: null
  &#125;,
  &quot;run&quot;: null,
  &quot;type&quot;: &quot;LLMResult&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt; &gt; chain:RunnableParallel&lt;topic&gt; &gt; chain:RunnableSequence &gt; parser:StrOutputParser] Entering Parser run with input:
[0m[inputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt; &gt; chain:RunnableParallel&lt;topic&gt; &gt; chain:RunnableSequence &gt; parser:StrOutputParser] [0ms] Exiting Parser run with output:
[0m&#123;
  &quot;output&quot;: &quot;math&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt; &gt; chain:RunnableParallel&lt;topic&gt; &gt; chain:RunnableSequence] [798ms] Exiting Chain run with output:
[0m&#123;
  &quot;output&quot;: &quot;math&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt; &gt; chain:RunnableParallel&lt;topic&gt;] [802ms] Exiting Chain run with output:
[0m&#123;
  &quot;topic&quot;: &quot;math&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt;] [803ms] Exiting Chain run with output:
[0m&#123;
  &quot;input&quot;: &quot;2+2ç­‰äºå¤šå°‘ï¼Ÿ&quot;,
  &quot;topic&quot;: &quot;math&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:route] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;2+2ç­‰äºå¤šå°‘ï¼Ÿ&quot;,
  &quot;topic&quot;: &quot;math&quot;
&#125;
DEBUG: è·¯ç”±åˆ†ç±»ç»“æœ -&gt; math
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:route &gt; chain:RunnableSequence] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;2+2ç­‰äºå¤šå°‘ï¼Ÿ&quot;,
  &quot;topic&quot;: &quot;math&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:route &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] Entering Prompt run with input:
[0m&#123;
  &quot;input&quot;: &quot;2+2ç­‰äºå¤šå°‘ï¼Ÿ&quot;,
  &quot;topic&quot;: &quot;math&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:route &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] [0ms] Exiting Prompt run with output:
[0m[outputs]
[32;1m[1;3m[llm/start][0m [1m[chain:RunnableSequence &gt; chain:route &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] Entering LLM run with input:
[0m&#123;
  &quot;prompts&quot;: [
    &quot;Human: ä½ æ˜¯ä¸€ä¸ªéå¸¸ä¼˜ç§€çš„æ•°å­¦å®¶ã€‚è¿™æ˜¯ä¸€ä¸ªé—®é¢˜ï¼š2+2ç­‰äºå¤šå°‘ï¼Ÿ&quot;
  ]
&#125;
[36;1m[1;3m[llm/end][0m [1m[chain:RunnableSequence &gt; chain:route &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] [602ms] Exiting LLM run with output:
[0m&#123;
  &quot;generations&quot;: [
    [
      &#123;
        &quot;text&quot;: &quot;2+2ç­‰äº4ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬çš„åŠ æ³•è¿ç®—ï¼Œç»“æœæ˜¯ç¡®å®šçš„ã€‚&quot;,
        &quot;generation_info&quot;: &#123;
          &quot;finish_reason&quot;: &quot;stop&quot;,
          &quot;logprobs&quot;: null
        &#125;,
        &quot;type&quot;: &quot;ChatGeneration&quot;,
        &quot;message&quot;: &#123;
          &quot;lc&quot;: 1,
          &quot;type&quot;: &quot;constructor&quot;,
          &quot;id&quot;: [
            &quot;langchain&quot;,
            &quot;schema&quot;,
            &quot;messages&quot;,
            &quot;AIMessage&quot;
          ],
          &quot;kwargs&quot;: &#123;
            &quot;content&quot;: &quot;2+2ç­‰äº4ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬çš„åŠ æ³•è¿ç®—ï¼Œç»“æœæ˜¯ç¡®å®šçš„ã€‚&quot;,
            &quot;additional_kwargs&quot;: &#123;
              &quot;refusal&quot;: null
            &#125;,
            &quot;response_metadata&quot;: &#123;
              &quot;token_usage&quot;: &#123;
                &quot;completion_tokens&quot;: 18,
                &quot;prompt_tokens&quot;: 45,
                &quot;total_tokens&quot;: 63,
                &quot;completion_tokens_details&quot;: null,
                &quot;prompt_tokens_details&quot;: null
              &#125;,
              &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
              &quot;system_fingerprint&quot;: &quot;&quot;,
              &quot;id&quot;: &quot;019b2c4934a4348c3e5720d60c9ac5fa&quot;,
              &quot;service_tier&quot;: null,
              &quot;finish_reason&quot;: &quot;stop&quot;,
              &quot;logprobs&quot;: null
            &#125;,
            &quot;type&quot;: &quot;ai&quot;,
            &quot;id&quot;: &quot;run--afc397ef-5b23-495c-9423-6f00290c973e-0&quot;,
            &quot;usage_metadata&quot;: &#123;
              &quot;input_tokens&quot;: 45,
              &quot;output_tokens&quot;: 18,
              &quot;total_tokens&quot;: 63,
              &quot;input_token_details&quot;: &#123;&#125;,
              &quot;output_token_details&quot;: &#123;&#125;
            &#125;,
            &quot;tool_calls&quot;: [],
            &quot;invalid_tool_calls&quot;: []
          &#125;
        &#125;
      &#125;
    ]
  ],
  &quot;llm_output&quot;: &#123;
    &quot;token_usage&quot;: &#123;
      &quot;completion_tokens&quot;: 18,
      &quot;prompt_tokens&quot;: 45,
      &quot;total_tokens&quot;: 63,
      &quot;completion_tokens_details&quot;: null,
      &quot;prompt_tokens_details&quot;: null
    &#125;,
    &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
    &quot;system_fingerprint&quot;: &quot;&quot;,
    &quot;id&quot;: &quot;019b2c4934a4348c3e5720d60c9ac5fa&quot;,
    &quot;service_tier&quot;: null
  &#125;,
  &quot;run&quot;: null,
  &quot;type&quot;: &quot;LLMResult&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:route &gt; chain:RunnableSequence &gt; parser:StrOutputParser] Entering Parser run with input:
[0m[inputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:route &gt; chain:RunnableSequence &gt; parser:StrOutputParser] [1ms] Exiting Parser run with output:
[0m&#123;
  &quot;output&quot;: &quot;2+2ç­‰äº4ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬çš„åŠ æ³•è¿ç®—ï¼Œç»“æœæ˜¯ç¡®å®šçš„ã€‚&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:route &gt; chain:RunnableSequence] [605ms] Exiting Chain run with output:
[0m&#123;
  &quot;output&quot;: &quot;2+2ç­‰äº4ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬çš„åŠ æ³•è¿ç®—ï¼Œç»“æœæ˜¯ç¡®å®šçš„ã€‚&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:route] [606ms] Exiting Chain run with output:
[0m&#123;
  &quot;output&quot;: &quot;2+2ç­‰äº4ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬çš„åŠ æ³•è¿ç®—ï¼Œç»“æœæ˜¯ç¡®å®šçš„ã€‚&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence] [1.41s] Exiting Chain run with output:
[0m&#123;
  &quot;output&quot;: &quot;2+2ç­‰äº4ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬çš„åŠ æ³•è¿ç®—ï¼Œç»“æœæ˜¯ç¡®å®šçš„ã€‚&quot;
&#125;
2+2ç­‰äº4ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬çš„åŠ æ³•è¿ç®—ï¼Œç»“æœæ˜¯ç¡®å®šçš„ã€‚
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n--- æµ‹è¯•æ— å…³é—®é¢˜ (ç”Ÿç‰©) ---&quot;</span>)<br><span class="hljs-built_in">print</span>(classification_chain.invoke(&#123;<span class="hljs-string">&quot;input&quot;</span>: <span class="hljs-string">&quot;ä¸ºä»€ä¹ˆæˆ‘ä»¬èº«ä½“é‡Œçš„æ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼Ÿ&quot;</span>&#125;))<br></code></pre></td></tr></table></figure>


<pre><code class="hljs">--- æµ‹è¯•æ— å…³é—®é¢˜ (ç”Ÿç‰©) ---
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä¸ºä»€ä¹ˆæˆ‘ä»¬èº«ä½“é‡Œçš„æ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼Ÿ&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt;] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä¸ºä»€ä¹ˆæˆ‘ä»¬èº«ä½“é‡Œçš„æ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼Ÿ&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt; &gt; chain:RunnableParallel&lt;topic&gt;] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä¸ºä»€ä¹ˆæˆ‘ä»¬èº«ä½“é‡Œçš„æ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼Ÿ&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt; &gt; chain:RunnableParallel&lt;topic&gt; &gt; chain:RunnableSequence] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä¸ºä»€ä¹ˆæˆ‘ä»¬èº«ä½“é‡Œçš„æ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼Ÿ&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt; &gt; chain:RunnableParallel&lt;topic&gt; &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] Entering Prompt run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä¸ºä»€ä¹ˆæˆ‘ä»¬èº«ä½“é‡Œçš„æ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼Ÿ&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt; &gt; chain:RunnableParallel&lt;topic&gt; &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] [1ms] Exiting Prompt run with output:
[0m[outputs]
[32;1m[1;3m[llm/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt; &gt; chain:RunnableParallel&lt;topic&gt; &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] Entering LLM run with input:
[0m&#123;
  &quot;prompts&quot;: [
    &quot;System: \nä½ æ˜¯ä¸€ä¸ªåˆ†ç±»åŠ©æ‰‹ã€‚ç»™å®šç”¨æˆ·çš„é—®é¢˜ï¼Œè¯·é€‰æ‹©æœ€é€‚åˆå›ç­”è¯¥é—®é¢˜çš„ä¸“å®¶ç±»å‹ã€‚\nåªè¾“å‡ºç±»åˆ«åç§°ï¼Œä¸è¦è¾“å‡ºå…¶ä»–ä»»ä½•å†…å®¹ã€‚\nå¯é€‰ç±»åˆ«: physics, math, history, computer_science\nå¦‚æœéƒ½ä¸åŒ¹é…ï¼Œè¾“å‡º: default\n\nHuman: ä¸ºä»€ä¹ˆæˆ‘ä»¬èº«ä½“é‡Œçš„æ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼Ÿ&quot;
  ]
&#125;
[36;1m[1;3m[llm/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt; &gt; chain:RunnableParallel&lt;topic&gt; &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] [117ms] Exiting LLM run with output:
[0m&#123;
  &quot;generations&quot;: [
    [
      &#123;
        &quot;text&quot;: &quot;biology&quot;,
        &quot;generation_info&quot;: &#123;
          &quot;finish_reason&quot;: &quot;stop&quot;,
          &quot;logprobs&quot;: null
        &#125;,
        &quot;type&quot;: &quot;ChatGeneration&quot;,
        &quot;message&quot;: &#123;
          &quot;lc&quot;: 1,
          &quot;type&quot;: &quot;constructor&quot;,
          &quot;id&quot;: [
            &quot;langchain&quot;,
            &quot;schema&quot;,
            &quot;messages&quot;,
            &quot;AIMessage&quot;
          ],
          &quot;kwargs&quot;: &#123;
            &quot;content&quot;: &quot;biology&quot;,
            &quot;additional_kwargs&quot;: &#123;
              &quot;refusal&quot;: null
            &#125;,
            &quot;response_metadata&quot;: &#123;
              &quot;token_usage&quot;: &#123;
                &quot;completion_tokens&quot;: 1,
                &quot;prompt_tokens&quot;: 75,
                &quot;total_tokens&quot;: 76,
                &quot;completion_tokens_details&quot;: null,
                &quot;prompt_tokens_details&quot;: null
              &#125;,
              &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
              &quot;system_fingerprint&quot;: &quot;&quot;,
              &quot;id&quot;: &quot;019b2c49432009bd1b63cca2787006bb&quot;,
              &quot;service_tier&quot;: null,
              &quot;finish_reason&quot;: &quot;stop&quot;,
              &quot;logprobs&quot;: null
            &#125;,
            &quot;type&quot;: &quot;ai&quot;,
            &quot;id&quot;: &quot;run--fac04505-5cab-4498-a53b-adc7baa46c4a-0&quot;,
            &quot;usage_metadata&quot;: &#123;
              &quot;input_tokens&quot;: 75,
              &quot;output_tokens&quot;: 1,
              &quot;total_tokens&quot;: 76,
              &quot;input_token_details&quot;: &#123;&#125;,
              &quot;output_token_details&quot;: &#123;&#125;
            &#125;,
            &quot;tool_calls&quot;: [],
            &quot;invalid_tool_calls&quot;: []
          &#125;
        &#125;
      &#125;
    ]
  ],
  &quot;llm_output&quot;: &#123;
    &quot;token_usage&quot;: &#123;
      &quot;completion_tokens&quot;: 1,
      &quot;prompt_tokens&quot;: 75,
      &quot;total_tokens&quot;: 76,
      &quot;completion_tokens_details&quot;: null,
      &quot;prompt_tokens_details&quot;: null
    &#125;,
    &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
    &quot;system_fingerprint&quot;: &quot;&quot;,
    &quot;id&quot;: &quot;019b2c49432009bd1b63cca2787006bb&quot;,
    &quot;service_tier&quot;: null
  &#125;,
  &quot;run&quot;: null,
  &quot;type&quot;: &quot;LLMResult&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt; &gt; chain:RunnableParallel&lt;topic&gt; &gt; chain:RunnableSequence &gt; parser:StrOutputParser] Entering Parser run with input:
[0m[inputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt; &gt; chain:RunnableParallel&lt;topic&gt; &gt; chain:RunnableSequence &gt; parser:StrOutputParser] [1ms] Exiting Parser run with output:
[0m&#123;
  &quot;output&quot;: &quot;biology&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt; &gt; chain:RunnableParallel&lt;topic&gt; &gt; chain:RunnableSequence] [122ms] Exiting Chain run with output:
[0m&#123;
  &quot;output&quot;: &quot;biology&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt; &gt; chain:RunnableParallel&lt;topic&gt;] [124ms] Exiting Chain run with output:
[0m&#123;
  &quot;topic&quot;: &quot;biology&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:RunnableAssign&lt;topic&gt;] [125ms] Exiting Chain run with output:
[0m&#123;
  &quot;input&quot;: &quot;ä¸ºä»€ä¹ˆæˆ‘ä»¬èº«ä½“é‡Œçš„æ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼Ÿ&quot;,
  &quot;topic&quot;: &quot;biology&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:route] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä¸ºä»€ä¹ˆæˆ‘ä»¬èº«ä½“é‡Œçš„æ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼Ÿ&quot;,
  &quot;topic&quot;: &quot;biology&quot;
&#125;
DEBUG: è·¯ç”±åˆ†ç±»ç»“æœ -&gt; biology
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:route &gt; chain:RunnableSequence] Entering Chain run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä¸ºä»€ä¹ˆæˆ‘ä»¬èº«ä½“é‡Œçš„æ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼Ÿ&quot;,
  &quot;topic&quot;: &quot;biology&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:route &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] Entering Prompt run with input:
[0m&#123;
  &quot;input&quot;: &quot;ä¸ºä»€ä¹ˆæˆ‘ä»¬èº«ä½“é‡Œçš„æ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼Ÿ&quot;,
  &quot;topic&quot;: &quot;biology&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:route &gt; chain:RunnableSequence &gt; prompt:ChatPromptTemplate] [1ms] Exiting Prompt run with output:
[0m[outputs]
[32;1m[1;3m[llm/start][0m [1m[chain:RunnableSequence &gt; chain:route &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] Entering LLM run with input:
[0m&#123;
  &quot;prompts&quot;: [
    &quot;Human: ä¸ºä»€ä¹ˆæˆ‘ä»¬èº«ä½“é‡Œçš„æ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼Ÿ&quot;
  ]
&#125;
[36;1m[1;3m[llm/end][0m [1m[chain:RunnableSequence &gt; chain:route &gt; chain:RunnableSequence &gt; llm:ChatOpenAI] [3.13s] Exiting LLM run with output:
[0m&#123;
  &quot;generations&quot;: [
    [
      &#123;
        &quot;text&quot;: &quot;æˆ‘ä»¬èº«ä½“é‡Œçš„æ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼Œè¿™æ˜¯å› ä¸ºDNAï¼ˆè„±æ°§æ ¸ç³–æ ¸é…¸ï¼‰æ˜¯ç”Ÿç‰©ä½“é—ä¼ ä¿¡æ¯çš„ä¸»è¦è½½ä½“ã€‚DNAåŒ…å«äº†æ„å»ºå’Œç»´æŒç”Ÿç‰©ä½“æ‰€éœ€çš„æ‰€æœ‰æŒ‡ä»¤ï¼Œè¿™äº›ä¿¡æ¯é€šè¿‡åŸºå› çš„å½¢å¼å­˜å‚¨åœ¨DNAåˆ†å­ä¸­ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªå…³é”®ç‚¹è§£é‡Šä¸ºä»€ä¹ˆæ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼š\n\n1. **é—ä¼ ä¿¡æ¯çš„ä¼ é€’**ï¼šDNAä¸­çš„é—ä¼ ä¿¡æ¯ç¡®ä¿äº†ç”Ÿç‰©ä½“èƒ½å¤Ÿä»ä¸€ä»£ä¼ é€’åˆ°ä¸‹ä¸€ä»£ã€‚æ¯ä¸ªç»†èƒéƒ½åŒ…å«ä¸€å¥—å®Œæ•´çš„é—ä¼ ä¿¡æ¯ï¼Œè¿™æ ·åœ¨ç»†èƒåˆ†è£‚æ—¶ï¼Œæ–°çš„ç»†èƒä¹Ÿèƒ½è·å¾—å®Œæ•´çš„é—ä¼ ä¿¡æ¯ã€‚\n\n2. **ç»†èƒåŠŸèƒ½çš„æŒ‡å¯¼**ï¼šDNAæŒ‡å¯¼ç»†èƒå¦‚ä½•æ‰§è¡Œå…¶ç‰¹å®šçš„åŠŸèƒ½ã€‚ä¸åŒçš„ç»†èƒç±»å‹ï¼ˆå¦‚ç¥ç»ç»†èƒã€è‚Œè‚‰ç»†èƒç­‰ï¼‰é€šè¿‡è¡¨è¾¾ä¸åŒçš„åŸºå› æ¥æ‰§è¡Œç‰¹å®šçš„åŠŸèƒ½ã€‚æ¯ä¸ªç»†èƒéƒ½åŒ…å«æ‰€æœ‰åŸºå› ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰åŸºå› åœ¨æ¯ä¸ªç»†èƒä¸­éƒ½è¢«è¡¨è¾¾ã€‚\n\n3. **ç»†èƒåˆ†è£‚å’Œä¿®å¤**ï¼šåœ¨ç»†èƒåˆ†è£‚è¿‡ç¨‹ä¸­ï¼ŒDNAå¤åˆ¶è‡ªèº«ï¼Œç¡®ä¿æ¯ä¸ªæ–°ç»†èƒéƒ½èƒ½è·å¾—ä¸€å¥—å®Œæ•´çš„é—ä¼ ä¿¡æ¯ã€‚æ­¤å¤–ï¼ŒDNAè¿˜å‚ä¸ç»†èƒä¿®å¤è¿‡ç¨‹ï¼Œå¸®åŠ©ä¿®å¤å—æŸçš„DNAï¼Œç»´æŒç»†èƒçš„æ­£å¸¸åŠŸèƒ½ã€‚\n\n4. **é€‚åº”æ€§å’Œè¿›åŒ–**ï¼šDNAä¸­çš„é—ä¼ ä¿¡æ¯å¯¹äºç”Ÿç‰©ä½“é€‚åº”ç¯å¢ƒå˜åŒ–è‡³å…³é‡è¦ã€‚é€šè¿‡è‡ªç„¶é€‰æ‹©ï¼Œé‚£äº›èƒ½å¤Ÿæ›´å¥½åœ°é€‚åº”ç¯å¢ƒçš„ç”Ÿç‰©ä½“æ›´æœ‰å¯èƒ½ç”Ÿå­˜ä¸‹æ¥å¹¶ä¼ é€’å…¶é—ä¼ ä¿¡æ¯ã€‚\n\nå°½ç®¡æ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰ç»†èƒéƒ½ä»¥ç›¸åŒçš„æ–¹å¼è¡¨è¾¾æ‰€æœ‰åŸºå› ã€‚ä¾‹å¦‚ï¼Œç¥ç»ç»†èƒå’Œè‚Œè‚‰ç»†èƒè™½ç„¶éƒ½åŒ…å«ç›¸åŒçš„DNAï¼Œä½†å®ƒä»¬è¡¨è¾¾çš„åŸºå› é›†ä¸åŒï¼Œè¿™å†³å®šäº†å®ƒä»¬å„è‡ªçš„åŠŸèƒ½å’Œç‰¹æ€§ã€‚&quot;,
        &quot;generation_info&quot;: &#123;
          &quot;finish_reason&quot;: &quot;stop&quot;,
          &quot;logprobs&quot;: null
        &#125;,
        &quot;type&quot;: &quot;ChatGeneration&quot;,
        &quot;message&quot;: &#123;
          &quot;lc&quot;: 1,
          &quot;type&quot;: &quot;constructor&quot;,
          &quot;id&quot;: [
            &quot;langchain&quot;,
            &quot;schema&quot;,
            &quot;messages&quot;,
            &quot;AIMessage&quot;
          ],
          &quot;kwargs&quot;: &#123;
            &quot;content&quot;: &quot;æˆ‘ä»¬èº«ä½“é‡Œçš„æ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼Œè¿™æ˜¯å› ä¸ºDNAï¼ˆè„±æ°§æ ¸ç³–æ ¸é…¸ï¼‰æ˜¯ç”Ÿç‰©ä½“é—ä¼ ä¿¡æ¯çš„ä¸»è¦è½½ä½“ã€‚DNAåŒ…å«äº†æ„å»ºå’Œç»´æŒç”Ÿç‰©ä½“æ‰€éœ€çš„æ‰€æœ‰æŒ‡ä»¤ï¼Œè¿™äº›ä¿¡æ¯é€šè¿‡åŸºå› çš„å½¢å¼å­˜å‚¨åœ¨DNAåˆ†å­ä¸­ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªå…³é”®ç‚¹è§£é‡Šä¸ºä»€ä¹ˆæ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼š\n\n1. **é—ä¼ ä¿¡æ¯çš„ä¼ é€’**ï¼šDNAä¸­çš„é—ä¼ ä¿¡æ¯ç¡®ä¿äº†ç”Ÿç‰©ä½“èƒ½å¤Ÿä»ä¸€ä»£ä¼ é€’åˆ°ä¸‹ä¸€ä»£ã€‚æ¯ä¸ªç»†èƒéƒ½åŒ…å«ä¸€å¥—å®Œæ•´çš„é—ä¼ ä¿¡æ¯ï¼Œè¿™æ ·åœ¨ç»†èƒåˆ†è£‚æ—¶ï¼Œæ–°çš„ç»†èƒä¹Ÿèƒ½è·å¾—å®Œæ•´çš„é—ä¼ ä¿¡æ¯ã€‚\n\n2. **ç»†èƒåŠŸèƒ½çš„æŒ‡å¯¼**ï¼šDNAæŒ‡å¯¼ç»†èƒå¦‚ä½•æ‰§è¡Œå…¶ç‰¹å®šçš„åŠŸèƒ½ã€‚ä¸åŒçš„ç»†èƒç±»å‹ï¼ˆå¦‚ç¥ç»ç»†èƒã€è‚Œè‚‰ç»†èƒç­‰ï¼‰é€šè¿‡è¡¨è¾¾ä¸åŒçš„åŸºå› æ¥æ‰§è¡Œç‰¹å®šçš„åŠŸèƒ½ã€‚æ¯ä¸ªç»†èƒéƒ½åŒ…å«æ‰€æœ‰åŸºå› ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰åŸºå› åœ¨æ¯ä¸ªç»†èƒä¸­éƒ½è¢«è¡¨è¾¾ã€‚\n\n3. **ç»†èƒåˆ†è£‚å’Œä¿®å¤**ï¼šåœ¨ç»†èƒåˆ†è£‚è¿‡ç¨‹ä¸­ï¼ŒDNAå¤åˆ¶è‡ªèº«ï¼Œç¡®ä¿æ¯ä¸ªæ–°ç»†èƒéƒ½èƒ½è·å¾—ä¸€å¥—å®Œæ•´çš„é—ä¼ ä¿¡æ¯ã€‚æ­¤å¤–ï¼ŒDNAè¿˜å‚ä¸ç»†èƒä¿®å¤è¿‡ç¨‹ï¼Œå¸®åŠ©ä¿®å¤å—æŸçš„DNAï¼Œç»´æŒç»†èƒçš„æ­£å¸¸åŠŸèƒ½ã€‚\n\n4. **é€‚åº”æ€§å’Œè¿›åŒ–**ï¼šDNAä¸­çš„é—ä¼ ä¿¡æ¯å¯¹äºç”Ÿç‰©ä½“é€‚åº”ç¯å¢ƒå˜åŒ–è‡³å…³é‡è¦ã€‚é€šè¿‡è‡ªç„¶é€‰æ‹©ï¼Œé‚£äº›èƒ½å¤Ÿæ›´å¥½åœ°é€‚åº”ç¯å¢ƒçš„ç”Ÿç‰©ä½“æ›´æœ‰å¯èƒ½ç”Ÿå­˜ä¸‹æ¥å¹¶ä¼ é€’å…¶é—ä¼ ä¿¡æ¯ã€‚\n\nå°½ç®¡æ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰ç»†èƒéƒ½ä»¥ç›¸åŒçš„æ–¹å¼è¡¨è¾¾æ‰€æœ‰åŸºå› ã€‚ä¾‹å¦‚ï¼Œç¥ç»ç»†èƒå’Œè‚Œè‚‰ç»†èƒè™½ç„¶éƒ½åŒ…å«ç›¸åŒçš„DNAï¼Œä½†å®ƒä»¬è¡¨è¾¾çš„åŸºå› é›†ä¸åŒï¼Œè¿™å†³å®šäº†å®ƒä»¬å„è‡ªçš„åŠŸèƒ½å’Œç‰¹æ€§ã€‚&quot;,
            &quot;additional_kwargs&quot;: &#123;
              &quot;refusal&quot;: null
            &#125;,
            &quot;response_metadata&quot;: &#123;
              &quot;token_usage&quot;: &#123;
                &quot;completion_tokens&quot;: 304,
                &quot;prompt_tokens&quot;: 39,
                &quot;total_tokens&quot;: 343,
                &quot;completion_tokens_details&quot;: null,
                &quot;prompt_tokens_details&quot;: null
              &#125;,
              &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
              &quot;system_fingerprint&quot;: &quot;&quot;,
              &quot;id&quot;: &quot;019b2c49438fcc9dd6bfd09e940711a2&quot;,
              &quot;service_tier&quot;: null,
              &quot;finish_reason&quot;: &quot;stop&quot;,
              &quot;logprobs&quot;: null
            &#125;,
            &quot;type&quot;: &quot;ai&quot;,
            &quot;id&quot;: &quot;run--9a4d75ab-d6b8-41e0-8417-bd06b4061a7f-0&quot;,
            &quot;usage_metadata&quot;: &#123;
              &quot;input_tokens&quot;: 39,
              &quot;output_tokens&quot;: 304,
              &quot;total_tokens&quot;: 343,
              &quot;input_token_details&quot;: &#123;&#125;,
              &quot;output_token_details&quot;: &#123;&#125;
            &#125;,
            &quot;tool_calls&quot;: [],
            &quot;invalid_tool_calls&quot;: []
          &#125;
        &#125;
      &#125;
    ]
  ],
  &quot;llm_output&quot;: &#123;
    &quot;token_usage&quot;: &#123;
      &quot;completion_tokens&quot;: 304,
      &quot;prompt_tokens&quot;: 39,
      &quot;total_tokens&quot;: 343,
      &quot;completion_tokens_details&quot;: null,
      &quot;prompt_tokens_details&quot;: null
    &#125;,
    &quot;model_name&quot;: &quot;Qwen/Qwen2.5-7B-Instruct&quot;,
    &quot;system_fingerprint&quot;: &quot;&quot;,
    &quot;id&quot;: &quot;019b2c49438fcc9dd6bfd09e940711a2&quot;,
    &quot;service_tier&quot;: null
  &#125;,
  &quot;run&quot;: null,
  &quot;type&quot;: &quot;LLMResult&quot;
&#125;
[32;1m[1;3m[chain/start][0m [1m[chain:RunnableSequence &gt; chain:route &gt; chain:RunnableSequence &gt; parser:StrOutputParser] Entering Parser run with input:
[0m[inputs]
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:route &gt; chain:RunnableSequence &gt; parser:StrOutputParser] [0ms] Exiting Parser run with output:
[0m&#123;
  &quot;output&quot;: &quot;æˆ‘ä»¬èº«ä½“é‡Œçš„æ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼Œè¿™æ˜¯å› ä¸ºDNAï¼ˆè„±æ°§æ ¸ç³–æ ¸é…¸ï¼‰æ˜¯ç”Ÿç‰©ä½“é—ä¼ ä¿¡æ¯çš„ä¸»è¦è½½ä½“ã€‚DNAåŒ…å«äº†æ„å»ºå’Œç»´æŒç”Ÿç‰©ä½“æ‰€éœ€çš„æ‰€æœ‰æŒ‡ä»¤ï¼Œè¿™äº›ä¿¡æ¯é€šè¿‡åŸºå› çš„å½¢å¼å­˜å‚¨åœ¨DNAåˆ†å­ä¸­ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªå…³é”®ç‚¹è§£é‡Šä¸ºä»€ä¹ˆæ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼š\n\n1. **é—ä¼ ä¿¡æ¯çš„ä¼ é€’**ï¼šDNAä¸­çš„é—ä¼ ä¿¡æ¯ç¡®ä¿äº†ç”Ÿç‰©ä½“èƒ½å¤Ÿä»ä¸€ä»£ä¼ é€’åˆ°ä¸‹ä¸€ä»£ã€‚æ¯ä¸ªç»†èƒéƒ½åŒ…å«ä¸€å¥—å®Œæ•´çš„é—ä¼ ä¿¡æ¯ï¼Œè¿™æ ·åœ¨ç»†èƒåˆ†è£‚æ—¶ï¼Œæ–°çš„ç»†èƒä¹Ÿèƒ½è·å¾—å®Œæ•´çš„é—ä¼ ä¿¡æ¯ã€‚\n\n2. **ç»†èƒåŠŸèƒ½çš„æŒ‡å¯¼**ï¼šDNAæŒ‡å¯¼ç»†èƒå¦‚ä½•æ‰§è¡Œå…¶ç‰¹å®šçš„åŠŸèƒ½ã€‚ä¸åŒçš„ç»†èƒç±»å‹ï¼ˆå¦‚ç¥ç»ç»†èƒã€è‚Œè‚‰ç»†èƒç­‰ï¼‰é€šè¿‡è¡¨è¾¾ä¸åŒçš„åŸºå› æ¥æ‰§è¡Œç‰¹å®šçš„åŠŸèƒ½ã€‚æ¯ä¸ªç»†èƒéƒ½åŒ…å«æ‰€æœ‰åŸºå› ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰åŸºå› åœ¨æ¯ä¸ªç»†èƒä¸­éƒ½è¢«è¡¨è¾¾ã€‚\n\n3. **ç»†èƒåˆ†è£‚å’Œä¿®å¤**ï¼šåœ¨ç»†èƒåˆ†è£‚è¿‡ç¨‹ä¸­ï¼ŒDNAå¤åˆ¶è‡ªèº«ï¼Œç¡®ä¿æ¯ä¸ªæ–°ç»†èƒéƒ½èƒ½è·å¾—ä¸€å¥—å®Œæ•´çš„é—ä¼ ä¿¡æ¯ã€‚æ­¤å¤–ï¼ŒDNAè¿˜å‚ä¸ç»†èƒä¿®å¤è¿‡ç¨‹ï¼Œå¸®åŠ©ä¿®å¤å—æŸçš„DNAï¼Œç»´æŒç»†èƒçš„æ­£å¸¸åŠŸèƒ½ã€‚\n\n4. **é€‚åº”æ€§å’Œè¿›åŒ–**ï¼šDNAä¸­çš„é—ä¼ ä¿¡æ¯å¯¹äºç”Ÿç‰©ä½“é€‚åº”ç¯å¢ƒå˜åŒ–è‡³å…³é‡è¦ã€‚é€šè¿‡è‡ªç„¶é€‰æ‹©ï¼Œé‚£äº›èƒ½å¤Ÿæ›´å¥½åœ°é€‚åº”ç¯å¢ƒçš„ç”Ÿç‰©ä½“æ›´æœ‰å¯èƒ½ç”Ÿå­˜ä¸‹æ¥å¹¶ä¼ é€’å…¶é—ä¼ ä¿¡æ¯ã€‚\n\nå°½ç®¡æ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰ç»†èƒéƒ½ä»¥ç›¸åŒçš„æ–¹å¼è¡¨è¾¾æ‰€æœ‰åŸºå› ã€‚ä¾‹å¦‚ï¼Œç¥ç»ç»†èƒå’Œè‚Œè‚‰ç»†èƒè™½ç„¶éƒ½åŒ…å«ç›¸åŒçš„DNAï¼Œä½†å®ƒä»¬è¡¨è¾¾çš„åŸºå› é›†ä¸åŒï¼Œè¿™å†³å®šäº†å®ƒä»¬å„è‡ªçš„åŠŸèƒ½å’Œç‰¹æ€§ã€‚&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:route &gt; chain:RunnableSequence] [3.14s] Exiting Chain run with output:
[0m&#123;
  &quot;output&quot;: &quot;æˆ‘ä»¬èº«ä½“é‡Œçš„æ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼Œè¿™æ˜¯å› ä¸ºDNAï¼ˆè„±æ°§æ ¸ç³–æ ¸é…¸ï¼‰æ˜¯ç”Ÿç‰©ä½“é—ä¼ ä¿¡æ¯çš„ä¸»è¦è½½ä½“ã€‚DNAåŒ…å«äº†æ„å»ºå’Œç»´æŒç”Ÿç‰©ä½“æ‰€éœ€çš„æ‰€æœ‰æŒ‡ä»¤ï¼Œè¿™äº›ä¿¡æ¯é€šè¿‡åŸºå› çš„å½¢å¼å­˜å‚¨åœ¨DNAåˆ†å­ä¸­ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªå…³é”®ç‚¹è§£é‡Šä¸ºä»€ä¹ˆæ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼š\n\n1. **é—ä¼ ä¿¡æ¯çš„ä¼ é€’**ï¼šDNAä¸­çš„é—ä¼ ä¿¡æ¯ç¡®ä¿äº†ç”Ÿç‰©ä½“èƒ½å¤Ÿä»ä¸€ä»£ä¼ é€’åˆ°ä¸‹ä¸€ä»£ã€‚æ¯ä¸ªç»†èƒéƒ½åŒ…å«ä¸€å¥—å®Œæ•´çš„é—ä¼ ä¿¡æ¯ï¼Œè¿™æ ·åœ¨ç»†èƒåˆ†è£‚æ—¶ï¼Œæ–°çš„ç»†èƒä¹Ÿèƒ½è·å¾—å®Œæ•´çš„é—ä¼ ä¿¡æ¯ã€‚\n\n2. **ç»†èƒåŠŸèƒ½çš„æŒ‡å¯¼**ï¼šDNAæŒ‡å¯¼ç»†èƒå¦‚ä½•æ‰§è¡Œå…¶ç‰¹å®šçš„åŠŸèƒ½ã€‚ä¸åŒçš„ç»†èƒç±»å‹ï¼ˆå¦‚ç¥ç»ç»†èƒã€è‚Œè‚‰ç»†èƒç­‰ï¼‰é€šè¿‡è¡¨è¾¾ä¸åŒçš„åŸºå› æ¥æ‰§è¡Œç‰¹å®šçš„åŠŸèƒ½ã€‚æ¯ä¸ªç»†èƒéƒ½åŒ…å«æ‰€æœ‰åŸºå› ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰åŸºå› åœ¨æ¯ä¸ªç»†èƒä¸­éƒ½è¢«è¡¨è¾¾ã€‚\n\n3. **ç»†èƒåˆ†è£‚å’Œä¿®å¤**ï¼šåœ¨ç»†èƒåˆ†è£‚è¿‡ç¨‹ä¸­ï¼ŒDNAå¤åˆ¶è‡ªèº«ï¼Œç¡®ä¿æ¯ä¸ªæ–°ç»†èƒéƒ½èƒ½è·å¾—ä¸€å¥—å®Œæ•´çš„é—ä¼ ä¿¡æ¯ã€‚æ­¤å¤–ï¼ŒDNAè¿˜å‚ä¸ç»†èƒä¿®å¤è¿‡ç¨‹ï¼Œå¸®åŠ©ä¿®å¤å—æŸçš„DNAï¼Œç»´æŒç»†èƒçš„æ­£å¸¸åŠŸèƒ½ã€‚\n\n4. **é€‚åº”æ€§å’Œè¿›åŒ–**ï¼šDNAä¸­çš„é—ä¼ ä¿¡æ¯å¯¹äºç”Ÿç‰©ä½“é€‚åº”ç¯å¢ƒå˜åŒ–è‡³å…³é‡è¦ã€‚é€šè¿‡è‡ªç„¶é€‰æ‹©ï¼Œé‚£äº›èƒ½å¤Ÿæ›´å¥½åœ°é€‚åº”ç¯å¢ƒçš„ç”Ÿç‰©ä½“æ›´æœ‰å¯èƒ½ç”Ÿå­˜ä¸‹æ¥å¹¶ä¼ é€’å…¶é—ä¼ ä¿¡æ¯ã€‚\n\nå°½ç®¡æ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰ç»†èƒéƒ½ä»¥ç›¸åŒçš„æ–¹å¼è¡¨è¾¾æ‰€æœ‰åŸºå› ã€‚ä¾‹å¦‚ï¼Œç¥ç»ç»†èƒå’Œè‚Œè‚‰ç»†èƒè™½ç„¶éƒ½åŒ…å«ç›¸åŒçš„DNAï¼Œä½†å®ƒä»¬è¡¨è¾¾çš„åŸºå› é›†ä¸åŒï¼Œè¿™å†³å®šäº†å®ƒä»¬å„è‡ªçš„åŠŸèƒ½å’Œç‰¹æ€§ã€‚&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence &gt; chain:route] [3.14s] Exiting Chain run with output:
[0m&#123;
  &quot;output&quot;: &quot;æˆ‘ä»¬èº«ä½“é‡Œçš„æ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼Œè¿™æ˜¯å› ä¸ºDNAï¼ˆè„±æ°§æ ¸ç³–æ ¸é…¸ï¼‰æ˜¯ç”Ÿç‰©ä½“é—ä¼ ä¿¡æ¯çš„ä¸»è¦è½½ä½“ã€‚DNAåŒ…å«äº†æ„å»ºå’Œç»´æŒç”Ÿç‰©ä½“æ‰€éœ€çš„æ‰€æœ‰æŒ‡ä»¤ï¼Œè¿™äº›ä¿¡æ¯é€šè¿‡åŸºå› çš„å½¢å¼å­˜å‚¨åœ¨DNAåˆ†å­ä¸­ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªå…³é”®ç‚¹è§£é‡Šä¸ºä»€ä¹ˆæ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼š\n\n1. **é—ä¼ ä¿¡æ¯çš„ä¼ é€’**ï¼šDNAä¸­çš„é—ä¼ ä¿¡æ¯ç¡®ä¿äº†ç”Ÿç‰©ä½“èƒ½å¤Ÿä»ä¸€ä»£ä¼ é€’åˆ°ä¸‹ä¸€ä»£ã€‚æ¯ä¸ªç»†èƒéƒ½åŒ…å«ä¸€å¥—å®Œæ•´çš„é—ä¼ ä¿¡æ¯ï¼Œè¿™æ ·åœ¨ç»†èƒåˆ†è£‚æ—¶ï¼Œæ–°çš„ç»†èƒä¹Ÿèƒ½è·å¾—å®Œæ•´çš„é—ä¼ ä¿¡æ¯ã€‚\n\n2. **ç»†èƒåŠŸèƒ½çš„æŒ‡å¯¼**ï¼šDNAæŒ‡å¯¼ç»†èƒå¦‚ä½•æ‰§è¡Œå…¶ç‰¹å®šçš„åŠŸèƒ½ã€‚ä¸åŒçš„ç»†èƒç±»å‹ï¼ˆå¦‚ç¥ç»ç»†èƒã€è‚Œè‚‰ç»†èƒç­‰ï¼‰é€šè¿‡è¡¨è¾¾ä¸åŒçš„åŸºå› æ¥æ‰§è¡Œç‰¹å®šçš„åŠŸèƒ½ã€‚æ¯ä¸ªç»†èƒéƒ½åŒ…å«æ‰€æœ‰åŸºå› ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰åŸºå› åœ¨æ¯ä¸ªç»†èƒä¸­éƒ½è¢«è¡¨è¾¾ã€‚\n\n3. **ç»†èƒåˆ†è£‚å’Œä¿®å¤**ï¼šåœ¨ç»†èƒåˆ†è£‚è¿‡ç¨‹ä¸­ï¼ŒDNAå¤åˆ¶è‡ªèº«ï¼Œç¡®ä¿æ¯ä¸ªæ–°ç»†èƒéƒ½èƒ½è·å¾—ä¸€å¥—å®Œæ•´çš„é—ä¼ ä¿¡æ¯ã€‚æ­¤å¤–ï¼ŒDNAè¿˜å‚ä¸ç»†èƒä¿®å¤è¿‡ç¨‹ï¼Œå¸®åŠ©ä¿®å¤å—æŸçš„DNAï¼Œç»´æŒç»†èƒçš„æ­£å¸¸åŠŸèƒ½ã€‚\n\n4. **é€‚åº”æ€§å’Œè¿›åŒ–**ï¼šDNAä¸­çš„é—ä¼ ä¿¡æ¯å¯¹äºç”Ÿç‰©ä½“é€‚åº”ç¯å¢ƒå˜åŒ–è‡³å…³é‡è¦ã€‚é€šè¿‡è‡ªç„¶é€‰æ‹©ï¼Œé‚£äº›èƒ½å¤Ÿæ›´å¥½åœ°é€‚åº”ç¯å¢ƒçš„ç”Ÿç‰©ä½“æ›´æœ‰å¯èƒ½ç”Ÿå­˜ä¸‹æ¥å¹¶ä¼ é€’å…¶é—ä¼ ä¿¡æ¯ã€‚\n\nå°½ç®¡æ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰ç»†èƒéƒ½ä»¥ç›¸åŒçš„æ–¹å¼è¡¨è¾¾æ‰€æœ‰åŸºå› ã€‚ä¾‹å¦‚ï¼Œç¥ç»ç»†èƒå’Œè‚Œè‚‰ç»†èƒè™½ç„¶éƒ½åŒ…å«ç›¸åŒçš„DNAï¼Œä½†å®ƒä»¬è¡¨è¾¾çš„åŸºå› é›†ä¸åŒï¼Œè¿™å†³å®šäº†å®ƒä»¬å„è‡ªçš„åŠŸèƒ½å’Œç‰¹æ€§ã€‚&quot;
&#125;
[36;1m[1;3m[chain/end][0m [1m[chain:RunnableSequence] [3.27s] Exiting Chain run with output:
[0m&#123;
  &quot;output&quot;: &quot;æˆ‘ä»¬èº«ä½“é‡Œçš„æ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼Œè¿™æ˜¯å› ä¸ºDNAï¼ˆè„±æ°§æ ¸ç³–æ ¸é…¸ï¼‰æ˜¯ç”Ÿç‰©ä½“é—ä¼ ä¿¡æ¯çš„ä¸»è¦è½½ä½“ã€‚DNAåŒ…å«äº†æ„å»ºå’Œç»´æŒç”Ÿç‰©ä½“æ‰€éœ€çš„æ‰€æœ‰æŒ‡ä»¤ï¼Œè¿™äº›ä¿¡æ¯é€šè¿‡åŸºå› çš„å½¢å¼å­˜å‚¨åœ¨DNAåˆ†å­ä¸­ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªå…³é”®ç‚¹è§£é‡Šä¸ºä»€ä¹ˆæ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼š\n\n1. **é—ä¼ ä¿¡æ¯çš„ä¼ é€’**ï¼šDNAä¸­çš„é—ä¼ ä¿¡æ¯ç¡®ä¿äº†ç”Ÿç‰©ä½“èƒ½å¤Ÿä»ä¸€ä»£ä¼ é€’åˆ°ä¸‹ä¸€ä»£ã€‚æ¯ä¸ªç»†èƒéƒ½åŒ…å«ä¸€å¥—å®Œæ•´çš„é—ä¼ ä¿¡æ¯ï¼Œè¿™æ ·åœ¨ç»†èƒåˆ†è£‚æ—¶ï¼Œæ–°çš„ç»†èƒä¹Ÿèƒ½è·å¾—å®Œæ•´çš„é—ä¼ ä¿¡æ¯ã€‚\n\n2. **ç»†èƒåŠŸèƒ½çš„æŒ‡å¯¼**ï¼šDNAæŒ‡å¯¼ç»†èƒå¦‚ä½•æ‰§è¡Œå…¶ç‰¹å®šçš„åŠŸèƒ½ã€‚ä¸åŒçš„ç»†èƒç±»å‹ï¼ˆå¦‚ç¥ç»ç»†èƒã€è‚Œè‚‰ç»†èƒç­‰ï¼‰é€šè¿‡è¡¨è¾¾ä¸åŒçš„åŸºå› æ¥æ‰§è¡Œç‰¹å®šçš„åŠŸèƒ½ã€‚æ¯ä¸ªç»†èƒéƒ½åŒ…å«æ‰€æœ‰åŸºå› ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰åŸºå› åœ¨æ¯ä¸ªç»†èƒä¸­éƒ½è¢«è¡¨è¾¾ã€‚\n\n3. **ç»†èƒåˆ†è£‚å’Œä¿®å¤**ï¼šåœ¨ç»†èƒåˆ†è£‚è¿‡ç¨‹ä¸­ï¼ŒDNAå¤åˆ¶è‡ªèº«ï¼Œç¡®ä¿æ¯ä¸ªæ–°ç»†èƒéƒ½èƒ½è·å¾—ä¸€å¥—å®Œæ•´çš„é—ä¼ ä¿¡æ¯ã€‚æ­¤å¤–ï¼ŒDNAè¿˜å‚ä¸ç»†èƒä¿®å¤è¿‡ç¨‹ï¼Œå¸®åŠ©ä¿®å¤å—æŸçš„DNAï¼Œç»´æŒç»†èƒçš„æ­£å¸¸åŠŸèƒ½ã€‚\n\n4. **é€‚åº”æ€§å’Œè¿›åŒ–**ï¼šDNAä¸­çš„é—ä¼ ä¿¡æ¯å¯¹äºç”Ÿç‰©ä½“é€‚åº”ç¯å¢ƒå˜åŒ–è‡³å…³é‡è¦ã€‚é€šè¿‡è‡ªç„¶é€‰æ‹©ï¼Œé‚£äº›èƒ½å¤Ÿæ›´å¥½åœ°é€‚åº”ç¯å¢ƒçš„ç”Ÿç‰©ä½“æ›´æœ‰å¯èƒ½ç”Ÿå­˜ä¸‹æ¥å¹¶ä¼ é€’å…¶é—ä¼ ä¿¡æ¯ã€‚\n\nå°½ç®¡æ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰ç»†èƒéƒ½ä»¥ç›¸åŒçš„æ–¹å¼è¡¨è¾¾æ‰€æœ‰åŸºå› ã€‚ä¾‹å¦‚ï¼Œç¥ç»ç»†èƒå’Œè‚Œè‚‰ç»†èƒè™½ç„¶éƒ½åŒ…å«ç›¸åŒçš„DNAï¼Œä½†å®ƒä»¬è¡¨è¾¾çš„åŸºå› é›†ä¸åŒï¼Œè¿™å†³å®šäº†å®ƒä»¬å„è‡ªçš„åŠŸèƒ½å’Œç‰¹æ€§ã€‚&quot;
&#125;
æˆ‘ä»¬èº«ä½“é‡Œçš„æ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼Œè¿™æ˜¯å› ä¸ºDNAï¼ˆè„±æ°§æ ¸ç³–æ ¸é…¸ï¼‰æ˜¯ç”Ÿç‰©ä½“é—ä¼ ä¿¡æ¯çš„ä¸»è¦è½½ä½“ã€‚DNAåŒ…å«äº†æ„å»ºå’Œç»´æŒç”Ÿç‰©ä½“æ‰€éœ€çš„æ‰€æœ‰æŒ‡ä»¤ï¼Œè¿™äº›ä¿¡æ¯é€šè¿‡åŸºå› çš„å½¢å¼å­˜å‚¨åœ¨DNAåˆ†å­ä¸­ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªå…³é”®ç‚¹è§£é‡Šä¸ºä»€ä¹ˆæ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼š

1. **é—ä¼ ä¿¡æ¯çš„ä¼ é€’**ï¼šDNAä¸­çš„é—ä¼ ä¿¡æ¯ç¡®ä¿äº†ç”Ÿç‰©ä½“èƒ½å¤Ÿä»ä¸€ä»£ä¼ é€’åˆ°ä¸‹ä¸€ä»£ã€‚æ¯ä¸ªç»†èƒéƒ½åŒ…å«ä¸€å¥—å®Œæ•´çš„é—ä¼ ä¿¡æ¯ï¼Œè¿™æ ·åœ¨ç»†èƒåˆ†è£‚æ—¶ï¼Œæ–°çš„ç»†èƒä¹Ÿèƒ½è·å¾—å®Œæ•´çš„é—ä¼ ä¿¡æ¯ã€‚

2. **ç»†èƒåŠŸèƒ½çš„æŒ‡å¯¼**ï¼šDNAæŒ‡å¯¼ç»†èƒå¦‚ä½•æ‰§è¡Œå…¶ç‰¹å®šçš„åŠŸèƒ½ã€‚ä¸åŒçš„ç»†èƒç±»å‹ï¼ˆå¦‚ç¥ç»ç»†èƒã€è‚Œè‚‰ç»†èƒç­‰ï¼‰é€šè¿‡è¡¨è¾¾ä¸åŒçš„åŸºå› æ¥æ‰§è¡Œç‰¹å®šçš„åŠŸèƒ½ã€‚æ¯ä¸ªç»†èƒéƒ½åŒ…å«æ‰€æœ‰åŸºå› ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰åŸºå› åœ¨æ¯ä¸ªç»†èƒä¸­éƒ½è¢«è¡¨è¾¾ã€‚

3. **ç»†èƒåˆ†è£‚å’Œä¿®å¤**ï¼šåœ¨ç»†èƒåˆ†è£‚è¿‡ç¨‹ä¸­ï¼ŒDNAå¤åˆ¶è‡ªèº«ï¼Œç¡®ä¿æ¯ä¸ªæ–°ç»†èƒéƒ½èƒ½è·å¾—ä¸€å¥—å®Œæ•´çš„é—ä¼ ä¿¡æ¯ã€‚æ­¤å¤–ï¼ŒDNAè¿˜å‚ä¸ç»†èƒä¿®å¤è¿‡ç¨‹ï¼Œå¸®åŠ©ä¿®å¤å—æŸçš„DNAï¼Œç»´æŒç»†èƒçš„æ­£å¸¸åŠŸèƒ½ã€‚

4. **é€‚åº”æ€§å’Œè¿›åŒ–**ï¼šDNAä¸­çš„é—ä¼ ä¿¡æ¯å¯¹äºç”Ÿç‰©ä½“é€‚åº”ç¯å¢ƒå˜åŒ–è‡³å…³é‡è¦ã€‚é€šè¿‡è‡ªç„¶é€‰æ‹©ï¼Œé‚£äº›èƒ½å¤Ÿæ›´å¥½åœ°é€‚åº”ç¯å¢ƒçš„ç”Ÿç‰©ä½“æ›´æœ‰å¯èƒ½ç”Ÿå­˜ä¸‹æ¥å¹¶ä¼ é€’å…¶é—ä¼ ä¿¡æ¯ã€‚

å°½ç®¡æ¯ä¸ªç»†èƒéƒ½åŒ…å«DNAï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰ç»†èƒéƒ½ä»¥ç›¸åŒçš„æ–¹å¼è¡¨è¾¾æ‰€æœ‰åŸºå› ã€‚ä¾‹å¦‚ï¼Œç¥ç»ç»†èƒå’Œè‚Œè‚‰ç»†èƒè™½ç„¶éƒ½åŒ…å«ç›¸åŒçš„DNAï¼Œä½†å®ƒä»¬è¡¨è¾¾çš„åŸºå› é›†ä¸åŒï¼Œè¿™å†³å®šäº†å®ƒä»¬å„è‡ªçš„åŠŸèƒ½å’Œç‰¹æ€§ã€‚
</code></pre>
<h2 id="ç¬¬äº”ç« -åŸºäºæ–‡æ¡£çš„é—®ç­”ï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰"><a href="#ç¬¬äº”ç« -åŸºäºæ–‡æ¡£çš„é—®ç­”ï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰" class="headerlink" title="ç¬¬äº”ç«  åŸºäºæ–‡æ¡£çš„é—®ç­”ï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰"></a>ç¬¬äº”ç«  åŸºäºæ–‡æ¡£çš„é—®ç­”ï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰</h2><p>ä½¿ç”¨å¤§è¯­è¨€æ¨¡å‹æ„å»ºä¸€ä¸ªèƒ½å¤Ÿå›ç­”å…³äºç»™å®šæ–‡æ¡£å’Œæ–‡æ¡£é›†åˆçš„é—®ç­”ç³»ç»Ÿæ˜¯ä¸€ç§éå¸¸å®ç”¨å’Œæœ‰æ•ˆçš„åº”ç”¨åœºæ™¯ã€‚ä¸ä»…ä¾èµ–æ¨¡å‹é¢„è®­ç»ƒçŸ¥è¯†ä¸åŒï¼Œè¿™ç§æ–¹æ³•å¯ä»¥è¿›ä¸€æ­¥æ•´åˆç”¨æˆ·è‡ªæœ‰æ•°æ®ï¼Œå®ç°æ›´åŠ ä¸ªæ€§åŒ–å’Œä¸“ä¸šçš„é—®ç­”æœåŠ¡ã€‚ä¾‹å¦‚,æˆ‘ä»¬å¯ä»¥æ”¶é›†æŸå…¬å¸çš„å†…éƒ¨æ–‡æ¡£ã€äº§å“è¯´æ˜ä¹¦ç­‰æ–‡å­—èµ„æ–™ï¼Œå¯¼å…¥é—®ç­”ç³»ç»Ÿä¸­ã€‚ç„¶åç”¨æˆ·é’ˆå¯¹è¿™äº›æ–‡æ¡£æå‡ºé—®é¢˜æ—¶ï¼Œç³»ç»Ÿå¯ä»¥å…ˆåœ¨æ–‡æ¡£ä¸­æ£€ç´¢ç›¸å…³ä¿¡æ¯ï¼Œå†æä¾›ç»™è¯­è¨€æ¨¡å‹ç”Ÿæˆç­”æ¡ˆã€‚</p>
<p>è¿™æ ·ï¼Œè¯­è¨€æ¨¡å‹ä¸ä»…åˆ©ç”¨äº†è‡ªå·±çš„é€šç”¨çŸ¥è¯†ï¼Œè¿˜å¯ä»¥å……åˆ†è¿ç”¨å¤–éƒ¨è¾“å…¥æ–‡æ¡£çš„ä¸“ä¸šä¿¡æ¯æ¥å›ç­”ç”¨æˆ·é—®é¢˜ï¼Œæ˜¾è‘—æå‡ç­”æ¡ˆçš„è´¨é‡å’Œé€‚ç”¨æ€§ã€‚æ„å»ºè¿™ç±»åŸºäºå¤–éƒ¨æ–‡æ¡£çš„é—®ç­”ç³»ç»Ÿï¼Œå¯ä»¥è®©è¯­è¨€æ¨¡å‹æ›´å¥½åœ°æœåŠ¡äºå…·ä½“åœºæ™¯ï¼Œè€Œä¸æ˜¯åœç•™åœ¨é€šç”¨å±‚é¢ã€‚è¿™ç§çµæ´»åº”ç”¨è¯­è¨€æ¨¡å‹çš„æ–¹æ³•å€¼å¾—åœ¨å®é™…ä½¿ç”¨ä¸­æ¨å¹¿ã€‚</p>
<p>åŸºäºæ–‡æ¡£é—®ç­”çš„è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬ä¼šæ¶‰åŠ LangChain ä¸­çš„å…¶ä»–ç»„ä»¶ï¼Œæ¯”å¦‚ï¼šåµŒå…¥æ¨¡å‹ï¼ˆEmbedding Models)å’Œå‘é‡å‚¨å­˜(Vector Stores)</p>
<p>ä» v0.1 åˆ° v0.3ï¼Œè¿™éƒ¨åˆ†å‘ç”Ÿäº†å¾ˆå¤šå˜åŒ–ï¼š<br>1åŒ…çš„æ‹†åˆ†ï¼šOpenAI çš„ç›¸å…³åŠŸèƒ½ç§»åˆ°äº† langchain_openaiã€‚<br>2å‘é‡åº“ç°åœ¨ä¸»æµæ¨èä½¿ç”¨ FAISS (CPUç‰ˆ) æˆ– Chroma ä½œä¸ºæœ¬åœ°å‘é‡åº“ã€‚<br>3é“¾çš„æ„å»ºæ–¹å¼ï¼šä½¿ç”¨ API æ–¹æ³• (create_retrieval_chain) ç»“åˆ LCELã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n=== 1. åˆå§‹åŒ–ä¸æ•°æ®åŠ è½½ ===&quot;</span>)<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;tool&#x27;</span> <span class="hljs-keyword">in</span> sys.modules:<br>    <span class="hljs-keyword">del</span> sys.modules[<span class="hljs-string">&#x27;tool&#x27;</span>]<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">from</span> IPython.display <span class="hljs-keyword">import</span> display, Markdown<br><br><span class="hljs-comment"># 1.1 ç¯å¢ƒé…ç½®ä¸æ¨¡å‹åŠ è½½</span><br><span class="hljs-comment"># å‡è®¾ tool æ¨¡å—å·²ç»é€‚é…</span><br>sys.path.append(<span class="hljs-string">&#x27;/home/py/shared/StudyChatgpt&#x27;</span>)<br><span class="hljs-keyword">from</span> tool <span class="hljs-keyword">import</span> get_chat_model2  <br><br><span class="hljs-comment"># è·å– LLM (å¯¹åº”åŸä»£ç çš„ ChatOpenAI)</span><br>llm = get_chat_model2(temperature=<span class="hljs-number">0.0</span>)<br><br><span class="hljs-comment"># 1.2 å¯¼å…¥ v0.3 æ ¸å¿ƒç»„ä»¶</span><br><span class="hljs-keyword">from</span> langchain_community.document_loaders <span class="hljs-keyword">import</span> CSVLoader<br><span class="hljs-keyword">from</span> langchain_community.vectorstores <span class="hljs-keyword">import</span> FAISS <span class="hljs-comment"># FAISS æ˜¯ç›®å‰æœ€ç¨³å¥çš„æœ¬åœ°å‘é‡åº“</span><br><span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate<br><span class="hljs-keyword">from</span> langchain_core.output_parsers <span class="hljs-keyword">import</span> StrOutputParser<br><span class="hljs-keyword">from</span> langchain_core.runnables <span class="hljs-keyword">import</span> RunnablePassthrough<br><br><span class="hljs-comment"># 1.3 åŠ è½½æ•°æ®</span><br>file = <span class="hljs-string">&#x27;data/OutdoorClothingCatalog_1000.csv&#x27;</span><br><br><span class="hljs-comment">#ç”¨äºå°†CSVæ–‡ä»¶åŠ è½½ä¸ºDocumentå¯¹è±¡çš„åˆ—è¡¨</span><br><span class="hljs-comment"># å¯¹æ¯ä¸€è¡Œæ•°æ®ï¼š</span><br><span class="hljs-comment"># ç¡®å®šæ–‡æ¡£æº(source)</span><br><span class="hljs-comment"># æ„å»ºæ–‡æ¡£å†…å®¹(content)</span><br><span class="hljs-comment"># åˆ›å»ºå…ƒæ•°æ®(metadata)</span><br><span class="hljs-comment"># ç”ŸæˆDocumentå¯¹è±¡</span><br><span class="hljs-comment"># ç”¨äºï¼šæ–‡æ¡£åˆ†æå’Œç´¢å¼•ã€æ•°æ®é¢„å¤„ç†å’Œè½¬æ¢ã€æ„å»ºçŸ¥è¯†åº“ã€æ•°æ®åˆ†æå’Œå¯è§†åŒ–å‰çš„æ•°æ®å‡†å¤‡</span><br><br><span class="hljs-comment"># ç¬¬ä¸€æ­¥ï¼šå®ä¾‹åŒ– (Initialization)</span><br><span class="hljs-comment"># è¯­æ³•ï¼šç±»å(å‚æ•°) -&gt; è¿”å›ä¸€ä¸ªå®ä¾‹å¯¹è±¡</span><br>loader = CSVLoader(file_path=file)   <span class="hljs-comment"># åˆ›å»ºå¯¹è±¡</span><br><span class="hljs-comment"># æ­¤æ—¶ï¼Œloader æ˜¯ä¸€ä¸ª CSVLoader ç±»å‹çš„å¯¹è±¡ã€‚å®ƒå­˜å‚¨äº† file_path è¿™ä¸ªä¿¡æ¯ã€‚</span><br><br><span class="hljs-comment"># ç¬¬äºŒæ­¥ï¼šè°ƒç”¨æ–¹æ³• (Execution)</span><br><span class="hljs-comment"># è¯­æ³•ï¼šå¯¹è±¡.æ–¹æ³•å() -&gt; æ‰§è¡Œé€»è¾‘å¹¶è¿”å›ç»“æœ</span><br><span class="hljs-comment"># åç»­ä¼šå°†è¿™ä¸ªæ–‡æ¡£åˆ‡å‰²ã€å‘é‡åŒ–å‘³ç»™ai</span><br>docs = loader.load()  <span class="hljs-comment">#åŠ è½½æ•°æ®æ–¹æ³•   # æ‰§è¡ŒåŠ¨ä½œè¡Œä¸º</span><br><span class="hljs-comment"># æ­¤æ—¶ï¼Œdocs æ‰æ˜¯çœŸæ­£çš„ç»“æœï¼ˆList[Document]ï¼‰ã€‚</span><br><br><span class="hljs-comment"># ä¸‹é¢çš„æ–¹æ³•æ˜¯ç»™å¼€å‘è€…è‡ªå·±æ£€æŸ¥çœ‹çš„</span><br><span class="hljs-comment"># æŸ¥çœ‹æ•°æ® (Pandas éƒ¨åˆ†ä¿æŒä¸å˜) ä»…åŠ è½½ç¬¬2åˆ—å’Œç¬¬3åˆ—ï¼ˆç´¢å¼•ä»0å¼€å§‹ï¼‰</span><br>data = pd.read_csv(file, usecols=[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ•°æ®é¢„è§ˆ:&quot;</span>)<br><span class="hljs-comment"># æ˜¾ç¤ºæ•°æ®çš„å‰5è¡Œï¼ˆé»˜è®¤å€¼ï¼‰ï¼Œç”¨äºå¿«é€Ÿæ£€æŸ¥åŠ è½½ç»“æœã€‚å¦‚æœåªæƒ³é¢„è§ˆå‰3è¡Œï¼Œå¯ä½¿ç”¨ data.head(3)</span><br><span class="hljs-built_in">print</span>(data.head())<br></code></pre></td></tr></table></figure>


<pre><code class="hljs">=== 1. åˆå§‹åŒ–ä¸æ•°æ®åŠ è½½ ===
æ•°æ®é¢„è§ˆ:
                                                name  \
0                           Women&#39;s Campside Oxfords   
1           Recycled Waterhog Dog Mat, Chevron Weave   
2  Infant and Toddler Girls&#39; Coastal Chill Swimsu...   
3         Refresh Swimwear, V-Neck Tankini Contrasts   
4                             EcoFlex 3L Storm Pants   

                                         description  
0  This ultracomfortable lace-to-toe Oxford boast...  
1  Protect your floors from spills and splashing ...  
2  She&#39;ll love the bright colors, ruffles and exc...  
3  Whether you&#39;re going for a swim or heading out...  
4  Our new TEK O2 technology makes our four-seaso...  
</code></pre>
<p>æ•°æ®æ˜¯å­—æ®µä¸º name å’Œ description çš„æ–‡æœ¬æ•°æ®ï¼š<br>å¯ä»¥çœ‹åˆ°ï¼Œå¯¼å…¥çš„æ•°æ®é›†ä¸ºä¸€ä¸ªæˆ·å¤–æœè£…çš„ CSV æ–‡ä»¶ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†åœ¨è¯­è¨€æ¨¡å‹ä¸­ä½¿ç”¨å®ƒã€‚</p>
<ol start="2">
<li>å‘é‡åŒ–ä¸å­˜å‚¨ (æ›¿ä»£ VectorstoreIndexCreator)<br>åœ¨ v0.3 ä¸­ï¼Œåˆ›å»º Embeddings å’Œ VectorStoreï¼Œè¿™æ ·æ›´é€æ˜ä¸”æ˜“äºè°ƒè¯•ã€‚</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n=== 2. åˆ›å»ºå‘é‡å­˜å‚¨ ===&quot;</span>)<br><br><span class="hljs-comment"># 2.1 åˆå§‹åŒ– Embedding æ¨¡å‹</span><br><span class="hljs-comment"># æ³¨æ„ï¼šéœ€è¦é…ç½® OPENAI_API_KEY ç¯å¢ƒå˜é‡ï¼Œæˆ–åœ¨æ­¤å¤„ä¼ å…¥ api_key å‚æ•°</span><br><span class="hljs-comment"># embeddings = OpenAIEmbeddings()</span><br><span class="hljs-keyword">from</span> tool <span class="hljs-keyword">import</span> get_embedding_model<br>embeddings = get_embedding_model()<br><br><br><span class="hljs-comment"># 2.2 æµ‹è¯• Embedding </span><br><span class="hljs-comment"># è°ƒç”¨ Embedding æ¨¡å‹æ¥å£ï¼Œå°†ä¸€æ®µéç»“æ„åŒ–çš„æ–‡æœ¬ï¼ˆStringï¼‰è½¬æ¢æˆä¸€ä¸ªç”±æµ®ç‚¹æ•°ç»„æˆçš„åˆ—è¡¨ï¼ˆList of floatsï¼‰ã€‚</span><br>test_embed = embeddings.embed_query(<span class="hljs-string">&quot;ä½ å¥½å‘€ï¼Œæˆ‘çš„åå­—å«å°å¯çˆ±&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å‘é‡è¡¨å¾é•¿åº¦: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(test_embed)&#125;</span>&quot;</span>)<br><span class="hljs-comment"># è¿™äº›æ•°å­—ä»£è¡¨äº†æ–‡æœ¬çš„â€œè¯­ä¹‰ç‰¹å¾â€ã€‚</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å‰5ä¸ªå…ƒç´ : <span class="hljs-subst">&#123;test_embed[:<span class="hljs-number">5</span>]&#125;</span>&quot;</span>)<br><br><span class="hljs-comment"># 2.3 åˆ›å»ºå‘é‡æ•°æ®åº“ (Vector Store)</span><br><span class="hljs-comment"># ä½¿ç”¨ FAISS æ›¿ä»£ DocArrayInMemorySearch</span><br><span class="hljs-comment"># from_documents ä¼šè‡ªåŠ¨æ‰§è¡Œï¼šæ–‡æœ¬ -&gt; å‘é‡åŒ– -&gt; å­˜å…¥ç´¢å¼•</span><br><span class="hljs-comment"># FAISSï¼šè¿™æ˜¯ä¸€ä¸ªç”± Meta (Facebook) å¼€å‘çš„é«˜æ•ˆå‘é‡æ£€ç´¢åº“ã€‚</span><br><span class="hljs-comment"># .from_documents(docs, embeddings)ï¼šè¿™æ˜¯ä¸€ä¸ªç±»å·¥å‚æ–¹æ³•ã€‚</span><br>    <span class="hljs-comment"># docsï¼šä¹‹å‰åŠ è½½çš„ Document å¯¹è±¡åˆ—è¡¨ï¼ˆåŒ…å«æ–‡æœ¬å†…å®¹å’Œå…ƒæ•°æ®ï¼‰ã€‚</span><br>    <span class="hljs-comment"># embeddingsï¼šæŒ‡å®šçš„â€œç¿»è¯‘å®˜â€ï¼Œå‘Šè¯‰ FAISS ç”¨å“ªä¸ªæ¨¡å‹æ¥æŠŠè¿™äº›æ–‡æ¡£è½¬æˆæ•°å­—ã€‚</span><br>vectorstore = FAISS.from_documents(docs, embeddings)<br><br><span class="hljs-comment"># 2.4 ç›¸ä¼¼åº¦æœç´¢æµ‹è¯• åœ¨ä»“åº“ä¸­å¯»æ‰¾ä¸ä½ çš„é—®é¢˜â€œè¯­ä¹‰æœ€æ¥è¿‘â€çš„ 4 ä¸ªæ–‡æ¡£ç‰‡æ®µ</span><br>query = <span class="hljs-string">&quot;è¯·æ¨èä¸€ä»¶å…·æœ‰é˜²æ™’åŠŸèƒ½çš„è¡¬è¡«&quot;</span><br><span class="hljs-comment"># .similarity_search(query, k=4)ï¼šæ‰§è¡Œå‘é‡ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—ã€‚</span><br>search_results = vectorstore.similarity_search(query, k=<span class="hljs-number">4</span>) <span class="hljs-comment"># k=4 è¡¨ç¤ºè¿”å›4ä¸ªç»“æœ</span><br>    <span class="hljs-comment"># å®ƒå…ˆå·å·æŠŠä½ çš„ query ä¹Ÿè½¬æˆ xxx ç»´çš„å‘é‡ã€‚</span><br>    <span class="hljs-comment"># ç„¶ååœ¨æ•°æ®åº“é‡Œè®¡ç®—å“ªä¸ªæ–‡æ¡£çš„å‘é‡ç¦»è¿™ä¸ª query å‘é‡æœ€è¿‘ï¼ˆå¤¹è§’æœ€å°ï¼‰ã€‚</span><br>    <span class="hljs-comment"># k=4ï¼šæŒ‡å®šè¿”å›æœ€ç›¸å…³çš„å‰ 4 æ¡ç»“æœã€‚</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\nè¿”å›æ–‡æ¡£ä¸ªæ•°: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(search_results)&#125;</span>&quot;</span>)<br><span class="hljs-comment"># search_results æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œé‡Œé¢åŒ…å«äº† 4 ä¸ª Document å¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡é‡Œéƒ½æœ‰åŸ CSV çš„å†…å®¹ã€‚</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ç¬¬ä¸€ä¸ªæ–‡æ¡£å†…å®¹: <span class="hljs-subst">&#123;search_results[<span class="hljs-number">0</span>].page_content[:<span class="hljs-number">100</span>]&#125;</span>...&quot;</span>) <span class="hljs-comment"># åªæ‰“å°å‰100å­—</span><br></code></pre></td></tr></table></figure>


<pre><code class="hljs">=== 2. åˆ›å»ºå‘é‡å­˜å‚¨ ===
ğŸš€ æ­£åœ¨ä»æœ¬åœ°ç¼“å­˜åŠ è½½æ¨¡å‹: BAAI/bge-base-zh-v1.5 ...
âœ… æ¨¡å‹åŠ è½½æˆåŠŸï¼
å‘é‡è¡¨å¾é•¿åº¦: 768
å‰5ä¸ªå…ƒç´ : [-0.016522271558642387, -0.020748768001794815, -0.02627386897802353, 0.004484944045543671, 0.040133096277713776]

è¿”å›æ–‡æ¡£ä¸ªæ•°: 4
ç¬¬ä¸€ä¸ªæ–‡æ¡£å†…å®¹: : 374
name: Men&#39;s Plaid Tropic Shirt, Short-Sleeve
description: Our Ultracomfortable sun protection ...
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n=== 3. æ‰‹åŠ¨æ„å»ºé—®ç­” (Manual RAG) ===&quot;</span>)<br><br><span class="hljs-comment"># 3.1 æ•°æ®æ¸…æ´—ä¸æ‹¼æ¥æ–‡æ¡£å†…å®¹</span><br><span class="hljs-comment"># æŠŠæ£€ç´¢å‡ºæ¥çš„ 4 ä¸ªæ–‡æ¡£å†…å®¹â€œç²˜â€åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªå·¨å¤§çš„èƒŒæ™¯çŸ¥è¯†å—ï¼ˆContextï¼‰</span><br>    <span class="hljs-comment"># åˆ—è¡¨æ¨å¯¼å¼</span><br>        <span class="hljs-comment"># d.page_contentï¼šä»æ¯ä¸ªè¿”å›çš„æ–‡æ¡£å¯¹è±¡ä¸­åªæå–æ–‡å­—å†…å®¹ã€‚</span><br>        <span class="hljs-comment"># &quot;\n\n&quot;.join(...)ï¼šç”¨ä¸¤ä¸ªæ¢è¡Œç¬¦æŠŠè¿™ 4 æ®µæ–‡å­—è¿æ¥èµ·æ¥ã€‚</span><br>qdocs = <span class="hljs-string">&quot;\n\n&quot;</span>.join([d.page_content <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> search_results])<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\næ‹¼æ¥æ–‡æ¡£å†…å®¹: <span class="hljs-subst">&#123;qdocs[:<span class="hljs-number">100</span>]&#125;</span>...&quot;</span>) <span class="hljs-comment"># åªæ‰“å°å‰100å­—</span><br><br><span class="hljs-comment"># 3.2 æ„å»º Prompt</span><br>manual_prompt = ChatPromptTemplate.from_template(<br>    <span class="hljs-string">&quot;&quot;&quot;åŸºäºä»¥ä¸‹å·²çŸ¥ä¿¡æ¯å›ç­”é—®é¢˜ï¼š</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    &#123;context&#125;</span><br><span class="hljs-string">    </span><br><span class="hljs-string">    é—®é¢˜ï¼š&#123;question&#125;</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>)<br><br><span class="hljs-comment"># 3.3 æ„å»ºé“¾</span><br><span class="hljs-comment"># é€»è¾‘ï¼šPrompt -&gt; LLM -&gt; StringParser</span><br>manual_chain = manual_prompt | llm | StrOutputParser()<br><br><span class="hljs-comment"># 3.4 è¿è¡Œ</span><br><span class="hljs-comment"># å°†åˆå¹¶çš„ç›¸ä¼¼æ–‡æ¡£å†…å®¹ååŠ ä¸Šé—®é¢˜ï¼ˆquestionï¼‰è¾“å…¥åˆ°llm</span><br>query_str = <span class="hljs-string">&quot;è¯·ç”¨markdownè¡¨æ ¼çš„æ–¹å¼åˆ—å‡ºæ‰€æœ‰å…·æœ‰é˜²æ™’åŠŸèƒ½çš„è¡¬è¡«ï¼Œå¯¹æ¯ä»¶è¡¬è¡«æè¿°è¿›è¡Œæ€»ç»“&quot;</span><br>response = manual_chain.invoke(&#123;<br>    <span class="hljs-string">&quot;context&quot;</span>: qdocs,<br>    <span class="hljs-string">&quot;question&quot;</span>: query_str<br>&#125;)<br><br>display(Markdown(response))<br></code></pre></td></tr></table></figure>


<pre><code class="hljs">=== 3. æ‰‹åŠ¨æ„å»ºé—®ç­” (Manual RAG) ===

æ‹¼æ¥æ–‡æ¡£å†…å®¹: : 374
name: Men&#39;s Plaid Tropic Shirt, Short-Sleeve
description: Our Ultracomfortable sun protection ...
</code></pre>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs markdown">| ç¼–å· | åç§° | æè´¨ | é˜²æ™’ç­‰çº§ | ç‰¹ç‚¹ | å¤‡æ³¨ |<br>| --- | --- | --- | --- | --- | --- |<br>| 374 | Men&#x27;s Plaid Tropic Shirt, Short-Sleeve | 52% polyester, 48% nylon | UPF 50+ | é˜²æ™’ã€é€Ÿå¹²ã€é˜²çš±ã€é€æ°”ã€å£è¢‹ã€è¿›å£è®¾è®¡ |  |<br>| 255 | Sun Shield Shirt | 78% nylon, 22% Lycra Xtra Life fiber | UPF 50+ | é˜²æ™’ã€é€Ÿå¹²ã€æŠ—ç£¨ã€è¿›å£è®¾è®¡ |  |<br>| 618 | Men&#x27;s Tropical Plaid Short-Sleeve Shirt | 100% polyester | UPF 50+ | é˜²æ™’ã€é€Ÿå¹²ã€é˜²çš±ã€é€æ°”ã€å£è¢‹ã€è¿›å£è®¾è®¡ |  |<br>| 535 | Men&#x27;s TropicVibe Shirt, Short-Sleeve | 71% Nylon, 29% Polyester | UPF 50+ | é˜²æ™’ã€é€Ÿå¹²ã€é˜²çš±ã€é€æ°”ã€å£è¢‹ã€è¿›å£è®¾è®¡ |  |<br></code></pre></td></tr></table></figure>

<p>ä»¥ä¸Šè¡¨æ ¼æ€»ç»“äº†æ‰€æœ‰å…·æœ‰é˜²æ™’åŠŸèƒ½çš„è¡¬è¡«ï¼ŒåŒ…æ‹¬æè´¨ã€é˜²æ™’ç­‰çº§ã€ç‰¹ç‚¹ä»¥åŠå¤‡æ³¨ä¿¡æ¯ã€‚</p>
<p>é€šè¿‡LangChainåˆ›å»ºä¸€ä¸ªæ£€ç´¢é—®ç­”é“¾ï¼Œå¯¹æ£€ç´¢åˆ°çš„æ–‡æ¡£è¿›è¡Œé—®é¢˜å›ç­”ã€‚æ£€ç´¢é—®ç­”é“¾çš„è¾“å…¥åŒ…å«ä»¥ä¸‹<br>llm: è¯­è¨€æ¨¡å‹ï¼Œè¿›è¡Œæ–‡æœ¬ç”Ÿæˆ<br>chain_type: ä¼ å…¥é“¾ç±»å‹ï¼Œè¿™é‡Œä½¿ç”¨stuffï¼Œå°†æ‰€æœ‰æŸ¥è¯¢å¾—åˆ°çš„æ–‡æ¡£ç»„åˆæˆä¸€ä¸ªæ–‡æ¡£ä¼ å…¥ä¸‹ä¸€æ­¥ã€‚å…¶ä»–çš„æ–¹å¼åŒ…æ‹¬ï¼š<br>Map Reduceï¼š å°†æ‰€æœ‰å—ä¸é—®é¢˜ä¸€èµ·ä¼ é€’ç»™è¯­è¨€æ¨¡å‹ï¼Œè·å–å›å¤ï¼Œä½¿ç”¨å¦ä¸€ä¸ªè¯­è¨€æ¨¡å‹è°ƒç”¨å°†æ‰€æœ‰å•ç‹¬çš„å›å¤æ€»ç»“æˆæœ€ç»ˆç­”æ¡ˆï¼Œå®ƒå¯ä»¥åœ¨ä»»æ„æ•°é‡çš„æ–‡æ¡£ä¸Šè¿è¡Œã€‚å¯ä»¥å¹¶è¡Œå¤„ç†å•ä¸ªé—®é¢˜ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦æ›´å¤šçš„è°ƒç”¨ã€‚å®ƒå°†æ‰€æœ‰æ–‡æ¡£è§†ä¸ºç‹¬ç«‹çš„<br>Refineï¼š ç”¨äºå¾ªç¯è®¸å¤šæ–‡æ¡£ï¼Œå®é™…ä¸Šå®ƒæ˜¯ç”¨è¿­ä»£å®ç°çš„ï¼Œå®ƒå»ºç«‹åœ¨å…ˆå‰æ–‡æ¡£çš„ç­”æ¡ˆä¹‹ä¸Šï¼Œéå¸¸é€‚åˆç”¨äºåˆå¹¶ä¿¡æ¯å¹¶éšæ—¶é—´é€æ­¥æ„å»ºç­”æ¡ˆï¼Œç”±äºä¾èµ–äºå…ˆå‰è°ƒç”¨çš„ç»“æœï¼Œå› æ­¤å®ƒé€šå¸¸éœ€è¦æ›´é•¿çš„æ—¶é—´ï¼Œå¹¶ä¸”åŸºæœ¬ä¸Šéœ€è¦ä¸Map Reduceä¸€æ ·å¤šçš„è°ƒç”¨<br>Map Re-rankï¼š å¯¹æ¯ä¸ªæ–‡æ¡£è¿›è¡Œå•ä¸ªè¯­è¨€æ¨¡å‹è°ƒç”¨ï¼Œè¦æ±‚å®ƒè¿”å›ä¸€ä¸ªåˆ†æ•°ï¼Œé€‰æ‹©æœ€é«˜åˆ†ï¼Œè¿™ä¾èµ–äºè¯­è¨€æ¨¡å‹çŸ¥é“åˆ†æ•°åº”è¯¥æ˜¯ä»€ä¹ˆï¼Œéœ€è¦å‘Šè¯‰å®ƒï¼Œå¦‚æœå®ƒä¸æ–‡æ¡£ç›¸å…³ï¼Œåˆ™åº”è¯¥æ˜¯é«˜åˆ†ï¼Œå¹¶åœ¨é‚£é‡Œç²¾ç»†è°ƒæ•´è¯´æ˜ï¼Œå¯ä»¥æ‰¹é‡å¤„ç†å®ƒä»¬ç›¸å¯¹è¾ƒå¿«ï¼Œä½†æ˜¯æ›´åŠ æ˜‚è´µ<br><a target="_blank" rel="noopener" href="https://datawhalechina.github.io/llm-cookbook/figures/C3/3_additional%20methods.png">https://datawhalechina.github.io/llm-cookbook/figures/C3/3_additional%20methods.png</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n=== 4. è‡ªåŠ¨åŒ–æ£€ç´¢é—®ç­”é“¾ (New Standard) ===&quot;</span>)<br><br><span class="hljs-comment"># å¯¼å…¥æ„å»ºé“¾çš„å·¥å‚å‡½æ•°</span><br><span class="hljs-comment"># create_stuff_documents_chainï¼šä¸“é—¨è´Ÿè´£å¤„ç†æ–‡æ¡£ã€‚å®ƒä¼šæŠŠæ‰€æœ‰æ‰¾åˆ°çš„ç›¸å…³æ–‡æ¡£â€œå¡è¿›â€ï¼ˆStuffï¼‰Prompt æ¨¡æ¿ä¸­ï¼Œäº¤ç»™ LLMã€‚</span><br><span class="hljs-comment"># create_retrieval_chainï¼šè´Ÿè´£è¿æ¥æ£€ç´¢å™¨å’Œå¤„ç†é“¾ã€‚å®ƒæ˜¯ä¸€ä¸ªé¡¶å±‚é“¾ï¼Œå…ˆæŠŠé—®é¢˜å‘ç»™å‘é‡æ•°æ®åº“æ‰¾èµ„æ–™ï¼Œå†æŠŠèµ„æ–™å–‚ç»™ä¸Šé¢çš„æ–‡æ¡£é“¾ã€‚</span><br><span class="hljs-keyword">from</span> langchain.chains <span class="hljs-keyword">import</span> create_retrieval_chain<br><span class="hljs-keyword">from</span> langchain.chains.combine_documents <span class="hljs-keyword">import</span> create_stuff_documents_chain<br><br><span class="hljs-comment"># 4.1 åˆ›å»ºæ£€ç´¢å™¨ (Retriever)</span><br><span class="hljs-comment"># as_retriever() æ˜¯å°†ä¸€ä¸ªå­˜å‚¨å‘é‡çš„æ•°æ®åº“ï¼ˆvectorstoreï¼‰è½¬æ¢ä¸ºä¸€ä¸ªæ ‡å‡†çš„æ£€ç´¢æ¥å£ï¼Œ</span><br><span class="hljs-comment"># ç”¨äºè‡ªåŠ¨æŸ¥æ‰¾ç›¸å…³æ–‡æ¡£</span><br>retriever = vectorstore.as_retriever()<br><br><span class="hljs-comment"># 4.2 åˆ›å»ºâ€œæ–‡æ¡£å¤„ç†é“¾â€ (Stuff Documents Chain)</span><br><span class="hljs-comment"># &#123;context&#125; å ä½ç¬¦ï¼šè¿™æ˜¯æ ¸å¿ƒã€‚create_stuff_documents_chain ä¼šè‡ªåŠ¨æŠŠæ£€ç´¢åˆ°çš„æ‰€æœ‰æ–‡æ¡£å†…å®¹æ›¿æ¢æ‰è¿™ä¸ª &#123;context&#125;ã€‚</span><br>system_prompt = (<br>    <span class="hljs-string">&quot;ä½ æ˜¯ä¸€ä¸ªæˆ·å¤–æœè£…å¯¼è´­ä¸“å®¶ã€‚ä½¿ç”¨ä»¥ä¸‹æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡æ¥å›ç­”é—®é¢˜ã€‚&quot;</span><br>    <span class="hljs-string">&quot;å¦‚æœä½ ä¸çŸ¥é“ç­”æ¡ˆï¼Œå°±è¯´ä¸çŸ¥é“ã€‚è¯·ä½¿ç”¨ Markdown è¡¨æ ¼æ ¼å¼ã€‚&quot;</span><br>    <span class="hljs-string">&quot;\n\n&quot;</span><br>    <span class="hljs-string">&quot;&#123;context&#125;&quot;</span><br>)<br><br><span class="hljs-comment"># &#123;input&#125; å ä½ç¬¦ï¼šè¿™æ˜¯ç”¨æˆ·çœŸæ­£æå‡ºçš„é—®é¢˜ã€‚</span><br>prompt = ChatPromptTemplate.from_messages([<br>    (<span class="hljs-string">&quot;system&quot;</span>, system_prompt),<br>    (<span class="hljs-string">&quot;human&quot;</span>, <span class="hljs-string">&quot;&#123;input&#125;&quot;</span>),<br>])<br><br>question_answer_chain = create_stuff_documents_chain(llm, prompt)<br><span class="hljs-comment"># ä»¥ä¸Šä¸‰ä¸ªæ­¥éª¤è¿™ä¸ªé“¾è´Ÿè´£å¤„ç†ï¼šå½¢æˆä¸€ä¸ªâ€œå°é“¾æ¡â€ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯ï¼šâ€œç»™æˆ‘ä¸€å †æ–‡æ¡£å’Œä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘æŠŠå®ƒä»¬æ’ç‰ˆå¥½ç»™ LLMã€‚â€</span><br><br><span class="hljs-comment"># 4.3 åˆ›å»ºæœ€ç»ˆçš„â€œæ£€ç´¢é—®ç­”é“¾â€ (Retrieval Chain)</span><br><span class="hljs-comment"># è¿™ä¸ªé“¾å°†æ‰€æœ‰é›¶ä»¶ç»„è£…èµ·æ¥è´Ÿè´£ï¼š</span><br><span class="hljs-comment"># æ¥æ”¶ç”¨æˆ·è¾“å…¥çš„inputé—®é¢˜ -&gt; è°ƒç”¨ Retriever æ¥å£åˆ°å‘é‡åº“æœå¯»ç›¸å…³çš„æ–‡æœ¬ç‰‡æ®µ -&gt; æŠŠæ–‡æ¡£å’Œé—®é¢˜ä¼ ç»™ä¸Šé¢çš„ question_answer_chain -&gt; LLM ç”Ÿæˆå›ç­”</span><br>rag_chain = create_retrieval_chain(retriever, question_answer_chain)  <span class="hljs-comment"># è¿”å›çš„æ˜¯ä¸€ä¸ªå­—å…¸</span><br><br><span class="hljs-comment"># 4.4 è¿è¡Œ</span><br><span class="hljs-comment"># æ³¨æ„ï¼šæ–°çš„ retrieval_chain è¾“å…¥å‚æ•°é€šå¸¸æ˜¯ &quot;input&quot;ï¼Œè¿”å›ç»“æœåœ¨ &quot;answer&quot; å­—æ®µä¸­</span><br>query = <span class="hljs-string">&quot;è¯·ç”¨markdownè¡¨æ ¼çš„æ–¹å¼åˆ—å‡ºæ‰€æœ‰å…·æœ‰é˜²æ™’åŠŸèƒ½çš„è¡¬è¡«ï¼Œå¯¹æ¯ä»¶è¡¬è¡«æè¿°è¿›è¡Œæ€»ç»“&quot;</span><br><br>result = rag_chain.invoke(&#123;<span class="hljs-string">&quot;input&quot;</span>: query&#125;)<br><br><span class="hljs-comment"># æ‰“å°ç»“æœ</span><br>display(Markdown(result[<span class="hljs-string">&quot;answer&quot;</span>]))<br><span class="hljs-comment"># result[&quot;input&quot;]ï¼šä½ çš„åŸé—®é¢˜ã€‚</span><br><span class="hljs-comment"># result[&quot;context&quot;]ï¼šæ£€ç´¢å‡ºæ¥çš„åŸå§‹æ–‡æ¡£ç‰‡æ®µï¼ˆæ–¹ä¾¿ä½ æŸ¥è¯ AI æœ‰æ²¡æœ‰èƒ¡è¯´å…«é“ï¼‰ã€‚</span><br><span class="hljs-comment"># result[&quot;answer&quot;]ï¼šAI æœ€ç»ˆç”Ÿæˆçš„ç­”æ¡ˆã€‚</span><br></code></pre></td></tr></table></figure>


<pre><code class="hljs">=== 4. è‡ªåŠ¨åŒ–æ£€ç´¢é—®ç­”é“¾ (New Standard) ===
</code></pre>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs markdown">| åç§° | æè¿° |<br>| --- | --- |<br>| Men&#x27;s Tropical Plaid Short-Sleeve Shirt | è¯¥è¡¬è¡«å…·æœ‰UPF 50+çš„é˜²æ™’åŠŸèƒ½ï¼Œé€‚åˆç‚çƒ­å¤©æ°”ç©¿ç€ã€‚é¢æ–™ä¸º100%èšé…¯çº¤ç»´ï¼Œå…·æœ‰é˜²çš±å’Œé€æ°”æ€§ã€‚ |<br>| Men&#x27;s Plaid Tropic Shirt, Short-Sleeve | è¯¥è¡¬è¡«å…·æœ‰UPF 50+çš„é˜²æ™’åŠŸèƒ½ï¼Œé€‚åˆç‚çƒ­å¤©æ°”ç©¿ç€ã€‚é¢æ–™ä¸º52%èšé…¯å’Œ48%å°¼é¾™ï¼Œå…·æœ‰é˜²çš±å’Œå¿«é€Ÿè’¸å‘æ±—æ°´çš„åŠŸèƒ½ã€‚ |<br>| Performance Plus Woven Shirt | è¯¥è¡¬è¡«å…·æœ‰UPF 40+çš„é˜²æ™’åŠŸèƒ½ï¼Œé€‚åˆç‚çƒ­å¤©æ°”ç©¿ç€ã€‚é¢æ–™ä¸º100%å°¼é¾™ï¼Œå…·æœ‰å¿«é€Ÿå¹²ç‡¥å’Œé˜²ç£¨æŸçš„åŠŸèƒ½ã€‚ |<br>| Sun Shield Shirt | è¯¥è¡¬è¡«å…·æœ‰UPF 50+çš„é˜²æ™’åŠŸèƒ½ï¼Œé€‚åˆç‚çƒ­å¤©æ°”ç©¿ç€ã€‚é¢æ–™ä¸º78%å°¼é¾™å’Œ22% Lycra Xtra Lifeçº¤ç»´ï¼Œå…·æœ‰å¿«é€Ÿå¹²ç‡¥å’Œè€ç£¨çš„åŠŸèƒ½ã€‚ |<br></code></pre></td></tr></table></figure>


<h2 id="ç¬¬å…­ç« -è¯„ä¼°"><a href="#ç¬¬å…­ç« -è¯„ä¼°" class="headerlink" title="ç¬¬å…­ç«  è¯„ä¼°"></a>ç¬¬å…­ç«  è¯„ä¼°</h2><p>è¯„ä¼°å¯ä»¥æ£€éªŒè¯­è¨€æ¨¡å‹åœ¨ä¸åŒæ–‡æ¡£ä¸Šçš„é—®ç­”æ•ˆæœã€è¿˜å¯ä»¥æ¯”è¾ƒä¸åŒæ¨¡å‹ï¼Œé€‰æ‹©æœ€ä½³çš„ç³»ç»Ÿã€‚<br>è¯„ä¼°ä¸»è¦ç›®çš„ï¼š<br>    æ£€éªŒllmåº”ç”¨æ˜¯å¦è¾¾åˆ°äº†éªŒæ”¶æ ‡å‡†<br>    åˆ†ææ”¹åŠ¨å¯¹äºllmåº”ç”¨æ€§èƒ½çš„å½±å“<br>åŸºæœ¬çš„æ€è·¯å°±æ˜¯åˆ©ç”¨è¯­è¨€æ¨¡å‹æœ¬èº«å’Œé“¾æœ¬èº«ï¼Œæ¥è¾…åŠ©è¯„ä¼°å…¶ä»–çš„è¯­è¨€æ¨¡å‹ã€é“¾å’Œåº”ç”¨ç¨‹åºã€‚</p>
<p>LangChain å®˜æ–¹ç°åœ¨å¤§åŠ›æ¨å´‡ä½¿ç”¨ LangSmith å¹³å°è¿›è¡Œè¯„ä¼°ï¼Œä½†åœ¨ä»£ç å±‚é¢ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥ä½¿ç”¨ LCEL æ„å»ºæœ¬åœ°çš„è¯„ä¼°æµç¨‹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n=== 1.åˆ›å»ºLLMæ–‡æ¡£é—®ç­”åº”ç”¨ ===&quot;</span>)<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;tool&#x27;</span> <span class="hljs-keyword">in</span> sys.modules:<br>    <span class="hljs-keyword">del</span> sys.modules[<span class="hljs-string">&#x27;tool&#x27;</span>]<br>sys.path.append(<span class="hljs-string">&#x27;/home/py/shared/StudyChatgpt&#x27;</span>)<br><span class="hljs-keyword">from</span> tool <span class="hljs-keyword">import</span> get_chat_model2 ,get_embedding_model<br><br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">from</span> langchain_community.document_loaders <span class="hljs-keyword">import</span> CSVLoader<br><span class="hljs-keyword">from</span> langchain_community.vectorstores <span class="hljs-keyword">import</span> FAISS<br><span class="hljs-keyword">from</span> langchain.chains <span class="hljs-keyword">import</span> create_retrieval_chain<br><span class="hljs-keyword">from</span> langchain.chains.combine_documents <span class="hljs-keyword">import</span> create_stuff_documents_chain<br><span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate<br><br><span class="hljs-comment"># 1.1 åŠ è½½ä¸æŸ¥çœ‹æ•°æ®</span><br>file = <span class="hljs-string">&#x27;data/product_data.csv&#x27;</span><br>loader = CSVLoader(file_path=file)<br>docs = loader.load()<br><br><span class="hljs-comment"># æŸ¥çœ‹æ•°æ® (ä»…ç”¨äºæ¼”ç¤ºï¼Œå®é™…æµç¨‹ä¸éœ€è¦)</span><br>test_data = pd.read_csv(file, skiprows=<span class="hljs-number">0</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ•°æ®é¢„è§ˆ:&quot;</span>)<br><span class="hljs-built_in">print</span>(test_data.head())<br><br><span class="hljs-comment"># 1.2 åˆ›å»ºå‘é‡æ£€ç´¢</span><br>embeddings = get_embedding_model()<br>vectorstore = FAISS.from_documents(docs, embeddings)<br>retriever = vectorstore.as_retriever()<br><br><span class="hljs-comment"># 1.3 æ„å»º RAG é“¾ (è¢«æµ‹ç³»ç»Ÿ)</span><br>llm = get_chat_model2()<br><br><span class="hljs-comment"># å®šä¹‰å›ç­”é—®é¢˜çš„ Prompt</span><br>qa_system_prompt = (<br>    <span class="hljs-string">&quot;ä½ æ˜¯ä¸€ä¸ªåŠ©æ‰‹ã€‚ä½¿ç”¨ä»¥ä¸‹æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡æ¥å›ç­”é—®é¢˜ã€‚&quot;</span><br>    <span class="hljs-string">&quot;å¦‚æœä½ ä¸çŸ¥é“ç­”æ¡ˆï¼Œå°±è¯´ä¸çŸ¥é“ã€‚&quot;</span><br>    <span class="hljs-string">&quot;\n\n&quot;</span><br>    <span class="hljs-string">&quot;&#123;context&#125;&quot;</span><br>)<br>qa_prompt = ChatPromptTemplate.from_messages([<br>    (<span class="hljs-string">&quot;system&quot;</span>, qa_system_prompt),<br>    (<span class="hljs-string">&quot;human&quot;</span>, <span class="hljs-string">&quot;&#123;input&#125;&quot;</span>),<br>])<br><br>question_answer_chain = create_stuff_documents_chain(llm, qa_prompt)<br><span class="hljs-comment"># æœ€ç»ˆçš„é—®ç­”é“¾</span><br>rag_chain = create_retrieval_chain(retriever, question_answer_chain)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;âœ… RAG åº”ç”¨æ„å»ºå®Œæˆ&quot;</span>)<br></code></pre></td></tr></table></figure>


<pre><code class="hljs">=== 1.åˆ›å»ºLLMæ–‡æ¡£é—®ç­”åº”ç”¨ ===
æ•°æ®é¢„è§ˆ:
  product_name                                        description
0       å…¨è‡ªåŠ¨å’–å•¡æœº  è§„æ ¼:\nå¤§å‹ - å°ºå¯¸ï¼š13.8&#39;&#39; x 17.3&#39;&#39;ã€‚\nä¸­å‹ - å°ºå¯¸ï¼š11.5&#39;&#39; ...
1         ç”µåŠ¨ç‰™åˆ·  è§„æ ¼:\nä¸€èˆ¬å¤§å° - é«˜åº¦ï¼š9.5&#39;&#39;ï¼Œå®½åº¦ï¼š1&#39;&#39;ã€‚\n\nä¸ºä»€ä¹ˆæˆ‘ä»¬çƒ­çˆ±å®ƒ:\næˆ‘ä»¬çš„...
2    æ©™å‘³ç»´ç”Ÿç´ Cæ³¡è…¾ç‰‡  è§„æ ¼:\næ¯ç›’å«æœ‰20ç‰‡ã€‚\n\nä¸ºä»€ä¹ˆæˆ‘ä»¬çƒ­çˆ±å®ƒ:\næˆ‘ä»¬çš„æ©™å‘³ç»´ç”Ÿç´ Cæ³¡è…¾ç‰‡æ˜¯å¿«é€Ÿè¡¥å……ç»´...
3       æ— çº¿è“ç‰™è€³æœº  è§„æ ¼:\nå•ä¸ªè€³æœºå°ºå¯¸ï¼š1.5&#39;&#39; x 1.3&#39;&#39;ã€‚\n\nä¸ºä»€ä¹ˆæˆ‘ä»¬çƒ­çˆ±å®ƒ:\nè¿™æ¬¾æ— çº¿è“...
4          ç‘œä¼½å«  è§„æ ¼:\nå°ºå¯¸ï¼š24&#39;&#39; x 68&#39;&#39;ã€‚\n\nä¸ºä»€ä¹ˆæˆ‘ä»¬çƒ­çˆ±å®ƒ:\næˆ‘ä»¬çš„ç‘œä¼½å«æ‹¥æœ‰å‡ºè‰²çš„...
ğŸš€ æ­£åœ¨ä»æœ¬åœ°ç¼“å­˜åŠ è½½æ¨¡å‹: BAAI/bge-base-zh-v1.5 ...
âœ… æ¨¡å‹åŠ è½½æˆåŠŸï¼
âœ… RAG åº”ç”¨æ„å»ºå®Œæˆ
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n=== 2.è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•é›† ===&quot;</span>)<br><span class="hljs-comment"># ç”¨äºå°† LLM ç”Ÿæˆçš„çº¯æ–‡æœ¬ï¼ˆé€šå¸¸æ˜¯å­—ç¬¦ä¸²ï¼‰å¼ºåˆ¶è§£ææˆç»“æ„åŒ–çš„ JSON å¯¹è±¡ï¼ˆå­—å…¸ï¼‰</span><br><span class="hljs-keyword">from</span> langchain_core.output_parsers <span class="hljs-keyword">import</span> JsonOutputParser<br><span class="hljs-comment"># Pydantic æ˜¯ Python ä¸­ç”¨äºæ•°æ®éªŒè¯å’Œè®¾ç½®æ•°æ®ç»“æ„çš„åº“</span><br><span class="hljs-keyword">from</span> langchain_core.pydantic_v1 <span class="hljs-keyword">import</span> BaseModel, Field<br><br><span class="hljs-comment"># 2.1 å®šä¹‰è¾“å‡ºçš„æ•°æ®ç»“æ„ (Pydantic)</span><br><span class="hljs-comment"># å‘Šè¯‰ LLM æˆ‘ä»¬æƒ³è¦ä»€ä¹ˆæ ·çš„ JSON æ ¼å¼</span><br><span class="hljs-comment"># å®šä¹‰äº†ä¸€ä¸ªåä¸º QAById çš„ç±»ï¼Œå®ƒç»§æ‰¿è‡ª BaseModel</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">QAById</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    <span class="hljs-comment"># å£°æ˜ä¸€ä¸ªåä¸º query çš„å±æ€§ï¼Œç±»å‹å¿…é¡»æ˜¯å­—ç¬¦ä¸² (str)</span><br>    <span class="hljs-comment"># è¿™æ˜¯ç»™ LLM çœ‹çš„â€œæç¤ºâ€ã€‚LangChain ä¼šæŠŠè¿™ä¸ª description ä¼ ç»™ LLMï¼Œå‘Šè¯‰å®ƒï¼šâ€œè¿™ä¸ªå­—æ®µè¯·å¡«å…¥åŸºäºæ–‡æ¡£ç”Ÿæˆçš„é—®é¢˜â€ã€‚</span><br>    query: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">&quot;åŸºäºæ–‡æ¡£ç”Ÿæˆçš„é—®é¢˜&quot;</span>)<br>    answer: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">&quot;åŸºäºæ–‡æ¡£ç”Ÿæˆçš„æ ‡å‡†ç­”æ¡ˆ&quot;</span>)<br><br><span class="hljs-comment"># 2.2 å®šä¹‰ç”Ÿæˆæ•°æ®çš„ Prompt</span><br><span class="hljs-comment"># æˆ‘ä»¬ä¸éœ€è¦ç»§æ‰¿ç±»ï¼Œç›´æ¥å†™ Prompt å³å¯ï¼Œéå¸¸çµæ´»</span><br>gen_system_prompt = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">ä½ æ˜¯ä¸€åæ­£åœ¨ç¼–å†™æµ‹éªŒçš„è€å¸ˆã€‚</span><br><span class="hljs-string">ç»™å®šä»¥ä¸‹æ–‡æ¡£ï¼Œè¯·åŸºäºè¯¥æ–‡æ¡£ç”Ÿæˆä¸€ä¸ªâ€œé—®é¢˜â€å’Œä¸€ä¸ªå¯¹åº”çš„â€œæ ‡å‡†ç­”æ¡ˆâ€ã€‚</span><br><span class="hljs-string">é—®é¢˜å¿…é¡»å…·ä½“ï¼Œä¸”ç­”æ¡ˆå¿…é¡»å®Œå…¨åŸºäºæ–‡æ¡£å†…å®¹ã€‚</span><br><span class="hljs-string">è¯·ä½¿ç”¨ä¸­æ–‡è¾“å‡ºã€‚</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br>gen_prompt = ChatPromptTemplate.from_messages([<br>    (<span class="hljs-string">&quot;system&quot;</span>, gen_system_prompt),<br>    (<span class="hljs-string">&quot;human&quot;</span>, <span class="hljs-string">&quot;æ–‡æ¡£å†…å®¹:\n&#123;doc&#125;\n\nè¯·ç”Ÿæˆ JSON æ ¼å¼çš„é—®ç­”å¯¹:&quot;</span>),<br>])<br><br><span class="hljs-comment"># 2.3 æ„å»ºç”Ÿæˆé“¾</span><br><span class="hljs-comment"># é€»è¾‘: Prompt -&gt; LLM -&gt; JSONè§£æå™¨</span><br><span class="hljs-comment"># å®ä¾‹åŒ–ä¸€ä¸ªè§£æå™¨ã€‚å…³é”®å‚æ•° pydantic_object=QAById å‘Šè¯‰è§£æå™¨ï¼šâ€œè¯·å¼•å¯¼ LLM ç”Ÿæˆç¬¦åˆ QAById ç±»ç»“æ„çš„æ•°æ®ï¼Œå¹¶æŠŠç»“æœè§£ææˆè¿™ä¸ªç»“æ„ã€‚â€</span><br>parser = JsonOutputParser(pydantic_object=QAById)<br>generator_chain = gen_prompt | llm | parser<br><br><span class="hljs-comment"># 2.4 æ‰¹é‡ç”Ÿæˆæµ‹è¯•æ•°æ®</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\næ­£åœ¨ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹...&quot;</span>)<br><span class="hljs-comment"># æˆ‘ä»¬åªå–å‰ 5 ä¸ªæ–‡æ¡£ç”Ÿæˆ</span><br><span class="hljs-comment"># æ³¨æ„ï¼šbatch æ˜¯ v0.3 ä¸­æ›¿ä»£ apply çš„æ ‡å‡†æ–¹æ³•</span><br>raw_docs = [&#123;<span class="hljs-string">&quot;doc&quot;</span>: d.page_content&#125; <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> docs[:<span class="hljs-number">5</span>]]<br><span class="hljs-comment"># è°ƒç”¨é“¾çš„ .batch() æ–¹æ³•</span><br><span class="hljs-comment"># å¹¶è¡Œå¤„ç†ã€‚å°† raw_docs é‡Œçš„ 5 ä¸ªè¾“å…¥ä¸€æ¬¡æ€§å‘ç»™é“¾è¿›è¡Œå¤„ç†ï¼Œ</span><br><span class="hljs-comment"># è€Œä¸æ˜¯å†™ for å¾ªç¯ä¸€æ¬¡ä¸€æ¬¡è°ƒã€‚è¿™ä¼šè¿”å›ä¸€ä¸ªåŒ…å« 5 ä¸ªç»“æœçš„åˆ—è¡¨ã€‚</span><br>generated_examples = generator_chain.batch(raw_docs)<br><br><span class="hljs-comment"># 2.5 åˆå¹¶æ‰‹åŠ¨æ•°æ®</span><br>manual_examples = [<br>    &#123;<br>        <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-string">&quot;é«˜æ¸…ç”µè§†æœºæ€ä¹ˆè¿›è¡ŒæŠ¤ç†ï¼Ÿ&quot;</span>,<br>        <span class="hljs-string">&quot;answer&quot;</span>: <span class="hljs-string">&quot;ä½¿ç”¨å¹²å¸ƒæ¸…æ´ã€‚&quot;</span><br>    &#125;,<br>    &#123;<br>        <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-string">&quot;æ—…è¡ŒèƒŒåŒ…æœ‰å†…å¤–è¢‹å—ï¼Ÿ&quot;</span>,<br>        <span class="hljs-string">&quot;answer&quot;</span>: <span class="hljs-string">&quot;æœ‰ã€‚&quot;</span><br>    &#125;<br>]<br><br><span class="hljs-comment"># åˆå¹¶æ‰€æœ‰æµ‹è¯•é›†</span><br>test_dataset = manual_examples + generated_examples<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âœ… æµ‹è¯•é›†å‡†å¤‡å®Œæˆï¼Œå…± <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(test_dataset)&#125;</span> æ¡æ•°æ®ã€‚&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ç¬¬ä¸€æ¡è‡ªåŠ¨ç”Ÿæˆçš„æ•°æ®: <span class="hljs-subst">&#123;generated_examples[<span class="hljs-number">0</span>]&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure>


<pre><code class="hljs">=== 2.è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•é›† ===

æ­£åœ¨ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹...


/home/py/miniconda3/envs/chatgpt/lib/python3.9/site-packages/IPython/core/interactiveshell.py:3550: LangChainDeprecationWarning: As of langchain-core 0.3.0, LangChain uses pydantic v2 internally. The langchain_core.pydantic_v1 module was a compatibility shim for pydantic v1, and should no longer be used. Please update the code to import from Pydantic directly.

For example, replace imports like: `from langchain_core.pydantic_v1 import BaseModel`
with: `from pydantic import BaseModel`
or the v1 compatibility namespace if you are working in a code base that has not been fully upgraded to pydantic 2 yet. 	from pydantic.v1 import BaseModel

  exec(code_obj, self.user_global_ns, self.user_ns)


âœ… æµ‹è¯•é›†å‡†å¤‡å®Œæˆï¼Œå…± 7 æ¡æ•°æ®ã€‚
ç¬¬ä¸€æ¡è‡ªåŠ¨ç”Ÿæˆçš„æ•°æ®: &#123;&#39;é—®é¢˜&#39;: &#39;è¿™æ¬¾å…¨è‡ªåŠ¨å’–å•¡æœºçš„ä¸­å‹å°ºå¯¸æ˜¯å¤šå°‘ï¼Ÿ&#39;, &#39;æ ‡å‡†ç­”æ¡ˆ&#39;: &quot;11.5&#39;&#39; x 15.2&#39;&#39;&quot;&#125;
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n 3.æ­£åœ¨è¿è¡Œ RAG é“¾è¿›è¡Œé¢„æµ‹...&quot;</span>)<br><br><span class="hljs-comment"># æå–æ‰€æœ‰é—®é¢˜</span><br><span class="hljs-comment"># print(test_dataset[0].keys())  # æŸ¥çœ‹ç¬¬ä¸€ä¸ªå…ƒç´ çš„é”®</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n=== è°ƒè¯•æ­¥éª¤ï¼šæ£€æŸ¥æ•°æ®é”®å ===&quot;</span>)<br><br><span class="hljs-comment"># æ‰“å°å‡ºæ¯ä¸€æ¡æ•°æ®çš„é”®åï¼Œçœ‹çœ‹æ˜¯å“ªä¸€æ¡ä¸ä¸€æ ·</span><br><span class="hljs-keyword">for</span> i, ex <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(test_dataset):<br>    <span class="hljs-comment"># å¦‚æœæ•°æ®é‡Œæ²¡æœ‰ &#x27;query&#x27; è¿™ä¸ªé”®ï¼Œå°±æŠŠå®ƒæ‰“å°å‡ºæ¥çœ‹çœ‹</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;query&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> ex:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âš ï¸ ç¬¬ <span class="hljs-subst">&#123;i&#125;</span> æ¡æ•°æ®æ ¼å¼ä¸å¯¹: <span class="hljs-subst">&#123;ex&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   è¯¥æ•°æ®çš„é”®åæ˜¯: <span class="hljs-subst">&#123;<span class="hljs-built_in">list</span>(ex.keys())&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">break</span>  <span class="hljs-comment"># æ‰¾åˆ°ä¸€ä¸ªå°±åœï¼Œä¸ç”¨ä¸€ç›´æ‰“</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-comment"># å¦‚æœå‰å‡ æ¡æ˜¯æ­£å¸¸çš„ï¼Œä¹Ÿæ‰“å°ä¸€ä¸‹ç¡®è®¤</span><br>        <span class="hljs-keyword">if</span> i &lt; <span class="hljs-number">3</span>: <br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âœ… ç¬¬ <span class="hljs-subst">&#123;i&#125;</span> æ¡æ•°æ®æ­£å¸¸: <span class="hljs-subst">&#123;<span class="hljs-built_in">list</span>(ex.keys())&#125;</span>&quot;</span>)<br><br><span class="hljs-comment"># ä¿®æ”¹å‰ï¼š</span><br><span class="hljs-comment"># questions = [&#123;&quot;input&quot;: ex[&quot;query&quot;]&#125; for ex in test_dataset]</span><br><br><span class="hljs-comment"># ä¿®æ”¹å (æ›´å¥å£®çš„å†™æ³•)ï¼š</span><br><span class="hljs-comment"># å°è¯•å– &quot;query&quot;ï¼Œå–ä¸åˆ°å°±å– &quot;question&quot;ï¼Œè¿˜å–ä¸åˆ°å°±æŠ¥é”™</span><br>questions = []<br><span class="hljs-keyword">for</span> ex <span class="hljs-keyword">in</span> test_dataset:<br>    <span class="hljs-comment"># ä¼˜å…ˆæ‰¾ queryï¼Œæ²¡æœ‰å°±æ‰¾ questionï¼Œè¿˜æ²¡æœ‰å°±ç»™ç©ºå­—ç¬¦ä¸²</span><br>    q_text = ex.get(<span class="hljs-string">&quot;query&quot;</span>) <span class="hljs-keyword">or</span> ex.get(<span class="hljs-string">&quot;é—®é¢˜&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> q_text:<br>        questions.append(&#123;<span class="hljs-string">&quot;input&quot;</span>: q_text&#125;)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æˆåŠŸæå– <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(questions)&#125;</span> ä¸ªé—®é¢˜ã€‚&quot;</span>)<br><br><span class="hljs-comment"># æ‰¹é‡è¿è¡Œé¢„æµ‹</span><br><span class="hljs-comment"># rag_chain.batch ä¼šå¹¶å‘å¤„ç†ï¼Œæ¯”å¾ªç¯å¿«</span><br>predictions = rag_chain.batch(questions)<br><br><span class="hljs-comment"># æå– RAG çš„å®é™…å›ç­” (prediction)</span><br><span class="hljs-comment"># create_retrieval_chain çš„ç»“æœåœ¨ &quot;answer&quot; å­—æ®µé‡Œ</span><br>predicted_answers = [p[<span class="hljs-string">&quot;answer&quot;</span>] <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> predictions]<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;âœ… é¢„æµ‹å®Œæˆã€‚&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ç¤ºä¾‹é—®é¢˜: <span class="hljs-subst">&#123;test_dataset[<span class="hljs-number">0</span>][<span class="hljs-string">&#x27;query&#x27;</span>]&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;RAGå›ç­”: <span class="hljs-subst">&#123;predicted_answers[<span class="hljs-number">0</span>]&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure>


<pre><code class="hljs"> 3.æ­£åœ¨è¿è¡Œ RAG é“¾è¿›è¡Œé¢„æµ‹...

=== è°ƒè¯•æ­¥éª¤ï¼šæ£€æŸ¥æ•°æ®é”®å ===
âœ… ç¬¬ 0 æ¡æ•°æ®æ­£å¸¸: [&#39;query&#39;, &#39;answer&#39;]
âœ… ç¬¬ 1 æ¡æ•°æ®æ­£å¸¸: [&#39;query&#39;, &#39;answer&#39;]
âš ï¸ ç¬¬ 2 æ¡æ•°æ®æ ¼å¼ä¸å¯¹: &#123;&#39;é—®é¢˜&#39;: &#39;è¿™æ¬¾å…¨è‡ªåŠ¨å’–å•¡æœºçš„ä¸­å‹å°ºå¯¸æ˜¯å¤šå°‘ï¼Ÿ&#39;, &#39;æ ‡å‡†ç­”æ¡ˆ&#39;: &quot;11.5&#39;&#39; x 15.2&#39;&#39;&quot;&#125;
   è¯¥æ•°æ®çš„é”®åæ˜¯: [&#39;é—®é¢˜&#39;, &#39;æ ‡å‡†ç­”æ¡ˆ&#39;]
æˆåŠŸæå– 7 ä¸ªé—®é¢˜ã€‚
âœ… é¢„æµ‹å®Œæˆã€‚
ç¤ºä¾‹é—®é¢˜: é«˜æ¸…ç”µè§†æœºæ€ä¹ˆè¿›è¡ŒæŠ¤ç†ï¼Ÿ
RAGå›ç­”: ä¸ºäº†æŠ¤ç†é«˜æ¸…ç”µè§†æœºï¼Œå»ºè®®ä½¿ç”¨å¹²å¸ƒè¿›è¡Œæ¸…æ´ã€‚é¿å…ä½¿ç”¨æ¹¿å¸ƒæˆ–ä»»ä½•å¯èƒ½å«æœ‰æ°´åˆ†çš„æ¸…æ´å·¥å…·ï¼Œä»¥é˜²æ­¢æ°´åˆ†è¿›å…¥ç”µè§†æœºå†…éƒ¨é€ æˆæŸåã€‚
</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain_core.output_parsers <span class="hljs-keyword">import</span> StrOutputParser<br><br><span class="hljs-comment"># 4.1 å®šä¹‰è£åˆ¤ Prompt</span><br>eval_prompt_template = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">ä½ æ˜¯ä¸€ä¸ªè¯„åˆ†å‘˜ã€‚è¯·è¯„ä¼° AI åŠ©æ‰‹çš„å›ç­”æ˜¯å¦æ­£ç¡®ã€‚</span><br><span class="hljs-string"></span><br><span class="hljs-string">ç”¨æˆ·é—®é¢˜: &#123;query&#125;</span><br><span class="hljs-string">æ ‡å‡†ç­”æ¡ˆ: &#123;real_answer&#125;</span><br><span class="hljs-string">AI çš„å›ç­”: &#123;predicted_answer&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">è¯·å¯¹æ¯”â€œæ ‡å‡†ç­”æ¡ˆâ€å’Œâ€œAI çš„å›ç­”â€ï¼š</span><br><span class="hljs-string">1. å¦‚æœæ„æ€ä¸€è‡´ï¼ˆå³ä½¿æªè¾ä¸åŒï¼‰ï¼Œè¯„ä¸º &quot;CORRECT&quot;ã€‚</span><br><span class="hljs-string">2. å¦‚æœæ„æ€ä¸ä¸€è‡´æˆ– AI å›ç­”é”™è¯¯ï¼Œè¯„ä¸º &quot;INCORRECT&quot;ã€‚</span><br><span class="hljs-string"></span><br><span class="hljs-string">è¯·åªè¾“å‡ºè¯„çº§ç»“æœï¼ˆCORRECT æˆ– INCORRECTï¼‰ï¼Œä¸è¦è¾“å‡ºå…¶ä»–å†…å®¹ã€‚</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br>eval_prompt = ChatPromptTemplate.from_template(eval_prompt_template)<br><br><span class="hljs-comment"># 4.2 æ„å»ºè£åˆ¤é“¾</span><br>eval_chain = eval_prompt | llm | StrOutputParser()<br><br><span class="hljs-comment"># 4.3 å‡†å¤‡è¯„ä¼°è¾“å…¥æ•°æ®</span><br><span class="hljs-comment"># æˆ‘ä»¬éœ€è¦æŠŠ query, real_answer, predicted_answer ç»„åˆåœ¨ä¸€èµ·ä¼ ç»™è£åˆ¤</span><br>eval_inputs = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(test_dataset)):<br>    item = test_dataset[i]<br>    <br>    <span class="hljs-comment"># --- æ ¸å¿ƒä¿®æ”¹å¼€å§‹ ---</span><br>    <span class="hljs-comment"># ä½¿ç”¨ .get() æ–¹æ³•ï¼Œå¦‚æœæ‰¾ä¸åˆ° &#x27;query&#x27; å°±æ‰¾ &#x27;é—®é¢˜&#x27;ï¼Œå†æ‰¾ä¸åˆ°å°±æ‰¾ &#x27;question&#x27;</span><br>    <span class="hljs-comment"># åªè¦æ‰¾åˆ°ä¸€ä¸ªéç©ºçš„ï¼Œå°±ä¼šèµ‹å€¼ç»™ q_text</span><br>    q_text = item.get(<span class="hljs-string">&quot;query&quot;</span>) <span class="hljs-keyword">or</span> item.get(<span class="hljs-string">&quot;é—®é¢˜&quot;</span>) <span class="hljs-keyword">or</span> item.get(<span class="hljs-string">&quot;question&quot;</span>)<br>    <br>    <span class="hljs-comment"># åŒç†ï¼Œå¤„ç†ç­”æ¡ˆå¯èƒ½çš„ä¸åŒé”®å (&#x27;answer&#x27;, &#x27;æ ‡å‡†ç­”æ¡ˆ&#x27;, &#x27;ç­”æ¡ˆ&#x27;)</span><br>    a_text = item.get(<span class="hljs-string">&quot;answer&quot;</span>) <span class="hljs-keyword">or</span> item.get(<span class="hljs-string">&quot;æ ‡å‡†ç­”æ¡ˆ&quot;</span>) <span class="hljs-keyword">or</span> item.get(<span class="hljs-string">&quot;ç­”æ¡ˆ&quot;</span>)<br>    <span class="hljs-comment"># --- æ ¸å¿ƒä¿®æ”¹ç»“æŸ ---</span><br><br>    <span class="hljs-comment"># å¦‚æœä¸‡ä¸€è¿˜æ˜¯æ²¡å–åˆ°ï¼Œç»™ä¸ªæç¤ºæˆ–è€…ç©ºå­—ç¬¦ä¸²ï¼Œé˜²æ­¢æŠ¥é”™ä¸­æ–­</span><br>    <span class="hljs-keyword">if</span> q_text <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>: q_text = <span class="hljs-string">&quot;Error: æœªæ‰¾åˆ°é—®é¢˜æ–‡æœ¬&quot;</span><br>    <span class="hljs-keyword">if</span> a_text <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>: a_text = <span class="hljs-string">&quot;Error: æœªæ‰¾åˆ°ç­”æ¡ˆæ–‡æœ¬&quot;</span><br><br>    eval_inputs.append(&#123;<br>        <span class="hljs-string">&quot;query&quot;</span>: q_text,<br>        <span class="hljs-string">&quot;real_answer&quot;</span>: a_text,<br>        <span class="hljs-string">&quot;predicted_answer&quot;</span>: predicted_answers[i]<br>    &#125;)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âœ… å·²å‡†å¤‡å¥½ <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(eval_inputs)&#125;</span> æ¡è¯„ä¼°æ•°æ®ã€‚&quot;</span>)<br><span class="hljs-comment"># æ‰“å°ç¬¬ä¸€æ¡æ£€æŸ¥ä¸€ä¸‹æ˜¯å¦æå–æ­£ç¡®</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æ£€æŸ¥ç¬¬ä¸€æ¡æ•°æ® -&gt; é—®é¢˜: <span class="hljs-subst">&#123;eval_inputs[<span class="hljs-number">0</span>][<span class="hljs-string">&#x27;query&#x27;</span>][:<span class="hljs-number">20</span>]&#125;</span>... | ç­”æ¡ˆ: <span class="hljs-subst">&#123;eval_inputs[<span class="hljs-number">0</span>][<span class="hljs-string">&#x27;real_answer&#x27;</span>][:<span class="hljs-number">20</span>]&#125;</span>...&quot;</span>)<br><br><span class="hljs-comment"># 4.4 æ‰¹é‡è¯„ä¼°</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\næ­£åœ¨è¿›è¡Œè‡ªåŠ¨åŒ–è¯„ä¼°...&quot;</span>)<br>graded_outputs = eval_chain.batch(eval_inputs)<br><br><span class="hljs-comment"># 4.5 æ‰“å°æœ€ç»ˆæŠ¥å‘Š</span><br><span class="hljs-comment"># 4.5 æ‰“å°æœ€ç»ˆæŠ¥å‘Š</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n====== è¯„ä¼°æŠ¥å‘Š ======&quot;</span>)<br><br><span class="hljs-comment"># æ³¨æ„ï¼šè¿™é‡Œæˆ‘ä»¬éå†çš„æ˜¯å·²ç»æ¸…æ´—è¿‡çš„ eval_inputsï¼Œè€Œä¸æ˜¯åŸå§‹çš„ test_dataset</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(eval_inputs)):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ğŸ“ æ¡ˆä¾‹ <span class="hljs-subst">&#123;i+<span class="hljs-number">1</span>&#125;</span>:&quot;</span>)<br>    <br>    <span class="hljs-comment"># âŒ ä¿®æ”¹å‰ï¼šç›´æ¥è¯»åŸå§‹æ•°æ®ï¼Œä¼šæŠ¥é”™</span><br>    <span class="hljs-comment"># print(f&quot;Q: &#123;test_dataset[i][&#x27;query&#x27;]&#125;&quot;)</span><br>    <span class="hljs-comment"># print(f&quot;æ ‡å‡†ç­”æ¡ˆ: &#123;test_dataset[i][&#x27;answer&#x27;]&#125;&quot;)</span><br>    <br>    <span class="hljs-comment"># âœ… ä¿®æ”¹åï¼šè¯»æˆ‘ä»¬æ¸…æ´—è¿‡çš„æ•°æ® (eval_inputs)ï¼Œè¿™é‡Œè‚¯å®šæœ‰ &#x27;query&#x27; å’Œ &#x27;real_answer&#x27;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Q: <span class="hljs-subst">&#123;eval_inputs[i][<span class="hljs-string">&#x27;query&#x27;</span>]&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æ ‡å‡†ç­”æ¡ˆ: <span class="hljs-subst">&#123;eval_inputs[i][<span class="hljs-string">&#x27;real_answer&#x27;</span>]&#125;</span>&quot;</span>)<br>    <br>    <span class="hljs-comment"># AI çš„å›ç­” (ä» predicted_answers æˆ– eval_inputs é‡Œå–éƒ½å¯ä»¥)</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;AI å›ç­”: <span class="hljs-subst">&#123;eval_inputs[i][<span class="hljs-string">&#x27;predicted_answer&#x27;</span>]&#125;</span>&quot;</span>)<br>    <br>    <span class="hljs-comment"># æ ¹æ®ç»“æœæ˜¾ç¤ºä¸åŒé¢œè‰² (ç»¿è‰²é€šè¿‡ï¼Œçº¢è‰²å¤±è´¥)</span><br>    grade = graded_outputs[i].strip()<br>    <br>    <span class="hljs-comment"># ç®€å•çš„é¢œè‰²ä»£ç </span><br>    color = <span class="hljs-string">&quot;\033[92m&quot;</span> <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;CORRECT&quot;</span> <span class="hljs-keyword">in</span> grade <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;\033[91m&quot;</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;è¯„çº§: <span class="hljs-subst">&#123;color&#125;</span><span class="hljs-subst">&#123;grade&#125;</span>\033[0m&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;-&quot;</span> * <span class="hljs-number">30</span>)<br></code></pre></td></tr></table></figure>

<pre><code class="hljs">âœ… å·²å‡†å¤‡å¥½ 7 æ¡è¯„ä¼°æ•°æ®ã€‚
æ£€æŸ¥ç¬¬ä¸€æ¡æ•°æ® -&gt; é—®é¢˜: é«˜æ¸…ç”µè§†æœºæ€ä¹ˆè¿›è¡ŒæŠ¤ç†ï¼Ÿ... | ç­”æ¡ˆ: ä½¿ç”¨å¹²å¸ƒæ¸…æ´ã€‚...

æ­£åœ¨è¿›è¡Œè‡ªåŠ¨åŒ–è¯„ä¼°...

====== è¯„ä¼°æŠ¥å‘Š ======
ğŸ“ æ¡ˆä¾‹ 1:
Q: é«˜æ¸…ç”µè§†æœºæ€ä¹ˆè¿›è¡ŒæŠ¤ç†ï¼Ÿ
æ ‡å‡†ç­”æ¡ˆ: ä½¿ç”¨å¹²å¸ƒæ¸…æ´ã€‚
AI å›ç­”: ä¸ºäº†æŠ¤ç†é«˜æ¸…ç”µè§†æœºï¼Œå»ºè®®ä½¿ç”¨å¹²å¸ƒè¿›è¡Œæ¸…æ´ã€‚é¿å…ä½¿ç”¨æ¹¿å¸ƒæˆ–ä»»ä½•å¯èƒ½å«æœ‰æ°´åˆ†çš„æ¸…æ´å·¥å…·ï¼Œä»¥é˜²æ­¢æ°´åˆ†è¿›å…¥ç”µè§†æœºå†…éƒ¨é€ æˆæŸåã€‚
è¯„çº§: [92mCORRECT[0m
------------------------------
ğŸ“ æ¡ˆä¾‹ 2:
Q: æ—…è¡ŒèƒŒåŒ…æœ‰å†…å¤–è¢‹å—ï¼Ÿ
æ ‡å‡†ç­”æ¡ˆ: æœ‰ã€‚
AI å›ç­”: æ ¹æ®æè¿°ï¼Œæ—…è¡ŒèƒŒåŒ…ç¡®å®æœ‰å¤šä¸ªå®ç”¨çš„å†…å¤–è¢‹ï¼Œè¿™ä½¿å¾—å®ƒèƒ½å¤Ÿè½»æ¾è£…ä¸‹æ‚¨çš„å¿…éœ€å“ã€‚
è¯„çº§: [92mCORRECT[0m
------------------------------
ğŸ“ æ¡ˆä¾‹ 3:
Q: è¿™æ¬¾å…¨è‡ªåŠ¨å’–å•¡æœºçš„ä¸­å‹å°ºå¯¸æ˜¯å¤šå°‘ï¼Ÿ
æ ‡å‡†ç­”æ¡ˆ: 11.5&#39;&#39; x 15.2&#39;&#39;
AI å›ç­”: è¿™æ¬¾å…¨è‡ªåŠ¨å’–å•¡æœºçš„ä¸­å‹å°ºå¯¸æ˜¯11.5&#39;&#39; x 15.2&#39;&#39;ã€‚
è¯„çº§: [92mCORRECT[0m
------------------------------
ğŸ“ æ¡ˆä¾‹ 4:
Q: è¿™æ¬¾ç”µåŠ¨ç‰™åˆ·çš„å°ºå¯¸æ˜¯å¤šå°‘ï¼Ÿ
æ ‡å‡†ç­”æ¡ˆ: é«˜åº¦ï¼š9.5&#39;&#39;ï¼Œå®½åº¦ï¼š1&#39;&#39;ã€‚
AI å›ç­”: è¿™æ¬¾ç”µåŠ¨ç‰™åˆ·çš„å°ºå¯¸æ˜¯é«˜åº¦ï¼š9.5è‹±å¯¸ï¼Œå®½åº¦ï¼š1è‹±å¯¸ã€‚
è¯„çº§: [92mCORRECT[0m
------------------------------
ğŸ“ æ¡ˆä¾‹ 5:
Q: æ¯ç›’æ©™å‘³ç»´ç”Ÿç´ Cæ³¡è…¾ç‰‡å«æœ‰å¤šå°‘ç‰‡ï¼Ÿ
æ ‡å‡†ç­”æ¡ˆ: æ¯ç›’å«æœ‰20ç‰‡ã€‚
AI å›ç­”: æ¯ç›’æ©™å‘³ç»´ç”Ÿç´ Cæ³¡è…¾ç‰‡å«æœ‰20ç‰‡ã€‚
è¯„çº§: [92mCORRECT[0m
------------------------------
ğŸ“ æ¡ˆä¾‹ 6:
Q: å•ä¸ªæ— çº¿è“ç‰™è€³æœºçš„å°ºå¯¸æ˜¯å¤šå°‘ï¼Ÿ
æ ‡å‡†ç­”æ¡ˆ: å•ä¸ªè€³æœºå°ºå¯¸ï¼š1.5&#39;&#39; x 1.3&#39;&#39;ã€‚
AI å›ç­”: å•ä¸ªæ— çº¿è“ç‰™è€³æœºçš„å°ºå¯¸æ˜¯1.5&#39;&#39; x 1.3&#39;&#39;ã€‚
è¯„çº§: [92mCORRECT[0m
------------------------------
ğŸ“ æ¡ˆä¾‹ 7:
Q: ç‘œä¼½å«çš„å°ºå¯¸æ˜¯å¤šå°‘ï¼Ÿ
æ ‡å‡†ç­”æ¡ˆ: 24&#39;&#39; x 68&#39;&#39;ã€‚
AI å›ç­”: ç‘œä¼½å«çš„å°ºå¯¸æ˜¯24&#39;&#39; x 68&#39;&#39;ã€‚å¯¹äºé˜²æ»‘ç‘œä¼½å«ï¼Œå…¶å°ºå¯¸æ˜¯72&#39;&#39; x 24&#39;&#39;ã€‚
è¯„çº§: [92mINCORRECT[0m
------------------------------
</code></pre>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/AI%E4%B8%8E%E6%8A%80%E6%9C%AF/" class="category-chain-item">AIä¸æŠ€æœ¯</a>
  
  
    <span>></span>
    
  <a href="/categories/AI%E4%B8%8E%E6%8A%80%E6%9C%AF/%E5%90%B4%E6%81%A9%E8%BE%BE%E9%9D%A2%E5%90%91%E5%BC%80%E5%8F%91%E8%80%85%E7%9A%84%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%89%8B%E5%86%8C3%E4%BD%BF%E7%94%A8LangChain%E5%BC%80%E5%8F%91%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F/" class="category-chain-item">å´æ©è¾¾é¢å‘å¼€å‘è€…çš„å¤§æ¨¡å‹æ‰‹å†Œ3ä½¿ç”¨LangChainå¼€å‘åº”ç”¨ç¨‹åº</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Prompt/" class="print-no-link">#Prompt</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>å´æ©è¾¾é¢å‘å¼€å‘è€…çš„å¤§æ¨¡å‹æ‰‹å†Œ3ä½¿ç”¨LangChainå¼€å‘åº”ç”¨ç¨‹åº</div>
      <div>https://py0909.github.io/2025/10/02/AIä¸æŠ€æœ¯/å´æ©è¾¾é¢å‘å¼€å‘è€…çš„å¤§æ¨¡å‹æ‰‹å†Œ3ä½¿ç”¨LangChainå¼€å‘åº”ç”¨ç¨‹åº/å´æ©è¾¾é¢å‘å¼€å‘è€…çš„å¤§æ¨¡å‹æ‰‹å†Œ3ä½¿ç”¨LangChainå¼€å‘åº”ç”¨ç¨‹åº/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>ä½œè€…</div>
          <div>Peng Yue</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>å‘å¸ƒäº</div>
          <div>2025å¹´10æœˆ2æ—¥</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>è®¸å¯åè®®</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - ç½²å">
                    <i class="iconfont icon-cc-by"></i>
                  </span>
                </a>
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="NC - éå•†ä¸šæ€§ä½¿ç”¨">
                    <i class="iconfont icon-cc-nc"></i>
                  </span>
                </a>
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
                  <span class="hint--top hint--rounded" aria-label="SA - ç›¸åŒæ–¹å¼å…±äº«">
                    <i class="iconfont icon-cc-sa"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2025/10/02/AI%E4%B8%8E%E6%8A%80%E6%9C%AF/%E5%90%B4%E6%81%A9%E8%BE%BE%E9%9D%A2%E5%90%91%E5%BC%80%E5%8F%91%E8%80%85%E7%9A%84%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%89%8B%E5%86%8C2%E6%90%AD%E5%BB%BA%E5%9F%BA%E4%BA%8EChatGPT%E7%9A%84%E9%97%AE%E7%AD%94%E7%B3%BB%E7%BB%9F/%E5%90%B4%E6%81%A9%E8%BE%BE%E9%9D%A2%E5%90%91%E5%BC%80%E5%8F%91%E8%80%85%E7%9A%84%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%89%8B%E5%86%8C2%E6%90%AD%E5%BB%BA%E5%9F%BA%E4%BA%8EChatGPT%E7%9A%84%E9%97%AE%E7%AD%94%E7%B3%BB%E7%BB%9F/" title="å´æ©è¾¾é¢å‘å¼€å‘è€…çš„å¤§æ¨¡å‹æ‰‹å†Œ2æ­å»ºåŸºäºChatGPTçš„é—®ç­”ç³»ç»Ÿ">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">å´æ©è¾¾é¢å‘å¼€å‘è€…çš„å¤§æ¨¡å‹æ‰‹å†Œ2æ­å»ºåŸºäºChatGPTçš„é—®ç­”ç³»ç»Ÿ</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2025/10/02/AI%E4%B8%8E%E6%8A%80%E6%9C%AF/%E5%90%B4%E6%81%A9%E8%BE%BE%E9%9D%A2%E5%90%91%E5%BC%80%E5%8F%91%E8%80%85%E7%9A%84%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%89%8B%E5%86%8C4%E4%BD%BF%E7%94%A8LangChain%E8%AE%BF%E9%97%AE%E4%B8%AA%E4%BA%BA%E6%95%B0%E6%8D%AE/%E5%90%B4%E6%81%A9%E8%BE%BE%E9%9D%A2%E5%90%91%E5%BC%80%E5%8F%91%E8%80%85%E7%9A%84%E5%A4%A7%E6%A8%A1%E5%9E%8B%E6%89%8B%E5%86%8C4%E4%BD%BF%E7%94%A8LangChain%E8%AE%BF%E9%97%AE%E4%B8%AA%E4%BA%BA%E6%95%B0%E6%8D%AE/" title="å´æ©è¾¾é¢å‘å¼€å‘è€…çš„å¤§æ¨¡å‹æ‰‹å†Œ4ä½¿ç”¨LangChainè®¿é—®ä¸ªäººæ•°æ®">
                        <span class="hidden-mobile">å´æ©è¾¾é¢å‘å¼€å‘è€…çš„å¤§æ¨¡å‹æ‰‹å†Œ4ä½¿ç”¨LangChainè®¿é—®ä¸ªäººæ•°æ®</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>ç›®å½•</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <span>Peng Yue</span> <i class="iconfont icon-love"></i> <span>Product Manager</span> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        æ€»è®¿é—®é‡ 
        <span id="busuanzi_value_site_pv"></span>
         æ¬¡
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        æ€»è®¿å®¢æ•° 
        <span id="busuanzi_value_site_uv"></span>
         äºº
      </span>
    
    

  

</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/5.0.0/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
